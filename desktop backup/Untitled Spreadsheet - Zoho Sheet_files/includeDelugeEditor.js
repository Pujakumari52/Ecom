var DRE={initComplete:false};DRE.Constants={baseUrl:"https://dre.zoho.com",staticUrl:{js:"https://js.zohostatic.com/dre",css:"https://css.zohostatic.com/dre"},buildLabel:"DRE_HOTFIX_BRANCH_Dec_19_2018"};var DRELoader=function(){};function dreArrayContains(c,b){if(c&&b){var e=b.toLowerCase();for(var d in c){if(c.hasOwnProperty(d)){var a=c[d];a=a.toLowerCase();if(a===e){return a}}}}return null}DRELoader.prototype={require:function(a,d,c){this.loadCount=0;this.totalRequired=a.length;this.callback=d;for(var b=0;b<a.length;b++){if(c){this.writeScript(a[b])}else{this.writeStyle(a[b])}}},loaded:function(a){this.loadCount++;if(this.loadCount==this.totalRequired&&typeof this.callback=="function"){this.callback.call()}},writeScript:function(d){var a=this;var c=document.createElement("script");c.type="text/javascript";c.async=true;c.src=d;if(c.addEventListener){c.addEventListener("load",function(f){a.loaded(f)},false)}else{if(c.attachEvent){c.attachEvent("onload",function(f){a.loaded(f)})}}var b=document.getElementsByTagName("head")[0];if(c!=null){b.appendChild(c)}},writeStyle:function(d){var a=this;var c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=d;c.async=true;if(c.addEventListener){c.addEventListener("load",function(f){a.loaded(f)},false)}else{if(c.attachEvent){if(document.createStyleSheet){document.createStyleSheet(c.href)}}}var b=document.getElementsByTagName("head")[0];b.appendChild(c)}};var initDelugeEditor=(function(){var b=DRE.Constants;var h={css:[b.staticUrl.css+"/"+b.buildLabel+"/css/codemirror.css",b.staticUrl.css+"/"+b.buildLabel+"/css/dre.css"],parentJS:[b.staticUrl.js+"/"+b.buildLabel+"/js/codemirror.js"],js:[b.staticUrl.js+"/"+b.buildLabel+"/js/dre.js"]};var f=false;var c=false;if(!d()){var e=new DRELoader();c=true;e.require(h.css,function(){e.require(h.parentJS,function(){e.require(h.js,function(){DRE.initComplete=true;f=true;var k=document.getElementById("delugeEditorArea");if((k&&k.getAttribute("auto-init")==="true")){j()}},true)},true)},false)}function d(){if(typeof(CodeMirror)!="undefined"&&typeof(DelugeEditorWrapper)!="undefined"){return true}return false}function j(p,n){n=n?n:{};if(d()){var q=p?p:document.getElementById("delugeEditorArea");if(q){var r=n.hasOwnProperty("loading")&&n.loading;r&&g(n.loading,true);var l=null;if(q.querySelector("#delugeCodeArea")){delugeEditor.setOptions(n);return null}else{n.constants=DRE.Constants;l=new DelugeEditorWrapper(q,n);a(l);delugeEditor=l}var o=q.getAttribute("preventWarning");if(o==null||o==""){o=false}k(l);if(n&&n.hasOwnProperty("callback")){n.callback(l)}r&&g(n.loading,false);return l}}else{var m=setInterval(function(){if(c==true&&f==true){clearInterval(m);n.hasOwnProperty("loading")&&g(n.loading,false);j(p,n)}else{n.hasOwnProperty("loading")&&g(n.loading,true)}},700)}function k(t){if(window.attachEvent){window.attachEvent("onbeforeunload",s)}else{if(window.addEventListener){window.addEventListener("beforeunload",s)}}function s(w){var u=delugeEditor.delugeArea.className;var v=document.getElementsByClassName(u);if(v.length>0&&t.isEditorContentModified()){w.returnValue="false"}}}}function a(l){var m=l.delugeArea;if(m){m.addEventListener("keydown",k,true)}function k(o){var n=o.keyCode||o.which;var p=o.ctrlKey&&!o.shiftKey&&!o.altKey&&!o.metaKey;if(p&&n==32){l.editor.execCommand("autocomplete");o.stopImmediatePropagation();o.stopPropagation();o.preventDefault()}}m.addEventListener("DOMNodeRemovedFromDocument",function(){m.removeEventListener("keyup",k,true)})}function g(l,k){if(l){if(k==true&&(!l.hasOwnProperty("shown")||l.shown==false)){l.show();l.shown=true}else{l.hide()}}}return j}());function fetchServiceForms(b,a){jQuery.ajax({type:"POST",url:DRE.Constants.baseUrl+"/getUserSchema",data:{scopeID:b},dataType:"json",beforeSend:function(c){lockRequest=true}}).done(function(c){appCache={services:c}})}function fetchConnectionNames(a,c){var b=a.scopeID;c()}function changeStatus(b,a){jQuery("#newstatusmessage").css("visibility","");if(a){jQuery("#newstatusmessage").attr("class","script-status-error");jQuery("#newstatusmessage").html(b)}else{jQuery("#newstatusmessage").attr("class","script-status-success");jQuery("#newstatusmessage").html(b)}}function showSaveStatus(b){var a=JSON.parse(b);if(a){if(a.status=="success"){changeStatus("Script Saved...")}else{changeStatus(a.message,true)}}else{changeStatus("Unable to save script",true)}}function initializeDelugeEditor(b,a){return initDelugeEditor(b,a)}function showResponse(b){var a=JSON.parse(b);jQuery("#newstatusmessage").css("visibility","");if(a){changeStatus(a.message);if(a.status=="success"){jQuery("#output-container").css("visibility","");jQuery("#output").html(a.result)}else{jQuery("#output-container").css("visibility","hidden")}}else{changeStatus("Unable to execute script",true)}}var dreConnectionUrls={css:[DRE.Constants.staticUrl.css+"/"+DRE.Constants.buildLabel+"/css/connections.css"],js:[DRE.Constants.staticUrl.js+"/"+DRE.Constants.buildLabel+"/js/connections.js"]};var isDreConnectionLoaded=false;function includeDREConnections(b,e,d,c){c=c||{};c.constants=DRE.Constants;if(!isDreConnectionLoaded){if(c&&c.hasOwnProperty("loading")){c.loading.shown=true;c.loading.show()}var a=new DRELoader();a.require(dreConnectionUrls.js,function(){a.require(dreConnectionUrls.css,function(){isDreConnectionLoaded=true;DREConnections.init(b,e,d,c)},false)},true)}else{DREConnections.init(b,e,d,c)}}var ExecutionLogs=new function(){this.serviceName=null;this.sharedBy=null;this.initialTime=null;this.setData=function(e,d,c){if(this.initialTime==null){jQuery(".execution-log").scroll(function(f){if((jQuery(".execution-log").scrollTop()+jQuery(".execution-log").height())>=jQuery(".execution-log")[0].scrollHeight){if(processing){return false}else{ExecutionLogs.fetchExecutionLogs();return false}}})}this.serviceName=e;this.sharedBy=d;this.initialTime=c};processing=false;var b=false;this.fetchExecutionLogs=function(){var c=DRE.Constants.baseUrl;if(!b){processing=true;a(true);jQuery.ajax({url:c+"/dre/executionLogs",type:"POST",async:"true",data:{serviceName:this.serviceName,sharedBy:this.sharedBy,initialTime:this.initialTime},success:function(e){var d=jQuery(".execution-log");if(e&&e.length>16){d.append(e)}else{b=true}a(false);processing=false}})}};function a(c){var d=jQuery("#executionLogsLoading");var e=jQuery(".execution-log");if(c){e.append(d);d.show()}else{d.hide();jQuery(".dre-execution-logs").append(d)}}};var dreVersion=(function(){function b(k,h,j){var g=k.delugeArea;var m=document.createElement("div");m.setAttribute("class","dre-test-popup");var l=document.createElement("div");l.setAttribute("class","dre-popup-freeze");var n={sharedBy:h,functionID:k.functionId,serviceName:j};m.innerHTML="<div class='dre-version dre-version-loading'><div class='version-header'><span class='dre-v-header-msg'>Version History</span><span class='dre-v-close'></span></div> <div class='no-version-msg'><div class='version-msg'>Loading...</div></div> </div>";g.appendChild(l);document.getElementById("delugeEditorArea").appendChild(m);m.querySelector(".dre-v-close").addEventListener("click",function(){a()});ajaxCall(DRE.Constants.baseUrl+"/deluge/versions","GET",n,f,true,true);function f(s){var r=document.querySelector(".dre-test-popup");if(r){r.innerHTML=s;var q=r.querySelector("#latestVersionScript");if(q){var p=document.getElementById("versionScript");e(p,q.innerText);q.parentElement.removeChild(q)}var o=r.querySelectorAll(".dre-version .version-list .version");o.forEach(function(t){t.addEventListener("click",function(){var u=r.querySelector(".dre-version .version-list .version.active");if(u!=null){u.className="version"}t.className="version active";c(h,t.getAttribute("fid"),t.getAttribute("version"))})});r.querySelector(".dre-v-close").addEventListener("click",function(){a()})}}}function d(f){document.addEventListener("keydown",function(k){var j=k.which||k.keyCode;if(j==27){var g=f;if(g){var h=g.querySelector(".dre-test-popup");if(h){a()}}}})}function c(j,f,h){var k=document.getElementById("versionScript");var l={sharedBy:j,functionID:f,version:h};var g=DRE.Constants.baseUrl;ajaxCall(g+"/versionScript","GET",l,function(m){e(k,m)},true,true)}function e(g,h){h=h.substr(h.indexOf("{")+2);h=h.substr(0,h.lastIndexOf("}"));var f=DelugeUtil.renderScript(h);g.innerHTML=f.outerHTML+"<div class='dre-v-replace'><input type='button' id='dreVReplace' class='dre-v-button' value='Replace With this'/></div><textarea id='dreVReplaceScript' style='display:none;'>"+h+"</textarea>";CodeMirror.runMode(h,"text/deluge",g.querySelector("pre"));g.querySelector("#dreVReplace").addEventListener("click",function(){delugeEditor.setEditorContent(g.querySelector("#dreVReplaceScript").value);a()})}function a(){var g=document.querySelector(".dre-test-popup");var f=document.querySelector(".dre-popup-freeze");if(g&&f){g.parentElement.removeChild(g);f.parentElement.removeChild(f)}}return{trigger:b,bindDocumentEvent:d}})();var DREGalleryFunction=function(){var l=null;var d="";var j=null;var c="";var f=null;var p=null;var q=null;var m={};var k=[];var o=null;this.showMessageBox=function(t,r,w){if(l==null){l=JSON.parse(document.getElementById("responseJson").value);j=l.functionsList;d=l.domainName;o=document.getElementById("dreContainer");f=o.querySelector("#dreMessageBox");p=document.getElementById("blackOverlay");var v=document;if(typeof v.addEventListener!="undefined"){v.addEventListener("keydown",function(C){if(C.keyCode==27){e()}},false)}else{if(typeof v.attachEvent!="undefined"){v.attachEvent("onkeydown",function(C){if(C.keyCode==27){e()}})}}finishElem=f.querySelector("#finishInstallBtn");finishElem.addEventListener("click",function(){var E=(JSON.parse(JSON.stringify(j[c])));E.galleryFunctionId=c;for(var D in k){if(k.hasOwnProperty(D)){var C=k[D];E.params[D].value=f.querySelector("#dre-g-arg-"+C).value}}E.moduleName=f.querySelector("#dreAddFunctionModule").value;galleryFunction.install(E);e()});moduleDiv=f.querySelector("#dreAddFunctionModule");moduleDiv.addEventListener("change",function(){n()});closeElem=f.querySelectorAll(".gbutton-inputs .cancel");for(i=0;i<closeElem.length;++i){closeElem[i].addEventListener("click",e)}}var s=false;var y=f.querySelector("#dreFunctionDetails");var u=f.querySelector("#dreAddFunctionFormDiv");if(y.style.display=="block"){s=true;y.className+=" animate-dre-function-desc";setTimeout(function(){y.style.display="none";y.className="brief-gfunction-desc g-row g-clear"},200)}if(u.style.display=="block"){u.className="gfunction-form";setTimeout(function(){u.style.display="none"},200)}if(r!=null){c=r}functionDetails=j[c];if(q&&q.hasOwnProperty("skipModuleAndArguments")&&q.skipModuleAndArguments){t="desc"}if(t=="desc"){y.querySelector("#dreFunctionTitle").textContent=functionDetails.displayName;y.querySelector("#dreFunctionDesc").textContent=functionDetails.description;y.querySelector("#addFuncNextBtn").value="Next";var A=functionDetails.logoUrl;A=d+(A!=null?A:"/svg/code.svg");if(w){y.querySelector("#addFuncNextBtn").setAttribute("onclick","galleryFunction.showMessageBox('addFunc',"+c+",true)")}else{y.querySelector("#addFuncNextBtn").setAttribute("onclick","galleryFunction.showMessageBox('addFunc')")}y.querySelector("#dreFunctionDescImage").innerHTML='<img src="'+A+'" />';if(w){y.className+=" animate-dre-function-desc";setTimeout(function(){y.style.display="block";y.className="brief-gfunction-desc g-row g-clear"},200)}else{k=[];y.style.display="block"}if(q&&q.hasOwnProperty("skipModuleAndArguments")&&q.skipModuleAndArguments){y.querySelector("#addFuncNextBtn").value="Finish";y.querySelector("#addFuncNextBtn").setAttribute("onclick","galleryFunction.install()")}}else{if(t=="addFunc"){if(typeof(w)=="undefined"){u.querySelector("#dreAddFunctionTitle").textContent=functionDetails.displayName;var x=u.querySelector("#showDescription");x.setAttribute("onclick","galleryFunction.showMessageBox('desc',"+c+",true)");var z=functionDetails.params;if(z&&z.length>0){var B=g(z);u.querySelector("#dreAddFunctionArgs").innerHTML=B;u.querySelector(".g-arguments").style.display="block"}else{u.querySelector(".g-arguments").style.display="none"}b()}if(s){u.style.display="block";setTimeout(function(){u.className+=" animate-dre-add-function"},200)}else{u.className+=" animate-dre-add-function";u.style.display="block"}}}f.style.display="block";setTimeout(function(){f.className="animate-msg-box"},100);p.style.display="block";setTimeout(function(){if(t=="desc"){y.querySelector("#addFuncNextBtn").focus()}else{if(t=="addFunc"){u.querySelector("#dreAddFunctionModule").focus()}}},200);a(y,u)};this.setModuleList=function(t){m={};for(var v in t){if(t.hasOwnProperty(v)){var u=t[v];var s={};for(var r in u){if(u.hasOwnProperty(r)){s[r]=u[r]}}m[u.moduleName]=s}}};this.refresh=function(){l=null};var n=function(){if(q&&q.hasOwnProperty("skipArguments")&&q.skipArguments){return}var s=o.querySelector("#dreAddFunctionModule").value;var r=m[s];if(r){var t=r.fields;if(!t){t=typeof(this.moduleOnChangeEvent)=="function"&&this.moduleOnChangeEvent(r,this.createFieldsOption)}else{h(t)}}};var h=function(v){var x="";x="<option/>Select Field</option>";if(v&&v!=null){for(var u in v){if(v.hasOwnProperty(u)){var z=v[u];if(z.hasOwnProperty("groupName")&&z.hasOwnProperty("fields")){var y=z.groupName;var w=z.fields;x+='<optgroup label="'+y+'">';for(var s in w){if(w.hasOwnProperty(s)){var t=w[s];x+='<option value="'+t.fieldName+'"/>'+t.displayName+"</option>"}}x+="</optgroup>"}else{if(z.hasOwnProperty("fieldName")&&z.hasOwnProperty("displayName")){x+='<option value="'+z.fieldName+'"/>'+z.displayName+"</option>"}}}}}for(var u in k){if(k.hasOwnProperty(u)){var r=k[u];var A=o.querySelector("#dre-g-arg-"+r);A.innerHTML=x}}};function b(){if(m){var v=m;var t=Object.keys(v).length;var u="",w=o.querySelector("#dreAddFunctionModule");u="<option/>Select Module</option>";for(var s in v){if(v.hasOwnProperty(s)){var r=v[s];u+='<option value="'+s+'"/>'+r.displayName+"</option>"}}w.innerHTML="";w.innerHTML=u}}function g(r){var s="";k=[];for(var t in r){if(r.hasOwnProperty(t)){var u=r[t];k.push(u.name);s+='<div class=" arg-inputs g-row g-clear "><div class="label-div g-col-1-2"><label >'+u.name+' </label></div><div class="g-col-1-2"><div class="g-dropdown"><select id="dre-g-arg-'+u.name+'"><option>Select Field</option></select>  </div></div></div>'}}return s}var e=function(){f.className="";setTimeout(function(){o.querySelector("#dreFunctionDetails").setAttribute("style","display:none");o.querySelector("#dreAddFunctionFormDiv").setAttribute("style","display:none");f.setAttribute("style","display:none");p.setAttribute("style","display:none");o.querySelector("#dreAddFunctionFormDiv").setAttribute("class","gfunction-form");o.querySelector("#dreFunctionDetails").setAttribute("class","brief-gfunction-desc g-row g-clear")},250)};this.setOptions=function(r){q=r};function a(u,t){if(q){if(q.hasOwnProperty("skipModule")&&q.skipModule){var s=t.querySelector(".dre-g-module");s.style.display="none";if(q.hasOwnProperty("moduleName")&&q.moduleName){t.querySelector("#dreAddFunctionModule").value=q.moduleName}n()}else{if(q.hasOwnProperty("skipArguments")&&q.skipArguments){var r=t.querySelector(".dre-g-arguments");r.style.display="none"}}}}};var galleryFunction=new DREGalleryFunction();