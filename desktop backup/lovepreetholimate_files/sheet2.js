function fillCellRange(){isCellRange()?(cellRange=getCellRange(),startR=cellRange.startRow,startC=cellRange.startCol,endR=cellRange.endRow,endC=cellRange.endCol):(startR=endR=ActiveCellInfo.getStartRow(),startC=endC=ActiveCellInfo.getStartCol())}function fetchRowHeights(){var e="";return e}function clearFormatting(e,t,r,o,a){clearBorder(e,t,r,o,a),clearFormat(e,t,r,o),setBorderValue(e,t,r,o,"remove")}function clearFormat(e,t,r,o){var a=new Range(e,t,r,o),l=a.getIterator();l.iterate(function(e,t){new Cell(e,t).executeMethod(setDefaultFormatForCell,e,t)});var n=new Range(r,t,r,o),s=n.getIterator();s.iterate(function(e,t){var r=new Cell(e,t);r.executeMethod(function(r){var o=getCell(e+1,t);o&&o.style.backgroundColor&&(r.style.borderBottom="1px solid transparent")})});var d=new Range(e,o,r,o),i=d.getIterator();i.iterate(function(e,t){var r=new Cell(e,t);r.executeMethod(function(r){var o=getCell(e,t+1);o&&o.style.backgroundColor&&(r.style.borderRight="1px solid transparent")})})}function applyNumberFormat(e,t,r,o,a,l){for(var n=Row.getAvailableRowsInRange(e,r),s=0,d=n.length;d>s;s++){rowIndex=n[s];for(var i=r;o>=i;i++)new Cell(rowIndex,i).executeMethod(setOrRemoveFormatAttr,a,l)}}function setFormatforCell(e,t,r,o,a){if(null!=e&&isObject(e)&&isStr(t)&&isBoolean(r)&&isStr(o))if(r)e.className=e.className.replace(t,"");else{var l=e.className;if(-1==l.indexOf(t)&&(l+=t,e.className=l,isUndefined(a)&&(a=""),"textAlign"==o)){var n=isRTL?/( (fa|ta)[lc])(\b)/i:/( (fa|ta)[rc])(\b)/i;(n.test(l)||-1!=l.indexOf(" W"))&&addFlexBoxDiv(cell,a)}}}function setOrRemoveFormatAttr(e,t,r){e&&("STANDARD"==t?e.removeAttribute("format"):"PERCENT"==t?r.is(":checked")?e.setAttribute("format",t):e.setAttribute:e.setAttribute("format",t))}function setStyleValue(e,t,r){r=0;var o=ActiveCellInfo.getStartRow(),a=ActiveCellInfo.getStartCol(),l=getCell(o,a);if(l){var n=l.className;if(e==ActionConstants.BOLD||e==ActionConstants.ITALIC){var s=getCSSStyleRegex(t);-1==n.search(s)&&(r=1)}else e==ActionConstants.UNDERLINE&&-1==n.search("tdu")&&-1==n.search("tdsu")?r=1:e==ActionConstants.STRIKETHROUGH&&-1==n.search("tdst")&&-1==n.search("tdsu")?r=1:e==ActionConstants.FORMAT_PERCENT&&"PERCENT"!=l.getAttribute("format")&&(r=1)}else $("#"+t).is(":checked")&&(r=1);format_new(e,t,r)}function format_new(e,t,r,o,a,l,n,s){if((e||t)&&(!jsPUBLIC_VIEW||PUBLIC_EDIT_MODE)){if("undefined"==typeof o?fillCellRange():(startR=o,startC=a,endR=l,endC=n),ProtectedRanges.isRangeLocked(startR,startC,endR,endC))return void ProtectedRanges.resetMenuItem("#"+t);var d,i,c=$("#"+t);if(0!=c.length&&(i=$(c).metadata().appData.dynamic),"userFormat"==t?t=$("#"+t).zcombo("getValue"):"currency"==t&&(t=$("#"+t).attr("currencyType")),"DOLLAR"==t||"CURRENCY"==t||"PERCENT"==t||"STANDARD"==t||"YEN"==t||"EURO"==t||"POUND"==t||"RUPEE"==t||"NONE"==t||"TEXT"==t||"RMB"==t||i){var C;if(!$(c).metadata().appData.dynamic)for(var f=["CURRENCY","DOLLAR","YEN","EURO","POUND","RUPEE","PERCENT","TEXT","RMB","STANDARD"],R=0;R<f.length;R++)t==f[R]&&(C=USERCURRENCY=f[R]);if($(c).metadata().appData.dynamic){{$(c).metadata().appData.arg.split(",")}C=t}var u=getObj("currency"),b=(u.getAttribute("currencyType"),$(r).children("span:first").text());isUndefined(r)||("PERCENT"!=t&&(appEvent.trigger("setCurrencyFormat",[b]),$("#currency").children("span:first").text($(r).children("span:first").text())),isUndefined($(u).metadata().appData.dynamic)||"PERCENT"==t||(C=t,u.setAttribute("currencyType",USERCURRENCY),changetooltip(u,$(r).data().metadata.label))),i&&u.setAttribute("currencyType",t);var p=$("#"+t);("NONE"==t||e==ActionConstants.FORMAT_PERCENT&&0==r)&&(C="STANDARD",e=ActionConstants.FORMAT_CURRENCY),p.next().hasClass("ui-state-active")||"PERCENT"!=t?"PERCENT"==t&&$("#PERCENT").next().addClass("ui-state-active"):"PERCENT"==t&&$("#PERCENT").next().removeClass("ui-state-active");var g=getViewPortRoundedDetails(startR,endR);g.isInViewPort&&applyNumberFormat(g.startRowIdx,g.endRowIdx,startC,endC,C,p),g.isInFreezedRange&&applyNumberFormat(g.freezedStartRowIdx,g.freezedEndRowIdx,startC,endC,C,p);var S=getServerRange(startR,startC,endR,endC);return void submitCellValueFormat(1*e,C,startR,startC,S.endRow,S.endCol)}var d=getCell(startR,startC),b="",m="",v=0,y=!1;if(!jsGADGET_VIEW)switch(t){case"bold":case"italic":case"strike":case"underline":}switch(t){case"bold":m=ActionConstants.BOLD,b=" fwb",1==r?(y=!1,v=1):(y=!0,v=0),jsGADGET_VIEW&&(d&&-1!=d.className.indexOf(" fwb")?(y=!0,v=0):(y=!1,v=1)),isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"fontWeight",v);break;case"italic":m=ActionConstants.ITALIC,b=" fsi",1==r?(y=!1,v=1):(y=!0,v=0),jsGADGET_VIEW&&(d&&-1!=d.className.indexOf(" fsi")?(y=!0,v=0):(y=!1,v=1)),isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"fontStyle",v);break;case"strike":m=ActionConstants.STRIKETHROUGH,b=" tdst",1==r?(y=!1,v=1):(y=!0,v=0),jsGADGET_VIEW&&(d&&-1!=d.className.indexOf(" tdst")?(y=!0,v=0):(y=!1,v=1)),isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"strikeThrough",v);break;case"underline":m=ActionConstants.UNDERLINE,b=" tdu",1==r?(y=!1,v=1):(y=!0,v=0),jsGADGET_VIEW&&(d&&-1!=d.className.indexOf(" tdu")?(y=!0,v=0):(y=!1,v=1)),isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"textDecoration",v);break;case"fontFace":m=ActionConstants.FONTFAMILY,v="undefined"==typeof r?$("#"+t).zcombo("getValue"):r,isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"fontFamily",v);break;case"fontSize":m=ActionConstants.FONTSIZE,v="undefined"==typeof r?$("#"+t).zcombo("getValue"):r,isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"fontSize",v);break;case"vtop":m=ActionConstants.VALIGN,v="top",isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"verticalAlign",v);break;case"vcenter":m=ActionConstants.VALIGN,v="middle",isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"verticalAlign",v);break;case"vbottom":m=ActionConstants.VALIGN,v="bottom",isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"verticalAlign",v);break;case"left":m=ActionConstants.HALIGN,v="start",isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"textAlign",v);break;case"center":m=ActionConstants.HALIGN,v="center",isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"textAlign",v);break;case"right":m=ActionConstants.HALIGN,v="end",isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"textAlign",v);break;case"bgcolor":m=ActionConstants.COLOR;var E=getObj(t).childNodes[0];if("undefined"==typeof r)var v=E.style.borderBottomColor;else var v=r;BACKGROUNDCOLOR=v,E.style.borderBottomColor=v,isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"backgroundColor",v);break;case"fontcolor":"default"==r&&(r="rgb(0,0,0)"),m=ActionConstants.TEXTCOLOR;var E=$("#"+t).children("span:first");if(isUndefined(r))var v=E.css("border-bottom-color");else var v=r;FONTCOLOR=v,E.css({"border-bottom-color":v}),isUpdateClientFirst&&updateRangeFormat(startR,startC,endR,endC,"color",v)}var S=getServerRange(startR,startC,endR,endC),h=startR,A=startC,O=S.endRow,T=S.endCol;if(startR==endR&&startC==endC){var w=ActiveCellInfo,B=w.getStartRow(),I=w.getStartCol(),F=w.getEndRow(),x=w.getEndCol();B==startR&&I==startC&&(h=B,A=I,O=F,T=x)}if("hide"==getCellContent(currCell,"fn")&&jsPUBLIC_VIEW&&!showFormulas)return void resetGlobalVariables();var N=new RequestParameters(m);N.setParameters(WorkSheets.getAssociatedActiveSheetName(),h,A,O,T,v);var k=new AjaxRequest;k.init("POST",N.getURL(),!0,N.getParametersAsString()),actionManager.addRequest(k),"false"==s&&(sheetdialog.close(),"FONTFAMILY"==m&&$("#fontFace").blur(),"FONTSIZE"==m&&$("#fontSize").blur(),focusSheet())}}function removeStyle(e,t,r,o,a){var l=new Range(t,r,o,a),n=l.getIterator();n.iterate(function(t,r){new Cell(t,r).executeMethod(removeStyle1,e)}),"backgroundColor"==e&&setBorderValue(t,r,o,a,"remove")}function removeStyle1(e,t){null!=e&&"null"!=e&&(e.style[t]=""),"backgroundColor"==t&&("transparent"==e.style.borderRightColor&&(e.style.borderRight=""),"transparent"==e.style.borderBottomColor&&(e.style.borderBottom=""))}function currentCellPreview(e){var t="",r=currCell;currCell&&("bg_fill"==e.id?document.getElementById("ColorPreview").style.backgroundColor=null==r.style.backgroundColor||""==r.style.backgroundColor||"transparent"==r.style.backgroundColor?"rgb(255,255,255)":r.style.backgroundColor:"text_color"==e.id&&(document.getElementById("ColorPreview").style.backgroundColor=null==r.style.color||""==r.style.color?"rgb(0,0,0)":"transparent"==r.style.color?"rgb(255,255,255)":r.style.color));var o=document.getElementById("ColorPreview").style.backgroundColor;if(-1==o.indexOf("#")){var a=o.substring(o.indexOf("(")+1,o.indexOf(")")),l=a.split(",");t=d2h(l[0].trim()),t+=d2h(l[1].trim()),t+=d2h(l[2].trim()),document.getElementById("ColorHex").value="#"+t,document.getElementById("ColorPreview").style.backgroundColor="#"+t}else document.getElementById("ColorHex").value=o,document.getElementById("ColorPreview").style.backgroundColor=o}function d2h(e){for(var t="0123456789ABCDEF",r=t.substr(15&e,1);e>15;)e>>=4,r=t.substr(15&e,1)+r;return 1==r.length&&(r="0"+r),r}function init_format(e){if(!jsGADGET_VIEW&&isHomeToolbarLoaded&&getObj("homeTab")&&e&&e){var t=ActiveCellInfo.getFormat(),r=ActiveCellInfo._getFormat(e);r.bolded!=t.bolded&&checkCurrFrmt("formatData","bolded","bold",TOOLBAR.HOME),r.italicized!=t.italicized&&checkCurrFrmt("formatData","italicized","italic",TOOLBAR.HOME),r.striked!=t.striked&&checkCurrFrmt("formatData","striked","strike",TOOLBAR.HOME);{$("#formatData")}r.underlined!==t.underlined&&checkCurrFrmt("formatData","underlined","underline",TOOLBAR.HOME);{var o=$("#wraptext");$("#formatCellsAlignment")}if(r.wrapped!=t.wrapped){var o=$("#wraptext");o.metadata().appData.status=r.wrapped?!0:!1,checkCurrFrmt("formatCellsAlignment","wrapped","wraptext",TOOLBAR.HOME)}var a=t?t.fontFamily:void 0;r.fontFamily===a&&r.fontFamily||checkFont($("#fontFace"),e);var l=t?t.fontSize:void 0;r.fontSize===l&&r.fontSize||checkFont($("#fontSize"),e);var n=function(){r.PERCENT!=t.PERCENT&&checkCurrFrmt("formatCellsNumber","PERCENT","PERCENT",TOOLBAR.FORMAT),r.hasSeparator!=t.hasSeparator&&checkCurrFrmt("formatCellsNumber","hasSeparator","comma",TOOLBAR.FORMAT)};menutabListener.doAction(TOOLBAR.FORMAT,{id:"formattw",action:"enable",callback:n});var s=document.getElementById("reviewTab");if(s&&"block"==s.style.display){var d=r.hasComment;d?toggleElements(["editcomment","removecomment"],["addcomment"],!0,"cellComment"):toggleElements(["editcomment","removecomment"],["addcomment"],!1,"cellComment")}ActiveCellInfo.resetFormat(r)}}function checkCurrFrmt(e,t,r,o){var a=ActiveCellInfo._getFormat(currCell);a[t]?menutabListener.doAction(o,{id:r,action:"enable",callback:applyStyle_zbutton,args:[e,"check",r]}):menutabListener.doAction(o,{id:r,action:"enable",callback:applyStyle_zbutton,args:[e,"uncheck",r]})}function getDDIndex(e,t){var r=-1;if($(e.selector).each(function(){$("option",this).each(function(e){this.value.toLowerCase()==t.toLowerCase()&&(r=e)})}),-1==r){var o=check($(e.selector),t);r=o?o:$(e.selector+" option").length-1}return r}function check(e,t){var r=$(e.selector).children(),o="",a=1,l=!1,n=e.attr("id");t=t.replace(/\'/g,"").replace(/\"/g,""),"fontSize"===n&&(t=parseFloat(t));for(var s=0;s<=r.length;s++)if(o=$(r[s]).val(),o==t){a=s,l=!0;break}if("fontSize"===n){var d=function(e,t){$(e).zcombo("setSelectedIndex",t)};menutabListener.doAction(TOOLBAR.HOME,{id:"fontSize",action:"setSelectedIndex",callback:d,args:[e.selector,a]})}if(l)return a;var i=new Option(t,t,!0,!0);i.selected=!0,"fontSize"===n?$(i).css("fontSize",t):$(i).css("fontFamily",t),$(e).append(i);var d=function(e){$(e).zcombo("refresh")};menutabListener.doAction(TOOLBAR.HOME,{id:"fontFace",action:"refresh",callback:d,args:[e]})}function checkFont(e,t){var r,o=t.className,a=[" f8"," f9"," f10"," f11"," f12"," f14"," f16"," f18"," f20"," f24"," f22"," f26"," f28"," f32"," f40"," f48"," f56"," f64"," f72"];switch(e.attr("id")){case"fontSize":var l=getCSSStyleRegex("fontSize").exec(o);null!=l&&(r=l[0]);var n=e.children();if(isUndefined(r))null===t.style.fontSize||""===t.style.fontSize?menutabListener.doAction(TOOLBAR.HOME,{id:"fontSize",action:"selectedIndex",callback:applyStyle_zCombo_with_fn,args:[e.attr("id"),"setValue",defultFontSize]}):check(e,t.style.fontSize);else for(var s=0,d=a.length;d>s;s++)if(getOnlyNumber(r)==$(n[s]).text()){menutabListener.doAction(TOOLBAR.HOME,{id:"fontSize",action:"selectedIndex",callback:applyStyle_zCombo_with_fn,args:[e.attr("id"),"setSelectedIndex",s]});break}break;case"fontFace":var l=getCSSStyleRegex("fontFamily").exec(o);if(null!=l&&(r=l[0]),r)menutabListener.doAction(TOOLBAR.HOME,{id:"fontSize",action:"selectedIndex",callback:applyStyle_zCombo_with_fn,args:[e.attr("id"),"setSelectedIndex",getDDIndex(e,UI.CSSClassFontNamesMap[r.trim()])]});else{var i=t.style.fontFamily,c=i.replace(/\'/g,"").replace(/\"/g,"");null==i||""==i?menutabListener.doAction(TOOLBAR.HOME,{id:"fontSize",action:"selectedIndex",callback:applyStyle_zCombo_with_fn,args:[e.attr("id"),"setSelectedIndex",getDDIndex(e,defultFontName)]}):-1!=getDDIndex(e,c)?menutabListener.doAction(TOOLBAR.HOME,{id:"fontSize",action:"selectedIndex",callback:applyStyle_zCombo_with_fn,args:[e.attr("id"),"setValue",c]}):check(e,c)}}}function cellwrap(){wraptext("wraptext"),sheetdialog.close()}function wraptext(e,t,r,o,a,l){$("#"+e);"undefined"==typeof l&&(l="false"),"undefined"==typeof t?fillCellRange():(startR=t,startC=r,endR=o,endC=a);var n;n=$("#wraptext").metadata().appData.status?0:1,applyWrap(startR,startC,endR,endC,n,l)}function applyWrap(e,t,r,o,a){if(ProtectedRanges.isRangeLocked(e,t,r,o))return!1;var l=getViewPortRoundedDetails(e,r);isUpdateClientFirst&&(l.isInViewPort&&setWrapPropertyForCellRange(l.startRowIdx,l.endRowIdx,t,o,a),l.isInFreezedRange&&setWrapPropertyForCellRange(l.freezedStartRowIdx,l.freezedEndRowIdx,t,o,a));var n=getServerRange(startR,startC,endR,endC),s=startR,d=startC,i=n.endRow,c=n.endCol;if(startR==endR&&startC==endC){var C=ActiveCellInfo,f=C.getStartRow(),R=C.getStartCol(),u=C.getEndRow(),b=C.getEndCol();f==startR&&R==startC&&(s=f,d=R,i=u,c=b)}var p=new RequestParameters(ActionConstants.WRAP);p.setParameters(WorkSheets.getAssociatedActiveSheetName(),s,d,i,c,a);var g=new AjaxRequest;g.init("POST",p.getURL(),!0,p.getParametersAsString()),actionManager.addRequest(g)}function setWrapPropertyForCellRange(e,t,r,o,a){for(var l=Row.getAvailableRowsInRange(e,t),n=0,s=l.length;s>n;n++){rowIndex=l[n];for(var d=r;o>=d;d++)new Cell(rowIndex,d).executeMethod(setWrapPropertyForCellRange1,a)}}function setWrapPropertyForCellRange1(e,t){null!=e&&"null"!=e&&(1==t?isCellWrapped(e)||wrapCell(e):isCellWrapped(e)&&unWrapCell(e))}function setWidthThroughJson(e){if(isStr(e)&&""!=e){var t=JSON.parse(e);updateWidthJson(t)}}function updateWidthJson(e){if(void 0!=e[0].sc)var t=e[0].sc;for(var r in e)"undefined"!=typeof e[r]&&"undefined"!=typeof e[r].sc&&setSheetColumnsWidth(e[r].sc,e[r].ec,parseInt(e[r].v));t>=0&&ole.shiftObjects("WIDTH",void 0,void 0,t),isCellFieldSPANHided()||setCellFieldSPANWidth(getColWidth(currCol))}function clearBorder(e,t,r,o,a){"undefined"==typeof e||"undefined"==typeof r||"undefined"==typeof t||"undefined"==typeof o?fillCellRange():(startR=e,endR=r,startC=t,endC=o),clearBorder1(void 0,a)}function clearBorder1(e,t){isUndefined(e)&&(e=sheetPaneId);var r,o,a,l=new Range(startR,startC,endR,endC),n=l.getIterator();n.addEventListener("onRowBefore",function(e,r,o,a,l){if(!t||t&&t.doNotSkipCoveredCells){var n=getCell(e,a-1),s=getCell(e,l+1);n&&(is_ie?(n.style.borderRightColor="",n.style.borderRightWidth="",n.style.borderRightStyle=""):n.style.borderRight="",removeCSSStyle("borderRight",n)),s&&(is_ie?(s.style.borderLeftColor="",s.style.borderLeftWidth="",s.style.borderLeftStyle=""):s.style.borderLeft="")}},e,startC,endC),n.iterate(function(l,n){if(r=getCell(l,n,e),void 0!=Merge.getCellInfo(l,n)&&!Merge.isCovered(l,n)){var s=getCell(l,n,e,!0);s.style.borderLeft="",s.style.borderRight="",s.style.borderTop="",s.style.borderBottom="",removeCSSStyle("borderRight",s),removeCSSStyle("borderBottom",s),clearCoveredCellsBorder(startR,startC,endR,endC,t)}null!=r&&"null"!=r&&(is_ie?(r.style.borderLeftColor="",r.style.borderRightColor="",r.style.borderTopColor="",r.style.borderBottomColor="",r.style.borderLeftWidth="",r.style.borderRightWidth="",r.style.borderTopWidth="",r.style.borderBottomWidth="",r.style.borderLeftStyle="",r.style.borderRightStyle="",r.style.borderTopStyle="",r.style.borderBottomStyle=""):(r.style.borderLeft="",r.style.borderRight="",r.style.borderTop="",r.style.borderBottom=""),removeCSSStyle("borderRight",r),removeCSSStyle("borderBottom",r)),void 0==Merge.getCellInfo(startR-1,n)&&(o=getCell(startR-1,n)),a=getCell(endR+1,n),null!=o&&"null"!=o&&(is_ie?(o.style.borderBottomColor="",o.style.borderBottomWidth="",o.style.borderBottomStyle=""):o.style.borderBottom="",removeCSSStyle("borderBottom",o)),null!=a&&"null"!=a&&(is_ie?(a.style.borderTopColor="",a.style.borderTopWidth="",a.style.borderTopStyle=""):a.style.borderTop="")},e)}function clearCoveredCellsBorder(e,t,r,o,a){var l=new Range(e,t,r,o),n=l.getIterator(a);n.addEventListener("onRowBefore",function(e,t,r,o,l){if(!a||a&&a.doNotSkipCoveredCells){var n=getCell(e,o-1),s=getCell(e,l+1);n&&(is_ie?(n.style.borderRightColor="",n.style.borderRightWidth="",n.style.borderRightStyle=""):n.style.borderRight="",removeCSSStyle("borderRight",n)),s&&(is_ie?(s.style.borderLeftColor="",s.style.borderLeftWidth="",s.style.borderLeftStyle=""):s.style.borderLeft="")}},paneId,t,o),n.iterate(function(t,o){aboveCell=getCell(e-1,o),belowCell=getCell(r+1,o),null!=aboveCell&&"null"!=aboveCell&&(is_ie?(aboveCell.style.borderBottomColor="",aboveCell.style.borderBottomWidth="",aboveCell.style.borderBottomStyle=""):aboveCell.style.borderBottom="",removeCSSStyle("borderBottom",aboveCell)),null!=belowCell&&"null"!=belowCell&&(is_ie?(belowCell.style.borderTopColor="",belowCell.style.borderTopWidth="",belowCell.style.borderTopStyle=""):belowCell.style.borderTop="")})}function drawBorder(e,t){var r=$(e);"borderBtn"!=r.attr("id")&&($("#borderBtn").children("span:first").removeAttr("class"),$("#borderBtn").children("span:first").addClass(r.children("span:first").children("span:first").attr("class"))),$("#menuitem_borderBtn").children("span:first").children("span:first").attr("class",r.children("span:first").children("span:first").attr("class")),"borderBtn"!=r.attr("id")&&$("#borderBtn").attr("bt",r.attr("bt")),isUndefined(t)&&(t=$("#borderBtn").attr("bt")),setBorder(t)}function setBorder(e,t,r,o,a,l,n,s){"undefined"==typeof s&&(s="false"),"undefined"==typeof o?fillCellRange():(startR=o,startC=a,endR=l,endC=n);var d=getServerRange(startR,startC,endR,endC),i=startR,c=startC,C=d.endRow,f=d.endCol;if(startR==endR&&startC==endC){var R=ActiveCellInfo,u=R.getStartRow(),b=R.getStartCol(),p=R.getEndRow(),g=R.getEndCol();u==startR&&b==startC&&(i=u,c=b,C=p,f=g)}if(e==ActionConstants.BORDER_INSIDE&&C-i==0&&f-c==0)return!1;if(ProtectedRanges.isRangeLocked(i,c,C,f))return!1;isUpdateClientFirst&&applyBorder(e,t,r,i,c,C,f),sheetdialog.close(),isRTL&&(13==e?e=14:14==e&&(e=13));var S=new RequestParameters(ActionConstants.BORDERS);S.setParameters(WorkSheets.getAssociatedActiveSheetName(),i,c,C,f,e);var m=new AjaxRequest;return m.init("POST",S.getURL(),!0,S.getParametersAsString()),actionManager.addRequest(m),!1}function applyBorder(e,t,r,o,a,l,n){("undefined"==typeof t||""==t)&&(26==e?t="4px double":29==e?t="2.5px solid":12!=e&&(t="1px solid")),12==e||"undefined"!=typeof r&&""!=r||(r="#000"),12==e&&(t="",r="");var s=getViewPortRoundedDetails(o,l);if(s.isInViewPort&&(setBorder1(e,t,r,s.startRowIdx,a,s.endRowIdx,n),FREEZED_COL>0&&setBorder1(e,t,r,s.startRowIdx,a,s.endRowIdx,n,sheetPane3Id)),s.isInFreezedRange)if(e==ActionConstants.BORDER_BOTTOM||e==ActionConstants.BORDER_BOTTOM_DOUBLE||e==ActionConstants.BORDER_BOTTOM_THICK)FREEZED_ROW>l&&(FREEZED_ROW>0&&setBorder1(e,t,r,s.freezedStartRowIdx,a,s.freezedEndRowIdx,n,sheetPane2Id),FREEZED_ROW>0&&FREEZED_COL>0&&setBorder1(e,t,r,s.freezedStartRowIdx,a,s.freezedEndRowIdx,n,sheetPane1Id));else if(e==ActionConstants.BORDER_TOP_BOTTOM||e==ActionConstants.BORDER_TOP_BOTTOM_DOUBLE||e==ActionConstants.BORDER_TOP_BOTTOM_THICK||e==ActionConstants.BORDER_OUTSIDE){var d=s.freezedEndRowIdx;l>=FREEZED_ROW-1&&(d=FREEZED_ROW-1),FREEZED_ROW>0&&setBorder1(e,t,r,s.freezedStartRowIdx,a,d,n,sheetPane2Id),FREEZED_ROW>0&&FREEZED_COL>0&&setBorder1(e,t,r,s.freezedStartRowIdx,a,d,n,sheetPane1Id)}else FREEZED_ROW>0&&setBorder1(e,t,r,s.freezedStartRowIdx,a,s.freezedEndRowIdx,n,sheetPane2Id),FREEZED_ROW>0&&FREEZED_COL>0&&setBorder1(e,t,r,s.freezedStartRowIdx,a,s.freezedEndRowIdx,n,sheetPane1Id),setBorder1(e,t,r,s.freezedStartRowIdx,a,s.freezedEndRowIdx,n)}function setBorder1(e,t,r,o,a,l,n,s){applyBorderType(e,t,r,o,a,l,n,s,isColSelected())}function updateBorderStylesForCell(e,t,r){if(null!=e&&"null"!=e){var o=t.prop,a=0,l=0;for(a=0,l=o.length;l>a;a++)e.style[o[a]]=r}}function applyBorderType(e,t,r,o,a,l,n,s,d){var i=t+" "+r;12==e&&(i="");var c,C,f,R,u;e=parseInt(e);var b=BorderTypes.right,p=BorderTypes.bottom,g=BorderTypes.bottomThick,S=BorderTypes.bottomDouble;switch(e){case ActionConstants.BORDER_NONE:for(var m=BorderTypes.removeRight,v=BorderTypes.removeBottom,y=BorderTypes.removeAll,E=Row.findNextNonHiddenRow(o,!1),h=(Row.findNextNonHiddenRow(l,!0),o);l>=h;h++){C=new Cell(h,a-1),C.executeMethod(updateBorderStylesForCell,m,i);for(var A=a;n>=A;A++){c=new Cell(h,A),c.executeMethod(updateBorderStylesForCell,y,i),R=new Cell(E,A),R.executeMethod(updateBorderStylesForCell,v,i);var O=getCell(h,A-1),T=getCell(h,A),w=getCell(h-1,A);T&&T.style.backgroundColor&&(w&&(w.style.borderBottom="1px solid transparent"),O&&(O.style.borderRight="1px solid transparent"),T.style.borderRight="1px solid transparent",T.style.borderBottom="1px solid transparent")}}break;case ActionConstants.BORDER_LEFT:if(isRTL){if(0!=a)for(var h=o;l>=h;h++)f=new Cell(h,n+1),f.executeMethod(updateBorderStylesForCell,b,i)}else if(0!=a)for(var h=o;l>=h;h++)C=new Cell(h,a-1),C.executeMethod(updateBorderStylesForCell,b,i);break;case ActionConstants.BORDER_RIGHT:if(isRTL){if(n<=getAvailableEndCol())for(var h=o;l>=h;h++){var c=new Cell(h,a);c.executeMethod(updateBorderStylesForCell,b,i)}}else if(n<=getAvailableEndCol())for(var h=o;l>=h;h++){var c=new Cell(h,n);c.executeMethod(updateBorderStylesForCell,b,i)}break;case ActionConstants.BORDER_LEFT_RIGHT:for(var h=o;l>=h;h++){var B=new Cell(h,a-1);B.executeMethod(updateBorderStylesForCell,b,i);var u=new Cell(h,n);u.executeMethod(updateBorderStylesForCell,b,i)}break;case ActionConstants.BORDER_TOP:if(0!=o)for(var E=Row.findNextNonHiddenRow(o,!1),I=a;n>=I;I++)R=new Cell(E,I),R.executeMethod(updateBorderStylesForCell,p,i);break;case ActionConstants.BORDER_BOTTOM:if(1!=d||getAvailableEndRow()==getRowMax()-1)for(var I=a;n>=I;I++)c=new Cell(l,I),c.executeMethod(updateBorderStylesForCell,p,i);break;case ActionConstants.BORDER_TOP_BOTTOM:var E=Row.findNextNonHiddenRow(o,!1);if(0!=o||1!=d||getAvailableEndRow()==getRowMax()-1)for(var I=a;n>=I;I++)(1!=d||getAvailableEndRow()==getRowMax()-1)&&(u=new Cell(l,I),u.executeMethod(updateBorderStylesForCell,p,i)),0!=o&&(R=new Cell(E,I),R.executeMethod(updateBorderStylesForCell,p,i));break;case ActionConstants.BORDER_OUTSIDE:if(isRTL)for(var I=o;l>=I;I++)u=new Cell(I,n+1),u.executeMethod(updateBorderStylesForCell,b,i),c=new Cell(I,a),c.executeMethod(updateBorderStylesForCell,b,i);else for(var I=o;l>=I;I++)u=new Cell(I,n),u.executeMethod(updateBorderStylesForCell,b,i),C=new Cell(I,a-1),C.executeMethod(updateBorderStylesForCell,b,i);if(1!=d||getAvailableEndRow()==getRowMax()-1)for(var E=Row.findNextNonHiddenRow(o,!1),F=a;n>=F;F++)u=new Cell(l,F),u.executeMethod(updateBorderStylesForCell,p,i),0!=o&&1!=d&&(R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i));break;case ActionConstants.BORDER_VERTICAL:if(isRTL)for(var I=o;l>=I;I++){n!=getColMax()&&(f=new Cell(I,n+1),f.executeMethod(updateBorderStylesForCell,b,i));for(var F=a;n>=F;F++)c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i)}else for(var I=o;l>=I;I++){0!=a&&(C=new Cell(I,a-1),C.executeMethod(updateBorderStylesForCell,b,i));for(var F=a;n>=F;F++)c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i)}break;case ActionConstants.BORDER_VERTICAL_OUTSIDE:for(var E=Row.findNextNonHiddenRow(o,!1),I=o;l>=I;I++)for(var F=a;n>=F;F++)C=new Cell(I,F-1),C.executeMethod(updateBorderStylesForCell,b,i),F==n&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i)),I==o&&(R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i)),I==l&&(u=new Cell(I,F),u.executeMethod(updateBorderStylesForCell,p,i));break;case ActionConstants.BORDER_HORIZONTAL:for(var E=Row.findNextNonHiddenRow(o,!1),I=o;l>=I;I++)for(var F=a;n>=F;F++)c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,p,i),0!=o&&I==o&&(R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i));break;case ActionConstants.BORDER_HORIZONTAL_OUTSIDE:if(isRTL)for(var I=o;l>=I;I++)for(var E=Row.findNextNonHiddenRow(I,!1),F=a;n>=F;F++)R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i),I==l&&(u=new Cell(I,F),u.executeMethod(updateBorderStylesForCell,p,i)),F==n&&(f=new Cell(I,F+1),f.executeMethod(updateBorderStylesForCell,b,i)),F==a&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i));else for(var I=o;l>=I;I++)for(var E=Row.findNextNonHiddenRow(I,!1),F=a;n>=F;F++)R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i),I==l&&(u=new Cell(I,F),u.executeMethod(updateBorderStylesForCell,p,i)),F==n&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i)),F==a&&(C=new Cell(I,F-1),C.executeMethod(updateBorderStylesForCell,b,i));break;case ActionConstants.BORDER_INSIDE:if(isRTL)for(var I=o;l>=I;I++)for(var F=a;n>=F;F++)I!=l&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,p,i)),F!=a&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i));else for(var I=o;l>=I;I++)for(var F=a;n>=F;F++)I!=l&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,p,i)),F!=n&&(c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i));break;case ActionConstants.BORDER_ALL:if(isRTL)for(var I=o;l>=I;I++)for(var E=Row.findNextNonHiddenRow(I,!1),F=a;n>=F;F++)R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i),c=new Cell(I,F),c.executeMethod(updateBorderStylesForCell,b,i),I==l&&(u=new Cell(I,F),u.executeMethod(updateBorderStylesForCell,p,i)),F==n&&(f=new Cell(I,F+1),f.executeMethod(updateBorderStylesForCell,b,i));else for(var I=o;l>=I;I++)for(var E=Row.findNextNonHiddenRow(I,!1),F=a;n>=F;F++)R=new Cell(E,F),R.executeMethod(updateBorderStylesForCell,p,i),C=new Cell(I,F-1),C.executeMethod(updateBorderStylesForCell,b,i),I==l&&(u=new Cell(I,F),u.executeMethod(updateBorderStylesForCell,p,i)),F==n&&(u=new Cell(I,F),u.executeMethod(updateBorderStylesForCell,b,i));break;case ActionConstants.BORDER_BOTTOM_DOUBLE:if(1!=d||getAvailableEndRow()==getRowMax()-1)for(var I=a;n>=I;I++)c=new Cell(l,I),c.executeMethod(updateBorderStylesForCell,S,i);break;case ActionConstants.BORDER_TOP_BOTTOM_DOUBLE:if(0!=o||1!=d||getAvailableEndRow()==getRowMax()-1)for(var I=a;n>=I;I++){if(0!=o){var E=Row.findNextNonHiddenRow(o,!1);R=new Cell(E,I),R.executeMethod(updateBorderStylesForCell,p,i)}if(1!=d||getAvailableEndRow()==getRowMax()-1){u=new Cell(l,I);var x=t;"1px solid"==t&&(x="4px double");var N=x+" "+r;u.executeMethod(updateBorderStylesForCell,S,N)}}break;case ActionConstants.BORDER_TOP_BOTTOM_THICK:if(0!=o||1!=d||getAvailableEndRow()==getRowMax()-1)for(var I=a;n>=I;I++){if(0!=o){var E=Row.findNextNonHiddenRow(o,!1);R=new Cell(E,I),R.executeMethod(updateBorderStylesForCell,p,i)}if(1!=d||getAvailableEndRow()==getRowMax()-1){u=new Cell(l,I);var x=t;"1px solid"==t&&(x="2.5px solid");var N=x+" "+r;u.executeMethod(updateBorderStylesForCell,g,N)}}break;case ActionConstants.BORDER_BOTTOM_THICK:if(1!=d||getAvailableEndRow()==getRowMax()-1)for(var I=a;n>=I;I++)c=new Cell(l,I),c.executeMethod(updateBorderStylesForCell,g,i);break;case ActionConstants.BORDER_ALL_LEFT:setBorder1(ActionConstants.BORDER_VERTICAL,t,r,o,a,l,n-1,s);break;case ActionConstants.BORDER_ALL_RIGHT:setBorder1(ActionConstants.BORDER_VERTICAL,t,r,o,a+1,l,n,s);break;case ActionConstants.BORDER_ALL_TOP:setBorder1(ActionConstants.BORDER_HORIZONTAL,t,r,o,a,l-1,n,s);break;case ActionConstants.BORDER_ALL_BOTTOM:setBorder1(ActionConstants.BORDER_HORIZONTAL,t,r,o+1,a,l,n,s);break;case ActionConstants.BORDER_INSIDE_VERTICAL:setBorder1(ActionConstants.BORDER_VERTICAL,t,r,o,a+1,l,n-1,s);break;case ActionConstants.BORDER_INSIDE_HORIZONTAL:setBorder1(ActionConstants.BORDER_HORIZONTAL,t,r,o+1,a,l-1,n,s)}}function insertDateOrTime(e){var t=new Date,r=parseInt(t.getMonth())+1,o=t.getDate(),a=t.getFullYear().toString(),l=t.getHours(),n=t.getMinutes(),s=t.getSeconds(),d=" "+timeFormat.AM_FORMAT;if(parseInt(r)<10&&(r="0"+r),parseInt(o)<10&&(o="0"+o),parseInt(n)<10&&(n="0"+n),parseInt(s)<10&&(s="0"+s),parseInt(l)>=12&&(d=" "+timeFormat.PM_FORMAT),a=a.substring(2,4),parseInt(l)<10&&(l="0"+l.toString()),"date"==e){var i=null;"MDY"===userDateFormatType&&(i=r+userDateSeparator+o+userDateSeparator+a),"DMY"===userDateFormatType&&(i=o+userDateSeparator+r+userDateSeparator+a),"YMD"===userDateFormatType&&(i=a+userDateSeparator+r+userDateSeparator+o)}else var i=l+":"+n+":"+s;focusCellField(cellField.value+i),submitCell()}function setSheetColumnsWidth(e,t,r){var o,a=0,l=0;if(!(FREEZED_COL>t)){e=FREEZED_COL>e?FREEZED_COL:e;var n=t;t>totCols-1&&(t=totCols-1);for(var s=e;t>=s;s++){var d=getColHead(s),i=getColWidth(s);a+=r-i,d.style.width=r+"px",s!=e?(l=o+r,shiftColHead(d,{mode:"CONST",val:l}),o=l):o=getColLeft(s)}if(setColDetails("RANGE",e,n,r),Merge.resizeDOM(e,n,"COLS"),ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.WIDTH,e),!(e>t)){for(var s=e;t>=s;s++){var c=getColHead(s),l=getColLeft(s);c.style[isRTL?"right":"left"]=l+"px",c.style.width=getColWidth(s)+"px"}shiftColHeads(t+1,totCols-1,{mode:"DIFF",val:0});ISFREEZED&&doSetSheetColumnsWidth(e,t,sheetPane2Id),doSetSheetColumnsWidth(e,t),ISFREEZED&&shiftCellsHorizontally(t+1,totCols-1,{mode:"DIFF",val:0},sheetPane2Id),shiftCellsHorizontally(t+1,totCols-1,{mode:"DIFF",val:0});var C=getColWidth(totCols-1)+getColLeft(totCols-1),f=ole.getObjectsByPositionX(getColLeft(e)),R=[];if(f.length>0){for(var s=0;s<f.length;s++){var u=parseInt(OLE[f[s].id].sColDiff),b=parseInt(OLE[f[s].id].sCol),i=parseInt(getColWidth(b)),l=parseInt(getColLeft(b));R[s]=u>i?l+i:l+u,ole.getCurrObj()&&ole.getCurrObj()._setSelectLayer(!0).positionActionBar()}hasOleMoved=!0}jsTHROWAWAY_VIEW||userPresence.tuneDivsWidth(e),focusSheet(),setSheetTableWidth(C),appEvent.trigger("grid.afterColumnResize",[e,t]),Filter.positionFilterIcons(e,!1),drawCols()}}}function doSetSheetColumnsWidth(e,t,r){isUndefined(r)&&(r=sheetPaneId);for(var o=(getAvailableTiles(r),getTilesCount(r)),a=0;o>a;a++){var l=getTile(a,r),n=getCellsInTile(l,r),s=FREEZED_COL,d=e;s&&(d=r==sheetPane1Id||r==sheetPane3Id?e:e-s);for(var i=e,c=d;t>=i;i++,c++){if(i!=e){var C=getColLeft(i);n[c].style[isRTL?"right":"left"]=C+"px"}if(n[c].style.width=getColWidth(i)+"px",!browser_ie){var f=n[c].className;(-1!=f.indexOf(" vab")||-1!=f.indexOf(" vam"))&&(featureSupport.boxAlign||(n[c].childNodes[0].style.width=getColWidth(i)+"px"))}}l.style.width=getColLeft(totCols-1)+getColWidth(totCols-1)+"px"}}function wrapCell(e){if(e){removeCSSStyle("wrapText",e);var t=e.className;t+=" W",e.className=t,e.style.overflow="hidden";var r=isRTL?/( (fa|ta)[lc])(\b)/i:/( (fa|ta)[rc])(\b)/i;if(!r.test(t)){var o=getCellInnerHTML(e);addFlexBoxDiv(e,o)}}}function unWrapCell(e){if(e){removeCSSStyle("wrapText",e);var t=e.className;t+=" nW",e.className=t,e.parentNode.className.indexOf("mCC")<0&&(e.style.overflow="visible");var r=/( (fa|ta)[rc])(\b)/i,o=e.getAttribute("hyper");r.test(t)||"multi"==o||removeFlexBoxDiv(e)}}function getMatchedCSSFontStyle(e){e=e.toUpperCase();var t="";if(isStr(e))switch(e){case"ARIAL BLACK":t=" fnab";break;case"ARIAL":t=" fnal";break;case"BOOK ANTIQUA":t=" fnba";break;case"CALIBRI":t=" fnci";break;case"COMIC SANS MS":t=" fncs";break;case"COURIER NEW":t=" fncn";break;case"GARAMOND":t=" fngd";break;case"GEORGIA":t=" fnga";break;case"LUCIDA CONSOLE":t=" fnlc";break;case"MS SANS SERIF":t=" fnms";break;case"MS GOTHIC":t=" fnmg";break;case"MS PGOTHIC":t=" fnmpg";break;case"MS MINCHO":t=" fnmm";break;case"MS P MINCHO":t=" fnmpm";break;case"MINGLIU":t=" fnml";break;case"SIMHEI":t=" fnsh";break;case"TAHOMA":t=" fnta";break;case"TIMES NEW ROMAN":t=" fntn";break;case"TREBUCHET MS":t=" fntms";break;case"VERDANA":t=" fnva";break;case"FANGSONG_GB2312":t=" fnfs";break;case"KAITI_GB2312":t=" fnkt";break;case"LISU":t=" fnls";break;case"SIMSUN":t=" fnss";break;case"NSIMSUN":t=" fnnss";break;case"YOUYUAN":t=" fnyy";break;case"SIMSUN (FOUNDER EXTENDED)":t=" fnssfe";break;case"FZSHUTI":t=" fnfzst";break;case"FZYAOTI":t=" fnfzy";break;case"STFANGSONG":t=" fnstf";break;case"STHUPO":t=" fnsth";break;case"STKAITI":t=" fnstk";break;case"STLITI":t=" fnstl";break;case"STSONG":t=" fnsts";break;case"STXINWEI":t=" fnstxw";break;case"STXIHEI":t=" fnstxh";break;case"STXINGKAI":t=" fnstxk";break;case"STZHONGSONG":t=" fnstz";break;case"MICROSOFT YAHEI":t=" fnmyh";break;case"STCAIYUN":t=" fnstc";break;case"GIST-TMOTCHANAKYA":t=" fntc";break;case"GIST-TMOTILANGO":t=" fnti";break;case"GIST-TMOTPATTINATHAR":t=" fntptn";break;case"GIST-TMOTPADMA":t=" fntp";break;case"GIST-TMOTKRISHNAN":t=" fntk";break;case"TSC_KANNADAASAN":t=" fntka";break;case"ANJAL":t=" fna";break;case"IMPACT":t=" fnit";break;case"ANDALE MONO":t=" fnam";break;case"PALATINO LINOTYPE":t=" fnpl";break;case"SYMBOL":t=" fnsl";break;case"WEBDINGS":t=" fnws";break;case"WEBDINGS 2":t=" fnws2";break;case"WEBDINGS 3":t=" fnws3"}return t}function getMatchedCSSFontSize(e){var t="";if(isNumber(e))switch(e){case 0:t=" f8";break;case 1:t=" f9";break;case 2:t=" f10";break;case 3:t=" f11";break;case 4:t=" f12";break;case 5:t=" f14";break;case 6:t=" f16";break;case 7:t=" f18";break;case 8:t=" f20";break;case 9:t=" f22";break;case 10:t=" f24";break;case 11:t=" f26"}return t}function removeCSSStyle(e,t){if(null!=t&&isStr(e)&&isObject(t)){var r=getCSSStyleRegex(e);r&&(t.className=t.className.replace(r,""))}}function getCSSStyleRegex(e){return UI.CSSClassNamePatterns[e]}function clearAll(e,t,r,o,a,l){1==l&&clearContents(e,t,r,o,null,!0),1==a&&clearFormatting(e,t,r,o),1==l&&clearContents(e,t,r,o,null,!0)}var cellRange,startR,startC,endR,endC,checkTextDeco=!1,isHomeToolbarLoaded=!1;appEvent.on("toolbar.home.load",function(){isHomeToolbarLoaded=!0,setTimeout(function(){PivotUtil.hideAndDisplayPivotTab(!0),init_format(currCell)},1e3)}),appEvent.on("update.rangeformat",$.debounce(500,function(){init_format(currCell)}));var BorderTypes={right:{prop:["borderRight"]},bottom:{prop:["borderBottom"]},bottomThick:{prop:["borderBottom"]},bottomDouble:{prop:["borderBottom"]},removeAll:{prop:["borderRight","borderBottom"],classname:[]},removeBottom:{prop:["borderBottom"],classname:[]},removeRight:{prop:["borderRight"],classname:[]}};
function getSourceRangeForCopyFormat(){isCellRange()?copyFormatRange=getCellRange():(copyFormatRange.startRow=ActiveCellInfo.getStartRow(),copyFormatRange.endRow=ActiveCellInfo.getEndRow(),copyFormatRange.startCol=ActiveCellInfo.getStartCol(),copyFormatRange.endCol=ActiveCellInfo.getEndCol()),isRowSelected()&&(copyFormatRange.endCol=getColMax()-1),isWholeSheetSelected()&&(copyFormatRange.endCol=getColMax()-1,copyFormatRange.endRow=getRowMax()-1),copyFormatRange.sheetName=sourceSheetname=CURRSHEETNAME,focusCellRangeFill(copyFormatRange.startRow,copyFormatRange.startCol,copyFormatRange.endRow,copyFormatRange.endCol)}function formatbrush(){var e=getObj("formatbrush");e.onclick=function(){fPainter.fPaintersingleclick||fPainter.fPainterdoubleclick?(fPainter.fPaintersingleclick=!1,fPainter.fPainterdoubleclick=!1,hideCellRangeFillDIV(),cursorchange(),firing=!1):firing||(firing=!0,fPainter.fPaintersingleclick=!0,cursorchange(),getSourceRangeForCopyFormat()),fPainter.singleclickpress||fPainter.singleclickpress||(fPainter.singleclickpress=!0,fPainter.fPainterdoubleclick=!1,setTimeout(function(){fPainter.singleclickpress=!1},500))},e.ondblclick=function(){fPainter.fPainterdoubleclick=!0,fPainter.fPaintersingleclick=!1,focusCellRangeFill(),cursorchange()},firing||(firing=!0,fPainter.fPaintersingleclick=!0,getSourceRangeForCopyFormat())}function copyFormatting(e){firing=!1;var t,a,n,o;if(isCellRange()){if(xRange=getCellRange(),t=xRange.startRow,a=xRange.startCol,n=xRange.endRow,o=xRange.endCol,isRowSelected()&&(o=xRange.endCol=getColMax()-1),isWholeSheetSelected()&&(o=getColMax()-1,n=getRowMax()-1),ActiveCellInfo.getStartRow()>0&&ActiveCellInfo.getStartCol()>0){if(cellRangeContainsMergeCells(xRange.startRow,xRange.startCol,xRange.endRow,xRange.endCol))return showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!1;if(ActiveCellInfo.isMerged())return showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!1}if(isPartOfArray(xRange.startRow,xRange.startCol,xRange.endRow,xRange.endCol)||containsAnyArray(xRange.startRow,xRange.startCol,xRange.endRow,xRange.endCol))return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),!1}else t=ActiveCellInfo.getStartRow(),a=ActiveCellInfo.getStartCol(),n=ActiveCellInfo.getStartRow()+(copyFormatRange.endRow-copyFormatRange.startRow),o=ActiveCellInfo.getStartCol()+(copyFormatRange.endCol-copyFormatRange.startCol),focusCellRange(ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),n,o,void 0,!0);if(isPartOfArray(ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),n,o)||containsAnyArray(ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),n,o))return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),!1;if(ActiveCellInfo.getStartRow()>0&&ActiveCellInfo.getStartCol()>0&&cellRangeContainsMergeCells(ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),n,o))return showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!1;if(ProtectedRanges.isRangeLocked(t,a,n,o))return!1;var r=WorkSheets.getSheetCodeFromName(sourceSheetname);if(void 0!=r){var i=new RequestParameters(ActionConstants.PASTESPECIAL_FORMATS);i.setParameters(WorkSheets.getAssociatedActiveSheetName(),copyFormatRange.startRow,copyFormatRange.startCol,copyFormatRange.endRow,copyFormatRange.endCol,r,t,a,n,o,sourceSheetname);var l=new AjaxRequest;l.init("POST",i.getURL(),!0,i.getParametersAsString()),actionManager.addRequest(l)}"dontPaste"!==e&&(fPainter.fPaintersingleclick?hideCellRangeFillDIV():copyFormatRange.sheetName==CURRSHEETNAME&&focusCellRangeFill(copyFormatRange.startRow,copyFormatRange.startCol,copyFormatRange.endRow,copyFormatRange.endCol,!0),fPainter.fPaintersingleclick&&(fPainter.fPaintersingleclick=!1,cursorchange()))}function applyFormatting(){appEvent.trigger("rangeEndSelect"),(fPainter.fPaintersingleclick||fPainter.fPainterdoubleclick)&&(isCopySelection=!1,copyFormatting(),cursorchange())}function cursorchange(){fPainter.fPaintersingleclick||fPainter.fPainterdoubleclick?(menutabListener.doAction(TOOLBAR.HOME,{id:"formatbrush",action:"enable",callback:applyStyle_addClass,args:["formatbrush","zbactive"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"sheet",action:"enable",callback:applyStyle_addClass,args:["sheet","fpCur"]})):(menutabListener.doAction(TOOLBAR.HOME,{id:"formatbrush",action:"disable",callback:applyStyle_removeClass,args:["formatbrush","zbactive"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"sheet",action:"disable",callback:applyStyle_removeClass,args:["sheet","fpCur"]}))}function exitFormatPainter(){(fPainter.fPainterdoubleclick||fPainter.fPaintersingleclick)&&(hideCellRangeFillDIV(),fPainter.fPainterdoubleclick=!1,fPainter.fPaintersingleclick=!1,cursorchange(),firing=!1)}var copyFormatRange={},fPainter={};fPainter.fPaintersingleclick=!1,fPainter.fPainterdoubleclick=!1;var xRange={},sourceSheetname,firing=!1;fPainter.singleclickpress=!1,appEvent.on("execute.OnGridAction",function(e,t){"gridaction"===e&&(fPainter.fPainterdoubleclick||fPainter.fPaintersingleclick)&&parseInt(t)!==ActionConstants.PASTESPECIAL_FORMATS&&exitFormatPainter()});
function createImageContextMenu(){var e=ole.getCurrObj().id,t=(parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.width+10),parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.height+10),[]);return t.push({data:"{label:'"+jsMsg.ResizeToOriginalSize+"', appData:{dynamic:true, callback: 'insertImage.resizeToOriginalDim', arg:'"+e+"'}}"}),t.push({mtype:"separator"}),allowExport&&(t.push({data:"{label:'"+jsMsg["Image.SaveImageAs"]+"', appData:{dynamic:true, callback: 'insertImage.downloadImage', arg:'"+e+"'}}"}),t.push({mtype:"separator"})),t.push({id:"imgclone",data:"{label:'"+jsMsg.Clone+"', appData:{dynamic:true, callback:'insertImage.onClone', arg: '"+e+"'}}"}),t.push({data:"{label:'"+jsMsg.ReplaceImage+"', appData:{dynamic:true, callback:'insertImage.replaceImage', arg: '"+e+"'}}"}),t.push({id:"imgdel",data:"{label:'"+jsMsg.Delete+"', appData:{dynamic:true, callback: 'ole.remove', arg:'"+e+",true'}}"}),t}function createButtonContextMenu(){var e=ole.getCurrObj().id,t=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.width+10),s=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.height+10),u=[];return u.push({id:"macroAssingext",data:"{label:'"+jsMsg["Button.AssignExistingMacro"]+"...', appData:{dynamic:true, callback: 'Button.showMacroList', arg:'"+ole.getCurrObj().id+"'}}"}),u.push({id:"macroAssignnew",data:"{submenu : '#assignmacrooptions', label:'"+jsMsg["Button.AssignNewMacro"]+"', appData:{ type : 'change'}}"}),u.push({data:"{label:'"+jsMsg["Button.EditLabel"]+"', appData:{dynamic:true, callback: 'Button.editLabel', arg:'"+e+"'}}"}),u.push({mtype:"separator"}),u.push({data:"{label:'"+jsMsg.Clone+"', appData:{dynamic:true, callback:'ole.currObj.clone', arg: '1,"+t+","+s+"'}}"}),u.push({data:"{label:'"+jsMsg.Delete+"', appData:{dynamic:true, callback: 'ole.remove', arg:'"+e+",true'}}"}),u}var zcontextmenu={menuItems:["CUT","COPY","PASTE","PASTE_SPECIAL","CLEAR","SEP1","INSERT","DELETE","COL_HEADER_INSERT","COL_HEADER_DELETE","COL_WIDTH","AUTOFIT_COL_WIDTH","ROW_HEADER_INSERT","ROW_HEADER_DELETE","ROW_HEIGHT","AUTOFIT_ROW_HEIGHT","FILTER","SORT","SEP2","EDIT_COMMENT","ADD_COMMENT","ADD_DISCUSSION","SEP3","NAME_THIS_CELL","FORMATCELLS","PIC_FROM_LIST","ADD_H_LINK","EDIT_H_LINK","REMOVE_H_LINK","PUBLISH_RANGE","PUBLISH_RANGE_ORG","SEP4","FREEZE","UNFREEZE","SEP5","PROTECT_RANGE","LOCK_UNLOCK_RANGE","PIVOT_BUILDER","SEP7","MOVE_PIVOT","REFRESH","DELETE_PIVOT","SEP8","ADD_DISCUSSION1"],subMenuItems:{insertSubMenu:["CELL_LEFT","CELL_RIGHT","CELL_ABOVE","SEP1","ROW_ABOVE","ROW_BELOW","SEP2","COL_BEFORE","COL_AFTER"],colInsertSubMenu:["COL_BEFORE","COL_AFTER","COPIED_COL_BEFORE","COPIED_COL_AFTER","CUT_COL_BEFORE","CUT_COL_AFTER"],rowInsertSubMenu:["ROW_ABOVE","ROW_BELOW","COPIED_ROW_ABOVE","COPIED_ROW_BELOW","CUT_ROW_ABOVE","CUT_ROW_BELOW"],deleteSubMenu:["CELL_RIGHT","CELL_LEFT","CELL_BELOW","SEP1","DELETE_ROW","DELETE_COL"],filterbySubMenu:["FILTER_BY_VALUE","FILTER_BY_CELL_COLOR","FILTER_BY_FONT_COLOR","SEP1","CLEAR_FILTER","REAPPLY"]},initGridRightClickMenu:function(e){var t=featurePermission.getPermission("contextmenu");if(!t||DR_SERVER||isPreview)return!1;sheetdialog.close(),sheetMenu.hideOpenedMenu();var s=1,u=1,n=!1;if(isCellRange()){var a=getCellRange();s=a.endRow-a.startRow+1,s-=Row.getHiddenRowCount(a.startRow,a.endRow),u=a.endCol-a.startCol+1,n=!0}var r=getCellRange().startRow,E=getCellRange().endRow,i=getCellRange().startCol,S=getCellRange().endCol;if($("#rmenu").zmenu("hideAllMenuItems"),"VERSION_VIEW"!=getViewType()&&!cdview&&"undefined"!=typeof Discussion&&Discussion.on&&this.changeMenuState(["ADD_DISCUSSION"],"SHOW"),!READ_WRITE||mask.isGridDiv($("#"+e)[0])||isReadOnlyViewMode||jsGADGET_VIEW)return void this.changeMenuState(["COPY"],"SHOW");if(jsEMBED_VIEW){var l=["COPY","SEP1","FILTER"];if(n&&l.push("SORT"),Filter.hasFilter&&0!==Filter.getInstance().appliedCols.length)if(this.changeSubMenuState("filterbySubMenu","REAPPLY","ENABLE"),currRow>=Filter.getInstance().range.sr&&currRow<=Filter.getInstance().range.er&&Filter.getInstance().appliedCols.contains(currCol)){var h='"'+getColHeadLabel(currCol+1)+'"';this.setSubMenuValue("filterbySubMenu","CLEAR_FILTER",replaceParams(jsMsg["Filter.Clear_Filter_From_Column"],new Array(h))),this.changeSubMenuState("filterbySubMenu","CLEAR_FILTER","ENABLE")}else this.changeSubMenuState("filterbySubMenu","CLEAR_FILTER","DISABLE"),this.setSubMenuValue("filterbySubMenu","CLEAR_FILTER",jsMsg["Filter.Clear_Filter"]);else this.changeSubMenuState("filterbySubMenu","REAPPLY","DISABLE"),this.changeSubMenuState("filterbySubMenu","CLEAR_FILTER","DISABLE"),this.setSubMenuValue("filterbySubMenu","CLEAR_FILTER",jsMsg["Filter.Clear_Filter"]);return void this.changeMenuState(l,"SHOW")}isCellEdited()&&submitCell();var o=pivot.Collection.isPivotRange();if(("fD"===e||"fD1"===e||"fD2"===e||"fD3"===e||"sheet"===e)&&o)return this.changeMenuState(["ADD_DISCUSSION"],"HIDE"),this.changeMenuState(["PIVOT_BUILDER","SEP7","MOVE_PIVOT","REFRESH","DELETE_PIVOT"],"SHOW"),void("undefined"!=typeof Discussion&&Discussion.on&&this.changeMenuState(["SEP8","ADD_DISCUSSION1"],"SHOW"));var l=["CUT","COPY","PASTE","PASTE_SPECIAL","CLEAR","SEP1","FORMATCELLS","NAME_THIS_CELL","SEP4","SEP2","SEP3"],M=[],C=[];if(!cdview){var b=ProtectedRanges.isRangeLocked(r,i,E,S,null,!0,!0)?"LOCK_UNLOCK_RANGE":"PROTECT_RANGE";writerCalenderWorkbook||!ProtectedRanges.showMenuEntry()||showChartWorbook||(l.push("SEP5"),l.push(b)),1==ProtectedRanges.showMenuEntry()&&0==ProtectedRanges.getObject().hasProtectedSheet(CURRSHEETNAME)?M.push(b):C.push(b)}var O=ClipRange.getClipObject(),_=ChartClipOperation.getClipObject();if(O.copyStatus||O.cutStatus||_.copyStatus||_.cutStatus?(M.push("PASTE"),O.cutStatus||_.cutStatus||_.copyStatus?C.push("PASTE_SPECIAL"):M.push("PASTE_SPECIAL")):(C.push("PASTE"),C.push("PASTE_SPECIAL")),gridView){var l=["CUT","COPY","PASTE","PASTE_SPECIAL","CLEAR"];return this.changeMenuState(l,"SHOW"),this.changeMenuState(C,"DISABLE"),void this.changeMenuState(M,"ENABLE")}if("sheet"!=e&&"fD"!=e&&"fD1"!=e&&"fD2"!=e&&"fD3"!=e||isRowSelected()||isColSelected()){if("rHT1"==e||"rHT"==e||isRowSelected()&&!isColSelected())l.push("ROW_HEADER_INSERT","ROW_HEIGHT"),isColSelected()||l.push("ROW_HEADER_DELETE"),s>1?(s=s.toString(),this.setSubMenuValue("rowInsertSubMenu","ROW_ABOVE",replaceParams(jsMsg.NoofRowsAbove,new Array(s))),this.setSubMenuValue("rowInsertSubMenu","ROW_BELOW",replaceParams(jsMsg.NoofRowsBelow,new Array(s))),this.setMenuValue("ROW_HEADER_DELETE",replaceParams(jsMsg.DeleteNoofRows,new Array(s)))):(this.setSubMenuValue("rowInsertSubMenu","ROW_ABOVE",jsMsg.RowAbove),this.setSubMenuValue("rowInsertSubMenu","ROW_BELOW",jsMsg.RowBelow),this.setMenuValue("ROW_HEADER_DELETE",jsMsg.DeleteRow)),O.insertCopyRows||O.insertCutRows?(this.changeSubMenuState("rowInsertSubMenu","ROW_ABOVE","HIDE"),this.changeSubMenuState("rowInsertSubMenu","ROW_BELOW","HIDE")):(this.changeSubMenuState("rowInsertSubMenu","ROW_ABOVE","SHOW"),this.changeSubMenuState("rowInsertSubMenu","ROW_BELOW","SHOW")),O.insertCopyRows?(this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_ABOVE","SHOW"),this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_BELOW","SHOW")):(this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_ABOVE","HIDE"),this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_BELOW","HIDE")),O.insertCopyRows&&!O.hasFilteredRows()?(this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_ABOVE","DISABLE"),this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_BELOW","DISABLE")):(this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_ABOVE","ENABLE"),this.changeSubMenuState("rowInsertSubMenu","COPIED_ROW_BELOW","ENABLE")),O.insertCutRows?(this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_ABOVE","SHOW"),this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_BELOW","SHOW")):(this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_ABOVE","HIDE"),this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_BELOW","HIDE")),O.insertCutRows&&!O.hasFilteredRows()?(this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_ABOVE","DISABLE"),this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_BELOW","DISABLE")):(this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_ABOVE","ENABLE"),this.changeSubMenuState("rowInsertSubMenu","CUT_ROW_BELOW","ENABLE")),O.clipHasMoreRows()?(O.insertCopyRows&&(this.setSubMenuValue("rowInsertSubMenu","COPIED_ROW_ABOVE",jsMsg["Insert.Copied.Rows.Above"]),this.setSubMenuValue("rowInsertSubMenu","COPIED_ROW_BELOW",jsMsg["Insert.Copied.Rows.Below"])),O.insertCutRows&&(this.setSubMenuValue("rowInsertSubMenu","CUT_ROW_ABOVE",jsMsg["Insert.Cut.Rows.Above"]),this.setSubMenuValue("rowInsertSubMenu","CUT_ROW_BELOW",jsMsg["Insert.Cut.Rows.Below"]))):(O.insertCopyRows&&(this.setSubMenuValue("rowInsertSubMenu","COPIED_ROW_ABOVE",jsMsg["Insert.Copied.Row.Above"]),this.setSubMenuValue("rowInsertSubMenu","COPIED_ROW_BELOW",jsMsg["Insert.Copied.Row.Below"])),O.insertCutRows&&(this.setSubMenuValue("rowInsertSubMenu","CUT_ROW_ABOVE",jsMsg["Insert.Cut.Row.Above"]),this.setSubMenuValue("rowInsertSubMenu","CUT_ROW_BELOW",jsMsg["Insert.Cut.Row.Below"])));else if("cHT"==e||"cHT1"==e||isColSelected()&&!isRowSelected()){l.push("COL_HEADER_INSERT","COL_WIDTH"),isRowSelected()||l.push("COL_HEADER_DELETE"),u>1?(u=u.toString(),this.setSubMenuValue("colInsertSubMenu","COL_BEFORE",replaceParams(jsMsg.NoofColumnsBefore,new Array(u))),this.setSubMenuValue("colInsertSubMenu","COL_AFTER",replaceParams(jsMsg.NoofColumnsAfter,new Array(u))),this.setMenuValue("COL_HEADER_DELETE",replaceParams(jsMsg.DeleteNoofColumns,new Array(u)))):(this.setSubMenuValue("colInsertSubMenu","COL_BEFORE",jsMsg.ColumnBefore),this.setSubMenuValue("colInsertSubMenu","COL_AFTER",jsMsg.ColumnAfter),this.setMenuValue("COL_HEADER_DELETE",jsMsg.DeleteColumn)),O.insertCopyCols||O.insertCutCols?(this.changeSubMenuState("colInsertSubMenu","COL_BEFORE","HIDE"),this.changeSubMenuState("colInsertSubMenu","COL_AFTER","HIDE")):(this.changeSubMenuState("colInsertSubMenu","COL_BEFORE","SHOW"),this.changeSubMenuState("colInsertSubMenu","COL_AFTER","SHOW")),O.insertCopyCols?(this.changeSubMenuState("colInsertSubMenu","COPIED_COL_BEFORE","SHOW"),this.changeSubMenuState("colInsertSubMenu","COPIED_COL_AFTER","SHOW")):(this.changeSubMenuState("colInsertSubMenu","COPIED_COL_BEFORE","HIDE"),this.changeSubMenuState("colInsertSubMenu","COPIED_COL_AFTER","HIDE")),O.insertCutCols?(this.changeSubMenuState("colInsertSubMenu","CUT_COL_BEFORE","SHOW"),this.changeSubMenuState("colInsertSubMenu","CUT_COL_AFTER","SHOW")):(this.changeSubMenuState("colInsertSubMenu","CUT_COL_BEFORE","HIDE"),this.changeSubMenuState("colInsertSubMenu","CUT_COL_AFTER","HIDE"));var R=Filter.hasFilteredCols()&&Row.hasHiddenRows();O.insertCutCols&&R?(this.changeSubMenuState("colInsertSubMenu","CUT_COL_BEFORE","DISABLE"),this.changeSubMenuState("colInsertSubMenu","CUT_COL_AFTER","DISABLE")):(this.changeSubMenuState("colInsertSubMenu","CUT_COL_BEFORE","ENABLE"),this.changeSubMenuState("colInsertSubMenu","CUT_COL_AFTER","ENABLE")),O.clipHasMoreCols()?(O.insertCopyCols&&(this.setSubMenuValue("colInsertSubMenu","COPIED_COL_BEFORE",jsMsg["Insert.Copied.Columns.Before"]),this.setSubMenuValue("colInsertSubMenu","COPIED_COL_AFTER",jsMsg["Insert.Copied.Columns.After"])),O.insertCutCols&&(this.setSubMenuValue("colInsertSubMenu","CUT_COL_BEFORE",jsMsg["Insert.Cut.Columns.Before"]),this.setSubMenuValue("colInsertSubMenu","CUT_COL_AFTER",jsMsg["Insert.Cut.Columns.After"]))):(O.insertCopyCols&&(this.setSubMenuValue("colInsertSubMenu","COPIED_COL_BEFORE",jsMsg["Insert.Copied.Column.Before"]),this.setSubMenuValue("colInsertSubMenu","COPIED_COL_AFTER",jsMsg["Insert.Copied.Column.After"])),O.insertCutCols&&(this.setSubMenuValue("colInsertSubMenu","CUT_COL_BEFORE",jsMsg["Insert.Cut.Column.Before"]),this.setSubMenuValue("colInsertSubMenu","CUT_COL_AFTER",jsMsg["Insert.Cut.Column.After"])))}}else{if(l.push("PIC_FROM_LIST","INSERT","DELETE","SEP3","FILTER"),s>1?(s=s.toString(),this.setSubMenuValue("insertSubMenu","CELL_LEFT",jsMsg["Shift.Cells.To.The.Right"]),this.setSubMenuValue("insertSubMenu","CELL_ABOVE",jsMsg["Shift.Cells.Down"]),this.setSubMenuValue("insertSubMenu","ROW_ABOVE",replaceParams(jsMsg.NoofRowsAbove,new Array(s))),this.setSubMenuValue("insertSubMenu","ROW_BELOW",replaceParams(jsMsg.NoofRowsBelow,new Array(s))),this.setSubMenuValue("deleteSubMenu","CELL_RIGHT",jsMsg["Shift.Cells.To.The.Left"]),this.setSubMenuValue("deleteSubMenu","CELL_BELOW",jsMsg["Shift.Cells.Up"]),this.setSubMenuValue("deleteSubMenu","DELETE_ROW",replaceParams(jsMsg.NoofRows,new Array(s)))):(this.setSubMenuValue("insertSubMenu","CELL_LEFT",jsMsg["Shift.Cells.To.The.Right"]),this.setSubMenuValue("insertSubMenu","CELL_ABOVE",jsMsg["Shift.Cells.Down"]),this.setSubMenuValue("insertSubMenu","ROW_ABOVE",jsMsg.RowAbove),this.setSubMenuValue("insertSubMenu","ROW_BELOW",jsMsg.RowBelow),this.setSubMenuValue("deleteSubMenu","CELL_RIGHT",jsMsg["Shift.Cells.To.The.Left"]),this.setSubMenuValue("deleteSubMenu","CELL_BELOW",jsMsg["Shift.Cells.Up"]),this.setSubMenuValue("deleteSubMenu","DELETE_ROW",jsMsg["Sheet.Row"])),u>1?(u=u.toString(),this.setSubMenuValue("insertSubMenu","CELL_LEFT",jsMsg["Shift.Cells.To.The.Right"]),this.setSubMenuValue("insertSubMenu","CELL_ABOVE",jsMsg["Shift.Cells.Down"]),this.setSubMenuValue("insertSubMenu","COL_BEFORE",replaceParams(jsMsg.NoofColumnsBefore,new Array(u))),this.setSubMenuValue("insertSubMenu","COL_AFTER",replaceParams(jsMsg.NoofColumnsAfter,new Array(u))),this.setSubMenuValue("deleteSubMenu","CELL_RIGHT",jsMsg["Shift.Cells.To.The.Left"]),this.setSubMenuValue("deleteSubMenu","CELL_BELOW",jsMsg["Shift.Cells.Up"]),this.setSubMenuValue("deleteSubMenu","DELETE_COL",replaceParams(jsMsg.NoofColumns,new Array(u)))):(this.setSubMenuValue("insertSubMenu","CELL_LEFT",jsMsg["Shift.Cells.To.The.Right"]),this.setSubMenuValue("insertSubMenu","CELL_ABOVE",jsMsg["Shift.Cells.Down"]),this.setSubMenuValue("insertSubMenu","COL_BEFORE",jsMsg.ColumnBefore),this.setSubMenuValue("insertSubMenu","COL_AFTER",jsMsg.ColumnAfter),this.setSubMenuValue("deleteSubMenu","CELL_RIGHT",jsMsg["Shift.Cells.To.The.Left"]),this.setSubMenuValue("deleteSubMenu","CELL_BELOW",jsMsg["Shift.Cells.Up"]),this.setSubMenuValue("deleteSubMenu","DELETE_COL",jsMsg["Sheet.Column"])),n){if(isCellRange())for(var I=r;E+1>I;I++)for(var L=i;S+1>L;L++){var c=getCell(I,L);if(c){var g=c.getAttribute("hyper");("full"==g||"multi"==g)&&l.push("REMOVE_H_LINK")}}}else{var T=currCell?currCell.getAttribute("hyper"):null;null==T||"null"==T?l.push("ADD_H_LINK"):"full"==T&&l.push("EDIT_H_LINK"),("multi"==T||"full"==T)&&l.push("REMOVE_H_LINK")}if(l.push(Annot.hasNote(ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol())?"EDIT_COMMENT":"ADD_COMMENT"),Filter.hasFilter&&0!==Filter.getInstance().appliedCols.length)if(this.changeSubMenuState("insertSubMenu","CELL_LEFT","HIDE"),this.changeSubMenuState("insertSubMenu","CELL_ABOVE","HIDE"),this.changeSubMenuState("insertSubMenu","SEP1","HIDE"),this.changeSubMenuState("deleteSubMenu","CELL_RIGHT","HIDE"),this.changeSubMenuState("deleteSubMenu","CELL_BELOW","HIDE"),this.changeSubMenuState("deleteSubMenu","SEP1","HIDE"),this.changeSubMenuState("filterbySubMenu","REAPPLY","ENABLE"),currRow>=Filter.getInstance().range.sr&&currRow<=Filter.getInstance().range.er&&Filter.getInstance().appliedCols.contains(currCol)){var h='"'+getColHeadLabel(currCol+1)+'"';this.setSubMenuValue("filterbySubMenu","CLEAR_FILTER",replaceParams(jsMsg["Filter.Clear_Filter_From_Column"],new Array(h))),this.changeSubMenuState("filterbySubMenu","CLEAR_FILTER","ENABLE")}else this.changeSubMenuState("filterbySubMenu","CLEAR_FILTER","DISABLE"),this.setSubMenuValue("filterbySubMenu","CLEAR_FILTER",jsMsg["Filter.Clear_Filter"]);else this.changeSubMenuState("insertSubMenu","CELL_LEFT","SHOW"),this.changeSubMenuState("insertSubMenu","CELL_ABOVE","SHOW"),this.changeSubMenuState("insertSubMenu","SEP1","SHOW"),this.changeSubMenuState("deleteSubMenu","CELL_RIGHT","SHOW"),this.changeSubMenuState("deleteSubMenu","CELL_BELOW","SHOW"),this.changeSubMenuState("deleteSubMenu","SEP1","SHOW"),this.changeSubMenuState("filterbySubMenu","REAPPLY","DISABLE"),this.changeSubMenuState("filterbySubMenu","CLEAR_FILTER","DISABLE"),this.setSubMenuValue("filterbySubMenu","CLEAR_FILTER",jsMsg["Filter.Clear_Filter"])}n&&l.push("SORT"),jsPUBLIC_VIEW||l.push("NAME_THIS_CELL"),jsSHARE_VIEW||jsTRASH_VIEW||jsGUEST_VIEW||jsPUBLIC_VIEW||jsREMOTE_VIEW||jsTHROWAWAY_VIEW||jsVERSION_VIEW||jsREMOTE_SAVE_VIEW||HIDE_PUBLISH_OPTION||writerCalenderWorkbook||showChartWorbook||l.push(-1!=zoid?"PUBLISH_RANGE_ORG":"PUBLISH_RANGE"),(("rHT"!=e||"rHT1"!=e)&&6>s||("cHT"!=e||"cHT1"!=e)&&6>u)&&(l.push("SEP4"),l.push(ISFREEZED?"UNFREEZE":"FREEZE")),this.changeMenuState(l,"SHOW"),this.changeMenuState(C,"DISABLE"),this.changeMenuState(M,"ENABLE"),isRTL&&(this.changeSubMenuState("deleteSubMenu","CELL_RIGHT","HIDE"),this.changeSubMenuState("deleteSubMenu","CELL_LEFT","SHOW"),this.changeSubMenuState("insertSubMenu","CELL_LEFT","HIDE"),this.changeSubMenuState("insertSubMenu","CELL_RIGHT","SHOW"))},initSheetTabRightClickPasteMenu:function(){if(!ALLOW_TO_WRITE||jsPUBLIC_VIEW)return!1;if(!ClipSheet.getClipObject().hasClip())return!1;var e=$("#sheetpastemenu");e.zmenu("showAllMenuItems"),e.css("padding","0px");var t=ClipSheet.getClipObject().sheetName,s=shortenSheetName(t,9);$("#pasteSht").find("span.ui-zmenu-text").text(jsMsg["CopySheet.Paste"]+" '"+s+"'"),$("#pasteSht").attr("title",t)},initSheetTabRightClickMenu:function(e,t){if(isErrorDoc||DR_SERVER||!isServerComponentLoaded(!0)||jsPUBLIC_VIEW&&(!isLoggedIn||!allowExport||!allowExportOrg))return!1;var s=t.target;currSheetOnRightClick=s.attr("sheetname");var u=$("#sheettabrmenu");if(currSheetOnRightClick!=CURRSHEETNAME&&showsheet(s.attr("id"),"open","rightclicked"),!ALLOW_TO_WRITE&&REMOTE.MODE!=REMOTE.SCRATCHVIEW&&!jsREMOTE_VIEW||isReadOnlyViewMode||jsGADGET_VIEW||jsEMBED_VIEW||jsPUBLIC_VIEW)return u.zmenu("hideAllMenuItems"),u.css("padding","0px"),void ClipSheet.changeMenuItem();sheetMenu.hideOpenedMenu();var n=ProtectedRanges.getObject().hasProtectedSheet(currSheetOnRightClick);if(featurePermission.getPermission("hidesheetTabMenu"))return!1;if(gridView)return!1;u.zmenu("showAllMenuItems"),ClipSheet.changeMenuItem();var a=$("#movesheet"),r=$("#sharesheet"),E=$("#sheetcode"),i=$("#deletesheet"),S=$("#renamesheet"),l=$("#sheettabcolor");if(null!=ProtectedRanges.getObject().getSheets().getSheetObj(currSheetOnRightClick)){$("#lockSheet").hide();var h=$("#manageLockSheet")}else $("#manageLockSheet").hide(),h=$("#lockSheet");n===!0?(S.disable(),l.disable()):(S.enable(),l.enable()),2===$("#sheetsTab").find("td").length?(a.disable(),i.disable()):(a.enable(),1==n?i.disable():i.enable());var o=!1;null!=TOP&&""!=TOP&&"entrepreneur"==TOP.toString()&&(o=!0),(jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW||o||jsPUBLIC_VIEW)&&(r.hide(),o||E.hide()),writerCalenderWorkbook&&($("#shtabsep").hide(),E.hide());var M=t&&t.currentTarget&&0!==$(t.currentTarget).find("img.pivotTableIcon , .pivotChartIcon , .tabularDataIcon").length;M?E.disable():E.enable(),M&&($("#copysheet").hide(),jsSHARE_VIEW&&$("#deletesheet").hide()),cdview||jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW||writerCalenderWorkbook||crmLibrary?($("#shtabsep2").hide(),h.hide()):0==ProtectedRanges.showMenuEntry()&&h.disable(),HIDE_SHARE_OPTION&&r.hide(),r.hide()},initChartRightClickMenu:function(){var e=$("#pic_publish_link_span");$("#chartRMenu").zmenu("showAllMenuItems"),0!=e.length&&e.is(":visible")?($("#chturl").hide(),$("#chtdelpub").hide()):$("#chtpub").hide(),(jsVERSION_VIEW||jsREMOTE_VIEW||jsPUBLIC_VIEW||jsTHROWAWAY_VIEW||jsGUEST_VIEW||jsREMOTE_SAVE_VIEW||jsTRASH_VIEW||jsSHARE_VIEW||HIDE_PUBLISH_OPTION||!user.permissions.publish||allowPublishOrg)&&($("#chtpub").hide(),$("#chturl").hide(),$("#chtdelpub").hide(),$("#chtsep2").hide())},changeMenuState:function(e,t){var s=$("#rmenu").children();for(i=0;i<e.length;i++){var u=this.menuItems.indexOf(e[i]),n=s[u];switch(t){case"SHOW":$(n).show();break;case"HIDE":$(n).hide();break;case"DISABLE":$(n).disable();break;case"ENABLE":$(n).enable()}}},changeSubMenuState:function(e,t,s){var u=$("#"+e),n=this.subMenuItems[e].indexOf(t),a=u.children()[n];switch(s){case"SHOW":$(a).show();break;case"HIDE":$(a).hide();break;case"DISABLE":$(a).disable();break;case"ENABLE":$(a).enable()}},setMenuValue:function(e,t){var s=this.menuItems.indexOf(e),u=$("#rmenu").children()[s];$(u).children("span.ui-zmenu-text").html(t)},setSubMenuValue:function(e,t,s){var u=$("#"+e),n=this.subMenuItems[e].indexOf(t),a=u.children()[n];$(a).children("span.ui-zmenu-text").html(s)}};
function message(e,t,i){var n=getObj("openmessage");if(null!=n)if("none"==t)n.style.display=t;else{var a="";"undefined"!=typeof i&&(a=i.substring(0,15)),n.textContent=e+a,n.style.display=t}}function replaceHTML(e){return e=e.replace(/colHeadFocus/gi,""),e=e.replace(/rowHeadFocus/gi,""),e=e.replace(/<IMG.*id.*ExcelGraph[^\"]+\"[^<]+/gi,""),e=e.replace(/ charts\=\"[^"]+\"/gi,""),e=e.replace(/<IMG.*id.*img_[^\"]+\"[^<]+/gi,"")}function sheetDefault(){assignInitialValues(),FadeCell.elemsarr={},SHEETSWITCH=!0,initSheet(ssServer,initSSWidth,initSSHeight,initCols,initRows,initColHeadHeight,initRowHeadWidth,initColWidth,initRowHeight,tablewidth,tableheight),getisSheetWritable(DOCUMENT_ID,CURRSHEETNAME),isSSActive&&(resetWorkSheetDim(),(documentBakeStatus.isBaked()||jsVERSION_VIEW)&&(postSheetLoader(ActionConstants.SWITCH_SHEET),pivot.Collection.createFilterIcons())),jsTHROWAWAY_VIEW||(userPresence.showAll(),CollabPanel.changeUserPresenceState()),isSheetLoading=!1}function loadControlComponent(e){for(var t=e,i=t.length,n=0;i>n;n++)t[n].cap=decodeURIComponent(replace(t[n].cap,"+"," ")),t[n].SHEETNAME=decodeURIComponent(replace(t[n].SHEETNAME,"+"," ")),Button.create(t[n])}
var mask=function(t){var e=function(e,o,i){i=i||"toolbarMask",o?n(e,i,o):n(e,"toolbarMask",t("#toolbarContainer"))},o=function(e,o){o?n(o,"bottomBandMask",t(".add_sheet").parent()):n(e,"bottomBandMask",t("#sheets"))},i=function(e,o,i,s){var a=t("#sheetdiv"),d="gridMask";if(e){if(!o)var h=a.width()-t("#ssRightPanel").width(),l={width:h};n(e,d,a,l,s);var c=t("#"+d);c.attr("context","rmenu"),o||mousewheel.addEventHandler(c[0],mousewheel.scroll),i||c.mousedown(function(t){r(t)})}else n(e,d)},s=function(t){return"gridMask"===t.id},a=function(){var e=t("#gridMask");e.length&&e.css({width:t("#sheetdiv").width()-t("#ssRightPanel").width(),height:t("#sheetdiv").height(),top:t("#sheetdiv").offset().top})},n=function(e,o,i,s,a){var n=t("#"+o);if(e){if(!n.length){n=t("<div>").attr("id",o);{i.offset()?i.offset().top:0}n.css({width:i.width(),height:i.height(),"background-color":"#F9F9F9",opacity:"0.5",position:"absolute","z-index":223+BASEZINDEX}),a&&n.addClass("sheetMask"),s&&n.css(s),n.prependTo(i)}}else n.remove()},r=function(e){var o=getCursorPos(e),i=t("#rH").width(),s=t("#cH").offset().top+t("#cH").height();o.x<=i&&o.y<=s?focusAllCells(e):o.x<=i?rowHeadClick(e):o.y<=s?colHeadClick(e):sheetMouseDown(e)};return{toolbar:e,bottomBand:o,grid:i,isGridDiv:s,resizeGrid:a}}(jQuery);
var featurePermission=function(){var e={contextmenu:!1,sheetswitch:!0,hidetoolbar:!1,allowToScroll:!0,hidesheetTabMenu:!1},o=function(o){e.contextmenu=void 0!==o.contextmenu?o.contextmenu:e.contextmenu,void 0!=o.sheetswitch&&(e.sheetswitch=o.sheetswitch,n()),void 0!=o.hidetoolbar&&(e.hidetoolbar=o.hidetoolbar,s()),e.allowToScroll=void 0!==o.allowToScroll?o.allowToScroll:e.allowToScroll,e.hidesheetTabMenu=void 0!==o.hidesheetTabMenu?o.hidesheetTabMenu:e.hidesheetTabMenu},t=function(){o({contextmenu:!0,sheetswitch:!0,hidetoolbar:!1,allowToScroll:!0,hidesheetTabMenu:!1})},i=function(o){for(var t in e)if(t===o)return e[t]},n=function(){var o=e.sheetswitch;mask.bottomBand(o?!1:!0)},s=function(){var o=e.hidetoolbar;mask.toolbar(o)};return{setPermission:o,getPermission:i,resetPermission:t}}(jQuery);
var arrayDetails,ssServer="",isSSActive=!0,spreadSheet,ssWidth,ssHeight,ssResizePane,ssResizeCue,ssLeft,ssTop,ssRightPanel,ssBottomPanel,ssHScrollResizePane,ssHScrollContainer,ssHScrollResizeCue,ssHScrollbarContainer,ssHScrollbar,ssHScrollDIV,ssHScrollEnd,ssVScrollStart,ssVScrollbar,ssVScrollDIV,sheetObjectsPane,colHeadContainer,rowHeadContainer,colHeadStart,colHead,colHeadHeight,colHeadTable,rowHead,rowHeadWidth,rowHeadTable,sheet,sheetTable,colHeadCells,rowHeadCells,sheetRightBit,sheetBottomBit,focusDIV,transSPAN,dummySPAN,dummyCANVAS,cellFieldSPAN,cellField,resizePane,resizeOverlay,currCell,currCellHolder,currCellRange,currRow,currCol,currCellWidth,selRow,selCol,currCellContent,currCellValue,currCellFormula,currKeyCode,sheetLeft,sheetTop,sheetRight,sheetBottom,sheetWidth,sheetHeight,scrollRight,adjst=browser_nn6?-3:3,pgUpCnt=10,pgDownCnt=10,totRows=0,totCols=0,startRow=-1,startCol=-1,endRow=-1,endCol=-1,stdCellWidth,stdCellHeight,fileToolbarMask,stdToolbarMask,exprPanel,exprField,currCellIndicator,isF2KeyPressed,isDblClicked,isenterKeyPressed=!1,isCellSelection,exprFieldKeyPressed=!1,totalTableWidth,totalTableHeight,fillSeriesDIV,fillSeriesSPAN,currColTemp,currRowTemp,ancStyle=" style='text-decoration:underline;color:blue;cursor:pointer;' target='_blank'",cellRangeFillDIV,cellRangeFillSPAN,formulaCell=!1,isExprFunc=!1,tempPos=0,cellRangeStartIdx=0,cellRangeEndfIdx=0,forRangeHidden="",browserVersion=window.navigator.appVersion,spreadSheetWidth=0,ssParentElWidth=0,bandOffsetWidth=0,ssParentElHeight=0,rowHeadDIVAdjust=6,colHeadDIVAdjust=6,totValAsArr=[],currColOrdrArr=[],isAutoSuggestMenuOpen=!1,EXPRCONTENTHEIGHT=16,collapsedExprField={},expandedExprField={},exprEqualExpandDiv={},exprArrowExpandDiv={},exprEqual={},colSelection=!1,rowSelection=!1,dummyTextArea={},isMouseEventInSheetScrollBar=!1,exprEqualTable={},EXPRFIELD_EXPAND_HEIGHT=80,EXPRFIELD_COLLAPSE_HEIGHT=20,cellContentWidth=0,cellContentHeight=0,requiredCellWidth=0,requiredCellHeight=0,currRowOfCellfield=0,currColOfCellfield=0,isSuggestAvailable=!1,maxCellFieldWidthInExprFieldNewMode=0,posOfCaret=0,startPosOfSelection=0,endPosOfSelection=0,scrolledHeightForExprField=0,scrolledHeightForCellField=0,isStylesAssignedForCellField=!1,contentHeight=0,currentCellObject={},sheetHeightMaxInViewPort=0,sheetWidthMaxInViewPort=0,isEditingInExprField=!1,isTextWrapped=!1,contentNotReachedMaximumWidth=!0,contentNotReachedMaximumheight=!0,sheetScrollLeftMaxInViewPort=0,rowToFocusOnPageNavigation=void 0,isColumnSelected=!1,isRowSelectd=!1,isRangeSelection=!1,tempFocusRow="",tempFocusCol="",colSelected,currColHead,currColHeadCOLTag,currColHeadCnt,currColHeadLeft,currColHeadWidth,colHeadTableWidth,currColHeadDIV,rowSelected,currRowHead,currRowHeadDIV,currRowHeadCnt,currRowHeadTop,currRowHeadHeight,rowHeadTableHeight,ssResizeType,cellRangeStartRow,cellRangeStartCol,cellRangeEndRow,cellRangeEndCol,cnt=0,rangeFill=!1,isColResized=!1,selectionLeft=-1,selectionTop=-1,quadName="DEFAULT",vertArea="DEFAULT",horiArea="DEFAULT",sheetScrollTopId,sheetScrollLeftId,tileHolder,prevScrollTop=0,currScrollTop1=0,currScrollLeft=0,isVScrollFaceOnDrag=!1,isHScrollFaceOnDrag=!1,isUpArrowPressed=!1,isDownArrowPressed=!1,scrollFaceDragTimer=200,scrollArrowClickTimer=10,sheetHolder,availableStartRow,availableEndRow,firstRowInViewPort,lastRowInViewPort,selectedCellRange={},sheetTotalScrollHeight,sheetTotalScrollWidth,colMergeDetailStr,colMergeDetails,isChangeMadeAfterScroll=!1,rowHeightAry=[],rowTopAry=[],colWidthAry=[],colLeftAry=[],mainTable,colHead1,colHead2,colHeadTable1,colHeadTable2,rowHead1,rowHead2,rowHeadTable1,rowHeadTable2,sheetPane1,sheetPane2,sheetPane3,sheetPane4,sheetTable1,sheetTable2,sheetTable3,sheetTable4,currTableId,currTableObj,freezedRowsHt,freezedColsWd,vFreezeCue,hFreezeCue,focusDIV1,focusDIV2,focusDIV3,focusDIV4,transSPAN1,transSPAN2,transSPAN3,transSPAN4,cellRangeFillDIV1,cellRangeFillDIV2,cellRangeFillDIV3,cellRangeFillDIV4,cellRangeFillSPAN1,cellRangeFillSPAN2,cellRangeFillSPAN3,cellRangeFillSPAN4,fillSeriesDIV1,fillSeriesDIV2,fillSeriesDIV3,fillSeriesDIV4,fillSeriesSPAN1,fillSeriesSPAN2,fillSeriesSPAN3,fillSeriesSPAN4,availChartRange={},DOCUMENT_REQUESTED_TIME,COLLAB_INFO={joinintvl:void 0},documentBakeStatus={renderBaked:!1,objectBaked:!1,collabBaked:!0,set collabBakedStatus(e){this.collabBaked=e,e?"undefined"!=typeof UIComponents&&UIComponents.setToolbarStatus():featurePermission.setPermission({hidetoolbar:!0})},get collabBakedStatus(){return this.collabBaked},reset:function(){this.renderBaked=!0,this.objectBaked=!1,this.collabBakedStatus=!0},isBaked:function(){return this.renderBaked&&this.objectBaked&&this.collabBakedStatus},setRenderBake:function(e){this.renderBaked=!!e},setObjectBake:function(e){this.objectBaked=!!e},setCollabBake:function(e){this.collabBakedStatus=!!e}};documentBakeStatus.reset();var docMetaDetails={},tileLoadTimeoutId,isTileLoaded,isVScrollFaceClicked,vScrollFaceClickedPos,updateTileCallbackInfo={isCallbackAvailable:!1,actionDetails:{}},currSearchBarEl="",isHScrollbarRightArrowPressed=!1,noOfUpdateRequestInProgress=0,VIEW_REQUESTED_TIME,PAGES_PER_LOAD=1,prevRow=-1,prevCol=-1,dataResponse=null,rowsInRange=0,colsInRange=0,cellDragRange={ASR:-1,ASC:-1,AER:-1,AEC:-1,CSR:-1,CSC:-1,CER:-1,CEC:-1},cellDragProps={ADR:-1,ADC:-1,cellDragRange:cellDragRange,isDraggable:!1},OLEDragProps={isDraggable:!1,rowNo:-1,colNo:-1,rowValForScrollTop:-1,colValForScrollTop:-1,scrollTop:0,scrollLeft:0,rowTop:0,colLeft:0,diffY:0},preOleLeftVal=-1,prevOleTopVal=-1,prevOleHeight=0,prevOleWidth=0,dragDIV,dragDIV1,dragDIV2,dragDIV3,moveCursorDIV,DOCUMENT_INFO={DOCUMENT_POINTER:void 0},fillSeriesProps={mergedRightEndCol:-1,mergedRightColSpan:-1,mergedLeftEndCol:-1,mergedLeftColSpan:-1,mergedTopEndRow:-1,mergedTopRowSpan:-1,mergedBottomEndRow:-1,mergedBottomRowSpan:-1,isMergeCellExists:!1,selectedStartRow:-1,selectedStartCol:-1,selectedEndRow:-1,selectedEndCol:-1,reset:function(){this.mergedRightEndCol=-1,this.mergedRightColSpan=-1,this.mergedLeftEndCol=-1,this.mergedLeftColSpan=-1,this.mergedTopEndRow=-1,this.mergedTopRowSpan=-1,this.mergedBottomEndRow=-1,this.mergedBottomRowSpan=-1,this.isMergeCellExists=!1,this.selectedStartRow=-1,this.selectedStartCol=-1,this.selectedEndRow=-1,this.selectedEndCol=-1}},WorkSheets={_sheetNamesMetaList:[],NAME_POS:0,META_POS:1,_ascActiveSheetName:void 0,getAssociatedActiveSheetName:function(){return this._ascActiveSheetName},updateSheetNamesList:function(e){this._sheetNamesMetaList=e},setAssociatedActiveSheetName:function(e){this._ascActiveSheetName=e},updateAscActiveSheetName:function(){var e=this._sheetNamesMetaList[this.NAME_POS];if(e){var t=e.indexOf(this.getActiveSheetName());-1!=t&&(this._ascActiveSheetName=this._sheetNamesMetaList[this.META_POS][t])}},getActiveSheetName:function(){return CURRSHEETNAME},getSheetCodeFromName:function(e){e=CellUtils.removeApostrophe(e);var t=this._sheetNamesMetaList[this.NAME_POS];if(t){var r=t.indexOf(e);return this._sheetNamesMetaList[this.META_POS][r]}return void 0},getSheetNameFromCode:function(e){var t=this._sheetNamesMetaList[this.META_POS];if(t){var r=t.indexOf(e);return this._sheetNamesMetaList[this.NAME_POS][r]}return void 0},isNameExists:function(e,t){var r=this._sheetNamesMetaList[this.NAME_POS];if(r){for(var l=0;l<r.length;l++){var s=r[l];if((s!=CURRSHEETNAME||!t)&&e&&r[l].toUpperCase()==e.toUpperCase())return!0}return!1}return!1},getActualSheetName:function(e){var t=this._sheetNamesMetaList[this.NAME_POS];if(t){for(var r=0;r<t.length;r++){var l=t[r];if(e&&l.toUpperCase()==e.toUpperCase())return l}return e}return e},getSheetObjByName:function(e){for(var t=getObj("sheetsTab").getElementsByTagName("TD"),r=0;r<t.length-1;r++){var l=t[r].getAttribute("sheetname");if(l.toUpperCase()==e.toUpperCase()){var s=t[r].children[0];return $(s)}}return void 0},getNewSheetId:function(){for(var e=(getObj("sheetsTab").getElementsByTagName("TD"),TOTALSHEETS),t=!0;t;){if(!getObj("sheetnames_"+e)){t=!1;break}e++}return"sheetnames_"+e}};WorkSheets.dom={fill:function(e){for(var t=getObj("sheetsTabTable").getElementsByTagName("TR")[0].cells,r=t.length-1,l=e.length,s=0;l>s;s++){var o=e[s];if(r>s){var a=t[s],i=a.getElementsByTagName("DIV")[0],n=i.getElementsByTagName("DIV")[0];a.setAttribute("sheetname",o);var d=document.createTextNode(o);a.id="sheetdiv-"+WorkSheets.getSheetCodeFromName(o),jsVERSION_VIEW?(a.removeAttribute("context"),a.removeAttribute("onmousedown"),a.setAttribute("onclick","versionSheetopen('"+o+"')")):(a.removeAttribute("onclick"),a.setAttribute("context","sheettabrmenu"),a.onmousedown=function(e){return reorderSheet(e,this)}),n.innerHTML="",ProtectedRanges.isSheetLocked(o)&&(n.innerHTML=ZS_ProtectedSheet.getSheetImgTag()),n.appendChild(d),i.className="tabItem"}else{var c=document.createElement("TD");c.setAttribute("sheetname",o),c.setAttribute("context","sheettabrmenu"),c.id="sheetdiv-"+WorkSheets.getSheetCodeFromName(o),c.title=o;var h="<div class='tabItem'><div id='sheetnames_"+s+"'>"+o;h+="</div></div>",c.innerHTML=h,c.onmousedown=function(e){return reorderSheet(e,this)};var S;S||(S=getObj("dummySheetTab")),S.parentNode.insertBefore(c,S)}}for(var u=l,g=0;r>u;u++,g++){var S;S||(S=getObj("dummySheetTab")),S.parentNode.removeChild(t[r-1-g])}}};
var gridListener={listen:function(e){var o=!0;switch(e){case 0:this.onDataUpdate();break;case 1:this.onFormatUpdate();break;case 2:this.onUndo();break;case 3:this.onRedo();break;case 4:this.onRecalculate();break;case 5:o=!1,this.onFormulaUpdate();break;case 6:this.onHyperlink();break;case 7:o=!1,this.onCellAnnotRender();break;case 8:this.onSort();break;case 9:o=!1,this.onWebDataUpdate();break;case 10:this.onWebDataChange();break;case 11:o=!1,this.onMacroUpdate();break;case 12:this.onMacroChange()}o&&this.onGridChange()},onDataUpdate:function(){},onFormatUpdate:function(){},onUndo:function(){},onRedo:function(){},onRecalculate:function(){},onFormulaUpdate:function(){},onHyperlink:function(){},onCellAnnotRender:function(){},onSort:function(){},onWebDataUpdate:function(){},onWebDataChange:function(){},onMacroUpdate:function(){},onMacroChange:function(){},onCustomFormat:function(){},onGridChange:function(){clearHiddenRowFormulas&&(Row.clientData.hiddenRowsInfo={})}},workbookData={},focusRemembering={localFromGoto:null,jsonWorkbookObj:function(){null==workbooksheets&&(workbooksheets=focusRemembering.constructClientJson());for(var e,o=workbooksheets.sheetcnt,t=0;o>=t;t++)e=workbooksheets["sheet"+t],void 0!=e&&(workbookData.shNm=e.sheetName,workbookData.preSheetName==e.sheetName&&(e.activeRowIndex=workbookData.preActiveRow,e.activeColIndex=workbookData.preActiveCol,e.activeERowIndex=workbookData.endRow,e.activeEColIndex=workbookData.endCol,e.positionBottom=workbookData.posBtm,e.positionLeft=workbookData.posLft));return workbooksheets},constructClientJson:function(){if(getObj("sheetsTab")){for(var e=getObj("sheetsTab").getElementsByTagName("TD"),o=[],t={},s=0;s<e.length-1;s++){var n={};o[s]=e[s].getAttribute("sheetname"),n.sheetName=o[s],n.activeRowIndex=0,n.activeColIndex=0,n.activeERowIndex=0,n.activeEColIndex=0,n.positionBottom=0,n.positionLeft=0,t["sheet"+s]=n,t.sheetcnt=e.length-1}return t}},addSheetInJson:function(e,o){var t=parseInt(o),s=t-1,n={};return n.sheetName=e,n.activeRowIndex=0,n.activeColIndex=0,n.activeERowIndex=0,n.activeEColIndex=0,n.positionBottom=0,n.positionLeft=0,workbooksheets["sheet"+s]=n,workbooksheets.sheetcnt=t,workbooksheets},renameSheetInJson:function(e,o){for(var t,s=workbooksheets.sheetcnt,n=0;s>n;n++)t=workbooksheets["sheet"+n],e==t.sheetName&&(t.sheetName=o)},deleteSheetInJson:function(e){for(var o,t=workbooksheets.sheetcnt,s=-1,n=0;t>n;n++)o=workbooksheets["sheet"+n],void 0!=o&&e==o.sheetName&&(s=n);for(var r=t,a=s;r>a;a++)r>a+1&&(workbooksheets["sheet"+a]=workbooksheets["sheet"+(a+1)]),a+1==r&&(delete workbooksheets["sheet"+a],workbooksheets.sheetcnt=t-1)},copySheetInJson:function(e,o){for(var t,s={},n=focusRemembering.jsonWorkbookObj(),r=n.sheetcnt,a=(parseInt(TOTALSHEETS),0);r>=a;a++)t=n["sheet"+a],void 0!=t&&t.sheetName==e&&(s.sheetName=o,s.activeRowIndex=0,s.activeColIndex=0,s.activeERowIndex=0,s.activeEColIndex=0,s.positionBottom=0,s.positionLeft=0,n["sheet"+(a+1)]=s,n.sheetcnt=r+1);return n},insertExtraFocusPositions:function(){for(var e=focusRemembering.jsonWorkbookObj(),o=e.sheetcnt,t=0;o>=t;t++){var s=e["sheet"+t];if(void 0!=s&&s.sheetName==CURRSHEETNAME){workbookData.switchSheet&&(position_Bottom=s.positionBottom,position_Left=s.positionLeft,cursor_Col_Index=s.activeEColIndex);var n=findRowInYPos(getRowTop(position_Bottom)+getSheetHeight(),!0);appendBlankRows("ROWS_EXCEEDED",n);var r,a;r=findColInXPos(getColLeft(position_Left)+getSheetWidth(),!0),a=totCols>r&&totCols>cursor_Col_Index?totCols-r+1:cursor_Col_Index>totCols&&totCols>r||totCols===cursor_Col_Index?cursor_Col_Index-totCols+1:r-totCols+1,(r>totCols||cursor_Col_Index>totCols||cursor_Col_Index===totCols)&&insertCol("append",totCols,a,!0,!0,!0,void 0,void 0,void 0,void 0,!0,void 0,!0)}}},setFocusPositions:function(){var e,o={};workbookData.copySheet?(e=focusRemembering.copySheetInJson(workbookData.originalSheet,workbookData.copiedSheet),workbookData.copySheet=!1):e=focusRemembering.jsonWorkbookObj();for(var t=e.sheetcnt,s=0;t>=s;s++){var n=e["sheet"+s];void 0!=n&&n.sheetName==CURRSHEETNAME&&(position_Bottom=n.positionBottom,position_Left=n.positionLeft,n.activeRowIndex==n.activeERowIndex&&n.activeColIndex==n.activeEColIndex||void 0===(n.activeERowIndex&&n.activeEColIndex)?(cursor_Row_Index=n.activeRowIndex,cursor_Col_Index=n.activeColIndex,o.endCol=n.activeColIndex,o.endRow=n.activeRowIndex,cursor_Row_Index>position_Bottom&&cursor_Col_Index>position_Left?focusRemembering.localFromGoto?(workbookData.switchSheet=!0,appEvent.trigger("goto.focused")):(setScrollTop(getRowTop(position_Bottom)),setScrollLeft(getColLeft(position_Left)>findSecondPaneXPos()?getColLeft(position_Left)-findSecondPaneXPos():getColLeft(getNormalizedScrollLeft())),focusCell(cursor_Row_Index,cursor_Col_Index,"",!0)):focusRemembering.localFromGoto?(workbookData.switchSheet=!0,appEvent.trigger("goto.focused")):(focusCell(cursor_Row_Index,cursor_Col_Index),setScrollTop(getRowTop(position_Bottom)),setScrollLeft(getColLeft(position_Left)>findSecondPaneXPos()?getColLeft(position_Left)-findSecondPaneXPos():getColLeft(getSheetScrollLeft())))):(cursor_Row_Index=n.activeRowIndex,cursor_Col_Index=n.activeColIndex,o.endRow=n.activeERowIndex,o.endCol=n.activeEColIndex,cursor_Row_Index+o.endRow>position_Bottom&&cursor_Col_Index+o.endCol>position_Left?(setScrollTop(getRowTop(position_Bottom)),setScrollLeft(getColLeft(position_Left)),focusCellRange(cursor_Row_Index,cursor_Col_Index,o.endRow,o.endCol,"",!0,"","",!0)):(focusCellRange(cursor_Row_Index,cursor_Col_Index,o.endRow,o.endCol,"",!1,"","",!0),setScrollTop(getRowTop(position_Bottom)),setScrollLeft(isRTL?ssHScrollbar.scrollWidth-parseInt(ssHScrollbar.style.width)-getColLeft(cursor_Col_Index):getColLeft(cursor_Col_Index)))))}flashON&&ClipRange.getClipObject().isSameSheet()&&(isCopySelection||formatPainterON)&&(flashSRow=parseInt(remFlashCellRange.substring(remFlashCellRange.indexOf("R")+1,remFlashCellRange.indexOf("C"))),flashsCol=parseInt(remFlashCellRange.substring(remFlashCellRange.indexOf("C")+1,remFlashCellRange.indexOf(":"))),flasheRow=parseInt(remFlashCellRange.substring(remFlashCellRange.lastIndexOf("R")+1,remFlashCellRange.lastIndexOf("C"))),flasheCol=parseInt(remFlashCellRange.substring(remFlashCellRange.lastIndexOf("C")+1,remFlashCellRange.length)),focusCellRangeFill(flashSRow,flashsCol,flasheRow,flasheCol,!0)),scrollCellIntoView(currRow,currCol)},setWorkbookData:function(){workbookData.preSheetName=CURRSHEETNAME;var e={};isCellRange()?(e=getCellRange(),workbookData.preActiveRow=e.startRow,workbookData.preActiveCol=e.startCol,workbookData.endRow=e.endRow,workbookData.endCol=e.endCol):(workbookData.preActiveRow=ActiveCellInfo.getStartRow(),workbookData.preActiveCol=ActiveCellInfo.getStartCol(),workbookData.endRow=ActiveCellInfo.getStartRow(),workbookData.endCol=ActiveCellInfo.getStartCol()),workbookData.switchSheet=!0;var o=getXYPositions();workbookData.posBtm=o.firstRow,workbookData.posLft=o.firstCol}},sheetTabBgColor=function(e){var o={},t=function(){e("#sheetTabBgclr").is("div")&&sheetdialog.close();var o="<div id='sheetTabBgclr'> <button id='sheetTabBgClrPicker' colorpalette='true' data='{colorpaletteOptions: {nofill: true, defaultColor: false}}'></button></div>",t={sheetswitch:!0,contextmenu:!0,hidetoolbar:!1};sheetdialog.open(o,t,s)},s=function(){var o=sheetdialog.getOpenedDialog(),t=WorkSheets.getSheetObjByName(CURRSHEETNAME);if(!t.length)return void sheetdialog.close();var s=t.offset(),r=s.left,a=s.top-70;o.css({left:r+"px",top:a+"px"}),e("#sheetTabBgClrPicker").bind("colorpalettecolorselected",function(e,o){n(o)}).click(),o.hide()},n=function(e){var o="transparent"!=e.color?zoho.color.rgbToHex(e.color):"",t=WorkSheets.getSheetCodeFromName(CURRSHEETNAME),s=new RequestParameters(ActionConstants.SHEET_TABCOLOR);s.setParameters(t,o);var n=new AjaxRequest;n.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(n),sheetdialog.close()},r=function(){var e=new RequestParameters(ActionConstants.GET_SHEET_TABCOLORS),o=new AjaxRequest;o.init("POST",e.getURL(),!0,e.getParametersAsString()),o.addEventListener("onComplete",function(e){jsVERSION_VIEW&&i(),a(e.responseText)}),o.sendRequest()},a=function(e){var t=parseJSON(e),s=Object.keys(t);s.forEach(function(e){var s=WorkSheets.getSheetCodeFromName(e),n=t[e];o[s]=n;var r=WorkSheets.getSheetObjByName(e);if(CURRSHEETNAME!=e){r.css("backgroundColor",n);var a=c(n);r.children("div:first").css("color","#000"),a&&r.children("div:first").css("color","#FFF")}else t[e]?(r.addClass("colored"),r.css("cssText","border-bottom-color:"+n+" !important; background-color:''")):(r.removeClass("colored"),r.css("borderBottomColor","#C8CBC9"),r.css("cssText",""))})},l=function(e){var t=e.SHEETNAME,s=e.TYPE,n=WorkSheets.getSheetObjByName(t);if(n){"undefined"!=typeof e.COLOR&&(o[WorkSheets.getSheetCodeFromName(t)]=e.COLOR);var r=o[WorkSheets.getSheetCodeFromName(t)];"BACKGROUND"==s?(r&&"rgb(200, 203, 201)"!=r&&(n.css({backgroundColor:r,borderBottomColor:""}),c(r)&&n.children("div:first").css("color","#FFFFFF")),n.removeClass("colored"),n.removeClass("selected")):"BORDER"==s&&(n.addClass("selected"),r&&"rgb(255, 255, 255)"!=r?(n.addClass("colored"),n.css("cssText","border-bottom-color:"+r+" !important; background-color:''"),n.children("div:first").css("color","#000")):r&&"rgb(200, 203, 201)"!=r&&n.addClass("colored"))}},i=function(){var e=CellUtils.getRequiredSheetNames().sheetNames;e.forEach(function(e){var o=WorkSheets.getSheetObjByName(e);o.css("borderBottomColor",""),o.css("backgroundColor",""),o.children("div:first").css("color","")}),o={}},c=function(e){if(""==e)return!1;var o=e;return 0==e.indexOf("#")&&(o=zoho.color.hexToRgb(e)),o=o.substring(4,o.length-1).split(","),zoho.color.isDark(o)},d=function(e){delete o[e]};return{showdialog:t,getSheetTabColors:r,responseHandler:a,updateSheetTabColors:l,isDarkerColor:c,clearTabColors:i,removeFromCache:d}}(jQuery),switchSheet=function(){var e=CURRSHEETNAME,o="",t=!1,s=function(s){var r=CellUtils.getRequiredSheetNames().sheetNames,a=r.indexOf(e);if("next"==s){if(a++,a>=r.length)return}else if(a--,0>a)return;window.clearTimeout(o),t=!0;var l=r[a];WorkSheets.getSheetObjByName(e).removeClass("selected"),WorkSheets.getSheetObjByName(l).addClass("selected"),sheetTabBgColor.updateSheetTabColors({SHEETNAME:e,TYPE:"BACKGROUND"}),sheetTabBgColor.updateSheetTabColors({SHEETNAME:l,TYPE:"BORDER"}),e=l,scrollSheetTabToView(WorkSheets.getSheetCodeFromName(e)),o=window.setTimeout(function(){n(),t=!1},300)},n=function(){showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open")};return appEvent.on("book.onaftersheetswitch",function(){t||(e=CURRSHEETNAME)}),appEvent.on("sheet.onnamechanged",function(o){e=o}),{doSwitch:s}}(jQuery);
function isMSEdge(){var e=navigator.userAgent,t=e.indexOf("Edge");if(t>-1){var s=e.substring(t),i=s.split(" ");if(i[0].indexOf("/")>-1){var o=i[0].split("/"),a=parseFloat(o[1]);if(a>11)return!0}}return!1}function unsetStatus(){jsREMOTE_VIEW&&ClipObject.hideFillDiv(),(!READ_WRITE||jsPUBLIC_VIEW)&&ClipObject.hideFillDiv(),ClipRange.isCellExceed=!1,ClipRange.isSameContent=!1}function showsheetTabFillDIV(){var e=$("#sheetsTabTable").find("div.tabItem.selected");currSheetOnRightClick===WorkSheets._sheetNamesMetaList[0][0]&&e.addClass("marginFirst"),e.addClass("fadeIt");var t=e.children(":first-child");t.addClass("sTF drop"),isSheetFillDivAvailable=!0}function cellRangeContainsMergeCells(e,t,s,i){var o=!1,a=Merge.getIterator(e,t,s,i);return a.initData(o),a.setDataProcessor(function(e){return e}),a.iterate(function(){this.processData(!0),this.interrupt()}),o=a.getData()}function adjustColsAndRowsForTextArea(){var e=0,t=0,s=0;if(TexttoColumns.maxRowCnt>0||TexttoColumns.maxColCnt>0){var o=TexttoColumns.cellContent.split("\n");t=o.length-1,e=TexttoColumns.maxColCnt}else{var a=cellField.value;0===a.length&&(a=cpTextArea.value);var n=a.split("\n");for(t=n.length-1,i=0;i<n.length;i++)s=n[i].split("	").length-1,s>e&&(e=s)}if(0==s&&(t-=1),TexttoColumns.maxRowCnt>0||TexttoColumns.maxColCnt>0){var r=TexttoColumns.getTargetCell();t+=r.row,e+=r.col}else t+=currRow,e+=currCol;if(t>totRows){var l=t-totRows+extraRows;appendBlankRows("ROWS_EXCEEDED",totRows+l),usedCursRow=t}if(e>totCols){var c=e-totCols+extraCols;insertCol("append",totCols,c,!0,!0,!0,void 0,void 0,void 0,void 0,!0)}}function shortenSheetName(e,t){var s=e;return s.length>t+3&&(s=s.substring(0,t)+"..."),s}function createToolTip(){var e=$("<div/>",{class:"tooltip",style:"display:none",id:"sheetCopyTip","data-tooltip":"2"}),t=$("<div/>",{class:"arrow"});t.appendTo(e);var s=$("<span/>");s.text("test"),s.appendTo(e),e.appendTo(document.body)}function showToolTip(e,t){e=$(e);var s=$("div#sheetCopyTip");s.show(),s.css({top:e.offset().top+20+"px",left:e.offset().left-20+"px"});var i=s.find("span");i.text(t),s.show(),s.animate({top:"-=30px"},200)}function removeToolTip(){$("div#sheetCopyTip").hide()}function showCopyMessage(){setTimeout(function(){serverResponse||(showProgressMessage(jsMsg["Notify.Copying"]),setTimeout(function(){hideProgressMessage()},200))},500)}function triggerCopy(){try{{document.execCommand("copy")}}catch(e){}}function clearTTLTimer(){clearTimeout(ttlTimer)}function showCopyCue(){setTimeout(setFocusInCellField,200),setTimeout(function(){if(!RangeSelector.isActive()){var e=ClipRange.getClipObject();focusCellRangeFill(e.startRow,e.startCol,e.endRow,e.endCol,!0)}hideProgressMessage()},500)}function checkIfRangeInViewPort(e,t,s,i){return e>=getAvailableStartRow()&&t>=getAvailableStartCol()&&s<=getAvailableEndRow()&&i<=getAvailableEndCol()}var clipRangeObject,clipSheetObject,isClippedNow=!1,extraRows=0,extraCols=2,flashON=!1,remSheetName,remFlashCellRange,isCopySelection=!1,isSheetFillDivAvailable=!1,rtype=-1,serverResponse=!1,ttlTimer,ClipObject=function(e){this.docid=DOCUMENT_ID,this.sheetName=CURRSHEETNAME,this.a=e,this.ver=DOCUMENT_VERSION,this.ttl=-1,this.aOwner=null,this.ftnLocalLang=ftnLocaleLang};ClipObject.prototype={setDocId:function(e){this.docid=e},isSameDocument:function(){return this.docid==DOCUMENT_ID&&-1!=this.a},setSheetName:function(e){this.sheetName=e},isSameSheet:function(){return this.isSameDocument()&&this.sheetName==CURRSHEETNAME},setVersion:function(e){this.ver=e},removeClip:function(e){isUndefined(e)&&(e="none");var t=new RequestParameters(ActionConstants.SERVERCLIP_REMOVE);t.setParameters(e);var s=new AjaxRequest;s.init("POST",t.getURL(),!0,t.getParametersAsString()),s.sendRequest(),ClipObject.hideFillDiv()},resetAction:function(){this.a=-1},setActionOwner:function(e){this.aOwner=e},setFunctionLocaleOfSource:function(e){this.ftnLocalLang=e}},ClipObject.removeClipInServer=function(){clipSheetObject&&clipSheetObject.hasClip()&&clipSheetObject.isSameDocument()?clipSheetObject.removeClip():clipRangeObject&&clipRangeObject.hasClip()&&clipRangeObject.isSameDocument()&&clipRangeObject.removeClip()},ClipObject.isLocaleSame=function(){return clipSheetObject.hasClip()?clipSheetObject.ftnLocalLang.toLowerCase()==ftnLocaleLang.toLowerCase():clipRangeObject.hasClip()?clipRangeObject.ftnLocalLang.toLowerCase()==ftnLocaleLang.toLowerCase():!0},ClipObject.setVars=function(e){if(e){var t=e.rtc?e.rtc:getSheetRange(e);e.docId!==DOCUMENT_ID&&(isClippedNow=!1),clearTTLTimer(),t?(ClipObject.clearFillDiv(!0,!1),clipRangeObject=new ClipRange(t.sr,t.sc,t.er,t.ec,e.a),clipRangeObject.setDocId(e.docId),clipRangeObject.setSheetName(e.sn),e.inop&&clipRangeObject.setInsertOption(e.inop),clipRangeObject.setTTL(e.ccttl),clipRangeObject.enableOrDisablePasteButton(),clipRangeObject.setFunctionLocaleOfSource(e.fl),ClipSheet.getClipObject().resetVars()):(ClipObject.clearFillDiv(!1,!0),clipSheetObject=new ClipSheet(e.a),clipSheetObject.setDocId(e.docId),clipSheetObject.setSheetName(e.sn),clipSheetObject.setTTL(e.ccttl),clipSheetObject.setFunctionLocaleOfSource(e.fl),ClipRange.getClipObject().resetVars())}},ClipObject.setResourceType=function(e){rtype=e};var ClipRange=function(e,t,s,i,o){ClipObject.call(this,o),this.init(e,t,s,i)};ClipRange.prototype=Object.create(ClipObject.prototype),ClipRange.prototype.constructor=ClipRange,ClipRange.prototype.init=function(e,t,s,i){this.startRow=e,this.startCol=t,this.endRow=s,this.endCol=i,this.copyStatus=!1,this.cutStatus=!1,this.insertCopyRows=!1,this.insertCopyCols=!1,this.insertCutRows=!1,this.insertCutCols=!1,this.isSolidCopy=!1,this.isDragDrop=!1,this.pasteType=null,this.isTranspose=!1,this.isChartAction=!1,this.setStatus(),this.isDragDropCopy=!1,this.isTSVRequired=!1,this.adjustedHideRows=!1},ClipRange.prototype.setTTL=function(e){this.ttl=1e3*e,this.ttl>0&&(ttlTimer=setTimeout(function(){ClipRange.getClipObject().hasClip()&&ClipRange.getClipObject().removeClip("expire")},this.ttl))},ClipRange.prototype.hasInsertOption=function(){return this.insertCopyRows||this.insertCopyCols||this.insertCutRows||this.insertCutCols},ClipRange.prototype.setStatus=function(){this.a==ActionConstants.SERVERCLIP_COPY_RANGE?this.copyStatus=!0:this.a==ActionConstants.SERVERCLIP_CUT_RANGE&&(this.cutStatus=!0),this.enableOrDisablePasteButton()},ClipRange.prototype.setIsSolidCopy=function(e){this.isSolidCopy=e},ClipRange.prototype.setIsTSVRequired=function(e){this.isTSVRequired=e},ClipRange.isCellExceed=!1,ClipRange.prototype.hasClip=function(){return-1!=this.a},ClipRange.prototype.setInsertOption=function(){0==this.startCol&&this.endCol==getColMax()-1?this.copyStatus?this.insertCopyRows=!0:this.cutStatus&&(this.insertCutRows=!0):0==this.startRow&&this.endRow==getRowMax()-1&&(this.copyStatus?this.insertCopyCols=!0:this.cutStatus&&(this.insertCutCols=!0))},ClipRange.prototype.hasFilteredRows=function(){return this.isSameSheet()&&Filter.isApplied()&&0!==Row.getHiddenRowCount(this.startRow,this.endRow)?!0:!1},ClipRange.prototype.getArraysInRange=function(){if(this.isSameSheet()){var e=this.cutStatus?!1:!0;return getArraysInRange(this.startRow,this.startCol,this.endRow,this.endCol,e)}return void 0},ClipRange.prototype.updateOnInsertOrDeleteRowOrCol=function(e,t,s){if(this.isSameSheet())switch(e){case ActionConstants.INSERT_ROW:t<=this.startRow&&(this.startRow+=s,this.endRow+=s);break;case ActionConstants.DELETE_ROW:t<=this.endRow&&(this.startRow-=s,this.endRow-=s);break;case ActionConstants.INSERT_COL:t<=this.startCol&&(this.startCol+=cnt,this.endCol+=cnt);break;case ActionConstants.DELETE_COL:t<=this.endCol&&(this.startCol-=cnt,this.endCol-=cnt)}},ClipRange.prototype.isCopyRange=function(){return this.copyStatus&&(this.endRow-this.startRow>0||this.endCol-this.startCol>0)},ClipRange.prototype.getRangeFillDim=function(){return getCellRangeDIM(this.startRow,this.startCol,this.endRow,this.endCol)},ClipRange.prototype.enableOrDisablePasteButton=function(){this.cutStatus||this.copyStatus?0!=$("#pasteButton").length&&(menutabListener.doAction(TOOLBAR.HOME,{id:"pasteButton",action:"enable",callback:button_enable,args:["pasteButton"]}),this.cutStatus?menutabListener.doAction(TOOLBAR.HOME,{id:"pasteButtonDropDown",action:"disable",callback:button_disable,args:["pasteButtonDropDown"]}):menutabListener.doAction(TOOLBAR.HOME,{id:"pasteButtonDropDown",action:"enable",callback:button_enable,args:["pasteButtonDropDown"]})):menutabListener.doAction(TOOLBAR.HOME,{id:"pasteButton",action:"disable",callback:button_disable,args:["pasteButton"]})},ClipRange.prototype.clipToServer=function(e){if(this.a!=ActionConstants.DRAG_DROP){var t=this;isClippedNow=!0;var s=new RequestParameters(this.a);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),this.startRow,this.startCol,this.endRow,this.endCol,this.isSolidCopy,this.isTSVRequired,DOCUMENT_VERSION);var i=new AjaxRequest;i.init("POST",s.getURL(),!1,s.getParametersAsString()),i.addEventListener("onComplete",function(s){if(e){if(null==s.responseText||"undefined"==typeof s.responseText)return void recalculate("",!0);var i=s.getResponseHeader("content-type")||"",o=!1;i.indexOf("html")>-1&&(o=!0),"cut"!=e&&ClipRange.handleSelectedData(s.responseText,e,o)}e&&"cut"==e&&ClipRange.handleSelectedData(" ","copyShortCut",!1),t.isTSVRequired&&ClipRange.showClipBoard(decodeURIComponent(s.responseText.replace(/\+/g," ")))}),i.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),i.sendRequest(),showCopyMessage()}},ClipRange.prototype.checkCellCount=function(e){var t=0,s=0,i=this.endRow,o=this.endCol;s=i>usedCursRow?usedCursRow+1-this.startRow:this.endRow+1-this.startRow,s-=Row.getHiddenRowCount(this.startRow,this.endRow),t=o>usedCursCol?usedCursCol+1-this.startCol:this.endCol+1-this.startCol;var a=t*s;if(a>65536){SheetNotifier.close();var n={type:"PopUpTimer",content:jsMsg["CopyToClipBoad.WholeRangeCopy"],count:15,timerMsg:jsMsg["CopyToClipboard.TimerMsg"],timeOut:0};return ClipRange.isCellExceed=!0,SheetNotifier.open(n),void SheetNotifier.startTimer()}if(a>1e4){SheetNotifier.close();var n={type:"PopUpTimer",content:jsMsg["CopyToClipBoad.WholeRangeCopy"],count:15,timerMsg:jsMsg["CopyToClipboard.TimerMsg"],timeOut:0};SheetNotifier.open(n),SheetNotifier.startTimer()}else if(browser_macSafari&&"copyShortCut"!=e&&"macShortCut"!=e){SheetNotifier.close();var n={type:"PopUpTimer",content:jsMsg["CopyToClipBoad.macSafari.Msg"],count:15,timerMsg:jsMsg["CopyToClipboard.TimerMsg"],timeOut:0};return SheetNotifier.open(n),SheetNotifier.startTimer(),void this.copyToServer()}RangeSelector.isActive()||this.isDragDrop||(focusCellRangeFill(this.startRow,this.startCol,this.endRow,this.endCol,!0),isCellRangeFillDivAvailable=!0),checkIfRangeInViewPort(this.startRow,this.startCol,this.endRow,this.endCol)?this.copyClient(e):this.clipToServer(e)},ClipRange.prototype.adjustArrayCells=function(e,t){var s=e,i=t,o=s+(this.endRow-this.startRow),a=i+(this.endCol-this.startCol),n=null,r=this.getArraysInRange();if("undefined"!=typeof r&&this.cutStatus&&(i>=this.startCol&&i<=this.endCol||a>=this.startCol&&a<=this.endCol)&&(s>=this.startRow&&s<=this.endRow||o>=this.startRow&&o<=this.endRow)&&(n=r,clearOldArrayPosition(this.startRow,this.startCol,this.endRow,this.endCol)),isPartOfArray(s,i,o,a)){if(null!=n)for(var l=0;l<n.length;l++)arrayDetails.push(n[l]);return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),!0}var c=[];if("undefined"!=typeof r)for(var p=0;p<r.length;p++){var C=r[p],h=s+C[0]-this.startRow,g=s+C[1]-this.startRow,d=i+C[2]-this.startCol,R=i+C[3]-this.startCol;if(isPartOfArray(h,d,g,R)){if(null!=n)for(var l=0;l<n.length;l++)arrayDetails.push(n[l]);return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),!0}c.push([h,d,g,R])}if(clearOldArrayPosition(s,i,o,a),this.isSameSheet()){this.cutStatus&&clearOldArrayPosition(this.startRow,this.startCol,this.endRow,this.endCol);for(var l=0;l<c.length;l++){var u=c[l];updateArrayDetails("SUBMIT",u[0],u[1],u[2],u[3])}}return!1},ClipRange.prototype.adjustMergeCellsForCopyRange=function(){var e=getCellRange(),t=this.isSameDocument()?cellRangeContainsMergeCells(this.startRow,this.startCol,this.endRow,this.endCol):!1;if(t){var s=this.endRow-this.startRow+1,i=this.endCol-this.startCol+1;if(Filter.isApplied()){var o=Row.getHiddenRowCount(this.startRow,this.endRow);s-=o,this.adjustedHideRows=o>0?!0:!1}var a=e.endRow-e.startRow+1;a=a<(this.isTranspose?i:s)?this.isTranspose?i:s:a;var n=e.endCol-e.startCol+1;if(n=n<(this.isTranspose?s:i)?this.isTranspose?s:i:n,isCellRange()){var r=e.startRow,l=e.startCol;focusCellRange(r,l,r+a-1,l+n-1,void 0,!0)}else focusCellRange(currRow,currCol,currRow+a-1,currCol+n-1)}var r=e.startRow,l=e.startCol,c=e.endRow,p=e.endCol;if(cellRangeContainsMergeCells(r,l,c,p))return showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!0;if(t){var C=new Range(this.startRow,this.startCol,this.endRow,this.endCol),h=C.getIterator();h.addEventListener("onMergeEncounter",function(e,t,s,i,o){var a=getCell(e,t);if(a){var n=this.getMerge(),r=n.getRowSpan(),l=n.getColSpan(),c=e-i,p=t-o,C=s.startRow+c,h=s.startCol+p,g=C+r-1,d=h+l-1;mergeCells(C,h,g,d,!0,!0,!0)}},e,this.startRow,this.startCol),h.iterate()}return!1},ClipRange.prototype.adjustMergeCellsForCopyCell=function(){var e,t,s,o,a,n=1,r=Merge.getCellInfo(this.startRow,this.startCol);if(r&&(s=r.getColSpan(),n=r.getRowSpan()),1==s||1==n)return!1;if(!isCellRange())return cellDragProps.isDraggable?(o=cellDragProps.cellDragRange.CSR,e=cellDragProps.cellDragRange.CSC,a=cellDragProps.cellDragRange.CER,t=cellDragProps.cellDragRange.CEC):(o=currRow,e=currCol,a=currRow+n-1,t=currCol+s-1),cellRangeContainsMergeCells(o,e,a,t)?(showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!0):(mergeCells(o,e,a,t,!0,!0,!0),!1);var l=getCellRange(),c=l.endCol-l.startCol+1,p=l.endRow-l.startRow+1,C=c/s,h=p/n,g=Math.floor(C),d=Math.floor(h),R=g,u=d;g!=C&&(R=1),d!=h&&(u=1);var t=l.startCol+R*s,a=l.startRow+u*n;if(cellRangeContainsMergeCells(l.startRow,l.startCol,a,t))return showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!0;for(i=0;u>i;i++)for(j=0;R>j;j++)o=l.startRow+i*n,e=l.startCol+j*s,a=o+n-1,t=e+s-1,mergeCells(o,e,a,t,!0,!0,!0);return!1},ClipRange.prototype.rangeToCellRange=function(){if(isCellRange()){var e=getCellRange(),t=this.endCol-this.startCol+1,s=isWholeSheetSelected()?getRowMax()-1:this.endRow-this.startRow+1;isRowSelected()&&(e.endCol=getColMax()-1);var i=e.endCol-e.startCol+1,o=isWholeSheetSelected()?getRowMax()-1:e.endRow-e.startRow+1;if(this.isTranspose){if(1>i/s||1>o/t){var a=showConfirmDialog(jsMsg.TheContentCopiedIsBigger+" "+jsMsg.DoYouWantToInsertAnyway);if(!a)return!1;this.adjustRowsAndCols()}}else if(1>i/t||1>o/s&&!this.adjustedHideRows){var a=showConfirmDialog(jsMsg.TheContentCopiedIsBigger+" "+jsMsg.DoYouWantToInsertAnyway);if(!a)return!1;this.adjustRowsAndCols()}}return this.submitPaste(),!0},ClipRange.prototype.paste=function(e,t,s){if(ChartClipOperation.getClipObject().hasClip())return void chartClipOperation.pasteClip();this.pasteType=s,this.isTranspose=!1,isUndefined(s)?this.pasteType="ALL":"TRANSPOSE"==s&&(this.isTranspose=!0);var i=getObj("notifier");if(i&&hideNotifier(),this.isSameSheet()&&this.adjustArrayCells(e,t))return!1;if(this.copyStatus){if(this.isCopyRange()){if(this.isSameSheet()&&this.adjustMergeCellsForCopyRange())return!1;if(isCellRange())return this.rangeToCellRange();this.adjustRowsAndCols()}else if(this.isSameSheet()&&this.adjustMergeCellsForCopyCell())return!1}else this.cutStatus&&(0!=$("#pasteButton").length&&$("#pasteButton").disable(),this.adjustRowsAndCols());if(browser_safari){var o=ActiveCellInfo;o.getStartRow()<FREEZED_ROW&&(cellField.style.width=o.getWidth()-1+"px",cellField.style.height=o.getHeight()-1+"px",sheetPane1.scrollTop=sheetPane2.scrollTop=0)}this.submitPaste(e,t),remSheetName="",remFlashCellRange="",flashON=!1,isCopySelection=!1},ClipRange.prototype.adjustRowsAndCols=function(){var e=currRow+(this.endRow-this.startRow)+1,t=currCol+(this.endCol-this.startCol)+1;if(this.isTranspose&&(e=currRow+(this.endCol-this.startCol)+1,t=currCol+(this.endRow-this.startRow)+1),!(e>=65536||totRows>=e)){appendBlankRows("ROWS_EXCEEDED",totRows)}if(t>totCols){var s=t-totCols+extraCols;insertCol("append",totCols,s,!0,!0,!0,void 0,void 0,void 0,void 0,!0)}},ClipRange.prototype.submitPaste=function(e,t){var s,i;if((jsREMOTE_VIEW||this.isDragDrop)&&ClipObject.hideFillDiv(),this.isDragDrop){s=e,i=t;var o=Merge.getCellInfo(e,t);o&&(e=o.startRow,t=o.startCol)}else if(isCellRange()){var a=getCellRange();e=a.startRow,t=a.startCol,s=a.endRow,i=a.endCol}else e=s=currRow,t=i=currCol;var n=getServerRange(e,t,s,i);s=n.endRow,i=n.endCol;var r=new Range(this.startRow,this.startCol,this.endRow,this.endCol),l=this.endRow-this.startRow+1,c=this.endCol-this.startCol+1,p=s-e+1,C=i-t+1;if(p=Math.max(p,this.isTranspose?c:l),C=Math.max(C,this.isTranspose?l:c),predictedDestEndRow=e+p-1,predictedDestEndCol=t+C-1,this.isTranspose){var h=new Range(e,t,predictedDestEndRow,predictedDestEndCol);if(this.isSameSheet()&&(r.intersects(h)||h.intersects(r)))return void showAlertDialog(jsMsg.PasteTransposeRangesCannotIntersect)}if(!this.copyStatus&&!this.cutStatus||!ProtectedRanges.isRangeLocked(e,t,predictedDestEndRow,predictedDestEndCol)){if(pivot.Collection.isPivotRange(e,t,predictedDestEndRow,predictedDestEndCol))return void showAlertDialog(jsMsg["Error.Pivot.Table.Part.Change"]);var g=new RequestParameters(ActionConstants.SERVERCLIP_PASTE_RANGE);if(g.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t,s,i,this.pasteType,this.isTranspose),this.a==ActionConstants.DRAG_DROP){if(cellDragProps.isDraggable){var d=cellDragProps.cellDragRange.ASR,R=cellDragProps.cellDragRange.ASC,u=cellDragProps.cellDragRange.AER,S=cellDragProps.cellDragRange.AEC;if(isUndefined(e)&&(e=cellDragProps.cellDragRange.CSR,t=cellDragProps.cellDragRange.CSC),ClipRange.isPasteAreaContainsMergedCells(e,t))return showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!1;g=new RequestParameters(ActionConstants.DRAG_DROP),g.setParameters(WorkSheets.getAssociatedActiveSheetName(),d,R,u,S,WorkSheets.getAssociatedActiveSheetName(),e,t,WorkSheets.getActiveSheetName(),this.isDragDropCopy),this.resetVars()}}else this.a==ActionConstants.COPY_TO_CLIP&&(g=new RequestParameters(ActionConstants.COPY_PASTE),g.setParameters(WorkSheets.getAssociatedActiveSheetName(),this.startRow,this.startCol,this.endRow,this.endCol,WorkSheets.getSheetCodeFromName(this.sheetName),e,t,s,i,this.pasteType,this.isTranspose,this.sheetName));var f=new AjaxRequest;f.init("POST",g.getURL(),!0,g.getParametersAsString()),f.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),isRecastAction=!1,actionManager.addRequest(f),setFocusInCellField()}},ClipRange.prototype.resetVars=function(){this.resetAction(),this.init(-1,-1,-1,-1),this.enableOrDisablePasteButton()},ClipRange.prototype.clipHasMoreRows=function(){return this.endRow-this.startRow>0},ClipRange.prototype.clipHasMoreCols=function(){return this.endCol-this.startCol>0},ClipRange.prototype.cut=function(e){var t=ClipRange.processRange();return isPivotOrArrayRange(t.sr,t.sc,t.er,t.ec)?(focusCellRange(currRow,currCol,currRow+(t.er-t.sr),currCol+(t.ec-t.sc),void 0,!0),ClipObject.hideFillDiv(),!1):ProtectedRanges.isRangeLocked(t.sr,t.sc,t.er,t.ec)?(this.cutStatus=!0,void(this.copyStatus=!1)):(isCopySelection=!0,flashON=!0,remSheetName=CURRSHEETNAME,remFlashCellRange=t.flashCell,this.a=e?ActionConstants.DRAG_DROP:ActionConstants.SERVERCLIP_CUT_RANGE,this.startRow=t.sr,this.startCol=t.sc,this.endRow=t.er,this.endCol=t.ec,this.isDragDrop=e,this.clipToServer("cut"),this.cutStatus=!0,this.copyStatus=!1,void(RangeSelector.isActive()||this.isDragDrop||focusCellRangeFill(t.sr,t.sc,t.er,t.ec,!0)))},ClipRange.prototype.copy=function(e){if(ole.isActive()&&ole.getCurrObj())return void chartOLEAction.copyChart(ole.getCurrObj().id);if(ChartClipOperation.getClipObject().hasClip()&&chartClipOperation.removeClip(),!requestSent){serverResponse=!1;var t=ClipRange.processRange();isCopySelection=!0,flashON=!0,remSheetName=CURRSHEETNAME,remFlashCellRange=t.flashCell,documentBakeStatus.objectBaked&&(this.setParams(t,e),this.checkCellCount(e))}},ClipRange.prototype.setParams=function(e,t){this.startRow=e.sr,this.startCol=e.sc,this.endRow=e.er,this.endCol=e.ec,"dragDrop"==t&&(this.isDragDrop=!0,this.isDragDropCopy=!0),this.a=this.isDragDrop?ActionConstants.DRAG_DROP:ActionConstants.SERVERCLIP_COPY_RANGE,this.copyStatus=!0,ClipRange.isSameContent=!1},ClipRange.prototype.copyToServer=function(){RangeSelector.isActive()||this.isDragDrop||(focusCellRangeFill(this.startRow,this.startCol,this.endRow,this.endCol,!0),isCellRangeFillDivAvailable=!0),isClippedNow=!0;var e=new RequestParameters(ActionConstants.SERVERCLIP_COPY_RANGE);e.setParameters(WorkSheets.getAssociatedActiveSheetName(),this.startRow,this.startCol,this.endRow,this.endCol,!1,!1,DOCUMENT_VERSION,!0);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()},ClipRange.copy=function(e){clipRangeObject.copy(e)},ClipRange.cut=function(){clipRangeObject.cut()},ClipRange.pasteSpecial=function(e){new Date;clipRangeObject.paste(void 0,void 0,e)},ClipRange.processRange=function(){var e,t,s,i,o;if(isCellRange()){var a=getCellRange();e=a.startRow,t=a.startCol,s=isWholeSheetSelected()?getRowMax()-1:a.endRow,i=isRowSelected()?getColMax()-1:a.endCol,o=currCellRange}else{e=s=currRow,t=i=currCol;var n=Merge.getCellInfo(currRow,currCol);n&&(s+=n.getRowSpan()-1,i+=n.getColSpan()-1),o="R"+e+"C"+t+":R"+s+"C"+i}return{sr:e,sc:t,er:s,ec:i,flashCell:o}},ClipRange.paste=function(e,t,s){return ChartClipOperation.getClipObject().hasClip()?void chartClipOperation.pasteClip():(isUndefined(e)&&(e=currRow,t=currCol),ClipRange.isPasteAreaContainsMergedCells(e,t)?(showAlertDialog(jsMsg.CannotPasteIntoMergedCell),cellDragProps.isDraggable&&(dragDIV.style.display="none",dragDIV1.style.display="none",dragDIV2.style.display="none",dragDIV3.style.display="none"),!0):(-1!=clipRangeObject.a&&clipRangeObject.paste(e,t,s),!1))},ClipRange.isPasteAreaContainsMergedCells=function(e,t){if(cellDragProps.isDraggable){var s=Merge.getCellInfo(e,t);if(s)return!0;var i=cellDragProps.cellDragRange.CER-cellDragProps.cellDragRange.CSR,o=cellDragProps.cellDragRange.CEC-cellDragProps.cellDragRange.CSC,a=e,n=t,r=a+i,l=n+o;if(cellRangeContainsMergeCells(a,n,r,l))return!0}else{if(ActiveCellInfo.isMerged())return!0;var i=clipRangeObject.endRow-clipRangeObject.startRow,o=clipRangeObject.endCol-clipRangeObject.startCol,a=ActiveCellInfo.getStartRow(),n=ActiveCellInfo.getStartCol(),r=a+i,l=n+o;if(cellRangeContainsMergeCells(a,n,r,l))return!0}},ClipRange.copytoclip=function(e){if(SheetNotifier.close(),!MKIMODE||MKIEXPORT){var t="",s=getCellRange();if(getAvailableStartRow()<=s.startRow&&getAvailableEndRow()>=s.endRow){var i=(s.endRow-s.startRow,s.endCol-s.startCol,new Range(s.startRow,s.startCol,s.endRow,s.endCol)),o=i.getIterator();o.initData(t),o.setDataProcessor(function(e){var t=this.getData();return t+=e}),o.addEventListener("onRowAfter",function(){this.processData("\n")}),o.iterate(function(e,t,s,i){var o=getCell(e,t);if(o){var a=getCellValue(o);"Link"==s&&(a=getHyperLinkInCell(o).childTag.href),null==a&&(a=""),this.processData(a),t!=i.endCol&&this.processData("	")}},e,s);var a=o.getData();ClipRange.showClipBoard(a,e)}else clipRangeObject.setIsTSVRequired(!0),clipRangeObject.clipToServer()}},ClipRange.handleSelectedData=function(e,t,s){if(!e)return void hideProgressMessage();serverResponse=!0;var i;if(window.clipboardData&&clipboardData.setData&&!s)return cellField.blur(),i=getObj("cpTextArea"),i.value=e,clipboardData.setData("text",i.innerText),i.value="",hideProgressMessage(),void setTimeout(setFocusInCellField,1);if(s){i=getObj("cpDiv"),i.innerHTML="";var o=document.createElement("div");o.innerHTML=e;var a=document.createDocumentFragment();a.appendChild(o.firstChild),i.appendChild(a),i.focus();var n=document.getSelection();n.selectAllChildren(i)}else i=getObj("cpTextArea"),i.value=e,i.select(),i.focus();if(("toolbarcopy"==t||"contextcopy"==t)&&triggerCopy(),"macShortCut"==t){setTimeout(function(){requestSent=!1},100),i=getObj("cpDiv"),i.innerHTML=e,i.focus();var n=document.getSelection();n.selectAllChildren(i),showCopyCue()}hideProgressMessage(),setTimeout(setFocusInCellField,200)},ClipRange.showClipBoard=function(e,t){var s="Link"==t?jsMsg.CopyLinkLocation:jsMsg.CopyToClipboard,i={clbvalue:e,init:function(){var e=$("#txt_copytoclip");e.val(this.clbvalue),setTimeout(function(){e.focus(),e.select()},200)}},o={width:500,title:s,buttons:[{text:jsMsg.Close,click:function(){sheetdialog.close()}}]};sheetdialog.open("clipboarddialog",o,i)};var strSourceAttr='source="ZohoSheet"',ieClipboardDiv=$("#cpDiv");ClipRange.pasteFromShortCut=function(){if(ChartClipOperation.getClipObject().hasClip())return void chartClipOperation.pasteClip();if(ClipRange.getClipObject().cutStatus)ClipObject.showLocaleInfoDialog("pasteRange");else if(browser_macSafari){var e=getObj("cpDiv");e.focus();var t=document.getSelection();t.selectAllChildren(e)}else cpTextArea.focus(),cpTextArea.select()},ClipRange.pasteRangeOnSheetDiv=function(e){if(!isCellFieldInEditMode()){var t,s,i;READ_WRITE&&(window.clipboardData?(t=window.clipboardData,setTimeout(function(){s=t.getData("Text"),i=ieClipboardDiv.html(),ieClipboardDiv.empty(),ClipRange.pasteFromSystemClipboard(s,i)},0)):(t=e.clipboardData,s=t.getData("text/plain"),i=t.getData("text/html"),!i&&ieClipboardDiv.html()&&isMSEdge()&&(i=ieClipboardDiv.html(),ieClipboardDiv.empty(),t.setData("text/html",i)),e.preventDefault(),ClipRange.pasteFromSystemClipboard(s,i)))}},ClipRange.pasteRangeIE=function(e){ieClipboardDiv.focus(),ieClipboardDiv.select(),window.clipboardData||e.clipboardData?ClipRange.pasteRangeOnSheetDiv(e):isMSEdge()&&ClipRange.compareContent(e.clipboardData.getData("text/plain"),e.clipboardData.getData("text/html"))},ClipRange.pasteFromSystemClipboard=function(e,t){var s=getCellRange();if(!ProtectedRanges.isRangeLocked(s.startRow,s.startCol,s.endRow,s.endCol)){if((t&&t.indexOf(ClipRange.htmlSrc)>=0||0===t.length&&0===e.length||ClipRange.isCellExceed)&&ClipRange.getClipObject().hasClip())return void ClipObject.showLocaleInfoDialog("pasteRange");var i=e.replace(/ /g,""),o=0==i.length&&t&&0==t.length?!0:!1;if(o)return void hideCellField();if(cellRangeContainsMergeCells(s.startRow,s.startCol,s.endRow,s.endCol))return hideCellField(),showAlertDialog(jsMsg.CannotPasteIntoMergedCell),!0;if(browser_safari){var a=ActiveCellInfo;a.getStartRow()<FREEZED_ROW&&(cellField.style.width=a.getWidth()-1+"px",cellField.style.height=a.getHeight()-1+"px",sheetPane1.scrollTop=sheetPane2.scrollTop=0)}if(isPivotOrArrayRange(s.startRow,s.startCol,s.endRow,s.endCol))return!0;clearOldArrayPosition(s.startRow,s.startCol,s.endRow,s.endCol);for(var n=e,r=n.split("\n"),l=!1,c=!1,p=!1,C=!1,h=!1,g=0;g<r.length&&10>g;g++)if(""!=r[g]){if(-1==r[g].indexOf("	")){l=!1;break}l=!0}if(!l)for(var d=/^[A-Za-z0-9 ]*$/,g=0;g<r.length&&10>g;g++)if(""!=r[g])if(-1!=r[g].indexOf(" ")){var R=r[g].split(" ");if(!(R.length<=2&&d.test(r[g]))){c=!1;break}c=!0}else{if(!d.test(r[g])){c=!1;break}c=!0}if(!c)for(var u=/^[A-Za-z0-9]*$/,g=0;g<r.length&&10>g;g++)if(""!=r[g]){if(!u.test(r[g])){p=!1;break}p=!0}if(!p)for(var g=0;g<r.length;g++){if(""!=r[g].trim()){h=!1;break}h=!0}if(1===r.length?C=!0:2===r.length&&(C=""!=r[0]&&""===r[1]?!0:!1),null!=t&&t.length>0||l||c||p||C||h){adjustColsAndRowsForTextArea(),isSelectionAfterPaste=!1;var S=new RequestParameters(ActionConstants.SYSTEMCLIP_PASTE);if(t.length>0&&t.length<1e6&&isHtmlParserEnabled)isHTMLDataPasted=!0,S.setParameters(WorkSheets.getAssociatedActiveSheetName(),s.startRow,s.startCol,encodeURIComponent(t),!0,isFormatApply);else{if(!(encodeURI(e).replace(/%20/g,"").length>0&&e.length<1e6))return void((t.length>1e6||e.length>1e6)&&showAlertDialog(jsMsg.ErrorExceedingPastedData));S.setParameters(WorkSheets.getAssociatedActiveSheetName(),s.startRow,s.startCol,encodeURIComponent(e),!1,!1)}var f=new AjaxRequest;f.init("POST",S.getURL(),!0,S.getParametersAsString()),actionManager.addRequest(f),l=!1,c=!1,p=!1,C=!1,h=!1,isWidgetCreated=!1}else TexttoColumns.cellContent=n,TexttoColumns.init(),TexttoColumns.submit();cpTextArea.blur(),hideCellField(),hideCellRangeFillDIV()}},ClipRange.removeClipFromServer=function(){clipRangeObject.removeClip()},ClipRange.getClipObject=function(){return isUndefined(clipRangeObject)&&(clipRangeObject=new ClipRange(-1,-1,-1,-1,-1)),clipRangeObject};var ClipSheet=function(e){ClipObject.call(this,e),this.init()};ClipSheet.prototype=Object.create(ClipObject.prototype),ClipSheet.prototype.constructor=ClipSheet,ClipSheet.prototype.init=function(){this.stc=new Array},ClipSheet.prototype.setTTL=function(e){this.ttl=1e3*e,this.ttl>0&&(ttlTimer=setTimeout(function(){ClipSheet.getClipObject().hasClip()&&ClipSheet.getClipObject().removeClip("expire")},this.ttl))},ClipSheet.prototype.resetVars=function(){this.resetAction()},ClipSheet.prototype.copy=function(){isClippedNow=!0,showsheetTabFillDIV();var e=shortenSheetName(CURRSHEETNAME,15),t=replaceParams(jsMsg["CopySheet.ProgressMessage"],[e]);showProgressMessage(t),0==this.stc.length&&this.stc.push("'"+WorkSheets.getAssociatedActiveSheetName()+"'");var s=new RequestParameters(ActionConstants.SERVERCLIP_COPY_SHEET);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),"["+this.stc+"]");var i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),i.sendRequest(),setTimeout(function(){hideProgressMessage(),showSuccessMessage(jsMsg["CopyClip.SheetCopy.SuccessMsg"])},2e3)},ClipSheet.prototype.duplicate=function(e){showProgressMessage(jsMsg["DuplicateSheet.ProgressMessage"]);var t=new RequestParameters(ActionConstants.SHEET_DUPLICATE);t.setParameters(CURRSHEETNAME,WorkSheets.getSheetCodeFromName(currSheetOnRightClick),"AfterCurrentSheet",currSheetOnRightClick,e);var s=new AjaxRequest;s.init("POST",t.getURL(),!0,t.getParametersAsString()),actionManager.addRequest(s)},ClipSheet.insertPastedSheets=function(e,t,s){var i;for(var o in e){var a=e[o];"undefined"!=typeof a.sn&&(a.a=ActionConstants.SHEET_COPY,updateWorkbookLevelAction(a,!1,!0)),0==o&&(i=a)}s&&showsheet("sheetdiv-"+t,"open")},ClipObject.cancelPaste=function(){var e=new RequestParameters(ActionConstants.SERVERCLIP_PASTE_SHEET_CANCEL);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()},ClipSheet.prototype.paste=function(e,t){e=parseJSON(e);var s=WorkSheets.getActiveSheetName();if(e){var i=WorkSheets._sheetNamesMetaList[WorkSheets.NAME_POS].length;s=WorkSheets._sheetNamesMetaList[WorkSheets.NAME_POS][i-1]}var o=new RequestParameters(ActionConstants.SERVERCLIP_PASTE_SHEET);o.setParameters(WorkSheets.getSheetCodeFromName(s),t);var a=new AjaxRequest;a.init("POST",o.getURL(),!0,o.getParametersAsString()),a.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),actionManager.addRequest(a)},ClipSheet.prototype.hasClip=function(){return-1!=this.a},ClipSheet.copy=function(){ClipObject.clearSheetTabFill(),clipSheetObject.copy()},ClipSheet.duplicate=function(){var e=null!=ProtectedRanges.getObject().getSheets().getSheetObj(CURRSHEETNAME),t=ProtectedRanges.getObject().getRanges().list.length>0;ProtectedRanges.showMenuEntry()&&(e||t)?ClipSheet.showLockInfoDialog("duplicate",!1):ClipSheet.getClipObject().duplicate(!1)},ClipSheet.getSheetList=function(e){if(clipSheetObject.isSameDocument()){if(!WorkSheets.isNameExists(clipSheetObject.sheetName))return clipSheetObject.removeClip(),!1;var t=new RequestParameters(ActionConstants.IS_LOCK_EXISTS);t.setParameters(WorkSheets.getSheetCodeFromName(clipSheetObject.sheetName));var s=new AjaxRequest;s.init("POST",t.getURL(),!0,t.getParametersAsString()),s.addEventListener("onComplete",function(t){if(""!==t.responseText){var s=parseJSON(t.responseText),i=s[JSONConstants.HAS_PROTECTED_RANGES],o=s[JSONConstants.IS_SHEET_PROTECTED];i||o?ClipSheet.showLockInfoDialog("copypaste",e):clipSheetObject.paste(e,!1)}}),s.sendRequest()}else ClipSheet.getRefSheets(e,"ddoc")},ClipSheet.getRefSheets=function(e,t){var s=new RequestParameters(ActionConstants.SERVERCLIP_GET_REFSHEETS);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),t);var i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.addEventListener("onComplete",function(s){if(""!==s.responseText){var i=parseJSON(s.responseText),o=i.refsheetList;if(isUndefined(o)){if(!isUndefined(i.a)&&i.a==ActionConstants.SHOW_ERROR_MESSAGE){var a=i.mk,n=a.split("#"),r=replaceParams(jsMsg[n[0]],[n[1]]);showAlertDialog(r)}}else o.length>0?ClipSheet.showSheetListDialog(e,i.refsheetList,t):"ddoc"==t?ClipSheet.getClipObject().paste(e,!1):"sdoc"==t&&ClipSheet.createNewSpreadsheet(!1)}}),i.sendRequest()},ClipSheet.createNewSpreadsheet=function(e){InfoBanner.hideBanner(),showProgressMessage(jsMsg["CopySheet.Create.New.Spreadsheet.ProgressMessage"]);var t=new RequestParameters(ActionConstants.SHEET_COPY_CREATE_NEW_SPREADSHEET);t.setParameters(WorkSheets.getSheetCodeFromName(currSheetOnRightClick),e);var s=new AjaxRequest;s.init("POST",t.getURL(),!0,t.getParametersAsString()),s.addEventListener("onComplete",function(e){if(hideProgressMessage(),""!==e.responseText){var t=parseJSON(e.responseText);if(t.newRID){var s=window.location,i=s.origin+ctxpath+"open/"+t.newRID;ClipSheet.showInfoBanner(i),setTimeout(function(){window.open(i,"_blank")},1e3)}}}),s.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),s.sendRequest()},ClipSheet.showInfoBanner=function(e){var t=jsMsg["CopySheet.Create.New.Spreadsheet.InfoBanner"]+" <a class='link' target='_blank' href='"+e+"'>"+jsMsg["InfoBanner.ClickHere"]+"</a>";InfoBanner.showBanner(t,!1,"success")},ClipSheet.showSheetListDialog=function(e,t,s){for(var i=$("<span/>"),o=0;o<t.length;o++){var a=t[o],n=$("<div/>",{class:"sheetListElem"}).text(a);n.appendTo(i)}var r={autoOpen:!1,width:470,modal:!0,resizable:!1,title:jsMsg.ZohoSheet,buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){var t=$("#sheetListDialog").find("input#refSheet").prop("checked");"ddoc"==s?ClipSheet.getClipObject().paste(e,t):"sdoc"==s&&ClipSheet.createNewSpreadsheet(t),$(this).zdialog("close")}},{text:jsMsg.Cancel,click:function(){ClipObject.cancelPaste(),$(this).zdialog("close")}}]};sheetdialog.open("sheetlistdialog",r,{init:function(){$("div#sheetListDialog").show(),$("#sheetlistdialogzdialog").parent().find(".ui-dialog-titlebar-close").hide(),$("div#sheetList").html(i.html())}})},ClipSheet.showLockInfoDialog=function(e,t){var s={buttons:[{text:jsMsg.Yes,class:"ui-zbutton-primary",click:function(){"duplicate"==e?ClipSheet.getClipObject().duplicate(!0):ClipSheet.getClipObject().paste(t,!0),$(this).zdialog("close")}},{text:jsMsg.No,click:function(){"duplicate"==e?ClipSheet.getClipObject().duplicate(!1):ClipSheet.getClipObject().paste(t,!1),$(this).zdialog("close")}}]},i=jsMsg["DuplicateSheet.LockConfirmMsg"];"copypaste"==e&&(i=jsMsg["CopySheet.LockConfirmMsg"]),sheetdialog.showConfirmDialog(i,s)},ClipSheet.getClipObject=function(){return isUndefined(clipSheetObject)&&(clipSheetObject=new ClipSheet(-1)),clipSheetObject},ClipSheet.changePasteMenuItem=function(){var e=$("#pastesheet");if(e.show(),(ALLOW_TO_WRITE||REMOTE.MODE==REMOTE.SCRATCHVIEW||jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW)&&ClipSheet.getClipObject().hasClip()){e.enable();var t=ClipSheet.getClipObject().sheetName,s=shortenSheetName(t,9);e.find("span.ui-zmenu-text").text(jsMsg["CopySheet.Paste"]+" '"+s+"'"),e.attr("title",t)}else ALLOW_TO_WRITE||REMOTE.MODE==REMOTE.SCRATCHVIEW||jsREMOTE_VIEW?(e.find("span.ui-zmenu-text").text(jsMsg["CopySheet.Paste"]),e.disable()):e.hide()},ClipSheet.changeMenuItem=function(){this.changePasteMenuItem();var e=shortenSheetName(CURRSHEETNAME,18),t=$("#copysheet");t.show(),t.next().show();var s=$("li#copysheetmenu");s.show(),s.find("div").remove(),s.find("span.helpInfo").remove();var i=s.find("span.ui-zmenu-text");i.text(jsMsg.Copy+" '"+e+"'"),i.attr("title",CURRSHEETNAME);var o=$("<div/>",{class:"sheetCopyHintText"}).text(jsMsg["CopySheet.Tip"]);o.appendTo(s);var a=$("<span/>",{class:"helpInfo helpInfoPosition",onmouseover:'showToolTip(this, "'+jsMsg["CopySheet.TipHint"]+'")',onmouseout:"removeToolTip(this)"});return a.appendTo(s),s=$("li#createspreadsheetmenu"),s.find("div").remove(),cdview||4==rtype||jsPUBLIC_VIEW&&(!allowExport||!allowExportOrg||!showFormulas||!showFormulasOrg)||jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW||REMOTE.MODE==REMOTE.SCRATCHVIEW?(s.prev().hide(),void s.hide()):(s.show(),s.prev().show(),o=$("<div/>",{class:"sheetCopyHintText"}).text(jsMsg["CopySheet.NewSpreadsheet.Tip"]),void o.appendTo(s))},ClipObject.clearClip=function(){jsVERSION_VIEW||(ClipSheet.getClipObject().isSameDocument()&&isClippedNow?ClipSheet.getClipObject().removeClip():ClipRange.getClipObject().isSameDocument()&&isClippedNow&&ClipRange.getClipObject().removeClip()),ClipObject.hideFillDiv()},ClipObject.hideFillDiv=function(){if(isCellRangeFillDivAvailable){isCellRangeFillDivAvailable=!1;var e="none";ISFREEZED&&(cellRangeFillDIV1.style.display=cellRangeFillDIV2.style.display=cellRangeFillDIV3.style.display=e),cellRangeFillDIV.style.display=e,flashON=!1}else isSheetFillDivAvailable&&(ClipObject.clearSheetTabFill(),isSheetFillDivAvailable=!1);isClippedNow=!1},ClipObject.clearFillDiv=function(e,t){if(isClippedNow){if(e)ClipObject.clearSheetTabFill();else if(t){var s="none";ISFREEZED&&(cellRangeFillDIV1.style.display=cellRangeFillDIV2.style.display=cellRangeFillDIV3.style.display=s),cellRangeFillDIV.style.display=s}}else if(e){var s="none";ISFREEZED&&(cellRangeFillDIV1.style.display=cellRangeFillDIV2.style.display=cellRangeFillDIV3.style.display=s),cellRangeFillDIV.style.display=s}else t&&ClipObject.clearSheetTabFill()},ClipObject.clearSheetTabFill=function(){var e=$("#sheetsTabTable").find("div");e.removeClass("fadeIt marginFirst sTF drop")},appEvent.on("copysheet.insert",function(e,t,s){ClipSheet.insertPastedSheets(e,t,s)}),appEvent.on("wms.messageprocessed",function(e){var t=e.cC;t&&void 0==t.sn&&(t.sn=t.sheetList&&WorkSheets.getSheetNameFromCode(t.sheetList[0][0])),t?ClipObject.setVars(t):0==t&&(ClipRange.getClipObject().resetVars(),ClipSheet.getClipObject().resetVars()),e.pasteAction&&ClipObject.hideFillDiv()}),appEvent.on("grid.afterRowResize",function(e){if(e&&e.length){var t=e[e.length-1].er,s=ClipRange.getClipObject();$("#fCRID").is(":visible")&&t<=s.endRow&&!fPainter.fPaintersingleclick&&!fPainter.fPainterdoubleclick&&focusCellRangeFill(s.startRow,s.startCol,s.endRow,s.endCol,!0)}}),appEvent.on("grid.afterColumnResize",function(e,t){var s=ClipRange.getClipObject();$("#fCRID").is(":visible")&&t<=s.endCol&&focusCellRangeFill(s.startRow,s.startCol,s.endRow,s.endCol,!0)}),appEvent.on("grid.shift",function(){var e=ClipRange.getClipObject();$("#fCRID").is(":visible")&&focusCellRangeFill(e.startRow,e.startCol,e.endRow,e.endCol,!0)}),$("#cpTextArea").blur(function(){setFocusInCellField()}),$(document).ready(function(){createToolTip()}),ClipObject.checkIsServerClipSourceSheet=function(e){if(ClipSheet.getClipObject().hasClip()){if(ClipSheet.getClipObject().isSameDocument()&&e==clipSheetObject.sheetName)return clipSheetObject.removeClip(),!1}else if(ClipRange.getClipObject().hasClip()&&ClipRange.getClipObject().isSameDocument()&&e==clipRangeObject.sheetName)return clipRangeObject.removeClip(),!1},ClipObject.showLocaleInfoDialog=function(e,t,s){var i=ClipObject.isLocaleSame()?!1:!0;if(i){var o={buttons:[{text:jsMsg.Yes,class:"ui-zbutton-primary",click:function(){ClipObject.sendPasteRequest(e,t,s),$(this).zdialog("close")}},{text:jsMsg.No,click:function(){ClipObject.cancelPaste(),$(this).zdialog("close")}}]},a=jsMsg["CopyClip.Locale.Info.Msg"];sheetdialog.showConfirmDialog(a,o)}else ClipObject.sendPasteRequest(e,t,s)},ClipObject.sendPasteRequest=function(e,t,s){switch(e){case"pasteSpecial":ClipRange.paste(currRow,currCol,t);break;case"pasteRange":ClipRange.paste();break;case"pasteSheet":ClipSheet.getSheetList(!1);break;case"INSERT_CUT_ROWS":case"INSERT_COPIED_ROWS":Range.executeShiftOperation(e,t,s);break;case"insertCopyCols":insertCopiedCols(t);break;case"insertCutCols":insertCutColumns(t)}},ClipRange.htmlSrc=window.location.hostname+" - ZohoSheet",ClipRange.isSameContent=!1,ClipRange.pasteEvent=function(e){if(browser_macSafari){var t=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("text/html");ClipRange.getClipObject().hasClip()?ClipRange.isSameContent?ClipObject.showLocaleInfoDialog("pasteRange"):ClipRange.compareContent(t,s):ClipRange.pasteFromSystemClipboard(t,s)}};var requestSent=!1;$(document).on("beforecopy",function(){if(browser_macSafari&&!requestSent)"cF"==document.activeElement.getAttribute("id")&&(ClipRange.getClipObject().copy("macShortCut"),requestSent=!0);else if(browser_macSafari){var e=getObj("cpDiv");e.focus();var t=document.getSelection();t.selectAllChildren(e),setTimeout(setFocusInCellField,200)}}),ClipRange.compareContent=function(e,t){var s=new RequestParameters(ActionConstants.SERVERCLIP_CLIPBOARD_COMPARE);s.setParameters(encodeURIComponent(e));var i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.addEventListener("onComplete",function(s){var i=parseJSON(s.responseText);i.isSame?(ClipObject.showLocaleInfoDialog("pasteRange"),ClipRange.isSameContent=!0):ClipRange.pasteFromSystemClipboard(e,t)}),i.sendRequest()},ClipRange.prototype.copyClient=function(e){var t=document.createDocumentFragment(),s=document.createElement("table");$(s).attr({source:ClipRange.htmlSrc,cellspacing:0,cellpadding:0,style:"font-size:13px;background-color:white;table-layout:fixed;border-collapse:collapse;"});var i=$(document.createElement("tr")),o=$(document.createElement("td"));getObj("cpDiv").innerHTML="";var a,n,r=new Range(this.startRow,this.startCol,this.endRow,this.endCol),l=r.getIterator();l.addEventListener("onRowBefore",function(){a=i.clone()}),l.addEventListener("onRowAfter",function(){a.appendTo($(s))}),l.iterate(function(e,t){n=o.clone();var s,i=getCell(e,t),r=Merge.getCellInfo(e,t);if(r){var l=r.endRow-r.startRow,c=r.endCol-r.startCol;n.attr("rowspan",l+1),n.attr("colspan",c+1)}var p=document.defaultView.getComputedStyle(i,null);if(p.padding&&n.css("padding",p.padding),p.backgroundColor&&n.css("background-color",p.backgroundColor),p.color&&n.css("color",p.color),p.fontFamily&&n.css("font-family",p.fontFamily),p.fontSize&&n.css("font-size",p.fontSize),p.fontWeight&&n.css("font-weight",p.fontWeight),p.fontStyle&&n.css("font-style",p.fontStyle),p.textDecoration&&n.css("text-decoration",p.textDecoration),p.wordWrap&&n.css("word-wrap",p.wordWrap),p.verticalAlign){var C=p.verticalAlign;$(i).hasClass("vam")&&(C="middle"),$(i).hasClass("vab")&&(C="bottom"),n.css("vertical-align",C)}var h=p.border;""==h&&(h="1px solid #CCC"),p.textAlign&&n.css("text-align",p.textAlign),n.css("border",h),n.css("width",i.style.width),n.css("height",i.style.height),"BOOLEAN"===i.getAttribute("format")?i.getAttribute("fn")?s=i.getAttribute("fn"):i.getAttribute("cv")&&(s=i.getAttribute("cv")):s=i.querySelector(".w100")?i.querySelector(".w100").innerHTML:i.innerHTML,s||(s="&nbsp"),n.html(s),n.appendTo(a)}),t.appendChild(s);var c=document.getElementById("cpDiv");c.appendChild(t),c.focus();var p=document.getSelection();p.selectAllChildren(c),("toolbarcopy"==e||"contextcopy"==e)&&triggerCopy(),showCopyCue(),this.copyToServer(),setTimeout(function(){requestSent=!1},100)},ClipRange.prototype.copyToServer=function(){isClippedNow=!0,isCellRangeFillDivAvailable=!0;var e=new RequestParameters(ActionConstants.SERVERCLIP_COPY_RANGE);e.setParameters(WorkSheets.getAssociatedActiveSheetName(),this.startRow,this.startCol,this.endRow,this.endCol,!1,!1,this.ver,!0);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()};
function initSheet(e,t,o,s,l,r,i,a,n){tileHolder=getObj("tileHolder"),sheetHolder=getObj("sheetHolder"),cellFieldSPAN=getObj("cF"),cellField=getObj("cF");var d=JSON.parse(colDetailStr);colWidthAry=d[0],colLeftAry=d[1];var c=JSON.parse(rowDetailStr);if(setRowDetails("LOAD",c),documentBakeStatus.isBaked()&&(docMetaDetails.CURRSHEETNAME||(docMetaDetails[CURRSHEETNAME]={}),docMetaDetails[CURRSHEETNAME].ROW_HT=rowDetailStr,docMetaDetails[CURRSHEETNAME].USED_COL=usedCursCol,docMetaDetails[CURRSHEETNAME].USED_ROW=usedCursRow),isRTL=!!JSON.parse(getObj("isRtl").value),prevSheetStyle=isRTL,RTLlang){document.getElementById("eP").style.direction="rtl",document.getElementById("Tv").style.textAlign="right",document.getElementById("Tv").style.direction="ltr";var h=document.getElementsByClassName("zsicon zsicon-formulas")[0].style;""!=h.left&&(h.right=h.left,h.left=""),document.getElementById("ssBottomPanel").style.direction="rtl",document.getElementById("sheetsTabNavBar").style.direction="ltr"}document.getElementById("ssHScrollbar").style.direction=isRTL?"rtl":"ltr",colMergeDetails={},arrayDetails=[],colDetailStr="",rowDetailStr="",e=e,spreadSheet=getObj("spreadSheet"),ssWidth=t,ssHeight=o;var g=getObj("poweredByDIV");null!=g&&(poweredByObjHt=g.offsetHeight),ssWidthIn=ssWidth.indexOf("%")>-1?"percentage":"fixed",ssHeightIn=ssHeight.indexOf("%")>-1?"percentage":"fixed",ssBottomPanel=getObj("ssBottomPanel"),ssRightPanel=getObj("ssRightPanel"),ssHScrollContainer=getObj("ssHScrollContainer"),ssHScrollResizePane=getObj("ssHScrollResizePane"),ssHScrollResizeCue=getObj("ssHScrollResizeCue"),ssHScrollbarContainer=getObj("ssHScrollbarContainer"),ssHScrollEnd=getObj("ssHScrollEnd"),ssHScrollbar=getObj("ssHScrollbar"),ssVScrollbar=getObj("ssVScrollbar"),ssHScrollDIV=ssHScrollbar.getElementsByTagName("DIV")[0],ssVScrollDIV=ssVScrollbar.getElementsByTagName("DIV")[0],ssResizePane=getObj("ssResizePane"),ssResizeCue=getObj("ssResizeCue"),colHeadHeight=parseInt(r),rowHeadWidth=parseInt(i),colHeadStart=getObj("cHSt"),colHeadContainer=getObj("cHCont"),colHead=getObj("cH"),colHeadTable=getObj("cHT"),fileToolbarMask=getObj("fileToolbarMask"),stdToolbarMask=getObj("stdToolbarMask"),exprPanel=getObj("eP"),exprField=getObj("Tv"),currCellIndicator=getObj("Trc"),rowHeadContainer=getObj("rHCont"),rowHead=getObj("rH"),rowHeadTable=getObj("rHT"),sheet=getObj("sheet"),sheetObjectsPane=getObj("sOP"),"undefined"!=typeof ole&&ole.setWorkSpace(sheetObjectsPane),mousewheel.addEventHandler(sheet,mousewheel.scroll);var f=getObj("cpTextArea");f.addEventListener("paste",ClipRange.pasteRangeOnSheetDiv),f.addEventListener("beforepaste",ClipRange.pasteRangeIE,!0),sheetTable=getObj("sT"),sheetPane=getObj("sP"),focusDIV=getObj("fD"),userPresencePane=getObj("uPP"),userPresencePane1=getObj("uPP1"),userPresencePane2=getObj("uPP2"),userPresencePane3=getObj("uPP3"),dragDIV=getObj("dragDIV"),dragDIV1=getObj("dragDIV1"),dragDIV2=getObj("dragDIV2"),dragDIV3=getObj("dragDIV3"),transSPAN=getObj("tS"),dummySPAN=getObj("dummySPAN"),dummyCANVAS=getObj("dummyCANVAS").getContext("2d"),fillSeriesDIV=getObj("fSD"),fillSeriesSPAN=getObj("fSS"),cellRangeFillDIV=getObj("fCROD"),cellRangeFillSPAN=getObj("fCRID"),forRangeHidden="",resizePane=getObj("resizePane"),resizeOverlay=getObj("resizeOverlay"),expandedExprField=getObj("eFTE"),collapsedExprField=getObj("eFTC"),exprEqualExpandDiv=getObj("eTExp"),exprArrowExpandDiv=getObj("eFTExp"),exprEqual=getObj("eE"),dummyTextArea=getObj("dummyTextArea"),exprEqualTable=getObj("eETable"),totCols=s,stdCellWidth=a,stdCellHeight=n,vFreezeCue=getObj("vFreezeCue"),hFreezeCue=getObj("hFreezeCue"),sheetPane1=getObj("sP1"),sheetPane2=getObj("sP2"),sheetPane3=getObj("sP3"),sheetTable1=getObj("sT1"),sheetTable2=getObj("sT2"),sheetTable3=getObj("sT3"),rowHead1=getObj("rH1"),rowHeadTable1=getObj("rHT1"),colHead1=getObj("cH1"),colHeadTable1=getObj("cHT1"),focusDIV1=getObj("fD1"),focusDIV2=getObj("fD2"),focusDIV3=getObj("fD3"),transSPAN1=getObj("tS1"),transSPAN2=getObj("tS2"),transSPAN3=getObj("tS3"),fillSeriesDIV1=getObj("fSD1"),fillSeriesDIV2=getObj("fSD2"),fillSeriesDIV3=getObj("fSD3"),fillSeriesSPAN1=getObj("fSS1"),fillSeriesSPAN2=getObj("fSS2"),fillSeriesSPAN3=getObj("fSS3"),cellRangeFillDIV1=getObj("fCROD1"),cellRangeFillDIV2=getObj("fCROD2"),cellRangeFillDIV3=getObj("fCROD3"),cellRangeFillSPAN1=getObj("fCRID1"),cellRangeFillSPAN2=getObj("fCRID2"),cellRangeFillSPAN3=getObj("fCRID3"),Merge.reset(),filterIconsPane=getObj("fIP"),filterIconsPane1=getObj("fIP1"),filterIconsPane2=getObj("fIP2"),filterIconsPane3=getObj("fIP3"),dvListIconsPane=getObj("dvIP"),dvListIconsPane1=getObj("dvIP1"),dvListIconsPane2=getObj("dvIP2"),dvListIconsPane3=getObj("dvIP3"),isEditingInExprField=!1,wmsBarHt=21,setSheetDim(),totRows=getCeilRow(l+1),totRows=Row.findMaxRowToRender();var S=getSheetWidth();if(totalTableWidth=getColLeft(totCols-1)+getColWidth(totCols-1),S>totalTableWidth)for(var b=getDefaultColHdr();S>totalTableWidth-100;){var R=b.cloneNode(!0);R.style.width=getColWidth(totCols)+"px",_insertColHead(1,R,totCols,"after",getColWidth(totCols)),totalTableWidth=getColLeft(totCols)+getColWidth(totCols),totCols+=1}totalTableHeight=totRows>0?getRowTop(totRows-1)+getRowHeight(totRows-1):0;var u=getScrollBarDIM();H_SCROLLBAR_HEIGHT=u,V_SCROLLBAR_WIDTH=18>u?18:u,browser_nn6&&(ssVScrollbar.style.width=V_SCROLLBAR_WIDTH+"px",ssHScrollbar.style.height=H_SCROLLBAR_HEIGHT+"px"),setSheetTableHeight(totalTableHeight),setSheetTableWidth(totalTableWidth),REMOTE.ISRMVIEW||focusRemembering.insertExtraFocusPositions(),os_mac&&browser_ff3||(restrictTextSelection(sheetTable),restrictTextSelection(focusDIV)),browser_ie&&(cellField.style.visibility="visible"),jsEMBED_VIEW||setCaretPos(cellField,0),SHEETSWITCH&&RangeSelector.isActive()||(isCellFieldSPANHided.isHided=!0,UTIL.DOM.addClass(cellField,"noBoxShadow"));var w=getSheetHeight(),p=findRowInYPos(2*w);l=getCeilRow(p),isRespondedInScroll=!0,firstRowInViewPort=0,lastRowInViewPort=0,availableStartRow=0,availableEndRow=0;var T=appEvent.isDefaultPrevented(appEvent.trigger("goto.fromdialog")),v=appEvent.isDefaultPrevented(appEvent.trigger("goto.getLbl"));T||(setScrollTop(0),setScrollLeft(0)),updateTileCallbackInfo.isCallbackAvailable=!0,updateTileCallbackInfo.actionDetails={action:"SHEET_OPEN",pageScrollState:"UNLOADED_SHEET",callbackMethod:sheetLoadCallBack},dataResponse&&"null"!=dataResponse?(isRespondedInScroll=!1,updateTile(dataResponse,200,"OK")):loadXTileIfVacantInViewPort(),T&&v&&scrollRowIntoView(CellUtils.getCellPosByLabel(v).row),ClipRange.getClipObject().isSameSheet()&&ClipRange.getClipObject().hasInsertOption()&&focusCellRangeFill(ClipRange.getClipObject().endRow,ClipRange.getClipObject().endCol,ClipRange.getClipObject().startRow,ClipRange.getClipObject().startCol,!1),documentUtilities(),$.ui&&autocomplete.init(autocomplete.defaultFormulaEls,{type:autocomplete.types.FORMULA,helpTip:!0,syntaxTip:!0})}function getScrollBarDIM(){var e=document.createElement("DIV"),t=document.createElement("DIV");e.style.height="100px",e.style.overflowX="scroll",e.style.overflowY="scroll",e.style.position="relative",e.style.top="-100000px",e.style.left="-100000px",t.style.height="1000px",e.appendChild(t),document.body.appendChild(e);var o=e.offsetWidth,s=t.offsetWidth;document.body.removeChild(e);var l=o-s;return l=17>l?17:l}function sheetLoadCallBack(){var e=appEvent.isDefaultPrevented(appEvent.trigger("grid.afterload"));if("undefined"!=typeof isSheetFreezed&&1==isSheetFreezed&&SHEET.FREEZE._freeze(persistedFreezedRow,persistedFreezedCol),!e){if(workbookData.switchSheet)focusRemembering.setFocusPositions();else{var t=focusRemembering.jsonWorkbookObj();if(t)for(var o=t.sheetcnt,s=0;o>=s;s++){var l=t["sheet"+s];void 0!=l&&l.sheetName==CURRSHEETNAME&&(l.activeERowIndex=l.activeRowIndex,l.activeEColIndex=l.activeColIndex)}cursor_Row_Index>position_Bottom&&cursor_Col_Index>position_Left?(setScrollTop(getRowTop(position_Bottom)-findThirdPaneYPos()),setScrollLeft(getColLeft(position_Left)>findSecondPaneXPos()?getColLeft(position_Left)-findSecondPaneXPos():getColLeft(position_Left)),focusCell(cursor_Row_Index,cursor_Col_Index,void 0,!0)):(focusCell(cursor_Row_Index,cursor_Col_Index,void 0,!0),setScrollTop(getRowTop(position_Bottom)-findThirdPaneYPos()),setScrollLeft(getColLeft(position_Left)>findSecondPaneXPos()?getColLeft(position_Left)-findSecondPaneXPos():getColLeft(position_Left))),workbookData.switchSheet=!0}cursorchange(),isCellRange()&&PivotUtil.hideAndDisplayPivotTab(!1),appEvent.trigger("book.sheetloaded")}}function setSheetDim(e){if(!e&&"RESET"!=e&&cellField&&!isUndefined(cellField.value)&&!isCellFieldSPANHided())var t=getCaretPos(cellField);ssLeft=findPosX(spreadSheet),ssTop=findPosY(spreadSheet),ssParentEl=getObj("spreadSheet")?getObj("spreadSheet").parentNode:getObj("sheetdiv");var o="undefined"!=typeof getObj("ssEResize")&&null!=getObj("ssEResize")?getObj("ssEResize").offsetWidth:0,s=("undefined"!=typeof getObj("ssSResize")&&null!=getObj("ssSResize")?getObj("ssSResize").offsetHeight:0,ssParentEl.offsetWidth),l=parseInt(ssWidth)/100*s-rowHeadWidth-o-ssRightPanel.offsetWidth;0>l&&(l=0);var r=findClientDim(),i=(r.width,r.height);bottomBandHeight=jsGADGET_VIEW?0:$("#bottomBand")?$("#bottomBand").height():0,bottomBandHeight=parseInt(bottomBandHeight);var a=0,n=getObj("searchBar");null!=n&&(a="none"!=n.style.display?$("#searchBar").height():0);var d=getObj("cHC");d&&(colHeadContPosY=findPosY(d),colHeadContHeight=parseInt(d.style.height));var c=36;browser_ie&&(c=37);var h=i-(colHeadContPosY+colHeadContHeight)-c-bottomBandHeight-wmsBarHt-a-poweredByObjHt;0>h&&(h=0),setSheetWidth(l),setSheetHeight(h),e||"RESET"==e||(SHEETSWITCH&&RangeSelector.isActive()&&(t=cellField.value.length),setCaretPos(cellField,t)),setSheetProps(),appEvent.trigger("sheet.resize")}function setSheetProps(){sheetLeft=findPosX(sheet),sheetTop=findPosY(sheet);var e=sheet.style.width,t=sheet.style.height;sheetRight=sheetLeft+parseInt(e),sheetBottom=sheetTop+parseInt(t),sheetWidth=parseInt(e),sheetHeight=parseInt(t),scrollRight=isRTL?ssHScrollbar.scrollWidth-parseInt(ssHScrollbar.style.width):0}function resetSheetDim(){if((isCellEdited()||exprFieldKeyPressed)&&exprField&&cellField&&(posOfCaret=getCaretPos(isEditingInExprField?exprField:cellField)),browser_nn6){var e=getScrollBarDIM();H_SCROLLBAR_HEIGHT=e,V_SCROLLBAR_WIDTH=18>e?18:e,parseInt(ssVScrollbar.style.width)!=V_SCROLLBAR_WIDTH&&(ssVScrollbar.style.width=V_SCROLLBAR_WIDTH+"px",ssHScrollbar.style.height=H_SCROLLBAR_HEIGHT+"px")}if(resetSheetDimIntvl&&clearInterval(resetSheetDimIntvl),cellField&&cellField.value&&!isCellFieldSPANHided())var t=getCaretPos(cellField);resetSheetDimIntvl=setTimeout(function(){setSheetDim("RESET"),ISFREEZED&&resetSheetPanesDim(),colHeadContainer.style.visibility="",rowHeadContainer.style.visibility="",sheet.style.visibility="",ssVScrollbar.style.visibility="",SHEETSWITCH&&RangeSelector.isActive()&&(t=cellField.value.length),!cellField||isUndefined(cellField.value)||isCellFieldSPANHided()||setCaretPos(cellField,t),setSheetProps(),drawColsRows(),loadXTileIfVacantInViewPort(),resetSheetDimIntvl&&clearInterval(resetSheetDimIntvl),checkCellFieldPos(),mask.resizeGrid()},0)}function focusHelper(e,t,o,s,l){isWholeSheetSelected()?focusSheet():isColSelected()?focusCol(t,s):isRowSelected()?focusRow(e,o):e!==o||t!==s?focusCellRange(e,t,o,s,void 0,l):focusCell(e,t)}function focusSheet(){if(null==ole.currObj){if(isCellRange()){var e,t,o,s,l=getCellRange();if(isWholeSheetSelected())e=0,t=0,o=getSheetTableWidth(),s=getSheetTableHeight(),setCurrCellIndicator(0,0,totRows-1,totCols-1);else{var r=getCellRangeDIM(l.startRow,l.startCol,l.endRow,l.endCol);t=r.top,e=r.left,o=r.width,s=r.height}ActiveCellInfo.reset(currRow,currCol),setFocusDIVPos(e,t),setFocusDIVDim(o,s)}else{var i=ActiveCellInfo,a=i.isMerged(),n=i.getStartRow(),d=i.getStartCol(),c=i.getEndRow(),h=i.getEndCol();ActiveCellInfo.reset(currRow,currCol);var g=ActiveCellInfo;a&&!g.isMerged()||!a&&g.isMerged()?(blurColHead(d,h),blurRowHead(n,c),currRow=n,currCol=d,ActiveCellInfo.reset(currRow,currCol),g=ActiveCellInfo,selectColHead(g.getStartCol(),g.getEndCol()),selectRowHead(g.getStartRow(),g.getEndRow())):(blurColHead(d,h),blurRowHead(n,c),selectColHead(g.getStartCol(),g.getEndCol()),selectRowHead(g.getStartRow(),g.getEndRow()));var t=g.getTop(),s=g.getHeight(),e=g.getLeft(),o=g.getWidth();setFocusDIVPos(e,t),setFocusDIVDim(o,s)}var f=getCell(currRow,currCol);f&&(currCell=f,updateActiveCellDependencies(currCell)),appEvent.trigger("grid.resize")}}function scrollSheetVertically(){var e=ssVScrollbar.scrollTop;if(getSheetScrollTop()!=e&&setScrollTop(e),isFilterOptionsDIVOpened&&Filter.hideFilterOptions(),sheetMenu.isMenuOpened()&&sheetMenu.hideOpenedMenu(),!isVScrollFaceOnDrag||isUpArrowPressed||isDownArrowPressed?isUpArrowPressed||isDownArrowPressed?("undefined"!=typeof vScrollbarMoveIntvl&&clearTimeout(vScrollbarMoveIntvl),vScrollbarMoveIntvl=setTimeout(function(){loadXTiles(e)},scrollArrowClickTimer)):loadXTiles(e):("undefined"!=typeof vScrollbarMoveIntvl&&clearTimeout(vScrollbarMoveIntvl),vScrollbarMoveIntvl=setTimeout(function(){loadXTiles(e)},scrollFaceDragTimer),isVScrollFaceClicked&&showRowNoInfo()),isDownArrowPressed&&appendBlankRows("SCROLLBAR_DOWN_ARROW_MOUSEDOWN"),ole.getCurrObj()&&ole.objectsSubHeader[ole.getCurrObj().type].hasActionBar){ole.getCurrObj().positionActionBar(!1);var t=parseInt(ole.getCurrObj().getActionBar().style.top),o=(parseInt(sheetBottom)-t-ole.getCurrObj().getActionBar().offsetHeight,ole.getCurrObj().top+ole.getCurrObj().height-getSheetScrollTop(),t-sheetTop);0>o&&$(ole.getCurrObj().getActionBar()).hide()}appEvent.trigger("sheet.verticallyScrolled")}function scrollSheetHorizontally(){sheetMenu.isMenuOpened()&&sheetMenu.hideOpenedMenu(),"undefined"!=typeof snippet&&snippet.hideDesignModeCue(),isMouseEventInSheetScrollBar=!0,mousewheel.hscroll?mousewheel.hscroll=!1:setScrollLeftonDrag(ssHScrollbar.scrollLeft),afterResetSheetDimension("SCROLL"),isHScrollbarRightArrowPressed&&getSheetScrollLeft()===getSheetTableWidth()-getSheetWidth()&&(insertCol("append",totCols,1,!1,!0,!1,void 0,void 0,void 0,void 0,!0),setScrollLeft(getSheetTableWidth()-getSheetWidth()-1),isRowSelected()&&(isWholeSheetSelected()?(setFocusDIVDim(getSheetTableWidth(),getSheetTableHeight()),focusSheet()):focusCellRange(currRow,0,getCellRange().endRow,totCols-1,"ROW",!0,!0))),appEvent.trigger("sheet.horizontallyScrolled")}function getScrollLeftOnWheel(){var e=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);return browser_firefox||!e&&browser_safari?ssHScrollbar.scrollWidth-ssHScrollbar.clientWidth-getNormalizedScrollLeft():getSheetScrollLeft()}function scrollSheet(){}function resizeHScrollbar(e,t){var o=findPosX(e),s=o-ssHScrollResizePane.offsetWidth/2+e.offsetWidth/2;ssHScrollResizePane.style.top=findPosY(e)+"px",ssHScrollContLeft=findPosX(ssHScrollContainer),sheetsTabLeft=findPosX(getObj("sheetsTab")),sheetsTabNavBarWidth=getObj("sheetsTabNavBar").offsetWidth,addSheetBtnWidth=getObj("addSheetBtn").offsetWidth,ssHScrollResizeDiff=o-s+6,window.addEventListener("mousemove",doResizeHScrollbar,!1),window.addEventListener("mouseup",endResizeHScrollbar,!1),stopEvt(t),document.body.style.cursor="col-resize"}function doResizeHScrollbar(e){clearTextSelection();var t=findDocDim();docWidth=t.width;var o=e.clientX;o-ssHScrollResizeDiff>sheetsTabLeft+sheetsTabNavBarWidth+addSheetBtnWidth&&docWidth-100>o&&(ssHScrollResizePane.style.left=o-ssHScrollResizeDiff+"px")}function endResizeHScrollbar(){document.body.style.cursor="",window.removeEventListener("mousemove",doResizeHScrollbar,!1),window.removeEventListener("mouseup",endResizeHScrollbar,!1);var e=parseInt(ssHScrollResizePane.style.left);if(!isNaN(e)&&e>0){var t=ssHScrollContainer.offsetWidth,o=e+ssHScrollResizeDiff-6;if(ssHScrollContLeft>o)var s=t+(ssHScrollContLeft-o);else var s=t-(o-ssHScrollContLeft);ssHScrollContainer.style.width=s+"px",ssHScrollContainer.setAttribute("customWidth",t-(o-ssHScrollContLeft)),setHScrollbarDim(),resetSheetsTabDim()}ssHScrollResizePane.style.left=ssHScrollResizePane.style.top="-100000px",ssHScrollContLeft=addSheetBtnWidth=sheetsTabNavBarWidth=ssHScrollResizeDiff=0}function resizeHScrollbarToDefaultWidth(){var e=ssHScrollDefaultWidth,t=e-ssHScrollContainer.offsetWidth;getObj("sheetsTabContainer").offsetWidth-t>sheetsTabNavBarWidth+addSheetBtnWidth&&(ssHScrollContainer.style.width=e+"px",ssHScrollContainer.setAttribute("customWidth",e),setHScrollbarDim(),resetSheetsTabDim())}function setHScrollbarDim(e,t,o){if("undefined"==typeof e||null==e){ssHScrollbar.style.width=ssHScrollbar.parentNode.offsetWidth+"px",ssHScrollDIV.style.width=getSheetTableWidth()-getSheetWidth()+parseInt(ssHScrollbar.style.width)+"px"}else{var s=o-(getObj("addSheetBtn").offsetWidth+getObj("sheetsTabNavBar").offsetWidth)-t;0>s&&(t+=s),ssHScrollContainer&&(ssHScrollContainer.style.width=t+"px"),ssHScrollbar.style.width="1px",ssHScrollbar.style.width=getObj("ssHScrollbarContainer").offsetWidth+"px",totalTableWidth&&(ssHScrollDIV.style.width=getSheetTableWidth()-getSheetWidth()+parseInt(ssHScrollbar.style.width)+"px")}sheetTabWidth=0,sbarEnd=0}function resetHScrollDim(e){if("undefined"!=typeof e&&null!=e&&""!=e){var t=getObj("sheetsTabNavBar");if(null==t)return;var o=(parseInt(t.offsetWidth),parseInt(getObj("addSheetBtn").offsetWidth),getObj("spreadSheet").offsetWidth);if("WIN_RESIZE"!=e){var s="DOCPANEL_OPEN"==e||"DOCPANEL_CLOSE"==e?docPanel.getWidth():sbWidth-sbWidthAdjust,l="DOCPANEL_OPEN"==e||"SIDEBAR_OPEN"==e?s:-1*s,r=o-l,i=r/o*100,a=ssHScrollContainer.offsetWidth,n=parseInt(i/100*a);setHScrollbarDim(e,n,r,l)}else{var d=findClientDim().width;if(clientWidth>d)var r=clientWidth-d,i=o/(o+r)*100;else var r=d-clientWidth,i=o/(o-r)*100;var n=d/2;browser_ff3&&(ssHScrollContainer.style.width="0px"),setHScrollbarDim(e,n,getObj("spreadSheet").offsetWidth,clientWidth>d?r:-1*r)}t=null}}function showHScrollbar(){var e=getObj("ssHScrollContainer").getElementsByTagName("TABLE")[0];e&&(e.style.visibility="visible")}function hideHScrollbar(){var e=getObj("ssHScrollContainer").getElementsByTagName("TABLE")[0];e&&(e.style.visibility="hidden")}function resizeSheet(e,t){return ssResizeType=e,browser_ie&&2==t.button?!1:browser_nn6&&3==t.which?!1:(sheet.style.cursor=sheetTable.style.cursor=ssResizePane.style.cursor=ssResizeType.indexOf("s")>=0&&ssResizeType.indexOf("e")>=0?"se-resize":ssResizeType.indexOf("s")>=0?"s-resize":"col-resize",ssResizePane.style.left=ssLeft+"px",ssResizePane.style.top=ssTop+"px",ssResizePane.style.width=spreadSheet.offsetWidth+"px",ssResizePane.style.height=spreadSheet.offsetHeight+"px",ssResizePane.style.display="block",window.addEventListener("mousemove",doResizeSheet,!1),window.addEventListener("mouseup",endResizeSheet,!1),stopEvt(t),!1)}function doResizeSheet(e){if(clearTextSelection(),browser_ie)var e=window.event,t=document.body.offsetWidth,o=document.body.offsetHeight;else if(browser_nn6)var t=document.body.offsetWidth,o=document.body.offsetHeight;if(ssResizeType.indexOf("e")>=0){var s=e.clientX;50>t-s?document.body.scrollLeft+=15:25>s&&(document.body.scrollLeft-=5);var l=s-ssLeft+document.body.scrollLeft;ssResizePane.style.width=(0>l?0:l)+"px"}if(ssResizeType.indexOf("s")>=0){var r=e.clientY;50>o-r?document.body.scrollTop+=15:25>r&&(document.body.scrollTop-=5);var i=r-ssTop+document.body.scrollTop;ssResizePane.style.height=(0>i?0:i)+"px"}}function endResizeSheet(){if(window.removeEventListener("mousemove",doResizeSheet,!1),window.removeEventListener("mouseup",endResizeSheet,!1),ssResizeType.indexOf("e")>=0){ssWidthIn="fixed",spreadSheet.style.width=ssResizePane.offsetWidth+"px";var e=spreadSheet.offsetWidth-rowHeadWidth-getObj("ssEResize").offsetWidth-ssRightPanel.offsetWidth;colHead.style.width=e+"px",sheet.style.width=e+"px",ssHScrollbar.style.width=ssHScrollbar.parentNode.offsetWidth+"px",ssHScrollDIV.style.width=getSheetTableWidth()-getSheetWidth()+parseInt(ssHScrollbar.style.width)+"px"}if(ssResizeType.indexOf("s")>=0){ssHeightIn="fixed",spreadSheet.style.height=ssResizePane.offsetHeight+"px";var t=parseInt(spreadSheet.style.height)-colHeadHeight-getObj("ssSResize").offsetHeight;setSheetHeight(t)}if(ssResizeType="",ssResizePane.style.display="none",browser_opera)sheet.style.cursor=sheetTable.style.cursor="default";else{var o=ctxpath+"images/cell.cur";sheet.style.cursor=sheetTable.style.cursor="url("+o+"), default"}updateResizedSheet(parseInt(spreadSheet.style.width),parseInt(spreadSheet.style.height))}function updateResizedSheet(e,t){}function copySheet(){var e={width:350,title:jsMsg.Copy,buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){duplicatesheet()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};sheetdialog.open("copysheetdialog",e,{init:function(){var e=CellUtils.getRequiredSheetNames().sheetNames,t=currSheetOnRightClick;workbookData.originalSheet=t;for(var o=0;o<e.length;o++)$("<option/>",{value:e[o],text:e[o]}).appendTo($("#copyTargetShNames"));$("#sheetSelect").zcombo("refresh"),setTimeout(function(){var o=replaceParams(jsMsg.CopyOfName,[t]),s=WorkSheets.isNameExists(o);if(s)for(var l=2,r=0;r<e.length&&(o=replaceParams(jsMsg.CopyOfNameUnderScore,new Array(l++,t)),WorkSheets.isNameExists(o));r++);$("#newsheetname").val(o).focus().select();var i=null!=ProtectedRanges.getObject().getSheets().getSheetObj(t),a=ProtectedRanges.getObject().getRanges().list.length>0;ProtectedRanges.showMenuEntry()&&(i||a)&&($("#copyLocks").removeAttr("disabled"),$("label[for='copyLocks']").removeClass("transparent"))},200)}})}function moveSheet(){var e={width:350,resizable:!1,title:jsMsg.MoveThisSheet,buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){sheetmovement()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};sheetdialog.open("movesheetdialog",e,{init:function(){var e=$("#mvShHeading").text(),t=currSheetOnRightClick,o=CellUtils.getRequiredSheetNames().sheetNames,s=$("#SelectedSheet");$("#mvShHeading").text(e+" "+t),$("#onclicksheetname").val(t),t==o[0]&&s.children()[1].remove(),t==o[o.length-1]&&s.children()[0].remove();for(var l=0;l<o.length;l++){var r=o[l];r!=t&&$("<option/>",{value:o[l],text:o[l]}).appendTo($("#mvTargetShNames"))}s.zcombo("refresh"),setTimeout(function(){$("#SelectedSheet").focus()},200)}})}function vScrollMouseDown(e){if(isFilterOptionsDIVOpened){if(browser_ie)var t=e.srcElement;else if(browser_nn6)var t=e.target;var o=t.id;return o&&-1!==o.indexOf("filter")||Filter.hideFilterOptions(),!1}sheetMenu.isMenuOpened()&&sheetMenu.hideOpenedMenu(),vScrollbarOnMove=!1,currScrollTop=getSheetScrollTop();var s=findPosY(ssVScrollbar),l=s+ssVScrollbar.offsetHeight,r=getCursorPos(e);r.y>s&&r.y<s+ARROW_HEIGHT_IN_SCROLLBAR?(isUpArrowPressed=!0,isDownArrowPressed=!1):r.y>l-ARROW_HEIGHT_IN_SCROLLBAR&&r.y<l?(isDownArrowPressed=!0,isUpArrowPressed=!1,isSheetScrollTopCrossedLastRow()&&(appendBlankRows("SCROLLBAR_DOWN_ARROW_MOUSEDOWN"),scrollSheetVertically())):(isDownArrowPressed=!1,isUpArrowPressed=!1),isUpArrowPressed||isDownArrowPressed?updateSSVScrollFaceState():(isVScrollFaceClicked=!0,vScrollFaceClickedPos=r),rowToFocusOnPageNavigation=void 0}function vScrollMouseMove(){isVScrollFaceOnDrag=!0}function vScrollMouseUp(){isVScrollFaceOnDrag=!1,isUpArrowPressed=!1,isDownArrowPressed=!1}function hScrollMouseDown(e){if(isFilterOptionsDIVOpened){if(browser_ie)var t=e.srcElement;else if(browser_nn6)var t=e.target;var o=t.id;return o&&-1!==o.indexOf("filter")||Filter.hideFilterOptions(),!1}sheetMenu.isMenuOpened()&&sheetMenu.hideOpenedMenu();var s=findPosX(ssHScrollbar),l=s+ssHScrollbar.offsetWidth,r=getCursorPos(e);isHScrollbarRightArrowPressed=!1,r.x>s&&r.x<s+ARROW_WIDTH_IN_SCROLLBAR||r.x>l-ARROW_WIDTH_IN_SCROLLBAR&&r.x<l&&(isHScrollbarRightArrowPressed=!0,getSheetScrollLeft()===getSheetTableWidth()-getSheetWidth()&&scrollSheetHorizontally(e))}function setScrollTop(e){if(isNumber(e)){showCell();var t=ssVScrollbar.scrollHeight-parseInt(ssVScrollbar.style.height);e=0>e?0:e,e=e>t?t:e,(isColsOnlyFreezed||isColsAndRowsFreezed)&&(sheetPane3.scrollTop=e),isCustomScroll&&(e-getSheetScrollTop()>100?e+=100:e-50>0&&(e-=50),isCustomScroll=!1),rowHead.scrollTop=e,sheetPane.scrollTop=e,ssVScrollbar.scrollTop!=e&&(ssVScrollbar.scrollTop=e),sheetScrollInfo.scrollTop=e}}function translateScrollValue(e){scrollRight=Math.abs(scrollRight-e)}function setScrollLeftInRTL(e){translateScrollValue(e);var t=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);(browser_firefox||!t&&browser_safari)&&(e=-1*(ssHScrollbar.scrollWidth-ssHScrollbar.clientWidth-e)),isNumber(e)&&(showCell(),activateCellField(),(isRowsOnlyFreezed||isColsAndRowsFreezed)&&(sheetPane2.scrollLeft=e),colHead.scrollLeft=sheetPane.scrollLeft=e,ssHScrollbar.scrollLeft!=e&&(ssHScrollbar.scrollLeft=e),sheetScrollInfo.scrollLeft=e,sheetScrollLeftVal=e,isFirstTimeTabPressed||(isFirstTimeTabPressed=!0))}function setScrollLeft(e){return isRTL?setScrollLeftInRTL(e):void(isNumber(e)&&(showCell(),activateCellField(),(isRowsOnlyFreezed||isColsAndRowsFreezed)&&(sheetPane2.scrollLeft=e),colHead.scrollLeft=sheetPane.scrollLeft=e,ssHScrollbar.scrollLeft!=e&&(ssHScrollbar.scrollLeft=e),sheetScrollInfo.scrollLeft=e,sheetScrollLeftVal=e,isFirstTimeTabPressed||(isFirstTimeTabPressed=!0)))}function setScrollLeftonDrag(e){isNumber(e)&&(showCell(),activateCellField(),(isRowsOnlyFreezed||isColsAndRowsFreezed)&&(sheetPane2.scrollLeft=e),colHead.scrollLeft=sheetPane.scrollLeft=e,ssHScrollbar.scrollLeft!=e&&(ssHScrollbar.scrollLeft=e),sheetScrollInfo.scrollLeft=e,sheetScrollLeftVal=e,isFirstTimeTabPressed||(isFirstTimeTabPressed=!0))}function findVScrollPos(e){var t,o,s,l,r=getSheetPaneHeight();if(isSheetScrolledDown()){var i=getAvailableEndRow(),a=0>i;if(a)var n=0;else var n=getRowTop(i)+getRowHeight(i);if(n>e&&e+r>n){var d=getRowRangeForPageInView("END_OF_PAGE");t=d.firstRow,o=d.lastRow,l="END_OF_PAGE"}else if(n>e&&e+r>n-r){var d=getRowRangeForPageInView("PAGE_AFTER_CURRENT_PAGE");t=d.firstRow,o=d.lastRow,l="PAGE_AFTER_CURRENT_PAGE"}else if(e+r>n){var d=getRowRangeForPageInView("UNLOADED_PAGE");t=d.firstRow,o=d.lastRow,l="UNLOADED_PAGE"}s="SCROLLDOWN"}else{var c=getAvailableStartRow(),a=0>=c;if(a)var h=0;else var h=getRowTop(c);if(h>e&&e+r>h){var d=getRowRangeForPageInView("START_OF_PAGE");t=d.firstRow,o=d.lastRow,l="START_OF_PAGE"}else if(e-r>0&&h>e-r&&e+r>h){var d=getRowRangeForPageInView("PAGE_BEFORE_CURRENT_PAGE");t=d.firstRow,o=d.lastRow,l="PAGE_BEFORE_CURRENT_PAGE"}else if(h>e+r){var d=getRowRangeForPageInView("UNLOADED_PAGE");t=d.firstRow,o=d.lastRow,l="UNLOADED_PAGE"}s="SCROLLUP"}return currScrollTop=getSheetScrollTop(),isNumber(t)?{startRow:t,endRow:o,scrollState:s,pageScrollState:l}:void 0}function appendBlankRows(e,t){var o=8,s=!1,l=!1,r=Row.lastNonHiddenRow;switch(e){case"MOUSE_WHEEL_SCROLL":getSheetScrollTop()===getSheetTableHeight()-getSheetHeight()&&(o=ROWS_PER_TILE,s=!0,l=!0);break;case"SCROLLBAR_DOWN_ARROW_MOUSEDOWN":getSheetScrollTop()==getSheetTableHeight()-getSheetHeight()&&(o=ROWS_PER_TILE,s=!0,l=!0);break;case"ROWS_EXCEEDED":s=!0,o=Row.getNonHiddenRowsInRange(totRows,t).length;break;default:s=!0}if(0>=o&&(s=!1),s){var i=getCeilRow(Row.findNthNonHiddenRow(o,totRows-1)+1);if(totRows===r)return;totRows=i>r?r+1:i,setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1)),l&&setScrollTop(getSheetTableHeight()-getSheetHeight()-1),isColSelected()&&(isWholeSheetSelected()?(setFocusDIVDim(getSheetTableWidth(),getSheetTableHeight()),focusSheet()):focusCellRange(0,currCol,totRows-1,getCellRange().endCol,"COLUMN",!0,!0))}}function removeRowHdrs(e,t){var o=e.length;if(o){var s=e[0],l=e[o-1],r=getRowHeads(s,l),i=r.length;switch(t){case"SCROLLDOWN":case"END_OF_PAGE":case"PAGE_AFTER_CURRENT_PAGE":case"SCROLLUP":case"START_OF_PAGE":case"PAGE_BEFORE_CURRENT_PAGE":for(var a=0;i>a;a++)rowHeadTable.removeChild(r[a]);break;case"UNLOADED_SHEET":case"UNLOADED_PAGE":rowHeadTable.innerHTML=""}}}function insertRowHdrs(e,t,o){var e=Row.getAvailableRows();if(e.length>0){var s=getRowHeadsDocFragment(e);rowHeadTable.innerHTML="",rowHeadTable.appendChild(s)}if(FREEZED_ROW>0&&o&&o.fakeReload&&(e=Row.getLoadedRowsInFrozenRange(),e.length>0)){var s=getRowHeadsDocFragment(e);rowHeadTable1.innerHTML="",rowHeadTable1.appendChild(s)}}function getRowHeadsDocFragment(e){var t=e[0],o=e[e.length-1];if(o>=t){var s=document.createDocumentFragment(),l=getDefaultRowHdrHTML(),r=!1;if(Filter&&Filter.isApplied()){var i=Filter.getInstance(CURRSHEETNAME);i&&0!=i.appliedCols.length&&(r=!0);var a=i.range.sr,n=i.range.er}for(var d=!0,c=e[0],h=0,g=e.length;g>h;h++){var f=l.cloneNode(!1);d||(f.style.borderTop="1px solid #BBBBBB");var S=e[h+1];S-c!=1?(f.style.borderBottom="1px solid #BBBBBB",d=!1):d=!0,isRowInsideCurrCellRange(c)&&(f.className="rowHeadFocus"),f.style.height=getRowHeight(c)+"px";var b=getRowTop(c);f.style.top=b+"px",r&&c>a&&n>=c&&(f.style.color="#AE101F"),f.innerHTML=c+1,s.appendChild(f),c=S}return s}}function insertColHeadTable(e,t){if(void 0==e&&void 0==t&&(colHeadTable.innerHTML="",e=0,t=totCols-1),t>=e){for(var o=document.createDocumentFragment(),s=getDefaultColHdr(),l=e;t>=l;l++){var r=s.cloneNode(!1);r.style.width=getColWidth(l)+"px",r.style[isRTL?"right":"left"]=getColLeft(l)+"px",r.innerHTML=getColHeadLabel(l+1),o.appendChild(r)}colHeadTable.appendChild(o)}}function stopTextSelectionScanning(){"undefined"!=typeof scanSelectionIntvlId&&null!=scanSelectionIntvlId&&(os_mac&&browser_ff3||(null!=sheetTable&&restrictTextSelection(sheetTable),null!=sheetTable1&&restrictTextSelection(sheetTable1),null!=sheetTable2&&restrictTextSelection(sheetTable2),null!=sheetTable3&&restrictTextSelection(sheetTable3)),clearInterval(scanSelectionIntvlId))}function closeSheet(){$("#fileName").text(""),exprPanel.style.visibility="hidden",fileToolbarMask.style.display="",stdToolbarMask.style.display="",getObj("editorDIV").className="blankState",getObj("editorContainer").style.visibility="hidden",ssHScrollContainer.getElementsByTagName("TABLE")[0].style.visibility="hidden",getObj("addSheetBtn").style.visibility="hidden",getObj("sheetsTabNavBar").style.visibility="hidden",getObj("bottomBandMask").style.display="",getObj("waitmsg").style.display="none";var e=getObj("notifyInfoMsg");null!=e&&(e.style.display="none"),getObj("docCloseBtn").style.display="none",getObj("msgBannerPanel").style.display="none",isEditorClosed=!0,formulaSyntaxTip.hideMe()}function showRowNoInfo(e,t){var o=getObj("rowInfoLoaderBox");"block"==o.style.display&&(o.style.display="none"),getObj("textWidthCalculator").innerHTML=jsMsg["Sheet.Row"];var s=getObj("rowInfoBox"),e=e?e:getBoundaryRowInViewPort().firstRow;s.innerHTML=jsMsg["Sheet.Row"]+": "+e;var l=ssVScrollbar.offsetLeft,r=ssVScrollbar.offsetWidth,i=findClientDim().width,a=l>i-r+1?i-r:l;s.style.left=addSTDMode(parseInt(a)-getObj("textWidthCalculator").offsetWidth-60),s.style.top=addSTDMode(isUndefined(t)?vScrollFaceClickedPos.y-parseInt(getCurrentStyle(s,"height"))/2:sheetTop+(t-getSheetScrollTop())),s.style.display="block"}function hideRowNoInfo(){isTileLoaded=!0,clearTileLoadTimeout(),isVScrollFaceClicked?(rowInfoBoxTimeout&&window.clearTimeout(rowInfoBoxTimeout),rowInfoBoxTimeout=window.setTimeout(function(){onRowInfoBoxTimeout("UNLOADED_PAGE")},500)):(hideRowInfoBox(),hideRowInfoLoaderBox()),getObj("textWidthCalculator").innerHTML=""}function hideRowInfoBox(){getObj("rowInfoBox").style.display="none"}function hideRowInfoLoaderBox(){getObj("rowInfoLoaderBox").style.display="none"}function showRowInfoBox(){getObj("rowInfoBox").style.display="block"}function onTileLoadTimeout(e,t,o){var s=getBoundaryRowInViewPort(),l=!1;if("VSCROLLBAR_FACE_DRAG"===e)o>=s.firstRow&&o<=s.lastRow&&(l=!0),t>=s.firstRow-1&&t<=s.lastRow-1&&(l=!0),t<s.firstRow&&s.lastRow<=o&&(l=!0),l&&positionRowInfoLoader();else{var r,i,a;o>=s.firstRow&&o<=s.lastRow&&(l=!0,r=t+1,i=getRowTop(o-1)-5,a=getRowHeight(o-1)),t>=s.firstRow-1&&t<=s.lastRow-1&&(l=!0,r=t+1,i=getRowTop(t)+5,a=getRowHeight(t)),t<s.firstRow&&s.lastRow<=o&&(l=!0,r=t+1,i=getRowTop(t)+5,a=getRowHeight(t)),r<s.firstRow&&(r=s.firstRow),l&&(i<getSheetScrollTop()?i=getSheetScrollTop()+5:i+parseInt(getObj("rowInfoBox").offsetHeight)>getSheetScrollTop()+getSheetHeight()&&(i=getSheetScrollTop()+getSheetHeight()-getObj("rowInfoBox").offsetHeight-5),showRowNoInfo(r,i),positionRowInfoLoader())}}function positionRowInfoLoader(){var e=getObj("rowInfoLoaderBox"),t=getObj("rowInfoBox");t.style.display="block",e.style.display="block",e.style.left=addSTDMode(parseInt(t.style.left)-parseInt(getObj("rowInfoLoaderBox").offsetWidth)+1),e.style.top=addSTDMode(t.style.top),browser_ie&&(e.style.height=addSTDMode(t.offsetHeight))}function clearTileLoadTimeout(){tileLoadTimeoutId&&window.clearTimeout(tileLoadTimeoutId)}function onRowInfoBoxTimeout(e){"LOADED_PAGE"===e&&hideRowNoInfo(),"UNLOADED_PAGE"===e&&(isRespondedInScroll?(hideRowInfoBox(),hideRowInfoLoaderBox()):(hideRowInfoLoaderBox(),clearTileLoadTimeout(),tileLoadTimeoutId=setTimeout("onTileLoadTimeout('VSCROLLBAR_FACE_DRAG',"+lastRequestedTileInfo.startRow+","+lastRequestedTileInfo.endRow+")",500),showRowInfoBox()))}function setRowInfoBoxTimeout(){isVScrollFaceClicked&&(rowInfoBoxTimeout&&window.clearTimeout(rowInfoBoxTimeout),rowInfoBoxTimeout=window.setTimeout(function(){onRowInfoBoxTimeout("LOADED_PAGE")},400))}function updateSSVScrollFaceState(){isVScrollFaceClicked&&(isVScrollFaceClicked=!1,onVScrollFaceStateChange())}function onVScrollFaceStateChange(){rowInfoBoxTimeout&&window.clearTimeout(rowInfoBoxTimeout),clearTileLoadTimeout(),hideRowInfoBox(),hideRowInfoLoaderBox()}function readRangeDetails(e,t,o,s){var l=getServerRange(e,t,o,s);o=l.endRow,s=l.endCol;var r=new RequestParameters(ActionConstants.READ_RANGE_DETAILS);r.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t,o,s);var i=new AjaxRequest;i.init("POST",r.getURL(),!0,r.getParametersAsString()),i.addEventListener("onComplete",function(l){var r=parseJSON(l.responseText),i=r.response;i?updateJson(i):clearFormatting(e,t,o,s),jsVERSION_VIEW&&AuditTrail.showViewPortVersionChanges()}),i.sendRequest()}function insertRowOrColumn(){var e=getCellRange();1==isRowSelected()?Range.executeShiftOperation("INSERT","ROW","above",e.startRow,e.endRow-e.startRow+1):1==isColSelected()&&insertCol("before",e.startcol,e.endcol-e.startcol+1)}function hideShowGrid(e){gridFunctionality(e);var t="hide"===e?ActionConstants.HIDE_GRID:ActionConstants.SHOW_GRID,o=new RequestParameters(t);o.setParameters(WorkSheets.getAssociatedActiveSheetName());var s=new AjaxRequest;s.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(s)}function gridFunctionality(e){appEvent.on("book.onbeforesheetswitch",function(){isVeryFirstScroll=!0});$("#showgrid"),$("#hidegrid"),$("#hideShowGrid");if("hide"==e){document.getElementById("forHideLines").innerHTML="",isGridHidden=!0;{$("#hidegrid"),$("#showgrid")}menutabListener.doAction(TOOLBAR.VIEW,{id:"hidegrid",action:"disable",callback:applyStyle_zbutton,args:["hideShowGrid","hide","hidegrid"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"showgrid",action:"enable",callback:applyStyle_zbutton,args:["hideShowGrid","show","showgrid"]})}else if("show"==e){addCSSClass(),isGridHidden=!1;{$("#showgrid"),$("#hidegrid")}menutabListener.doAction(TOOLBAR.VIEW,{id:"showgrid",action:"disable",callback:applyStyle_zbutton,args:["hideShowGrid","hide","showgrid"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"hidegrid",action:"enable",callback:applyStyle_zbutton,args:["hideShowGrid","show","hidegrid"]})}}function addCSSClass(){var e=".JcD,  .cD, .CcD{border-right: 1px solid #D5D5D5;border-bottom: 1px solid #D5D5D5;}.brt{ border-right: 1px solid transparent; }.bbt{ border-bottom: 1px solid transparent;} ",t=document.getElementById("forHideLines");if(!t.innerHTML){var o=document.createElement("style");o.innerHTML=e,t.appendChild(o)}}var resetSheetDimIntvl,mousewheel={};mousewheel.config={divisor:browser_opera?40:browser_firefox&&os_mac?1:browser_firefox?3:120,eventThreshold:7,timeThreshold:150,isVigorousMode:!1,maxRowsPerEvent:5,maxRowsPerEventInVigorousMode:3,vigorousModeDivisor:10,timeDiff:void 0,eventCount:0,rowHeightThreshold:40,scrollDelta:20,wheelEventSupport:"onwheel"in document.createElement("div")||browser_ie,slopeLimit:2},mousewheel.hscroll=!1,mousewheel.hscrollTimeout=0,mousewheel.scroll=function(e){appEvent.trigger("zsmousewheel.scroll");var t=featurePermission.getPermission("allowToScroll");if(t||$.ZContextMenu._isMenuShowing||(t=!0),!t)return!1;var o=mousewheel.config;if(isFilterOptionsDIVOpened)return!1;o.timeDiff&&(o.timeDiff=performance.now()-o.timeDiff,o.timeDiff>o.timeThreshold?(o.eventCount=0,o.isVigorousMode=!1):(o.eventCount>o.eventThreshold&&(o.isVigorousMode=!0),o.eventCount++)),e||(e=event);var s,l,r=o.wheelEventSupport,i=(r?e.delta:e.wheelDelta,r?e.deltaX:e.wheelDeltaX),a=r?e.deltaY:e.wheelDeltaY,n=i,d=a;if(Math.abs(i)/Math.abs(a)>o.slopeLimit&&(d=!1),Math.abs(a)/Math.abs(i)>o.slopeLimit&&(n=!1),d){var c=a,h=findRowInYPos(getSheetScrollTop()+findThirdPaneYPos()+1),g=r?c>0:0>c;c=Math.abs(c),s=c/o.divisor,s=Math.ceil(o.isVigorousMode&&browser_firefox?s/o.vigorousModeDivisor:s);var f=o.isVigorousMode?o.maxRowsPerEventInVigorousMode:o.maxRowsPerEvent;if(s=Math.min(f,s),void 0!==h&&getRowHeight(h)>o.rowHeightThreshold)l=getSheetScrollTop()+(g?o.scrollDelta:-o.scrollDelta);else if(void 0!==h){var S=Row.findNthNonHiddenRow(s,h,!!g);l=void 0!==S&&getRowHeight(S)>o.rowHeightThreshold||getRowTop(S)-getSheetScrollTop()>o.rowHeightThreshold?getSheetScrollTop()+(g?o.scrollDelta:-o.scrollDelta):Math.max(getRowTop(S)-findThirdPaneYPos(),0),0==getRowHeight(S)&&(g?l+=1:l-=1)}void 0!==h&&setScrollTop(l),appendBlankRows("MOUSE_WHEEL_SCROLL")}if(n)if(isRTL){mousewheel.hscroll=!0;var b=r?-i/6:i/SCROLL_PER_MOUSEWHEEL;isRTL&&(b=-1*b);var R=SCROLL_PER_MOUSEWHEEL*(b/3),u=Math.abs(ssHScrollbar.scrollLeft);if(0>b){var w=ssHScrollbar.scrollLeft+R;if(getNormalizedScrollLeft()+getSheetWidth()>=getSheetTableWidth())return browser_firefox&&setScrollLeftonDrag(-1*(ssHScrollbar.scrollWidth-ssHScrollbar.clientWidth)),!1}else var w=ssHScrollbar.scrollLeft+R;cancelAnimationFrame(mousewheel.hscrollTimeout),mousewheel.hscrollTimeout=requestAnimationFrame(function(){setScrollLeftonDrag(w)})}else{mousewheel.hscroll=!0;var b=r?-i/6:i/SCROLL_PER_MOUSEWHEEL,R=SCROLL_PER_MOUSEWHEEL*(b/3),u=getSheetScrollLeft();if(0>b){var w=u+-1*R;if(getSheetScrollLeft()+getSheetWidth()>=getSheetTableWidth())return!1}else var w=u-R;var p=getSheetWidth(),T=getSheetTableWidth(),v=T-p;w>v&&(w=v),0>w&&(w=0),cancelAnimationFrame(mousewheel.hscrollTimeout),mousewheel.hscrollTimeout=requestAnimationFrame(function(){setScrollLeft(w)})}return stopEvt(e),o.timeDiff=performance.now(),browser_safari&&!isRTL?!1:void 0},mousewheel.addEventHandler=function(e,t){e.addEventListener(mousewheel.config.wheelEventSupport?"wheel":"mousewheel",t,!0)};var ssHScrollContLeft=0,ssHScrollResizeDiff=0,sheetsTabLeft=0,sheetsTabNavBarWidth=0,addSheetBtnWidth=0,ssHScrollDefaultWidth=650,sheetScrollInfo={scrollTop:0,scrollLeft:0},isCustomScroll=!1,lastRequestedTileInfo,rowInfoBoxTimeout,isGridHidden=!1;
var NamedRange=function(e){function n(e){if(s(e.NAME,R),delete g.nameLink[e.NAME],e.ISRANGE){s(e.NAME,u);var n=_(e.REFSHEET,e.STARTROW,e.STARTCOLUMN,e.ENDROW,e.ENDCOLUMN);S(n,e.NAME)}}function t(e,n,t){var a,i=M(e.n);if(n==C.RANGE&&t==C.RANGE&&(a=r(i),h(a,e)),n==C.RANGE&&t==C.EXPRESSION){a=r(i),S(a,i);var s=u.indexOf(i);u.splice(s,1)}if(n==C.EXPRESSION&&t==C.RANGE){var o=_(e);p(o,i),u.push(i)}}function a(e){return g.nameLink[e]}function r(e){var n=a(e);return _(n.REFSHEET,n.STARTROW,n.STARTCOLUMN,n.ENDROW,n.ENDCOLUMN)}function s(e,n){var t=n.indexOf(e);-1!=t&&n.splice(t,1)}var o,l=!1,c=!0,d=!1,N="",f=function(e){var n=new RequestParameters(ActionConstants.JSP_NAMEDRANGE);n.setParameters(currRow,currCol);var t=n.getURL()+"?"+n.getParametersAsString(),a={width:567,title:jsMsg["NamedRange.DefineName"],close:function(){G()}},i={init:function(){x(e)},destroy:function(){RangeSelector.off()}};sheetdialog.open("NamedRangeDialog",a,i,void 0,t)},E=[],R=[],u=[],g={nameLink:{},rangeLink:{}},C={RANGE:1,EXPRESSION:2},m=function(e){var n={};if(e.n){n=v(e);var t=E.push(n)-1,a=n.NAME;if(R.push(a),g.nameLink[a]=E[t],e.is_r){u.push(a);var i=_(e.sn,e.sr,e.sc,e.er,e.ec);p(i,a)}}},v=function(e){var n={},t=e.is_r,a=e.n;return a=a.substring(1,a.length-1),n.NAME=a,n.CONTENT=e.v,n.ISRANGE=t,t&&(n.STARTROW=e.sr,n.STARTCOLUMN=e.sc,n.ENDROW=e.er,n.ENDCOLUMN=e.ec,n.REFSHEET=e.sn),n},A=function(e){e.pos<0||e.Pos>E.length-1||(n(E[e.pos]),E.splice(e.pos,1))},T=function(e){if(!(e.pos<0||e.Pos>E.length-1)&&e.n){{var n=a(M(e.n)),i=n.ISRANGE?C.RANGE:C.EXPRESSION,r=e.is_r?C.RANGE:C.EXPRESSION;e.is_r}t(e,i,r),D(e,i,r)}},p=function(e,n){g.rangeLink[e]||(g.rangeLink[e]={}),g.rangeLink[e][n]=a(n)},S=function(e,n){g.rangeLink[e]&&g.rangeLink[e][n]&&(delete g.rangeLink[e][n],0==Object.keys(g.rangeLink[e]).length&&delete g.rangeLink[e])},h=function(e,n){var t=M(n.n);S(e,t);var a=_(n);p(a,t)},D=function(e,n,t){var a=e.pos,i=E[a];i.ISRANGE=e.is_r,i.CONTENT=e.v,t==C.EXPRESSION?(O(i,"REFSHEET"),O(i,"STARTROW"),O(i,"STARTCOLUMN"),O(i,"ENDROW"),O(i,"ENDCOLUMN")):t==C.RANGE&&(i.REFSHEET=e.sn,i.STARTROW=e.sr,i.STARTCOLUMN=e.sc,i.ENDROW=e.er,i.ENDCOLUMN=e.ec)},O=function(e,n){isUndefined(e[n])||delete e[n]},M=function(e){return e.substring(1,e.length-1)},_=function(e,n,t,a,i){return"object"==typeof e&&(n=e.sr,t=e.sc,a=e.er,i=e.ec,e=e.sn),e+":"+n+":"+t+":"+a+":"+i};appEvent.on("version.load",function(){E=[],R=[],u=[],g={nameLink:{},rangeLink:{}}});var U=function(){return u},I=function(e,n,t,a,i){var r=_(i,e,n,t,a);return obj=g.rangeLink[r],obj?!0:!1},L=function(e,n,t,a,i){var r=_(i,e,n,t,a);return obj=g.rangeLink[r],obj?Object.keys(obj):[]},w=function(e,n){n=n.toUpperCase();var t=a(e);return isUndefined(t)?void 0:isUndefined(t[n])?"":t[n]},P=function(e){var n=a(e);return{startRow:n.STARTROW,startCol:n.STARTCOLUMN,endRow:n.ENDROW,endCol:n.ENDCOLUMN,sheetName:n.REFSHEET}},b=function(e){return-1!==u.indexOf(e)},k=function(e){var n=a(e);return n.STARTROW==n.ENDROW&&n.STARTCOLUMN==n.ENDCOLUMN},j=function(e){var n=a(e);return n.STARTROW==n.ENDROW||n.STARTCOLUMN==n.ENDCOLUMN},y=function(){return R},x=function(n){if(d=!0,F(),"add"==n||""==n){n="",e("#defineCellName").focus();var t=CURRSHEETNAME,a="";if(isCellRange()){var i=getCellRange();i=getServerRange(i.startRow,i.startCol,i.endRow,i.endCol),a=CellUtils.constructCellName(i.startRow,i.startCol,i.endRow,i.endCol,c)}else{var r=ActiveCellInfo.getStartRow(),s=ActiveCellInfo.getStartCol();a=CellUtils.constructCellName(r,s,void 0,void 0,c)}var o=getObj("refCellTxt");-1!=t.indexOf(" ")&&(t="'"+t+"'"),o.value=ASSIGNEDTO="$"+t+"."+a}},F=function(){e("#defineCellName").on("keyup",function(e){W(this.value,e)}).on("keypress",function(e){B(this,e)}),e("#refCellTxt").on("keypress",function(e){B(this,e)}).on("focus",function(){q(this)}),$("#namesListDIV input[type='text']").on("keydown",function(e){var n=browser_ie?window.event.keyCode:e.which;27===n&&(e.stopPropagation(),NamedRange.defineNameActions(void 0,this,"Cancel"))}),e("#name_createBtn").on("click",function(){X()})},G=function(){d=!1,N="",FOCUSSEDNAMEINPUTOBJECT=defineNameHTML=o=ASSIGNEDTO="",resetCellRangeFill("definename"),focusActiveElement()},W=function(n){""==n.trim()?e("#name_createBtn").disable():e("#name_createBtn").enable()},H=function(){return l},B=function(n,t){var a=t.which;if(13==a)if("defineCellName"==n.id||"refCellTxt"==n.id)X();else{var i=n.id,r=i.substring(i.indexOf("_")+1,i.length);o=e("#contentSPAN_"+r);var s=o.attr("cname"),l=e("#contentINPUT_"+r).val();Y(s,l)}},q=function(e){FOCUSSEDNAMEINPUTOBJECT=e;var n=e;RangeSelector.on({el:n,isAbsoluteRef:c,appendSheetName:!0,disableArrowSupport:!0})},J=function(n,t,a){RangeSelector.off();var i=t.id,n=i.substring(i.indexOf("_")+1,i.length),r=(parseInt(t.getAttribute("pos")),e("#contentSPAN_"+n));if(-1!=i.indexOf("nameEditTD_")){r.hide(),e("#nameEditTD_"+n).hide(),e("#nameDeleteTD_"+n).hide(),e("#contentINPUT_"+n).show(),e("#nameUpdateTD_"+n).show(),e("#nameCancelTD_"+n).show();var s=r.attr("cname"),l=w(s,"REFSHEET"),c=w(s,"STARTROW"),d=w(s,"STARTCOLUMN"),f=w(s,"ENDROW"),E=w(s,"ENDCOLUMN");CURRSHEETNAME.toUpperCase().trim()==l.toUpperCase().trim()&&focusCellRangeFill(parseInt(c),parseInt(d),parseInt(f),parseInt(E)),e("#contentINPUT_"+n).focus()}else if(-1!=i.indexOf("nameUpdateTD_")){o=r;var s=r.attr("cname"),n=i.substring(i.indexOf("_")+1,i.length),R=e("#contentINPUT_"+n).val();Y(s,R),FOCUSSEDNAMEINPUTOBJECT="",resetCellRangeFill("definename")}else if(-1!=i.indexOf("nameCancelTD_")||"Cancel"==a){var u=e("#contentINPUT_"+n),s=r.attr("cname"),g=en(s,"CONTENT");u.val(null!=g?g:N),o=r,z(),resetCellRangeFill("definename"),r.show(),e("#nameEditTD_"+n).show(),e("#nameDeleteTD_"+n).show(),u.hide(),e("#nameUpdateTD_"+n).hide(),e("#nameCancelTD_"+n).hide(),FOCUSSEDNAMEINPUTOBJECT=""}else if(-1!=i.indexOf("nameDeleteTD_")){r=e("#contentSPAN_"+n),o=r,s=r.attr("cname");var R=r.html();V(s,R)}},X=function(n,t){if(READ_WRITE||ProtectedRanges.isSheetLocked(CURRSHEETNAME)){if("undefined"==typeof n){var a=e("#defineCellName").val(),t=e("#refCellTxt").val();if(""==a.trim())return void showAlertDialog(jsMsg.Namecannotbeempty);if(""==t.trim())return void showAlertDialog(jsMsg.Rangecannotbeempty);if(CellUtils.isSupportedName(a,"DEFINE_NAME")||!isNaN(a.charAt(0))||CellUtils.isCellLabel(a.trim())){var i=jsMsg.InvalidName+"\n";return i+="	",i+="- "+jsMsg.CellNamecannotstartwithnumbers,i+="\n	",i+="- "+jsMsg.CellNamecannotbeassameasZohoSheetdefinedcelllabels,void showAlertDialog(i)}}else var a=n,t=t;var r=!1;if(r=b(a))return showAlertDialog(jsMsg["Error.NamedExpression.Already.Exists"]),void e("#defineCellName").focus().select();var s=RangeSelector.returnsourceSheet();s!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(s),"open");var o=new RequestParameters(ActionConstants.NAMEDRANGE_ADD);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),a,encodeURIComponent(t));var l=new AjaxRequest;l.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(l)}},Y=function(e,n,t){var a=e,n=n;if("undefined"==typeof t&&""==n.trim())return void showAlertDialog(jsMsg.Rangecannotbeempty);var i=en(a,"CONTENT");if(d&&resetCellRangeFill("definename"),i==n)return void z();var r=new RequestParameters(ActionConstants.NAMEDRANGE_MODIFY);r.setParameters(WorkSheets.getAssociatedActiveSheetName(),ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),ActiveCellInfo.getStartRow(),ActiveCellInfo.getStartCol(),a,encodeURIComponent(n));var s=new AjaxRequest;s.init("POST",r.getURL(),!0,r.getParametersAsString()),actionManager.addRequest(s)},V=function(e){var n=new RequestParameters(ActionConstants.NAMEDRANGE_DELETE);n.setParameters(e,WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",n.getURL(),!0,n.getParametersAsString()),actionManager.addRequest(t)},K=function(e,n,t){var a=n;a.length>18&&(a=a.substring(0,18)+"...");var i=t;i.length>18&&(i=i.substring(0,18)+"..."),t=escapeSpecialCharacters(t),n=escapeSpecialCharacters(n);var r="";return r+="<tr class='trOdd' id='nameTR_"+n+"'>",r+="<td style='width: 170px; height: 22px;' id='nameTD_"+n+"' title='"+n+"'><a href ='javascript:Goto.gotoCellInit(\""+n+'", "NAME");\'>'+escapeSpecialCharacters(a)+"</a></td>",r+="<td style='width: 170px; height: 22px;'><input type='text' onfocus='NamedRange.updateFocusID(this);' onKeyPress='NamedRange.updateNameRangeEnter(this, event);' id='contentINPUT_"+n+"' value=\""+t+"\" style='display:none;'>",r+="<span id='contentSPAN_"+n+"' cname='"+n+"' title=\""+t+'">'+escapeSpecialCharacters(i)+"</span></td>",r+="<td>",r+="<a class='trActionLink' id='nameEditTD_"+n+"' onclick='NamedRange.defineNameActions("+e+", this);return false;' href='javascript:void(0);'>"+jsMsg.EditReference+"</a>",r+="<a class='trActionLink' id='nameUpdateTD_"+n+"' style='display:none' onclick='NamedRange.defineNameActions("+e+", this);return false;' href='javascript:void(0);'>"+jsMsg.Update+"</a>",r+="<span class='linkSep'> | </span>",r+="<a class='trActionLink' id='nameCancelTD_"+n+"' style='display:none' onclick='NamedRange.defineNameActions("+e+", this);return false;' href='javascript:void(0);'>"+jsMsg.Cancel+"</a>",r+="<a class='trActionLink' id='nameDeleteTD_"+n+"' onclick='NamedRange.defineNameActions("+e+", this);return false;' href='javascript:void(0);'>"+jsMsg.Delete+"</a>",r+="</td></tr>"},Q=function(){if(d)if(browser_ie){for(var e=getObj("namesListTbl");e.rows.length>0;)e.deleteRow(0);var n=document.createElement("TR");n.className="trOdd",n.id="nameTR_0";var t=document.createElement("TD");t.align="center",t.innerHTML="0 "+jsMsg.NamesDefined,n.appendChild(t);var a=getObj("namesListTBody");if(null==a||"undefined"==typeof a){var i=document.createElement("TBODY");i.id="namesListTBody",e.appendChild(i),a=i}a.appendChild(n)}else a=getObj("namesListTBody"),a.innerHTML=Z()},Z=function(){var e="";return e+="<tr class='trOdd' id='nameTR_0'>",e+="<td align='center'>0 "+jsMsg.NamesDefined+"</td>",e+="</td></tr>"},z=function(){if(""!=o){var n=o.attr("id"),t=n.substring(n.indexOf("_")+1,n.length);e("#contentSPAN_"+t).show(),e("#nameEditTD_"+t).show(),e("#nameDeleteTD_"+t).show(),e("#contentINPUT_"+t).hide(),e("#nameUpdateTD_"+t).hide(),e("#nameCancelTD_"+t).hide()}},en=function(e,n){return n?w(e,n):void 0},nn=function(e,n){n.v=decodeURIComponent(n.v),e==ActionConstants.NAMED_RANGE?tn(n):e==ActionConstants.NAMEDRANGE_ADD?sn(n):e==ActionConstants.NAMEDRANGE_MODIFY?rn(n):e==ActionConstants.NAMEDRANGE_DELETE?on(n):"DEFINENAME"==e&&an(n)},tn=function(e){for(i=0;i<e.length;i++){var n=e[i];switch(n.v=decodeURIComponent(n.v),n.a){case ActionConstants.NAMEDRANGE_MODIFY:rn(n);break;default:ln(n)}}},an=function(e){var n=e.SUBMODE,t=e.CELLNAME,a=e.CONTENT,i=e.CURRENT_ELEM;"ADD"==n?X(t,a):"MODIFY"==n?Y(t,a,i):"DELETE"==n&&V(t,a)},rn=function(n){var t=n.v,a=M(n.n);d&&(t.length>18&&(t=t.substring(0,18)+"..."),z(),e("#contentSPAN_"+a).html(escapeSpecialCharacters(t)),e("#contentSPAN_"+a).attr("title",n.v),e("#contentINPUT_"+a).val(n.v),e("#defineCellName").focus()),ln(n)},sn=function(n){if(n.n)var t=n.n.substring(1,n.n.length-1);if(d){var a=n.pos,i=e("#namesListTBody");if(0==a){var r=getObj("nameTR_0"),s=r.parentNode;s.removeChild(r)}var o=K(a,t,n.v);if(i.append(o),resetCellRangeFill("definename"),FOCUSSEDNAMEINPUTOBJECT="",i.find("#contentINPUT_"+t).on("keydown",function(e){var n=browser_ie?window.event.keyCode:e.which;27===n&&(e.stopPropagation(),NamedRange.defineNameActions(void 0,this,"Cancel"))}),e("#defineCellName").val("").focus(),u.length>5){var l=getObj("namesListDIV");l.scrollTop=l.scrollHeight}}ln(n)},on=function(n){if(ln(n),d){var t=getObj("nameTR_"+M(n.n));if(t){var a=t.parentNode;a.removeChild(t),e("#defineCellName").val("").focus(),n.cnt>0||Q()}}},ln=function(e){var n=e.a,t=e.n,a=(e.is_r,e.v,e.sr),i=e.sc,r=e.er,s=e.ec,o=e.sn;if(t){t=t.substring(1,t.length-1);switch(n){case"modify":case ActionConstants.NAMEDRANGE_MODIFY:T(e);break;case"delete":case ActionConstants.NAMEDRANGE_DELETE:A(e);break;case"add":case ActionConstants.NAMEDRANGE_ADD:default:m(e)}var l=getCellRange();("delete"==n||n==ActionConstants.NAMEDRANGE_DELETE||t==currCellIndicator.value||l.startRow==a&&l.startCol==i&&l.endRow==r&&l.endCol==s&&CURRSHEETNAME==o)&&(cn(t),CellUtils.displayCellName(l.startRow,l.startCol,l.endRow,l.endCol,CURRSHEETNAME))}},cn=function(e){if("true"==ISSAMESHEET&&currCellIndicator.value==e){var n=getCellRange(),t=n.startRow,a=n.startCol,i=n.endRow,r=n.endCol;t-i==0&&a-r==0?currCellIndicator.value=getColHeadLabel(r+1)+getRowHeadLabel(i):i>=t&&r>=a?currCellIndicator.value=i-t+1+"R x "+(r-a+1)+"C":t>i&&a>r?currCellIndicator.value=t-i+1+"R x "+(a-r+1)+"C":i>=t&&a>r?currCellIndicator.value=i-t+1+"R x "+(a-r+1)+"C":t>i&&r>=a&&(currCellIndicator.value=t-i+1+"R x "+(r-a+1)+"C")}};return appEvent.on("namedrangechanged",function(e,n){NamedRange.responseHandler(e,n)}),appEvent.on("initNamedRangeDialog",function(e){NamedRange.init(e)}),{init:f,updateNameRangeEnter:B,updateFocusID:q,defineNameActions:J,responseHandler:nn,isDialogOpened:H,getDefinedNameProperty:en,getRangeandExpression:y,getNamedRangesList:U,isRangeNamed:I,getNamedRange:L,getNamedRangeInfo:w,getRange:P,isNamedRangeACell:k,isNamedRangeOneDimentional:j,isNamedRange:b}}(jQuery);
var Cell=function(e,t){this.row=e,this.col=t,this.references=this.getDomReferences()};Cell.prototype={getDomReferences:function(){var e=this.row,t=this.col;if(e=parseInt(e),t=parseInt(t),0>e||0>t)return null;var r=[];paneId=getPaneId(e,t);var a=Merge.getCellInfo(e,t),n=getAvailableStartRow(),i=getAvailableEndRow(),l=FREEZED_ROW;if((!a||!(a.startRow<l)&&(a.startRow>i||a.endRow<n))&&(e>=totRows||t>=totCols||e>i||t>getAvailableEndCol()))return null;if(a){var o=a.getDOM();o&&(ISFREEZED?(r[0]=o.mC1,r[1]=o.mC2,r[2]=o.mC3,r[3]=o.mC):r[0]=o.mC)}else{var s=getRowIndex(e,paneId,!0),u=ROWS_PER_TILE,g=u,f=rowsInPage,c=Row.getAvailableRowsInFrozenRange(),d=0,h=f[0];c&&c.length&&(d=c.length,h=Row.findNextNonHiddenRow(l-1));var v=s,R=0;if(R=FREEZED_ROW>e?s:0!=n?s:s-c.length,-1!==s){var p=getTile(R,paneId),C=0,m=t,N=totCols,b=FREEZED_COL;t>=b?(m=Math.abs(b-t),N-=b):N=b;var A=v%g;C=A*N+m;var E=getChildNode(p,C);r[0]=E}}return r},executeMethod:function(e,t,r){var a=this.references;if(null!=a&&"null"!=a)for(var n=Array.prototype.slice.call(arguments),i=0,l=a.length;l>i;i++){n[0]=this.references[i];var a=n[0];null!=a&&e.apply(null,n,t,r)}return this}};var CellUtils=function(){var e=function(e){var t=!1;(void 0==e||null==e)&&(e=""),e=p(e);var r=[];if(getObj("sheetsTab")){for(var a=getObj("sheetsTab").getElementsByTagName("TD"),n=0;n<a.length-1;n++)r[n]=a[n].getAttribute("sheetname"),r[n].toUpperCase()==e.toUpperCase()&&(e=r[n],t=!0);e=t?e:""}return{sheetNames:r,sheetName:e}},t=function(e){var t=!1;(void 0==e||null==e)&&(e="");var r=NamedRange.getNamedRangesList();return t=NamedRange.isNamedRange(e),e=t?e:"",{rangeNames:r,rangeName:e}},r=function(e){return NamedRange.isNamedRange(e)},a=function(e){e=p(e);for(var t=getObj("sheetsTab").getElementsByTagName("TD"),r=[],a=0;a<t.length-1;a++)if(r[a]=t[a].getAttribute("sheetname"),r[a].trim().toUpperCase()==e.trim().toUpperCase())return!0;return!1},n=function(e){var t=/^[A-z]/,r=e.length;if(r>=2&&isNaN(e.charAt(0))&&t.test(e)){if(2==r&&!isNaN(e.charAt(1))&&parseInt(e.charAt(1))>0)return!0;if(isNaN(e.charAt(1))){if(!isNaN(e.substring(2,r))){var a=e.toUpperCase().charCodeAt(0),n=parseInt(e.substring(2,r));if(n<=getRowMax()&&n>0&&73>=a)return 73==a&&e.toUpperCase().charCodeAt(1)>86?!1:!0}}else if(!isNaN(e.substring(1,r))){var n=parseInt(e.substring(1,r));if(n<=getRowMax()&&n>0)return!0}}return!1},i=function(e){return isValidRangeGlobal(e)},l=function(e){return r(e)||i(e)||a(e)?!0:!1},o=function(e){for(var t="",r="",a=0,n=0,i=0;n<e.length;n++,i++)isNaN(e.charAt(n))?t+=e.charAt(n).toUpperCase():r+=e.charAt(n);if(t.length>2||0==r)var a=-1;else if(1==t.length)var a=t.charCodeAt(0)-65;else var a=26*(t.charCodeAt(0)-65)+(t.charCodeAt(1)-65+26);return{row:r-1,col:a}},s=function(e,t,r,a,n,i){var l=n?1:0;return u(e,t,r,a,l,i)},u=function(e,t,r,a,n,i){var l=1==n?"$":"",o="",s="",u="";switch(n){case 1:s=u="$";break;case 2:s="$";break;case 3:u="$"}if(!r&&!a||e===r&&t===a)o=u+getColHeadLabel(t+1)+s+getRowHeadLabel(e);else{var g=0===e&&r===getRowMax()-1,f=0===t&&a===getColMax()-1;o=(f&&!g?"":u+getColHeadLabel(t+1))+(g?"":s+getRowHeadLabel(e)),o+=":"+(f&&!g?"":u+getColHeadLabel(a+1))+(g?"":s+getRowHeadLabel(r))}return i&&(-1==i.indexOf("-")&&-1==i.indexOf(" ")&&isNaN(parseInt(i))&&new RegExp("^[a-zA-Z0-9]*$").test(i)||(i="'"+i+"'"),o=l+i+"."+o),o},g=function(e){var t=getDataFrom2DRangeText(e);return{asn:t.sheetCode,startRow:t.sR,startCol:t.sC,endRow:t.eR,endCol:t.eC}},f=function(e,t){if("CELL_REF"==t){var r=new RegExp("^[a-zA-Z0-9_\\u00A1-\\uFFFF!:]+$");return!r.test(e)}if("DEFINE_NAME"==t){var r=new RegExp("^[a-zA-Z0-9_\\u00A1-\\uFFFF]+$");return!r.test(e)}if("SHEET_NAME"==t){var r=new RegExp("^[a-zA-Z0-9_ \\u00A1-\\uFFFF]+$");return!r.test(e)}return!1},c=function(e,t,r,a,n){var i=NamedRange.getNamedRange(e,t,r,a,n);return i.length>0?(currCellIndicator.value=i[0],currCellIndicator.title=i[0],i[0]):""},d=function(e,t,r,a){switch(a){case"checkbox":var n=checkbox.getFromCell(r).get(0);break;default:var n=getHyperLinkInCell(r).childTag}if(n&&("checkbox"===a||isObject(n)&&n.tagName&&"A"==n.tagName.toUpperCase())){var i=n.getBoundingClientRect();fromLeft=i.left,fromTop=i.top;var l=i.right,o=i.bottom;if(e>=fromLeft&&l>=e&&t>=fromTop&&o>=t)return!0}},h=function(e){if(e=R(e),-1!==e.indexOf(".")){var t=e.substring(0,e.indexOf("."));return 0===t.indexOf("'")&&(t=t.substring(1,t.length-1)),t}return cellPrevState?cellPrevState.sourceSheet:CURRSHEETNAME},v=function(e){if(e=R(e),-1!=e.indexOf(".")){var t=e.split(".");return t[1]}return e},R=function(e){for(e=e.replace("!",".");-1!=e.indexOf("$");)e=e.replace("$","");return e},p=function(e){for(;-1!=e.indexOf("'");)e=e.replace("'","");return e},C=function(e){if(e&&-1===e.indexOf("/'")){var t=h(e),r=v(e);if(-1!=t.indexOf(" ")||!isNaN(parseInt(t))){var a="'"+t+"'."+r;return a}}return e},m=function(e){var t=!1;if(e=e.replace("!","."),-1!==e.indexOf(".")){var r=e.substring(0,e.indexOf("."));if(0===r.indexOf("'")&&(r=r.substring(1,r.length-1)),!a(r))return!1;e=e.substring(e.indexOf(".")+1,e.length)}return-1!=e.indexOf(":")?!1:(n(e)&&(t=!0),t)},N=function(e){var t=v(e);return t.split(":")};return{getRequiredSheetNames:e,getRequiredRangeNames:t,isDefinedName:r,isDefinedSheet:a,isCellLabel:n,checkCellLbl:i,checkCellRef:l,getCellPosByLabel:o,constructCellName:s,constructCellNameByMode:u,isSupportedName:f,displayCellName:c,checkBoundaryForTextInDiv:d,getSheetNameFromCelLbl:h,removeDollar:R,removeApostrophe:p,addApostrophe:C,getCellRef:v,isSingleCell:m,getLabelsSplitFromRange:N,getRangeFromCellLbl:g}}(jQuery);
function cellKeyUp(e){if(isSSActive){var t=appEvent.isDefaultPrevented(appEvent.trigger("cell.keyUp",[e]));if(t===!0)return;if(browser_opera){var o=browser_ie?window.event.keyCode:e.which;(9===o||13===o&&!e.ctrlKey)&&exprField.blur()}if(browser_ie)var e=window.event,l=e.srcElement,o=e.keyCode;else if(browser_nn6)var l=e.target,o=e.which;if(!jsREMOTE_SAVE_VIEW&&!jsGADGET_VIEW&&!jsTHROWAWAY_VIEW){var r=!1;e.ctrlKey&&(ole.onCtrlKeyUp(e,l),r=!0),17!=o||r||ole.onCtrlKeyUp(e,l)}}}function cellKeyDown(e){var t=appEvent.isDefaultPrevented(appEvent.trigger("cell.keyDown",[e]));if(t!==!0){stopTextSelectionScanning();var o=e;if(isSSActive){if(browser_ie)var e=window.event,l=e.srcElement,r=e.keyCode;else if(browser_nn6)var l=e.target,r=e.which;var n=e.shiftKey,i=e.ctrlKey,a=e.altKey,s=e.metaKey,C=n||i||a||s||20==r||8==r||9==r||18==r||91==r,c=33===r||34===r||35===r||36===r||37===r||38===r||39===r||40===r;if(!(ClipRange.getClipObject().hasClip()||formulaCell&&c)&&isFilterOptionsDIVOpened)return!1;formulaCell?16!=r&&37!=r&&38!=r&&39!=r&&40!=r&&resetFillRanges("cellField",e.shiftKey,r):e.shiftKey&&16!=r&&37!=r&&38!=r&&39!=r&&40!=r&&resetFillRanges("cellField",e.shiftKey,r),jsREMOTE_SAVE_VIEW||jsGADGET_VIEW||jsTHROWAWAY_VIEW||(i&&ole.onCtrlKeyDown(e,l),s&&ole.onCtrlKeyDown(e,l));var d=l.tagName.toUpperCase();if(l!==cellField&&("INPUT"===d||"TEXTAREA"===d&&"cpTextArea"!==l.id||"SELECT"===d||"IMG"===d||"A"===d))return(9===r||39===r)&&currCol+1===totCols&&(insertCol("append",totCols,1,!1,!0,!1),focusCell(currRow,currCol+1,void 0,void 0,void 0,o)),(13===r||40===r)&&currRowTemp+1===totRows&&(appendBlankRows(),focusCell(currRowTemp+1,currCol,void 0,void 0,void 0,o)),void((37==r||38==r||39==r||40==r)&&rangeSelection());if(currKeyCode=r,os_mac&&8==r&&(browser_safari||browser_firefox)&&deleteCell(),!os_mac&&67==r&&i&&a){var R="dontCopy";getSourceRangeForCopyFormat(R)}if(!os_mac&&86==r&&i&&a){var u="dontPaste";copyFormatting(u)}if(os_mac&&(s||i)||!os_mac&&i&&!a&&!s)switch(r){case 32:if(n)focusAllCells();else{var g,f;if(isCellRange()){var E=getCellRange();g=E.startCol,f=E.endCol}else{var w=ActiveCellInfo;g=w.getStartCol(),f=w.getEndCol()}focusCol(g,f)}return stopEvt(e),!1;case 65:return focusAllCells(),!1;case 66:if(READ_WRITE){var v;$("#bold").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#bold")):(v=1,$("#formatData").zbutton("check","#bold")),format_new(ActionConstants.BOLD,"bold",v)}return!1;case 67:if(os_mac&&(i||s)&&a){browser_firefox||e.stopPropagation();var R="dontCopy";return getSourceRangeForCopyFormat(R),!1}return void ClipRange.getClipObject().copy("copyShortCut");case 68:return isCellRange()&&getCellRange().startRow<getCellRange().endRow?(Event.stop(e),stopEvt(e),fillSeriesDown(),!1):void 0;case 70:return n?(READ_WRITE&&setCaretPos(exprField,getCellContent().length),!1):(showSearchBar(),browser_ie&&disableKeys(e),stopEvt(e),!1);case 71:return Goto.showDialog(),!1;case 72:return showSearchBar(),browser_ie&&disableKeys(e),stopEvt(e),!1;case 73:if(READ_WRITE){var v;$("#italic").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#italic")):(v=1,$("#formatData").zbutton("check","#italic")),format_new(ActionConstants.ITALIC,"italic",v)}return!1;case 75:return READ_WRITE&&!isCellRange()&&appEvent.trigger("showLinkDialog"),!1;case 76:if(n&&!ProtectedRanges.isSheetLocked(CURRSHEETNAME))return Filter.doFilterAction(),!1;break;case 77:if(a)return Discussion.showGetter(),!1;break;case 110:case 78:if(n)currCellIndicator.focus();else if(!(jsREMOTE_SAVE_VIEW||jsGADGET_VIEW||jsTHROWAWAY_VIEW||jsPUBLIC_VIEW)){if(jsDOCS_VIEW||docView&&displayAll)return;ole.onOpenNewDoc(e),TEMPLATE_FLAG="false",createNewDocument("document")}return!1;case 79:return browser_ie&&disableKeys(e),openFileDialog(),!1;case 80:return!jsREMOTE_VIEW&&!jsTHROWAWAY_VIEW&&allowExport&&allowExportPublic&&allowPrint?(exportDoc(".html","print","yes"),!1):(browser_ie&&disableKeys(e),stopEvt(e),!1);case 82:return!e.shiftKey&&isCellRange()&&getCellRange().startCol<getCellRange().endCol?(Event.stop(e),stopEvt(e),fillSeriesRight(),!1):void 0;case 83:return n&&REMOTE.MODE!==REMOTE.EXCELVIEW&&REMOTE.MODE!==REMOTE.SCRATCHVIEW?saveasdialog("saveasdialog"):n&&saveToMyAccount.getDetails(),isGDriveView&&updateDocToGDrive(),jsREMOTE_SAVE_VIEW&&saveremoteGEdoc(),!1;case 84:return;case 85:if(READ_WRITE&&os_mac&&i)isF2KeyPressed=!0,focusCellField(getCellContent());else if(READ_WRITE&&!e.shiftKey){var v;$("#underline").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#underline")):(v=1,$("#formatData").zbutton("check","#underline")),format_new(ActionConstants.UNDERLINE,"underline",v)}else e.shiftKey&&(isExprFieldExpanded?collapseExprField():expandExprField());return!1;case 86:if(os_mac&&(i||s)&&a){var u="dontPaste";return copyFormatting(u),!1}return void ClipRange.pasteFromShortCut();case 88:return void(READ_WRITE&&ClipRange.getClipObject().cut(!1));case 89:return READ_WRITE&&redo(),!1;case 90:if(READ_WRITE){if(n)return redo(),!1;undo()}return!1;case 107:if(n||a)return insertRowOrColumn(),!1;case 109:return void setTimeout(function(){focusSheet()},10);case 114:return READ_WRITE&&appEvent.trigger("initNamedRangeDialog",["add"]),!1;case 49:if(READ_WRITE&&n)return appEvent.trigger("showFormatCellsDialog"),!1;break;case 50:if(READ_WRITE&&n){var v;return $("#bold").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#bold")):(v=1,$("#formatData").zbutton("check","#bold")),format_new(ActionConstants.BOLD,"bold",v),!1}break;case 51:if(READ_WRITE&&n){var v;return $("#italic").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#italic")):(v=1,$("#formatData").zbutton("check","#italic")),format_new(ActionConstants.ITALIC,"italic",v),!1}break;case 52:if(READ_WRITE&&n){var v;return $("#underline").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#underline")):(v=1,$("#formatData").zbutton("check","#underline")),format_new(ActionConstants.UNDERLINE,"underline",v),!1}break;case 53:if(n&&READ_WRITE){var v;return $("#strike").is(":checked")?(v=0,$("#formatData").zbutton("uncheck","#strike")):(v=1,$("#formatData").zbutton("check","#strike")),format_new(ActionConstants.STRIKETHROUGH,"strike",v),!1}break;case 57:}if(107===r&&i&&(n||a))return insertRowOrColumn(),!1;if(187===r&&e.ctrlKey&&(e.altKey||e.shiftKey))return insertRowOrColumn(),!1;if(113===r)return n?(READ_WRITE&&Annot.add(e),exitFormatPainter()):READ_WRITE&&(isF2KeyPressed=!0,focusCellField(getCellContent()),exitFormatPainter()),!1;if(114==r){if(!n){if(jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE)return;return showSearchBar(),browser_ie&&!browser_ie6&&(e.keyCode=0),stopEvt(e),!1}showFuncList()}if(115==r)return browser_ie&&!browser_ie6&&(e.keyCode=0),redo(),!1;if(a&&119===r&&ALL_SHEET_SHARED&&!jsREMOTE_SAVE_VIEW&&!jsGADGET_VIEW&&!jsTHROWAWAY_VIEW&&READ_WRITE)return showMacros(),stopEvt(e),!1;if(a&&122===r&&ALL_SHEET_SHARED&&!jsREMOTE_SAVE_VIEW&&!jsGADGET_VIEW&&!jsTHROWAWAY_VIEW&&READ_WRITE)return showMacroEditorDialog(),stopEvt(e),!1;if(120===r)return recalculate(""),stopEvt(e),!1;if(n&&122===r)return"PUBLIC_VIEW"!==getViewType()&&!isReadOnlyViewMode&&READ_WRITE&&insertSheet(),!1;if(27===r)return isFullScreen&&(isFilterOptionsDIVOpened||$("#fCRID").is(":visible")||fPainter.fPainterdoubleclick||fPainter.fPaintersingleclick||toggleScreenView()),(fPainter.fPainterdoubleclick||fPainter.fPaintersingleclick)&&(fPainter.fPainterdoubleclick=!1,fPainter.fPaintersingleclick=!1,cursorchange(),firing=!1),clearCellRangeFill(),isFilterOptionsDIVOpened&&Filter.hideFilterOptions(),sheetdialog.escClose(),$.ZContextMenu._isMenuShowing&&($.ZContextMenu.hideMenu(),setTimeout(function(){sheetMenu.hideMenu(e),focusActiveElement()},100)),"undefined"!=typeof SheetSignup&&SheetSignup.closeDialog(),!1;if(r>=16&&20>=r||27==r||45==r||r>=112&&126>=r||144==r||145==r||193==r)return;switch((37==r||38==r||39==r||40==r)&&rangeSelection(),r){case 8:return READ_WRITE&&(os_mac||!browser_safari&&!browser_firefox||focusCellField("")),!1;case 27:clearCellRangeFill(),focusCell(currRow,currCol,void 0,void 0,void 0,o);break;case 32:if(n){var I,A;if(isCellRange()){var E=getCellRange();I=E.startRow,A=E.endRow}else{var w=ActiveCellInfo;I=w.getStartRow(),A=w.getEndRow()}focusRow(I,A)}break;case 33:if(i)return;var E=getCellRange(),T=E.startRow,p=getSheetScrollTop()-getSheetHeight(),m=0,S=getBoundaryRowInViewPort();if(void 0!==rowToFocusOnPageNavigation)m=rowToFocusOnPageNavigation;else{var S=getBoundaryRowInViewPort(),D=S.firstRow,O=S.lastRow;if(O>=T&&T>=D)var m=Row.getNonHiddenRowsInRange(D,T).length;else var m=0;rowToFocusOnPageNavigation=m}if(getRowTop(T)-getSheetHeight()<0&&S.firstRow<E.startRow||T===S.lastRow){if(setScrollTop(0),!n)return;m=0}else setScrollTop(p+findThirdPaneYPos());var S=getBoundaryRowInViewPort(),h=S.firstRow,N=S.lastRow,_=Row.getNonHiddenRowsInRange(h,N).length;if(m=Row.findNthNonHiddenRow(m>_?_:m,h-1,!0),n)clearTextSelection(),focusCellRange(currRow,currCol,m,E.endCol,"KEYSELECTION",!0,void 0,!0);else{var w=ActiveCellInfo;focusCell(m,w.getStartCol(),void 0,!0,!0,o)}return!1;case 34:if(i)return;var E=getCellRange(),b=E.endRow,L=getSheetScrollTop()+getSheetHeight(),m=0;if(void 0!==rowToFocusOnPageNavigation)m=rowToFocusOnPageNavigation;else{var S=getBoundaryRowInViewPort(),D=S.firstRow,O=S.lastRow;if(O>=b&&b>=D)var m=Row.getNonHiddenRowsInRange(D,b).length;else var m=0;rowToFocusOnPageNavigation=m}var y=getSheetScrollTop()+2*getSheetHeight();if(getRowTop(totRows-1)+getRowHeight(totRows-1)<y){var P=getCeilRow(findRowInYPos(y,!0));appendBlankRows("ROWS_EXCEEDED",P)}setScrollTop(L-findThirdPaneYPos());var S=getBoundaryRowInViewPort(),M=S.firstRow,F=S.lastRow,H=Row.getNonHiddenRowsInRange(M,F).length;if(m=Row.findNthNonHiddenRow(m>H?H:m,M-1,!0),n)clearTextSelection(),totRows===S.lastRow&&L>getRowTop(totRows-1)&&(m=F-1),focusCellRange(currRow,currCol,m,E.endCol,"KEYSELECTION",!0,void 0,!0);else{var w=ActiveCellInfo;focusCell(m,w.getStartCol(),void 0,!0,!0,o)}return!1;case 35:if(i){var x=usedCursRow;Row.isHidden(usedCursRow)&&(x=Row.findNextNonHiddenRow(usedCursRow,!1)),isUndefined(x)&&(x=0)}if(i&&!n)focusCell(x,usedCursCol,void 0,void 0,void 0,o);else if(n&&!i)clearTextSelection(),f=null==selCol||-1==selCol?currCol:selCol,focusCellRange(currRow,currCol,currRow,totCols);else if(i&&n)clearTextSelection(),A=null==selRow||-1==selRow?currRow:selRow,focusCellRange(currRow,currCol,x,usedCursCol);else{var w=ActiveCellInfo;focusCell(w.getStartRow(),totCols-1,void 0,void 0,void 0,o)}return!1;case 36:if(n&&!i){if(isCellRange()){var E=getCellRange();blurColHead(E.startCol,E.endCol)}return clearTextSelection(),A=null==selRow||-1==selRow?currRow:selRow,ISFREEZED?focusCellRange(currRow,currCol,A,FREEZED_COL):focusCellRange(currRow,currCol,A,0),!1}if(i&&!n)return ISFREEZED?focusCell(Row.isHidden(FREEZED_ROW)?Row.findNextNonHiddenRow(FREEZED_ROW-1):FREEZED_ROW,FREEZED_COL,void 0,void 0,void 0,o):focusCell(Row.firstNonHiddenRow,0),!1;if(i&&n){if(isCellRange()){var E=getCellRange();blurColHead(E.startCol,E.endCol),blurRowHead(E.startRow,E.endRow)}return clearTextSelection(),A=null==selRow||-1==selRow?currRow:selRow,ISFREEZED?focusCellRange(currRow,currCol,Row.isHidden(FREEZED_ROW)?Row.findNextNonHiddenRow(FREEZED_ROW-1):FREEZED_ROW,FREEZED_COL):focusCellRange(currRow,currCol,0,0),!1}if(!a){var w=ActiveCellInfo;return focusCell(w.getStartRow(),FREEZED_COL,void 0,void 0,void 0,o),!1}return;case 37:return!a||n||i||s?(isRTL?navigateOnRightKeyPress(e,n,i,a,s,C,c,r,o):navigateOnLeftKeyPress(e,n,i,a,s,C,c,r,o),!1):(switchSheet.doSwitch(RTLlang?"next":"prev"),!1);case 38:if($("#colorpaletteID").is(":visible")||!allowtowrite)return;if(rangeSelection(),!n||i||s)if(i||s){if(isCellRange()){if(n){var E=getCellRange();if(currRow!=E.startRow)var k=E.startRow;else var k=E.endRow}else{var k=currRow,w=ActiveCellInfo;k=w.getStartRow()}var U=getCell(k,currCol,void 0,!0);cellRangeContainsMergeCells(k,currCol)&&(U=getCell(k,currCol))}else{var k=currRow,w=ActiveCellInfo,W=w.getActiveRow(),V=w.getActiveCol(),U=getCell(W,V,void 0,!0);cellRangeContainsMergeCells(W,V)&&(U=getCell(W,V)),k=w.getStartRow()}var K="UP";if(k>0){if(!isRowAvailable(k))return void getUsedCursorCell(k,currCol,K,n);if(isCellContainingContent(U)){var B=Row.findNextNonHiddenRow(k,!1),G=getCell(B,currCol,void 0,!0);if(cellRangeContainsMergeCells(B,currCol)&&(G=getCell(B,currCol)),!isRowAvailable(B))return void getUsedCursorCell(k,currCol,K,n);if(isCellContainingContent(G)){var w=getNextCellDetailsNotContainingContent(k,currCol,K,n),j=w.found?w.row+1:w.row;if(isNaN(j))return}else{var j=getNextCellDetailsContainingContent(k,currCol,K,n).row;if(isNaN(j))return}}else{var j=getNextCellDetailsContainingContent(k,currCol,K,n).row;if(isNaN(j))return}if(j=0>j?0:j,n)if(isCellRange()){var E=getCellRange();currRow!=E.startRow?focusCellRange(E.endRow,E.startCol,j,E.endCol,"KEYSELECTION"):(resetCellRange(),focusCellRange(E.startRow,E.startCol,j,E.endCol,"KEYSELECTION"))}else focusCellRange(currRow,currCol,j,currCol,"KEYSELECTION");else focusCell(j,currCol,void 0,void 0,void 0,o)}}else if(formulaCell){var w=ActiveFormulaInfo,Y=w.getActiveCol(),z=Row.findNextNonHiddenRow(w.getStartRow(),!1);z>=0&&(ActiveFormulaInfo.set(z,Y),focusCellRangeFill(z,Y,z,Y))}else{var w=ActiveCellInfo;focusCell(Row.findNextNonHiddenRow(w.getStartRow(),!1),w.getActiveCol(),void 0,void 0,void 0,o)}else{if(formulaCell)var g=cellRangeStartCol,f=cellRangeEndCol,I=T,A=b,w=ActiveFormulaInfo,W=w.getActiveRow(),Z=!1,q=!1;else var X=getCellRange(),g=X.startCol,f=X.endCol,I=X.startRow,A=X.endRow,W=currRow,Z=isColSelected(),q=isRowSelected();if(Z)return;if(q)if(I==W){if(0>=A)return;focusRow(I,Row.findNextNonHiddenRow(A,!1))}else if(A==W){if(0>=I)return;focusRow(A,Row.findNextNonHiddenRow(I,!1))}else{var J=new Range(W,g,W,f);Merge.extendRange(J);var Q=J.startRow,et=J.endRow;if(Q==I){if(0>=A)return;focusRow(I,Row.findNextNonHiddenRow(A,!1))}else if(et==A){if(0>=I)return;focusRow(A,Row.findNextNonHiddenRow(I,!1))}}else if(I==W){var tt=new Range(A,g,A,f);if(Merge.extendRange(tt),tt.startRow<=0)return;A=Row.findNextNonHiddenRow(tt.startRow,!1),focusCellRange(I,g,A,f,"KEYSELECTION")}else if(A==W){if(0>=I)return;I=Row.findNextNonHiddenRow(I,!1),focusCellRange(A,f,I,g,"KEYSELECTION")}else{var J=new Range(W,g,W,f);Merge.extendRange(J);var Q=J.startRow,et=J.endRow;if(Q==I){var tt=new Range(A,g,A,f);if(Merge.extendRange(tt),tt.startRow<=0)return;A=Row.findNextNonHiddenRow(tt.startRow,!1),focusCellRange(I,g,A,f,"KEYSELECTION")}else if(et==A){if(0>=I)return;I=Row.findNextNonHiddenRow(I,!1),focusCellRange(A,f,I,g,"KEYSELECTION")}else{if(0>=A)return;A=Row.findNextNonHiddenRow(A,!1),focusCellRange(I,g,A,f,"KEYSELECTION")}}}return!1;case 9:if(n&&!i&&!s){if(!isCellRange()){var w=ActiveCellInfo;focusCell(w.getActiveRow(),w.getStartCol()-1,void 0,void 0,void 0,o)}return!1}if(i||s||a)return;case 39:if(a&&!n&&!i&&!s)return switchSheet.doSwitch(RTLlang?"prev":"next"),!1;if(isRTL){if(9==r)return navigateOnRightKeyPress(e,n,i,a,s,C,c,r,o),!1;navigateOnLeftKeyPress(e,n,i,a,s,C,c,r,o)}else navigateOnRightKeyPress(e,n,i,a,s,C,c,r,o);return!1;case 13:if(a)return void repeat.doAction(repeat.LASTACTIONJSON,!1);if(READ_WRITE)return checkbox.isPresent()?checkbox.edit(" "):(isenterKeyPressed=!0,focusCellField(getCellContent())),!1;if(n){var w=ActiveCellInfo;return focusCell(Row.findNextNonHiddenRow(w.getStartRow(),!1),w.getActiveCol(),void 0,void 0,void 0,o),!1}case 40:if($("#colorpaletteID").is(":visible")||!allowtowrite)return;var ot=(isCellRange()?selRow:currRow)>=Row.lastNonHiddenRow;if(ot)return!1;if(rangeSelection(),!n||i||s)if(i||s){if(isCellRange()){if(n){var E=getCellRange();if(currRow!=E.endRow)var k=E.endRow;else var k=E.startRow}else{var k=currRow,w=ActiveCellInfo;k=w.getEndRow()}var U=getCell(k,currCol,void 0,!0);cellRangeContainsMergeCells(k,currCol)&&(U=getCell(k,currCol))}else{var k=currRow,w=ActiveCellInfo,W=w.getActiveRow(),V=w.getActiveCol(),U=getCell(W,V,void 0,!0);cellRangeContainsMergeCells(W,V)&&(U=getCell(W,V)),k=w.getEndRow()}var K="DOWN";if(totRows-1>k){if(!isRowAvailable(k))return void getUsedCursorCell(k,currCol,K,n);if(isCellContainingContent(U)){var lt=Row.findNextNonHiddenRow(k),rt=getCell(lt,currCol,void 0,!0);if(cellRangeContainsMergeCells(lt,currCol)&&(rt=getCell(lt,currCol)),!isRowAvailable(lt))return void getUsedCursorCell(k,currCol,K,n);if(isCellContainingContent(rt)){var w=getNextCellDetailsNotContainingContent(k,currCol,K,n),j=w.found?w.row-1:w.row;if(isNaN(j))return}else{var j=getNextCellDetailsContainingContent(k,currCol,K,n).row;if(isNaN(j))return}}else{var j=getNextCellDetailsContainingContent(k,currCol,K,n).row;if(isNaN(j))return}if(j=j>=totRows?totRows-1:j,n)if(isCellRange()){var E=getCellRange();currRow!=E.endRow?focusCellRange(E.startRow,E.startCol,j,E.endCol,"KEYSELECTION"):(resetCellRange(),focusCellRange(E.endRow,E.startCol,j,E.endCol,"KEYSELECTION"))}else focusCellRange(currRow,currCol,j,currCol,"KEYSELECTION");else formulaCell?(currRow=j,focusCellRangeFill(j,currCol,j,currCol)):focusCell(j,currCol,void 0,void 0,void 0,o)}}else{if(a&&40==r){if(READ_WRITE)if(Filter.hasFilter&&Filter.getInstance().range.sr===currRow&&currCol>=Filter.getInstance().range.sc&&currCol<=Filter.getInstance().range.ec)Filter.showFilterOptions(),setTimeout(function(){$($("#headers").find(".fselected")).css("box-shadow","0px 0px 2px 2px #addfff")},200);else{var t=appEvent.isDefaultPrevented(appEvent.trigger("cell.showDvList",[e]));t||pickFromList()}break}if(formulaCell){var w=ActiveFormulaInfo,Y=w.getActiveCol(),z=w.getEndRow()+1;totRows>z&&(ActiveFormulaInfo.set(z,Y),focusCellRangeFill(z,Y,z,Y))}else{var w=ActiveCellInfo;focusCell(Row.findNextNonHiddenRow(w.getEndRow(),!0),w.getActiveCol(),void 0,void 0,void 0,o)}if(currRowTemp+1===totRows)if(appendBlankRows(),formulaCell)currRow=currRowTemp+1,focusCellRangeFill(Row.findNextNonHiddenRow(currRowTemp),currCol,currRowTemp+1,currCol);else{var w=ActiveCellInfo;focusCell(Row.findNextNonHiddenRow(w.getEndRow()),w.getActiveCol(),void 0,void 0,void 0,o)}}else{if(clearTextSelection(),formulaCell)var g=cellRangeStartCol,f=cellRangeEndCol,I=T,A=b,w=ActiveFormulaInfo,W=w.getActiveRow(),Z=!1,q=!1;else{if(isCellRange())var X=getCellRange(),g=X.startCol,f=X.endCol,I=X.startRow,A=X.endRow;else var w=ActiveCellInfo,g=w.getStartCol(),f=w.getEndCol(),I=w.getStartRow(),A=w.getEndRow();var W=currRow,Z=isColSelected(),q=isRowSelected()}if(Z)return;if(q)if(I==W)focusRow(I,Row.findNextNonHiddenRow(A));else if(A==W)focusRow(A,Row.findNextNonHiddenRow(I));else{var J=new Range(W,g,W,f);Merge.extendRange(J);var Q=J.startRow,et=J.endRow;Q==I?focusRow(I,Row.findNextNonHiddenRow(A)):et==A&&focusRow(A,Row.findNextNonHiddenRow(I))}else if(I==W)A=Row.findNextNonHiddenRow(A),focusCellRange(I,g,A,f,"KEYSELECTION");else if(A==W){var tt=new Range(I,g,I,f);Merge.extendRange(tt),I=Row.findNextNonHiddenRow(tt.endRow),focusCellRange(A,f,I,g,"KEYSELECTION")}else{var J=new Range(W,g,W,f);Merge.extendRange(J);var Q=J.startRow,et=J.endRow;if(Q==I)A=Row.findNextNonHiddenRow(A),focusCellRange(I,g,A,f,"KEYSELECTION");else if(et==A){var tt=new Range(I,g,I,f);Merge.extendRange(tt),I=Row.findNextNonHiddenRow(tt.endRow),focusCellRange(A,f,I,g,"KEYSELECTION")}else I=Row.findNextNonHiddenRow(I),focusCellRange(A,f,I,g,"KEYSELECTION")}selRow>=totRows-1&&appendBlankRows()}return!1;case 46:if(!jsREMOTE_SAVE_VIEW&&!jsGADGET_VIEW&&!jsTHROWAWAY_VIEW&&ole.isActive()&&null!=ole.currObj&&!isUndefined(ole.currObj)){ole.remove(ole.currObj.id,!0),ole.conf.onblur();break}!READ_WRITE||e.shiftKey&&e.ctrlKey||deleteCell();break;case 59:case 186:if(e.ctrlKey||e.metaKey)return insertDateOrTime(e.shiftKey?"time":"date"),!1;break;case 61:if((e.shiftKey||e.altKey)&&e.ctrlKey)return insertRowOrColumn(),!1;case 107:case 187:if(!e.ctrlKey&&e.altKey)return initAutoSum(e),!1;break;case 191:if(e.ctrlKey){var nt=getArray(currRow,currCol);return void(null!==nt&&focusCellRange(nt[0],nt[2],nt[1],nt[3]))}}}}}function cellKeyPress(e){if(isSSActive){if(browser_ie)var e=window.event,t=e.srcElement,o=e.keyCode;else if(browser_nn6)var t=e.target,o=e.which;var l=t.tagName.toUpperCase();if(t!=cellField&&("INPUT"==l||"TEXTAREA"==l||"SELECT"==l||"IMG"==l||"A"==l))return;if(browser_nn6&&window.navigator.userAgent.toLowerCase().indexOf("firefox")<0&&(34==currKeyCode||40==currKeyCode||9==currKeyCode))return!1;if(e.ctrlKey||e.metaKey)switch(o){case 66:case 98:case 73:case 105:case 83:case 115:case 85:case 117:return!1}if(e.shiftKey&&32==o)return;if(150>o&&(0==o||27==o||e.ctrlKey||e.altKey||e.metaKey))return;if(browser_opera){if(13===o||9===o)return exprField.blur(),!1;if(16===o||8===o||36===o||35===o)return}if(browser_nn6){if((9!=e.keyCode&&13!=e.keyCode&&33!=e.keyCode&&34!=e.keyCode&&!(e.keyCode>=37&&e.keyCode<=40)||browser_safari&&13!=e.keyCode)&&READ_WRITE){var r=isCapsLockOn(o,e.shiftKey);229==e.keyCode?focusCellField():o>=65&&90>=o||o>=95&&123>=o?focusCellField(o>=65&&90>=o&&r?e.shiftKey?String.fromCharCode(o).toLowerCase():String.fromCharCode(o):o>=95&&123>=o&&r?e.shiftKey?String.fromCharCode(o):String.fromCharCode(o).toUpperCase():String.fromCharCode(o)):os_mac&&e.metaKey&&e.altKey||focusCellField(String.fromCharCode(o))}}else browser_ie&&focusCellField(o>=65&&90>=o&&r?e.shiftKey?String.fromCharCode(o).toLowerCase():String.fromCharCode(o):o>=95&&123>=o&&r?e.shiftKey?String.fromCharCode(o):String.fromCharCode(o).toUpperCase():String.fromCharCode(o));return!1}}function focusCell(e,t,o,l,r,n,i){if(appEvent.trigger("collabpanal.senduseredit",[isCellEdited()]),!(e>=getRowMax()||t>=getColMax())){var a=0;n&&(a=browser_ie?window.event.keyCode:n.which),isFirstTimeTabPressed||(isFirstTimeTabPressed=!0);var s=fPainter;if((s.fPainterdoubleclick||s.fPaintersingleclick)&&copyFormatRange.sheetName==CURRSHEETNAME&&focusCellRangeFill(copyFormatRange.startRow,copyFormatRange.startCol,copyFormatRange.endRow,copyFormatRange.endCol,!0),isCellFieldSPANHided()){if(Row.isAppendable(e)&&appendBlankRows("ROWS_EXCEEDED",e+1),updateSSVScrollFaceState(),colSelection=!1,rowSelection=!1,menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["insrowstbtn","insrowsmenu"]]}),menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["inscolstbtn","inscolsmenu"]]}),~~e>=0&&~~t>=0){window.clearTimeout(userpresenceintvl);var C=getCell(e,t),c=isCellRange();resetCellRange();var d=ActiveCellInfo,R=d.isMerged(),u=d.getStartCol(),g=d.getEndCol(),f=d.getStartRow(),E=d.getEndRow();currColTemp=currCol,currRowTemp=currRow,currRow=e,currCol=t,ActiveCellInfo.reset(e,t);var w=ActiveCellInfo,v=w.getTop(),I=w.getHeight(),A=w.getLeft(),T=w.getWidth(),p=w.isMerged(),m=!1;(R&&!p||!R&&p||R&&p)&&(m=!0),m?(blurColHead(u,g),blurRowHead(f,E),selectColHead(w.getStartCol(),w.getEndCol()),selectRowHead(w.getStartRow(),w.getEndRow())):((38!=a&&40!=a&&13!=a||c)&&(blurColHead(u,g),selectColHead(w.getStartCol(),w.getEndCol())),(37!=a&&39!=a&&9!=a||c)&&(blurRowHead(f,E),selectRowHead(w.getStartRow(),w.getEndRow()))),setFocusInCellField(),setFocusDIVPos(A,v,a),setFocusDIVDim(T,I,a);var S=currCol,D=currRow;if(D=parseInt(w.getStartRow()),S=parseInt(w.getStartCol()),currCell=C,currCellIndicator.title="",currCellIndicator.value=getColHeadLabel(S+1)+getRowHeadLabel(D),updateActiveCellDependencies(C),window.clearTimeout(activeCellUIUpdateTimeoutId),activeCellUIUpdateTimeoutId=setTimeout(function(){decideMergeIcon(getCellRange()),loadIntegrationDatePicker(),o&&o(),r||(rowToFocusOnPageNavigation=void 0),$("#insert").enable(),menutabListener.doAction(TOOLBAR.INSERT,{id:"inserthyperlink",action:"enable",callback:callbackHyperlink,args:["inserthyperlink"]})},timer),void 0!=n&&9!=n.keyCode&&applyFormatting(),cellRangeStartRow=currRow,cellRangeStartCol=currCol,cellRangeEndRow=currRow,cellRangeEndCol=currCol,CellUtils.displayCellName(currRow,currCol,currRow,currCol,CURRSHEETNAME),jsPUBLIC_VIEW&&PUBLIC_EDIT_MODE&&(READ_WRITE=!0,"hide"!=getCellContent(currCell,"fn")||showFormulas?showFormulas&&(READ_WRITE=!0,exprField.readonly=!1):(READ_WRITE=!1,exprField.readonly=!0),READ_WRITE?(setStatusText(""),$("#cellStatus").hide()):setStatusText(jsMsg["PublicView.ProtectedCell"])),l||(ActiveCellInfo.isMerged()&&ActiveCellInfo.getRange().isCol()||scrollRowIntoView(D),ActiveCellInfo.isMerged()&&ActiveCellInfo.getRange().isRow()||scrollColIntoView(S)),!jsTHROWAWAY_VIEW){var O=!1;27==a&&(O=!0),userpresenceintvl=window.setTimeout(function(){userPresence.send(O)},userPresence.HOLD_ON_TIME)}}if(i!==!1&&Row.isHidden(currRow)){var h=getHiddenCellFormula(e,t);isUndefined(h)?requestHiddenRowData(e):updateExprFieldWithHiddenRowData(e,h)}appEvent.trigger("cell.focus",[{row:currRow,col:currCol}])}}}function requestHiddenRowData(e){var t=new RequestParameters(ActionConstants.HIDDEN_ROW_DATA);t.setParameters(WorkSheets.getAssociatedActiveSheetName(),e);var o=new AjaxRequest;o.init("POST",t.getURL(),!0,t.getParametersAsString()),o.addEventListener("onComplete",function(e){var t=JSON.parse(decodeURIComponent(e.responseText));updateHiddenRowData(t.row,t.data),clearHiddenRowFormulas=!0}),o.sendRequest()}function updateHiddenRowData(e,t){Row.clientData.hiddenRowsInfo[e]=t,updateExprFieldWithHiddenRowData(e)}function updateExprFieldWithHiddenRowData(e,t){if(currRow===e){var o=isUndefined(t)?getHiddenCellFormula(e,currCol):t;exprField.value=o,t=o}}function getHiddenCellFormula(e,t){var o,l=Row.clientData.hiddenRowsInfo[e];return l&&(o=l[t],isUndefined(o)&&(o="")),o}function updateActiveCellDependencies(e){if(currCellHolder=e,currCellValue=currCell?currCell.getAttribute("cV"):null,(null==currCellValue||"null"==currCellValue)&&(currCellValue=""),currCellFormula=getCellFormula(currCell),currCellFormula=""!=currCellFormula?currCellFormula:currCellValue,jsVERSION_VIEW||(window.clearTimeout(initFormatTimeoutId),initFormatTimeoutId=setTimeout(function(){init_format(e)},timer)),isFuncDlgOpen||isCellEdited()||isExprFunc||isEditingInExprField||(exprField.value=getCellContent()),jsPUBLIC_VIEW&&!showFormulas&&PUBLIC_EDIT_MODE){if("hide"==getCellContent(currCell,"fn"))return READ_WRITE=!1,void(exprField.readonly=!0);READ_WRITE=!0,exprField.readonly=!1}}function sheetMouseDown(e){if(browser_ie)var t=e.srcElement,o=2==e.button;else if(browser_nn6)var t=e.target,o=3==e.which;if(isFilterOptionsDIVOpened){var l=t.id;return l&&-1!==l.indexOf("filter")||Filter.hideFilterOptions("",""),!1}isFirstTimeTabPressed||(isFirstTimeTabPressed=!0);var r=getRowPosInMouseEvent(e),n=getColPosInMouseEvent(e);formulaMenuUtil.isFMenuOpened&&formulaMenuUtil.hideMenu();var i=Merge.getCellInfo(r,n);if(i&&(r=i.startRow,n=i.startCol),"sheet"!=t.id){if(isCellEdited()&&0!==cellField.value.indexOf("=")&&isPivotOrArrayRange(currRow,currCol,currRow,currCol))return!1;var a=browser_ie&&"filterIconContainer"===t.className,s=appEvent.isDefaultPrevented(appEvent.trigger("grid.mousedown",[e,r,n,o]));if(s)return!1;if(!isCellField(t)){if(isCellFieldSPANHided()||(cellPrevState&&cellPrevState.sourceSheet!==CURRSHEETNAME?sheetSwitchBeforeSubmit():submitCell()),e.shiftKey&&(isCell(t)||ProtectedRanges.isSheetLocked(CURRSHEETNAME)||"vcD"==t.className||a)){var C=currCol,c=n;return clearSelection(),resetCellRange(),focusCellRange(currRow,C,r,c),!1}if("mousedown"==e.type&&!o&&(a||isTransSPAN(t)||isFocusDIV(t))){if(e.shiftKey)return resetCellRange(),void focusCellRange(currRow,currCol,r,n);"move"!=t.style.cursor&&focusCell(r,n,void 0,!0)}if("mousedown"==e.type&&!o&&!isTransSPAN(t)&&(isFocusDIV(t)||userPresence.isOwnDiv(t)||mask.isGridDiv(t))){var d=getCell(r,n),R=getCursorPos(e),u=getHyperLinkInCell(d).childTag;if(u&&isObject(u)&&u.tagName&&"A"==u.tagName.toUpperCase()){var g=R.x,f=R.y;CellUtils.checkBoundaryForTextInDiv(g,f,d)&&u.click()}else if(checkbox.isPresent()&&CellUtils.checkBoundaryForTextInDiv(R.x,R.y,d,"checkbox")){var E=checkbox.getFromCell(d);checkbox.toggle(E)}}if("mousedown"==e.type&&isCellRangeFlashInnerDIV(t)&&(e.shiftKey?focusCellRange(currRow,currCol,r,n):focusCell(r,n,void 0,!0)),"mousedown"==e.type&&!o&&(a||isCell(t)||isFocusDIV(t)||isSheetTable(t)||isTransSPAN(t)||isCellRangeFlashInnerDIV(t)||"undefined"!=typeof userPresence&&userPresence.isOwnDiv(t)||"undefined"!=typeof auditTrail&&auditTrail.isOwnDiv(t)||"undefined"!=typeof mask&&mask.isGridDiv(t)||"undefined"!=typeof checkbox&&checkbox.isOwnDiv(t)||"undefined"!=typeof Discussion&&Discussion.isOwnEl(t)))return(isCell(t)||isSheetTable(t)||a||"undefined"!=typeof userPresence&&userPresence.isOwnDiv(t)||"undefined"!=typeof auditTrail&&auditTrail.isOwnDiv(t)||"undefined"!=typeof mask&&mask.isGridDiv(t)||"undefined"!=typeof checkbox&&checkbox.isOwnDiv(t)||"undefined"!=typeof Discussion&&Discussion.isOwnEl(t))&&(focusCell(r,n,void 0,!0),$("#fileName").length&&$("#fileName").hasClass("ui-zfilefield-active")&&$("body").trigger("click.zstf")),void(isFocusDIV(t)&&"move"==t.style.cursor?READ_WRITE&&startDragCellOrCellRange(e,t):(selRow=currRow,selCol=currCol,selectionLeft=getEndLeftOfCol(currCol),selectionTop=getEndTopOfRow(currRow),document.addEventListener("mousemove",selectCell,!1),document.addEventListener("mouseup",endSelect,!1)));"mousedown"==e.type&&o&&(a||isCell(t)||"A"==t.tagName&&isCell(t.parentNode))&&focusCell(r,n,void 0,!0),"mousedown"==e.type&&o&&exitFormatPainter()}}}function blurCell(e,t){if(isNumber(e)&&isNumber(t)){var o=endRow=e,l=endCol=t,r=Merge.getCellInfo(e,t);r&&(o=r.startRow,l=r.startCol,endRow=r.endRow,endCol=r.endCol),blurColHead(l,endCol),blurRowHead(o,endRow)}}function setCellContent(e,t){var o=t;if(e){if(isObject(e)&&!isUndefined(t)){var l=e.className,r=$(e).find("[class*='iS-']");(-1!=l.indexOf("tac")||-1!=l.indexOf("tar")||-1!=l.indexOf("fac")||-1!=l.indexOf("far"))&&e.childNodes[0]?e.childNodes[0].innerText?e.childNodes[0].innerText=t:e.childNodes[0].textContent=t:e.innerText?e.innerText=t:e.textContent=t,0!==r.length&&(hasFlexBoxDiv(e)?$(e.querySelector(".w100")).prepend(r):$(e).prepend(r))}t?e.setAttribute("cV",o):(r&&$(e).find("[class*='iS-']").remove(),e.removeAttribute("cV"))}}function clearCell(e,t,o){if("undefined"!=typeof e&&"undefined"!=typeof t){var l=new Cell(e,t);l.executeMethod(function(e){o||!checkbox.isPresent(e)?(checkbox.clear(e),setCellContent(e,""),e.removeAttribute("fn")):checkbox.isPresent(e)&&(checkbox.add(e,"0"),e.removeAttribute("cV"))})}appEvent.trigger("cell.clear",[{row:e,col:t}]),jsGADGET_VIEW}function setDefaultFormatForCell(e,t,o){if(null!=e){$(e).find("[class*='iS-']").remove();var l=(e.className,checkbox.isPresent(e)?"cD nW tac vam":"cD nW"),r=getCellInnerHTML(e);e.className=l;var n=parseInt(e.style.top),i=parseInt(e.style[isRTL?"right":"left"]),a=parseInt(e.style.width),s=parseInt(e.style.height),C=parseInt(e.style.zIndex);e.removeAttribute("style"),e.style.top=n+"px",e.style[isRTL?"right":"left"]=i+"px",e.style.width=a+"px",e.style.height=s+"px",e.style.zIndex=C;var c=e.getAttribute("format");"FLOAT"==c&&(e.className+=" tar"),checkbox.isPresent(e)||(e.innerHTML=r),""!=r&&appEvent.trigger("cell.setZIndex",[e,t,o])}}function setDefaultValueForCell(e){setCellContent(e,""),e.removeAttribute("fn"),e.removeAttribute("cV")}function getMergeType(e){var t;switch(e){case ACTION_MERGE_CELLS:t="MergeCells";break;case ACTION_MERGE_AND_CENTER:t="MergeAndCenter";break;case ACTION_MERGE_DOWN:t="MergeDown";break;case ACTION_MERGE_ACROSS:t="MergeAcross";break;default:t="Unmerge"}return t}function changeMerge(e){e.icon?e.action!=ACTION_UNMERGE?(recentlyUsedAction=e.action,recentlyUsedIcon=e.icon,updateMerge(ACTION_UNMERGE)):updateMerge(recentlyUsedAction):updateMerge(action===ACTION_UNMERGE?recentlyUsedAction:ACTION_UNMERGE)}function decideMergeIcon(){var e=document.getElementById("shrinked_menuitem_merge");mergeIconId="merge",e&&(mergeIconId="shrinked_menuitem_merge");var t=getCellRange();if(isCellRange()){if(menutabListener.doAction(TOOLBAR.HOME,{id:mergeIconId,action:"enable",callback:callbackMergeEnable,args:[mergeIconId]}),cellRangeContainsMergeCells(t.startRow,t.startCol,t.endRow,t.endCol))return void updateMerge(ACTION_UNMERGE);updateMerge(recentlyUsedAction)}else{if(cellRangeContainsMergeCells(t.startRow,t.startCol,t.endRow,t.endCol))return menutabListener.doAction(TOOLBAR.HOME,{id:mergeIconId,action:"enable",callback:callbackMergeEnable,args:[mergeIconId]}),void updateMerge(ACTION_UNMERGE);updateMerge(recentlyUsedAction),menutabListener.doAction(TOOLBAR.HOME,{id:mergeIconId,action:"enable",callback:callbackMergeDisable,args:[mergeIconId]})}}function updateMerge(e){var t;switch(e){case ACTION_UNMERGE:t=unmergeIcon;break;case ACTION_MERGE_CELLS:t=defaultMergeIcon;break;default:recentlyUsedAction=e,t=recentlyUsedIcon}action=e;var o=getMergeType(e);menutabListener.doAction(TOOLBAR.HOME,{id:mergeIconId,action:"enable",callback:callbackMerge,args:[t,o]})}function callbackMerge(e,t){if("merge"===mergeIconId)$("#formatCellsAlignment").zbutton("changeLabel",t,"#"+mergeIconId),$("#formatCellsAlignment").zbutton("changeIcon",{primary:e},"#"+mergeIconId);else{var o=document.getElementById(mergeIconId);o.children[0].children[0].classList="ui-icon ui-zmenu-icon-inner "+e,o.children[1].innerText=t}}function callbackMergeEnable(e){$("#"+e).enable()}function callbackMergeDisable(e){$("#"+e).disable()}function merge(e){var t=($("#merge"),$(e).metadata());if(action=t.action?t.action:action,action===ACTION_UNMERGE)splitCells();else{var o=getMergeType(action);mergeCells(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o)}changeMerge(t)}function mergeCells(e,t,o,l,r,n,i,a,s,C,c){if(isUndefined(e)&&isUndefined(t)&&isUndefined(o)&&isUndefined(l)){if(!isCellRange())return;var d=getCellRange();e=d.startRow,t=d.startCol,o=d.endRow,l=d.endCol,isWholeSheetSelected()?(e=0,t=0,o=getRowMax()-1,l=getColMax()-1):isColSelected()?(e=0,o=getRowMax()-1):isRowSelected()&&(t=0,l=getColMax()-1)}else e=parseInt(e),o=parseInt(o),t=parseInt(t),l=parseInt(l);if(containsAnyArray(e,t,o,l))return void showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray);if(!isPivotOrArrayRange(e,t,o,l)){if(!i)var i=!1;r||(r=!1),n||(n=!1);var R=!1,u=!1,g=new Range(getAvailableStartRow(),getAvailableStartCol(),getAvailableEndRow(),getAvailableEndCol());if(l>t){var f=getTotalColumn(),E=t>f?f-1:t,w=l>f?f:l,v=new Range(e,E+1,o,w);if(g.subset(v)){var I=v.getIterator();I.initData(!1),I.setDataProcessor(function(e){return e}),I.iterate(function(e,t){var o=getCell(e,t);if(o){var l=getCellContent(o);""!=l&&(this.processData(!0),I.interrupt())}}),R=I.getData()}else u=!0,R=!0}if(o>e&&!R){var f=getTotalColumn(),E=t>f?f:t,A=new Range(e+1,E,o,E);if(g.subset(A)){var I=A.getIterator();I.initData(!1),I.setDataProcessor(function(e){return e}),I.iterate(function(e,t){var o=getCell(e,t);if(o){var l=getCellContent(o);""!=l&&(this.processData(!0),I.interrupt())}}),R=I.getData()}else u=!0,R=!0}if(!ProtectedRanges.isRangeLocked(e,t,o,l,ActionConstants.MERGE_RANGE)){var T=!0;if(c||(c="MergeCells"),R&&!i&&("MergeCells"==c?T=showConfirmDialog(jsMsg.MergingIntoOneCellKeepUpperLeftData+"\n "+jsMsg.AreYouSureToMerge):"MergeAcross"==c?T=showConfirmDialog(jsMsg.MergingAcrossRowKeepLeftMostData+"\n "+jsMsg.AreYouSureToMerge):"MergeDown"==c&&(T=showConfirmDialog(jsMsg.MergingDownColumnKeepUpperMostData+"\n "+jsMsg.AreYouSureToMerge))),T){var p=(getAvailableStartRow(),getAvailableEndRow(),e),m=t;if((isUpdateClientFirst||r)&&appEvent.trigger("range.onBeforeMerge",[{SR:e,SC:t,ER:o,EC:l,mergeOption:c}]),mergeInfo.mergeList[Range.getPrimal(e,t)]){var S=getCell(e,t,getPaneId(e,t),!0),D=getCell(e,t);if(D&&S){var O=D.cloneNode(!0);O.style[isRTL?"right":"left"]=S.style[isRTL?"right":"left"],O.style.top=S.style.top,O.style.height=S.style.height,O.style.width=S.style.width,O.style.zIndex=S.style.zIndex,S.parentNode.replaceChild(O,S)}}if("MergeCells"==c?((isUpdateClientFirst||r)&&mergeRange(e,t,o,l),c=ActionConstants.MERGE_RANGE):"MergeAndCenter"==c?((isUpdateClientFirst||r)&&mergeAndCenter(e,t,o,l),c=ActionConstants.MERGE_AND_CENTER):"MergeAcross"==c?((isUpdateClientFirst||r)&&mergeAcross(e,t,o,l,isColSelected()),p=o,c=ActionConstants.MERGE_ACROSS):"MergeDown"==c&&((isUpdateClientFirst||r)&&mergeDown(e,t,o,l),m=l,c=ActionConstants.MERGE_DOWN),!r){var h=getServerRange(e,t,o,l),N=new RequestParameters(c);N.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t,h.endRow,h.endCol);var _=new AjaxRequest;_.init("POST",N.getURL(),!0,N.getParametersAsString()),actionManager.addRequest(_)}p>usedCursRow&&(usedCursRow=p),m>usedCursCol&&(usedCursCol=m),n||focusHelper(e,t,o,l,!0)}}}}function doMergeCells(e,t,o,l,r){var n=getAvailableStartRow(),i=(getAvailableEndRow(),sheetPaneId),a=getColLeft(t),s=getRowTop(e),C=getObj("mCC"),c=mergeDOMInfo,d=Range.getPrimal(e,t);if(c[d]={},ISFREEZED){if(FREEZED_ROW>e&&n>FREEZED_ROW){i=sheetPane2Id}var R=getObj(mCC1Id),u=getObj(mCC2Id),g=getObj(mCC3Id)}var f=getRowTop(o)+getRowHeight(o)-getRowTop(e),E=getColLeft(l)+getColWidth(l)-getColLeft(t),w=getDefaultCellHTML().cloneNode(!0);r&&r[CellConstants.WRAP]&&(w.className="cD W");getCellContent(w);if(w.style[isRTL?"right":"left"]=a+"px",w.style.top=s+"px",w.style.width=E+"px",w.style.height=f+"px",w.style.position="absolute",w.style.zIndex=1+BASEZINDEX,w.style.overflow="hidden",w.style.display=0==f?"none":"",r&&r[CellConstants.CELLFORMULA]&&w.setAttribute("fn",decodeURIComponent(r[CellConstants.CELLFORMULA])),r){var v=r[CellConstants.CELLVALUE];if(null===v&&(v="null"),v){var I=decodeURIComponent(v),A=I;w.setAttribute("cV",I),r&&r[CellConstants.ENCODEDCELLVALUE]&&(I=decodeURIComponent(r[CellConstants.ENCODEDCELLVALUE]),A=I);var T=r[CellConstants.CELLHYPER];if(T){var p=(T[0],T[1]);if("multi"!=p){var A=T[2];A=decodeURIComponent(A)}if("multi"!=p?appEvent.trigger("addlink",[w,I,A.replace(/\n/g,"<br>"),!0]):appEvent.trigger("addlink",[w,I]),(browser_ie||browser_safari)&&null!=w){var m=getHyperLinkInCell(w).childTag;if(m){{var S=w;w.className}S=getCellContentNode(S);for(var D=getChildNodesLength(S),O=0;D>O;O+=1)if(m=getChildItem(S.childNodes,O),null!=m&&"A"==m.nodeName){var h=w.style.fontSize,N=w.style.fontfamily;""!=h&&(m.style.fontSize=h),""!=N&&(m.style.fontfamily=N)}}}}else{var A=encodeBlankSpaces(A.replace(/\n/g,"<br>"),!0);setCellInnerHTML(w,revertQuote(A))}}}if(r&&r[CellConstants.CELLANNOT]&&""!=r[CellConstants.CELLANNOT]&&Annot.addComment(w,r[CellConstants.CELLANNOT],e,t,!1),r){r[CellConstants.CLASSNAME]&&(w.className+=r[CellConstants.CLASSNAME]);var _=(r[CellConstants.CLASSNAME]||"",r[CellConstants.VALUEFORMAT]),b=w.className,L=getCSSStyleRegex("utextAlign");L.test(b)||_&&1!==_&&-1==b.indexOf("tar")&&(b=concat(b," tar"));var y=isRTL?/( (fa|ta)[lc])(\b)/i:/( (fa|ta)[rc])(\b)/i;if(y.test(b)||-1!=b.indexOf(" W")){var P=getCellInnerHTML(w);addFlexBoxDiv(w,P)}if(w.className=b,_){switch(_){case 1:_="STRING";break;case 2:_="FORMULA";break;case 3:_="DATE";break;case 4:_="PERCENT";break;case 5:_="FRACTION";break;case 6:_="CURRENCY";break;case 7:_="BOOLEAN";break;case 8:_="DATETIME";break;case 9:_="ERROR";break;case 10:_="TIME";break;case 11:_="MATRIX";break;case 12:_="SCIENTIFIC";break;case 13:_="FLOAT"}w.setAttribute("format",_)}}if(r&&r[CellConstants.DATAVALIDATION]){var M=decodeURIComponent(r[CellConstants.DATAVALIDATION]);appEvent.trigger("cell.setDataValidation",[e,t,w,M])}var F;r&&r[CellConstants.CELLSTYLE]&&(F=r[CellConstants.CELLSTYLE]),F&&null!=F[CellConstants.BORDERRIGHT]&&(w.style.borderRight=F[CellConstants.BORDERRIGHT]),F&&null!=F[CellConstants.BORDERBOTTOM]&&(w.style.borderBottom=F[CellConstants.BORDERBOTTOM]),c[d].mC=w,C.appendChild(w);var H={1:"backgroundColor",2:"color",3:"fontFamily",4:"fontSize",5:"textAlign",6:"verticalAlign"},x=!0;if(F)for(var k=1;k<=Object.keys(H).length;k++)if(F[k]){var U={doNotSkipFirstCoveredCell:!0};updateRangeFormat(e,t,o,l,H[k],F[k],U,x,!0)}if(w.style.backgroundColor){var W=new Range(e,t-1,o,t-1),V=W.getIterator();V.iterate(function(e,t){var o=new Cell(e,t);o.executeMethod(function(e){e.style.borderRight||(e.style.borderRight="1px solid transparent")})});var W=new Range(e-1,t,e-1,l),V=W.getIterator();V.iterate(function(e,t){var o=new Cell(e,t);o.executeMethod(function(e){e.style.borderBottom||(e.style.borderBottom="1px solid transparent")})})}if(ISFREEZED){var K=w.cloneNode(!0);if(isColsAndRowsFreezed)var B=w.cloneNode(!0),G=w.cloneNode(!0);FREEZED_ROW>0&&FREEZED_COL>0?(FREEZED_ROW>e&&(c[d].mC1=K,c[d].mC2=B,R.appendChild(K),u.appendChild(B)),c[d].mC3=G,g.appendChild(G)):FREEZED_ROW>0&&FREEZED_ROW>e?(c[d].mC2=K,u.appendChild(K)):FREEZED_COL>0&&(c[d].mC3=K,g.appendChild(K))}}function clearCoveredCells(e,t,o,l){var r=getAvailableStartRow(),n=getAvailableEndRow();o=o>n?n:o,e>FREEZED_ROW&&(e=r>e?r:e),l>t&&(clearContents(e,t+1,o,l,null,!0),clearFormat(e,t+1,o,l),Annot.removeAll(e,t+1,o,l)),o>e&&(clearContents(e+1,t,o,t,null,!0),clearFormat(e+1,t,o,l),Annot.removeAll(e+1,t,o,t))}function splitCells(e,t,o,l,r,n,i){if("undefined"==typeof i&&(i="false"),"undefined"==typeof n)var n=!1;if("undefined"==typeof e&&"undefined"==typeof t&&"undefined"==typeof o&&"undefined"==typeof l)if(isCellRange())var a=getCellRange(),e=a.startRow,t=a.startCol,o=a.endRow,l=a.endCol;else var s=ActiveCellInfo,e=s.getStartRow(),t=s.getStartCol(),o=s.getEndRow(),l=s.getEndCol();else if("undefined"!=typeof e&&"undefined"!=typeof t&&"undefined"==typeof o&&"undefined"==typeof l)var o=e,l=t;getAvailableStartRow(),getAvailableEndRow();if(n||!ProtectedRanges.isRangeLocked(e,t,o,l)){if((isUpdateClientFirst||n)&&Merge.remove(e,t,o,l),!n){var C=getServerRange(e,t,o,l),c=new RequestParameters(ActionConstants.MERGE_SPLIT);c.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t,C.endRow,C.endCol);var d=new AjaxRequest;d.init("POST",c.getURL(),!0,c.getParametersAsString()),actionManager.addRequest(d)}r||focusHelper(e,t,o,l,!0)}}function drawChart(e,t,o,l){"undefined"==typeof l&&(l=!1),HTMLCHARTINFO=[];var r=e.CP_CHART_DBID,n=e.CP_LEFT,i=e.CP_TOP,a=e.CP_WIDTH,s=e.CP_HEIGHT,C="false";"PUBLISH"===t&&(C="true");var c=e.CP_DATARANGE,d=e.CP_DATAIN,R=e.CP_CHART_TITLE,u=e.CP_GRAPHTYPE,g=e.CP_PLOT_ORIENTATION,f=e.CP_SHOW_LEGEND,E=e.CP_CHART_X_LABEL,w=e.CP_CHART_Y_LABEL,v=e.CP_LABEL_FORMAT,I=u;if(u.indexOf("BAR")>-1)var I=u+"_"+g;HTMLCHARTINFO.CP_CHART_DBID=r,HTMLCHARTINFO.CP_PLOT_ORIENTATION=g,HTMLCHARTINFO.CP_CHARTTYPEID=I,HTMLCHARTINFO.CP_GRAPHTYPE=u,HTMLCHARTINFO.CP_SHOW_LEGEND=f,HTMLCHARTINFO.CP_DOCUMENTID=e.CP_DOCUMENTID,HTMLCHARTINFO.CP_DOCUMENTSHEET_NAME=e.CP_DOCUMENTSHEET_NAME,HTMLCHARTINFO.CP_DOCUMENTSHEETID=e.CP_DOCUMENTSHEETID,HTMLCHARTINFO.CP_DATARANGE=c,HTMLCHARTINFO.CP_DATAIN=d,HTMLCHARTINFO.CP_CHART_TITLE=R,HTMLCHARTINFO.CP_LEFT=n,HTMLCHARTINFO.CP_TOP=i,HTMLCHARTINFO.CP_HEIGHT=s,HTMLCHARTINFO.CP_WIDTH=a,HTMLCHARTINFO.CP_CHART_X_LABEL=E,HTMLCHARTINFO.CP_CHART_Y_LABEL=w,HTMLCHARTINFO.CP_LABEL_FORMAT=v,HTMLCHARTINFO.CP_CHART_PUBLICURL=e.CP_CHART_PUBLICURL;var A=getChartImgId(r);if("NEW"===t){var T=ExcelGraph.createInstance(HTMLCHARTINFO);T.CP_CHART_DBID=r,A=T.CP_CHARTID;var p=document.createElement("IMG");p.id=A,p.src=e.CHART_URL,p.style.height=s+"px",p.style.width=a+"px",p.style.left=n+"px",p.style.top=i+"px",p.objType="chart",p.className="chart",p.width=T.CP_WIDTH,p.height=T.CP_HEIGHT,p.chartName=T.CP_CHART_TITLE,p.setAttribute("dbid",r),setChartPermission(),insertImgorChartIsFreezed(p,n,i),ole.init(A).bringToFront(),ole(T.CP_CHARTID).sRow=T.CP_SROW&&-1!=T.CP_SROW?T.CP_SROW:findRowInYPos(i),ole(T.CP_CHARTID).sCol=T.CP_SCOL&&-1!=T.CP_SCOL?T.CP_SCOL:findColInXPos(n),ole(T.CP_CHARTID).sRowDiff=T.CP_SROW_DIFF&&-1!=T.CP_SROW_DIFF?T.CP_SROW_DIFF:i-getRowTop(ole(T.CP_CHARTID).sRow),ole(T.CP_CHARTID).sColDiff=T.CP_SCOL_DIFF&&-1!=T.CP_SCOL_DIFF?T.CP_SCOL_DIFF:n-getColLeft(ole(T.CP_CHARTID).sCol);var m=parseInt(ole(p.id).sColDiff)>parseInt(getColWidth(ole(p.id).sCol))?parseInt(getColLeft(ole(p.id).sCol))+parseInt(getColWidth(ole(p.id).sCol)):getColLeft(ole(p.id).sCol)+parseInt(ole(p.id).sColDiff),S=parseInt(ole(p.id).sRowDiff)>parseInt(getRowHeight(ole(p.id).sRow))?parseInt(getRowTop(ole(p.id).sRow))+parseInt(getRowHeight(ole(p.id).sRow)):getRowTop(ole(p.id).sRow)+parseInt(ole(p.id).sRowDiff);ole(p.id).moveTo(m,S)}else if("EDIT"===t||"REGENERATE"===t){if(""!==A){var D=e.CHART_URL,O=ExcelGraph.getInstance(A);if(O.CP_DATARANGE=c,O.CP_DATAIN=d,O.CP_CHARTTYPEID=I,O.CP_GRAPHTYPE=u,O.CP_PLOT_ORIENTATION=g,O.CP_SHOW_LEGEND=f,O.CP_CHART_TITLE=R,O.CP_CHART_X_LABEL=E,O.CP_CHART_Y_LABEL=w,O.CP_LABEL_FORMAT=v,null===getObj(A)||null===D||jsREMOTE_SAVE_VIEW){if(!l){var O=ExcelGraph.getInstance(A);createChart(O,"EDIT",C,o,"val")}}else getObj(A).src=D}}else if(""!==A){var O=ExcelGraph.getInstance(A),D=e.CHART_URL;"MOVE"===t?(jsREMOTE_SAVE_VIEW||(getObj(A).src=D),ole(A).sCol=findColInXPos(n),ole(A).sRow=findRowInYPos(i),ole(A).sRowDiff=i-getRowTop(ole(A).sRow),ole(A).sColDiff=n-getColLeft(ole(A).sCol),ole.isSelected(A)?(OLE[A].setLeft(n)._setSelectLayer().positionActionBar(),OLE[A].setTop(i)._setSelectLayer().positionActionBar()):ole.isFocussed(A)?(OLE[A].setLeft(n).setFocusLayer(),OLE[A].setTop(i).setFocusLayer()):(OLE[A].setLeft(n),OLE[A].setTop(i))):"RESIZE"===t?(jsREMOTE_SAVE_VIEW||(getObj(A).src=D),ole(A).sCol=findColInXPos(n),ole(A).sRow=findRowInYPos(i),ole(A).sRowDiff=i-getRowTop(ole(A).sRow),ole(A).sColDiff=n-getColLeft(ole(A).sCol),ole.isSelected(A)?(OLE[A].moveTo(n,i)._setSelectLayer().positionActionBar(),OLE[A].resizeTo(a,s)._setSelectLayer().positionActionBar()):ole.isFocussed(A)?(OLE[A].moveTo(n,i).setFocusLayer(),OLE[A].resizeTo(a,s).setFocusLayer()):(OLE[A].moveTo(n,i),OLE[A].resizeTo(a,s))):"DELETE"==t?(ole.currObj&&ole.currObj.id==A&&getObj("OLETextarea").blur(),ole.remove(A,!l),activateCellField()):"PUBLISH"===t?publishChart(A,o,l):"UNPUBLISH"===t&&unpublishChart(A,o,l)}}function getChartImgId(e){var t="";for(var o in ExcelGraph._INSTANCES){var l=getObj(o);if(null!==l){var r=l.getAttribute("dbid");r===e&&(t=l.id)}}return t}function makeOffline(e,t,o,l){if(t!=zuid&&t!=RMUSER&&""!=t){for(var r=!1,n=!1,i="",a=0;a<SHAREDUSERSLIST.length;a++)SHAREDUSERSLIST[a].uname==t&&SHAREDUSERSLIST[a].cstatus!=l&&(SHAREDUSERSLIST[a].cstatus="0",n=!0),"1"!=SHAREDUSERSLIST[a].cstatus||r||(r=!0),i=SHAREDUSERSLIST[a];if(r||(COLLABORATIVE_EDITING="OFF"),0!=SHAREDUSERSLIST.length&&n){var s={type:"PopUp",content:o+" "+jsMsg.hasClosedDocument};SheetNotifier.open(s)}jsTHROWAWAY_VIEW||userPresence.removeByZuid(i.zuid),updateSharedUserStatus()}}function makeOnline(e,t,o){for(var l=!1,r=0;r<SHAREDUSERSLIST.length;r++){{var n=SHAREDUSERSLIST[r];n.dname}if(n.uname==t){if(l=!0,"1"==n.cstatus)return;n.cstatus="1";break}}if(l||(_SharedUserList[t]={uname:t,dname:o,cstatus:1}),!DONTNOTIFY&&!jsPUBLIC_VIEW){var i={type:"PopUp",content:o+" "+jsMsg.hasOpenedDoc,href:{action:"docPanel.show",args:"chat",text:jsMsg.EnterDiscussionRoom}};SheetNotifier.open(i)}DONTNOTIFY=!1,updateSharedUserStatus(),jsTHROWAWAY_VIEW||userPresence.send()}function updateSharedUserStatus(){for(var e=0,t=0;t<SHAREDUSERSLIST.length;t++){var o=SHAREDUSERSLIST[t],l=o.cstatus,r=o.pstatus,n=o.status;"1"===l&&"1"===r&&"1"===n&&(n=1,e+=1)}var i=$("#userStatusDiv"),a=getObj("sharedUserStatus");if((!cdview||0!=e)&&CollabPanel.isAllowed()&&(0==e&&(IS_DOCUMENT_SHARED||REMOTE.ISCOLLABEDITVIEW||REMOTE.ISCOLLABVIEW)&&!jsPUBLIC_VIEW||e>0)){if(i.show(),menutabListener.doAction(TOOLBAR.SHARE,{id:"chatwithusersPanel",action:"enable",callback:button_enable,args:["chatwithusersPanel"]}),menutabListener.doAction(TOOLBAR.SHARE,{id:"notifysharedusers",action:"enable",callback:button_enable,args:["notifysharedusers"]}),i.hasClass("chatBlink")&&i.removeClass("chatBlink"),e>0?i.addClass("userOnline"):i.removeClass("userOnline"),null!=a){var s=jsMsg["Share.Collaborators"];1==e&&(s=jsMsg["Share.Collaborator"]),a.innerHTML="<b>"+e+"</b> "+s,a.title=jsMsg.SharedUserStatus}appEvent.trigger("collabpanal.update",[SHAREDUSERSLIST])}}function getCollaboratorsMode(e){var t,o=!1;t="[";for(var o=!1,l=0;l<SHAREDUSERSLIST.length;l++){var r=SHAREDUSERSLIST[l],n=r.cstatus,i=r.dname;"1"==n&&(t+="{uname:'"+i+"',mode:'-1'}",l<SHAREDUSERSLIST.length-1&&(t+=","))}t+="]","undefined"==typeof e&&(o=!0),"[]"!=t&&(t=JSON.parse('{"CollabModes":"'+t+'"}'),setUserDivColor(t,o))}function setUserDivColor(e){if(null!=e||""!=e)for(var t=0;t<e.CollabModes.length;t++){if("undefined"==typeof e.CollabModes[t])return!1;var o=e.CollabModes[t].mode?e.CollabModes[t].mode:null,l=(e.CollabModes[t].uname?e.CollabModes[t].uname:null,e.CollabModes[t].dname?e.CollabModes[t].dname:null);null!=o&&null!=l&&(userpremission[l]=o)}}function showCommentsIFrame(){docPanel.show("comments",showSheetComments())}function getNextCellDetailsContainingContent(e,t,o,l){var r,n,i={};switch(o){case"DOWN":r=e;for(var a=Row.getNonHiddenRowsInRange(e+1,totRows-1),s=a.length,C=0;s>C;C++){if(r=a[C],!isRowInAvailableRowRange(e))return getUsedCursorCell(e,t,o,l),-1;if(r>getAvailableEndRow())return getUsedCursorCell(e,t,o,l),-1;if(i=getCell(r,t),isCellContainingContent(i))break}case"LEFT":for(n=t-1;n>=0;n-=1){if(!isRowAvailable(e))return getUsedCursorCell(e,t,o,l),-1;if(i=getCell(e,n),isNotValidCell(i)){var c=getValidCellWithDetails(e,n);i=c.obj,n=c.col}if(isCellContainingContent(i))break}break;case"RIGHT":n=t;var d=Range.getIterator(e,t+1,e,totCols-1),R=d.iterate(function(e,t,o,l){if(!isRowAvailable(e))return getUsedCursorCell(e,n,o,l),this.interrupt(),null;var r=getCell(e,t);return isCellContainingContent(r)&&this.interrupt(),{row:e,col:t,cell:r}},o,l);if(!R)return-1;r=R.row,n=R.col,i=R.cell;break;case"UP":for(var a=Row.getNonHiddenRowsInRange(0,e-1),s=a.length-1;s>-1;){if(r=a[s],!isRowAvailable(e))return getUsedCursorCell(e,t,o,l),-1;if(r<getAvailableStartRow())return getUsedCursorCell(e,t,o,l),-1;if(i=getCell(r,t),isCellContainingContent(i))break;s--}}return{row:r,col:n,cell:i}}function getNextCellDetailsNotContainingContent(e,t,o,l){var r,n,i={},a=!1;switch(o){case"DOWN":r=e;for(var s=Row.getNonHiddenRowsInRange(e+1,totRows-1),C=s.length,c=0;C>c;c++){if(r=s[c],!isRowInAvailableRowRange(e))return getUsedCursorCell(e,t,o,l),-1;if(r>getAvailableEndRow())return getUsedCursorCell(e,t,o,l),-1;if(i=getCell(r,t),!isCellContainingContent(i)){a=!0;break}}break;case"LEFT":for(n=t-1;n>=0;n-=1){if(!isRowAvailable(e))return getUsedCursorCell(e,t,o,l),-1;if(i=getCell(e,n),isNotValidCell(i)){var d=getValidCellWithDetails(e,n);i=d.obj,n=d.col}if(!isCellContainingContent(i))break}break;case"RIGHT":n=t;var R=Range.getIterator(e,t+1,e,totCols-1),u=R.iterate(function(e,t,o,l){if(!isRowAvailable(e))return getUsedCursorCell(e,n,o,l),this.interrupt(),null;var r=getCell(e,t);return isCellContainingContent(r)||this.interrupt(),{row:e,col:t,cell:r}},o,l);if(!u)return-1;r=u.row,n=u.col,i=u.cell;break;case"UP":for(var s=Row.getNonHiddenRowsInRange(0,e-1),C=s.length-1;C>-1;){if(r=s[C],!isRowAvailable(e))return getUsedCursorCell(e,t,o,l),-1;if(r<getAvailableStartRow())return getUsedCursorCell(e,t,o,l),-1;if(i=getCell(r,t),!isCellContainingContent(i)){a=!0;break}C--}}return{row:r,col:n,cell:i,found:a}}function setCellTooltip(e,t){e.title=t}function getUsedCursorCell(e,t,o,l){if(!jsPUBLIC_VIEW||PUBLIC_EDIT_MODE){var r=new RequestParameters(ActionConstants.CTRL_NAVIGATION),n="DOWN"==o?1:"UP"==o?2:"RIGHT"==o?3:4;r.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t,e,t,n,totRows,totCols);var i=new AjaxRequest;i.init("POST",r.getURL(),!0,r.getParametersAsString()),i.addEventListener("onComplete",function(r){var n=JSON.parse(r.responseText),i=n.row,a=n.col;if(l)if(isCellRange()){var s=getCellRange();"DOWN"==o.toUpperCase()?currRow!=s.endRow?focusCellRange(s.startRow,s.startCol,i,s.endCol):(resetCellRange(),focusCellRange(s.endRow,s.startCol,i,s.endCol)):"UP"==o.toUpperCase()?currRow!=s.startRow?focusCellRange(s.endRow,s.startCol,i,s.endCol):(resetCellRange(),focusCellRange(s.startRow,s.startCol,i,s.endCol)):"RIGHT"==o.toUpperCase()?currCol!=s.endCol?focusCellRange(s.startRow,s.startCol,s.endRow,a):(resetCellRange(),focusCellRange(s.startRow,s.endCol,s.endRow,a)):"LEFT"==o.toUpperCase()&&(currCol!=s.startCol?focusCellRange(s.startRow,s.endCol,s.endRow,a):(resetCellRange(),focusCellRange(s.startRow,s.startCol,s.endRow,a)))}else focusCellRange(e,t,i,a);else focusCell(i,a)}),i.sendRequest()}}function getNearerCellPos(e,t,o,l){var r="undefined"!=typeof e?parseInt(e):currRow,n="undefined"!=typeof t?parseInt(t):currCol,i="undefined"!=typeof o?parseInt(o):2,a="undefined"!=typeof l?parseInt(l):1,s=null==getCell(r-i,a)?r+i:r-i,C=null==getCell(r,n-a)?n+a:n-a;return{row:s,col:C}}function clearContents(e,t,o,l,r,n){var i=new Range(e,t,o,l),a=i.getIterator();appEvent.trigger("range.clearcontent",[e,t,o,l,totCols,r]),a.iterate(clearCell,n)}function setCellClass(e,t,o){e&&("undefined"!=typeof o&&1==o?e.className=t:e.className+=" "+t)}function insertCells(){SAVED=!1,reloadPage()}function deleteCells(){SAVED=!1,reloadPage()}function startDragCellOrCellRange(e,t){("fD"==t.id||"fD1"==t.id||"fD2"==t.id||"fD3"==t.id)&&(cellDragProps.isDraggable=!0);var o=getCellRange();if(isCellRange())var l=o.startRow,r=o.startCol,n=o.endRow,i=o.endCol;else var a=ActiveCellInfo,l=a.getStartRow(),r=a.getStartCol(),n=a.getEndRow(),i=a.getEndCol();cellDragProps.cellDragRange.ASR=l,cellDragProps.cellDragRange.ASC=r,cellDragProps.cellDragRange.AER=n,cellDragProps.cellDragRange.AEC=i;var s=getRowPosInMouseEvent(e);l>s?s=l:s>n&&(s=n),cellDragProps.ADR=s;var C=getColPosInMouseEvent(e);r>C?C=r:C>i&&(acutalCol=i),cellDragProps.ADC=C,rowsInRange=cellDragProps.cellDragRange.AER-cellDragProps.cellDragRange.ASR,colsInRange=cellDragProps.cellDragRange.AEC-cellDragProps.cellDragRange.ASC,selRow=currRow,selCol=currCol,selectionLeft=getEndLeftOfCol(currCol),selectionTop=getEndTopOfRow(currRow),moveCursorDIV||(moveCursorDIV=document.createElement("DIV"),moveCursorDIV.className="moveCursorDIV",moveCursorDIV.id="moveCursorDIV",moveCursorDIV.style.cursor="move",browser_ie&&(moveCursorDIV.style.backgroundColor="#fff",moveCursorDIV.style.filter="alpha(opacity=0)"),moveCursorDIV.style.display="none",document.body.appendChild(moveCursorDIV)),document.addEventListener("mousemove",dragCellOrCellRange,!1),document.addEventListener("mouseup",endDragCellOrCellRange,!1),document.addEventListener("keydown",cancelDragCellOrCellRange,!1)}function loadIntegrationDatePicker(){if(null!=intDatePicker)for(i=0;i<intDatePicker.length;i++){var e,t=(getCellContent(getCell(currRow,intDatePicker[i].PKColNo)),document.getElementById("intDatePickerDiv")),o=ActiveCellInfo.getTop()+sheetTop,l=ActiveCellInfo.getLeft()+ActiveCellInfo.getWidth()+sheetLeft;if(currCol==intDatePicker[i].datePickerColNo){t.style.top=o+"px",t.style.left=l+"px",t.style.visibility="visible",$("#intDatePickerInput").datepicker({showOn:"button",buttonImage:"styles/"+CURR_THEME+"/images/datetime.png",buttonImageOnly:!0,onSelect:function(){e=$("#intDatePickerInput").datepicker("getDate");var o=$.datepicker.formatDate("dd-mm-yy",e);currCell.innerHTML=o,cellField.value=o,submitCell();document.getElementById("intDatePickerDiv");t.style.visibility="hidden"}});break}t.style.visibility="hidden"}}function navigateOnLeftKeyPress(e,t,o,l,r,n,i,a,s){if(!$("#colorpaletteID").is(":visible")&&allowtowrite)if(rangeSelection(),!t||o||r)if(o||r){if(isCellRange()){if(t){var C=getCellRange();if(currCol!=C.startCol)var c=C.startCol;else var c=C.endCol}else{var c=currCol,d=ActiveCellInfo;c=d.getStartCol()}var R=getCell(currRow,c,void 0,!0);cellRangeContainsMergeCells(currRow,c)&&(R=getCell(currRow,c))}else{var c=currCol,d=ActiveCellInfo,u=d.getActiveRow(),g=d.getActiveCol(),R=getCell(u,g,void 0,!0);cellRangeContainsMergeCells(u,g)&&(R=getCell(u,g)),c=d.getStartCol()}var f="LEFT";if(c>0){if(!isRowAvailable(currRow))return void getUsedCursorCell(currRow,c,f,t);if(isCellContainingContent(R)){var E=getCell(currRow,c-1,void 0,!0);if(cellRangeContainsMergeCells(currRow,c-1)&&(E=getCell(currRow,c-1)),isCellContainingContent(E))var w=getNextCellDetailsNotContainingContent(currRow,c,f,t).col+1;else var w=getNextCellDetailsContainingContent(currRow,c,f,t).col}else var w=getNextCellDetailsContainingContent(currRow,c,f,t).col;if(w=0>w?0:w,t)if(isCellRange()){var C=getCellRange();currCol!=C.startCol?focusCellRange(C.startRow,C.endCol,C.endRow,w,"KEYSELECTION"):(resetCellRange(),focusCellRange(C.startRow,C.startCol,C.endRow,w,"KEYSELECTION"))}else focusCellRange(currRow,currCol,currRow,w,"KEYSELECTION");else focusCell(currRow,w,void 0,void 0,void 0,s)}}else if(formulaCell){var d=ActiveFormulaInfo,v=d.getActiveRow(),I=d.getStartCol()-1;I>=0&&(ActiveFormulaInfo.set(v,I),focusCellRangeFill(v,I,v,I))}else{var d=ActiveCellInfo;focusCell(d.getActiveRow(),d.getStartCol()-1,void 0,void 0,void 0,s)}else{if(formulaCell)var A=cellRangeStartCol,T=cellRangeEndCol,p=cellRangeStartRow,m=cellRangeEndRow,d=ActiveFormulaInfo,g=d.getActiveCol(),S=!1,D=!1;else var O=getCellRange(),A=O.startCol,T=O.endCol,p=O.startRow,m=O.endRow,g=currCol,S=isColSelected(),D=isRowSelected();if(D)return;if(S)if(A==g){if(0>=T)return;focusCol(A,T-1)}else if(T==g){if(0>=A)return;focusCol(T,A-1)}else{var h=new Range(p,g,m,g);Merge.extendRange(h);var N=h.startCol,_=h.endCol;if(N==A){if(0>=T)return;focusCol(A,T-1)}else if(_==T){if(0>=A)return;focusCol(T,A-1)}}else if(A==g){var b=new Range(p,T,m,T);if(Merge.extendRange(b),b.startCol<=0)return;T=b.startCol-1,focusCellRange(p,A,m,T,"KEYSELECTION")}else if(T==g){if(0>=A)return;A-=1,focusCellRange(m,T,p,A,"KEYSELECTION")}else{var h=new Range(p,g,m,g);Merge.extendRange(h);var N=h.startCol,_=h.endCol;if(N==A){var b=new Range(p,T,m,T);if(Merge.extendRange(b),b.startCol<=0)return;T=b.startCol-1,focusCellRange(p,A,m,T,"KEYSELECTION")}else if(_==T){if(0>=A)return;A-=1,focusCellRange(m,T,p,A,"KEYSELECTION")}else{if(0>=T)return;T-=1,focusCellRange(p,A,m,T,"KEYSELECTION")}}}}function navigateOnRightKeyPress(e,t,o,l,r,n,i,a,s){if(!$("#colorpaletteID").is(":visible")&&allowtowrite)if(rangeSelection(),!t||o||r)if(o||r){if(isCellRange()){if(t){var C=getCellRange();if(currCol!=C.endCol)var c=getCellRange().endCol;else var c=getCellRange().startCol}else{var c=currCol,d=ActiveCellInfo;c=d.getEndCol()}var R=getCell(currRow,c,void 0,!0);cellRangeContainsMergeCells(currRow,c)&&(R=getCell(currRow,c))}else{var c=currCol,d=ActiveCellInfo,u=d.getActiveRow(),g=d.getActiveCol(),R=getCell(u,g,void 0,!0);cellRangeContainsMergeCells(u,g)&&(R=getCell(u,g)),c=d.getEndCol()}var f="RIGHT";if(totCols-1>c){if(!isRowAvailable(currRow))return void getUsedCursorCell(currRow,c,f,t);if(isCellContainingContent(R)){var E=getCell(currRow,c+1,void 0,!0);if(cellRangeContainsMergeCells(currRow,c+1)&&(E=getCell(currRow,c+1)),isCellContainingContent(E)){var w=getNextCellDetailsNotContainingContent(currRow,c,f,t).col;isCellContainingContent(getCell(currRow,w))||(w-=1)}else var w=getNextCellDetailsContainingContent(currRow,c,f,t).col}else var w=getNextCellDetailsContainingContent(currRow,c,f,t).col;if(w=w>=totCols?totCols-1:w,t)if(isCellRange()){var C=getCellRange();currCol!==C.endCol?focusCellRange(C.startRow,C.startCol,C.endRow,w,"KEYSELECTION"):(resetCellRange(),focusCellRange(C.startRow,C.endCol,C.endRow,w,"KEYSELECTION"))}else focusCellRange(currRow,currCol,currRow,w,"KEYSELECTION");else focusCell(currRow,w,void 0,void 0,void 0,s)}}else if(formulaCell){var d=ActiveFormulaInfo,v=d.getActiveRow(),I=d.getEndCol()+1;totCols>I&&(ActiveFormulaInfo.set(v,I),focusCellRangeFill(v,I,v,I))}else{var d=ActiveCellInfo,I=d.getEndCol()+1;I==totCols&&insertCol("append",totCols,1,!1,!0,!1),focusCell(d.getActiveRow(),I,void 0,void 0,void 0,s)}else{if(formulaCell)var A=cellRangeStartCol,T=cellRangeEndCol,p=cellRangeStartRow,m=cellRangeEndRow,d=ActiveFormulaInfo,g=d.getActiveCol(),S=!1,D=!1;else{if(isCellRange())var O=getCellRange(),A=O.startCol,T=O.endCol,p=O.startRow,m=O.endRow;else var d=ActiveCellInfo,A=d.getStartCol(),T=d.getEndCol(),p=d.getStartRow(),m=d.getEndRow();var g=currCol,S=isColSelected(),D=isRowSelected()}if(D)return;if(S)if(A==g)focusCol(A,T+1);else if(T==g)focusCol(T,A+1);else{var h=new Range(p,g,m,g);Merge.extendRange(h);var N=h.startCol,_=h.endCol;N==A?focusCol(A,T+1):_==T&&focusCol(T,A+1)}else if(A==g)T+=1,focusCellRange(p,A,m,T,"KEYSELECTION");else if(T==g){var b=new Range(p,A,m,A);Merge.extendRange(b),A=b.endCol+1,focusCellRange(m,T,p,A,"KEYSELECTION")}else{var h=new Range(p,g,m,g);Merge.extendRange(h);var N=h.startCol,_=h.endCol;if(N==A)T+=1,focusCellRange(p,A,m,T,"KEYSELECTION");else if(_==T){var b=new Range(p,A,m,A);Merge.extendRange(b),A=b.endCol+1,focusCellRange(m,T,p,A,"KEYSELECTION")}else A+=1,focusCellRange(m,T,p,A,"KEYSELECTION")}}}function changeAlignIcon(){var e=$("#halignbtn");isRTL?($(e).children("span:first").removeClass("zicon-leftalign"),$(e).children("span:first").addClass("zicon-rightalign")):($(e).children("span:first").removeClass("zicon-rightalign"),$(e).children("span:first").addClass("zicon-leftalign"))}var scanSelectionIntvlId;$(document).ready(function(){document.getElementById("cF").addEventListener("compositionstart",function(){isCellFieldSPANHided()&&focusCellField()})});var callbackHyperlink=function(){isCellRange()?button_disable("inserthyperlink"):button_enable("inserthyperlink")},clearHiddenRowFormulas=!0,initFormatTimeoutId=0,activeCellUIUpdateTimeoutId=0,timer=browser_ie?500:300,ACTION_UNMERGE=0,ACTION_MERGE_CELLS=1,ACTION_MERGE_AND_CENTER=2,ACTION_MERGE_DOWN=3,ACTION_MERGE_ACROSS=4,action=ACTION_MERGE_CELLS,unmergeIcon="zsicon zsicon-unmerge-cells",defaultMergeIcon="zsicon zsicon-merge-cells",recentlyUsedAction=ACTION_MERGE_CELLS,recentlyUsedIcon="zsicon zsicon-merge-cells",mergeIconId,_SharedUserList={};
!function(e){function t(e){var t=e.match(regexCollection.rangeRegex);if(t)return o(e,t)}function n(e){var t=e.match(regexCollection.valid2DRange);if(t)return o(e,t)}function o(e,t){var n={},o=CellUtils.getSheetNameFromCelLbl(e);o=CellUtils.removeApostrophe(o),o=WorkSheets.getActualSheetName(o);var l=WorkSheets.getSheetCodeFromName(o);n.sheetName=o,n.sheetCode=l;var r=t[2].match(regexCollection.splitCellReferencesInRange),i=getRowMax(),s=getColMax(),c=0,g=0;r.forEach(function(e){var t=a(e);i=t.row?Math.min(t.row,i):1,c=t.row?Math.max(t.row,c):getRowMax(),s=t.col?Math.min(t.col,s):1,g=t.col?Math.max(t.col,g):getColMax()});var d=new Range(i-1,s-1,c-1,g-1);return Merge.extendRange(d),n.sR=d.startRow,n.sC=d.startCol,n.eR=d.endRow,n.eC=d.endCol,n}function a(e){var t=regexCollection.cellRangeForReferenceToggling.exec(e);if(t){var n=l(t[2]),o=~~t[4];return{row:o,col:n}}}function l(e){return e?parseInt((parseInt(e,36)-parseInt(Math.pow(10,e.length)-1,36)-1).toString(36),26)+1:0}e.getDataFromRangeText=t,e.getDataFrom2DRangeText=n}(this);var RangeHighlighter=function(){function e(e){var n=getDataFromRangeText(e);n.sheetName===CURRSHEETNAME&&t(n.sR,n.sC,n.eR,n.eC,!0,!0)}function t(e,t,o,a,l,r){F=e,A=o,D=t,N=a,I=WorkSheets.getAssociatedActiveSheetName(),n(e,t,o,a,l,r)}function n(e,t,n,a,l,r){var i=new Range(e,t,n,a);if(Merge.extendRange(i),e=i.startRow,t=i.startCol,n=i.endRow,a=i.endCol,e>=totRows||t>=totCols||n>=totRows&&!isCellEdited()&&!isColSelected()&&!RangeSelector.isActive()||a>=totCols&&!isRowSelected()&&!RangeSelector.isActive())return void o();if((-1==t||0==t&&a===getColMax()-1)&&(rowSelection=!0,t=0),(-1==e||0==e&&n===getRowMax()-1)&&(colSelection=!0,e=0),!(0>n||0>a)){var s=ActiveFormulaInfo.getActiveRow()===e?"N":"S",c=ActiveFormulaInfo.getActiveCol()===t?"W":"E";if(!colSelection){var g=a>t?t:a,d=t>a?t:a,R=n>e?e:n,f=e>n?e:n,h=new Range(R,g,f,d);Merge.extendRange(h),e=h.startRow,t=h.startCol,n=h.endRow,a=h.endCol}var u=n,m=a;u="N"==s?n:e,m="W"==c?a:t;var C=getCellRangeDIM(e,t,n,a),v=ActiveFormulaInfo.getActiveCol(),p=ActiveFormulaInfo.getActiveRow(),S=Math.min(e,n),w=Math.min(t,a),y=Math.max(e,n),E=Math.max(t,a);p>=S&&y>=p&&v>=w&&E>=v||ActiveFormulaInfo.set(S,w),requestAnimationFrame(function(){gridFormulaEditController.isFormula()&&gridFormulaEditController.isDiv()&&RangeSelector.isActive()?x({sR:e,sC:t,eR:n,eC:a,sheetCode:WorkSheets.getAssociatedActiveSheetName()},"RS"):(setCellRangeFillDIVPos(C.left,C.top),setCellRangeFillDIVDim(C.width,C.height),showCellRangeFillDIV())});var F="";if(!l)switch(colSelection&&rowSelection?F="WHOLESHEET":rowSelection?F="ROW":colSelection&&(F="COLUMN"),F){case"WHOLESHEET":break;case"ROW":scrollRowIntoView(u);break;case"COLUMN":scrollColIntoView(m);break;default:scrollCellIntoView(u,m)}cellRangeStartRow=e,cellRangeStartCol=t,cellRangeEndRow=n,cellRangeEndCol=a,r||insertCellRange()}}function o(){currFocusFld="",isFuncDlgOpen=!1,rangeFill=!1,formulaCell=!1,isExprFunc=!1,hideCellRangeFillDIV(),w("RS"),isCopySelection=!1,ActiveFormulaInfo.reset(),cellRangeStartRow=currRow,cellRangeStartCol=currCol,cellRangeEndRow=currRow,cellRangeEndCol=currCol,isRangeSelection=!1,formulaSIdxTemp=0,formulaEIdxTemp=0,F=D=A=N=-1}function a(e){var t=e?"#"+e:"";h("RS",{color:t}),e&&w(e),L=e,m("RS"),u("RS")}function l(e){var t=Object.keys(b);return isNumber(e)&&(t=t.slice(e+1)),t}function r(e){O=R(e);for(var t=0;t<O.length;t++)O[t].classList.add("findActive");return O}function i(e,t,n,o){var a=new Range(e,t,n,o);Merge.extendRange(a);for(var l=getCellRangeDIM(a.startRow,a.startCol,a.endRow,a.endCol),i=O?O:r("find"),s=0;s<i.length;s++)i[s].style[isRTL?"right":"left"]=l.left-1+"px",i[s].style.top=l.top-1+"px",i[s].style.width=l.width+1+"px",i[s].style.height=l.height+1+"px",i[s].style.display=""}function s(){for(var e=O,t=0;t<e.length;t++)e[t].style.display="none"}function c(e){var t=R(e);return b[e]={sR:-1,sC:-1,eR:-1,eC:-1,sheetCode:-1,hidden:!0,dom:t},b[e]}function g(e){return b[e]?b[e]:c(e)}function d(e,t,n){if(e){var o=g(e);o[t]=n}}function R(e){var t="fRD_"+e,n=[];return M.forEach(function(o){var a=document.createElement("DIV");a.className="fRD",a.id=t,a.style.color="#"+e;var l=document.createElement("DIV");l.className="bC";var r=document.createElement("DIV");r.className="bg",a.appendChild(l),a.appendChild(r),o.appendChild(a),a.setAttribute("color",e),a.onmousedown=T;var i=document.createElement("DIV");i.className="fexp",["tl","tr","bl","br"].forEach(function(e){var t=document.createElement("DIV");t.className=e,i.appendChild(t)}),a.appendChild(i),n.push(a)}),n}function f(e){return g(e).dom}function h(e,t){for(var n=f(e),o=0;o<n.length;o++){n[o].style.display="";for(var a=Object.keys(t),l=0;l<a.length;l++){var r=a[l];n[o].style[r]!==t[r]&&(n[o].style[r]=t[r])}}var i=g(e);i.hidden=!1}function u(e){var t=g(e);if(!t.hidden){for(var n=f(e),o=0;o<n.length;o++)n[o].className+=" active",browser_safari&&(n[o].style.display="none",n[o].style.display="",n[o].children[0].style.display="none",n[o].children[0].style.display="");t.hidden=!1}}function m(e){for(var t=f(e),n=0;n<t.length;n++)t[n].className=t[n].className.replace(" active","")}function C(e){v(),e&&(u(e),k=e)}function v(){k&&(m(k),k=null)}function p(e){var t=l(e);t.forEach(function(e){w(e)})}function S(){var e=l();e.forEach(function(e){var t=g(e);t.hidden||E(t,e)})}function w(e){var t=g(e);t.hidden||(h(e,{display:"none"}),t.hidden=!0)}function y(e,t){if(t){var n=getDataFromRangeText(e);n.sheetName===CURRSHEETNAME?x(n,t):w(t)}}function x(e,t){var n=g(t);n.sR=e.sR,n.eR=e.eR,n.sC=e.sC,n.eC=e.eC,n.sheetCode=e.sheetCode,E(n,t)}function E(e,t){var n=new Range(e.sR,e.sC,e.eR,e.eC);Merge.extendRange(n);var o=getCellRangeDIM(n.startRow,n.startCol,n.endRow,n.endCol);o[isRTL?"right":"left"]=o.left-1+"px",o.top=o.top-1+"px",o.width=o.width+1+"px",o.height=o.height+1+"px",o.display="",h(t,o)}var F,D,A,N,I;appEvent.on("grid.resize",function(){isCellRangeFillDivAvailable&&I===WorkSheets.getAssociatedActiveSheetName()&&n(F,D,A,N,!0,!0),gridFormulaEditController.isFormula()&&S()}),appEvent.on("sheet.removed",function(e,t){I===t&&o()});var M=[getObj("fCPD"),getObj("fCPD1"),getObj("fCPD2"),getObj("fCPD3")],b={};appEvent.on("book.onaftersheetswitch",function(){M=[getObj("fCPD"),getObj("fCPD1"),getObj("fCPD2"),getObj("fCPD3")],b={},u("RS"),O=r("find"),L=-1}),appEvent.on("Sheet.Freeze",function(e){var t=-e.top+"px",n=-e.left+"px";switch(e.type){case"ROWS":M[0].style.marginTop=t;break;case"COLS":isRTL?(M[0].style.marginRight=n,M[0].style.marginLeft=""):(M[0].style.marginLeft=n,M[0].style.marginRight="");break;case"ROWS/COLS":M[3].style.marginTop=M[0].style.marginTop=t,isRTL?(M[2].style.marginRight=M[0].style.marginRight=n,M[2].style.marginLeft=M[0].style.marginLeft=""):(M[2].style.marginLeft=M[0].style.marginLeft=n,M[2].style.marginRight=M[0].style.marginRight="")}}),appEvent.on("Sheet.Unfreeze",function(){M[2].style.marginTop=M[0].style.marginTop="0px",isRTL?M[3].style.marginRight=M[0].style.marginRight="0px":M[3].style.marginLeft=M[0].style.marginLeft="0px"});var L=-1;appEvent.on("FormulaHighlightRangeSelector.colorChange",function(e){L!==e&&a(e)});var O,T=function(e){RangeSelector.isActive()&&RangeSelector.off();var t=e.target.className,n=this.getAttribute("color"),o=RangeHighlighter.getColorData(n),a=/t/.test(t),l=/l/.test(t),r=" fexp"+(a&&l||!a&&!l?1:2);return sheet.className+=r,gridFormulaEditController.setRangeSelectionInindex(o.index),ActiveFormulaInfo.set(a?o.eR:o.sR,l?o.eC:o.sC),focusCellRangeFill(o.sR,o.sC,o.eR,o.eC),document.addEventListener("mouseup",W,!1),!1},W=function(){var e=sheet.className.replace(/ fexp(1|2)/g,"");sheet.className=e,document.removeEventListener("mouseup",W,!1),RangeSelector.off(),gridFormulaEditController.rehighlightRanges(),gridFormulaEditController.setFocus()};u("RS");var k;return{drawDashedSelectionWithRangeName:e,drawDashedSelection:t,clearDashedSelection:o,drawColorSelectionWithRangeName:y,setActiveStatetoColorSelection:C,removeActiveStatetoColorSelection:v,addColorDataEntry:d,getColorData:g,drawFindCue:i,hideFindCue:s,clearAllColorSelection:p}}();
function rangeSelection(){if(isCellEdited()&&0===cellField.value.indexOf("=")&&isCellFieldInNewMode){if(isRangeSelection)tempPos=formulaSIdxTemp>0?formulaSIdxTemp:getCaretPos(cellField);else{isRangeSelection=!0;var e=ActiveFormulaInfo;e.isAvailable()||ActiveFormulaInfo.set(currRow,currCol),tempPos=getCaretPos(cellField)}return cellRangeStartIdx=getSelectionStart(cellField),cellRangeEndfIdx=getSelectionEnd(cellField),formulaCell=!0,functionRow=currRow,functionCol=currCol,!0}return!0}function selectCell(e){clearTextSelection(),isCellSelection=!0;var l=(browser_ie?window.event.srcElement:e.target,scrollHelper.pointerOffsetPosCalculator(e,!0,!0));if(l.x>getColLeft(currCol)){var t=l.x>selectionLeft?increaseReqCellLeft(l.x,selCol,selectionLeft):decreaseReqCellLeft(l.x,selCol,selectionLeft);selCol=t.col,selectionLeft=t.left}else{var t=l.x<selectionLeft?decreaseReqCellLeft(l.x,selCol,selectionLeft):increaseReqCellLeft(l.x,selCol,selectionLeft);selCol=t.col,selectionLeft=t.left}if(l.y>getRowTop(currRow)){var o=l.y>selectionTop?increaseReqCellTop(l.y,selRow,selectionTop):decreaseReqCellTop(l.y,selRow,selectionTop);selRow=o.row,selectionTop=o.top}else{var o=l.y<selectionTop?decreaseReqCellTop(l.y,selRow,selectionTop):increaseReqCellTop(l.y,selRow,selectionTop);selRow=o.row,selectionTop=o.top}var r=currCol,n={currRow:currRow,startCol:r,selRow:selRow,selCol:selCol,direction:"INCREMENT"},a={handleFreezedCase:!0,onScrollCallback:selection,defaultCallBack:focusCellRange,callbackParams:n};appEvent.on("scrollCallBack",focusCellRange,"currRow","startCol","selRow","selCol","direction"),scrollHelper.handleCursorPos(a),focusCellRange(currRow,r,selRow,selCol,"INCREMENT")}function endSelect(){applyFormatting(),window.clearTimeout(userpresenceintvl),document.removeEventListener("mousemove",selectCell,!1),document.removeEventListener("mouseup",endSelect,!1),"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),"undefined"!=typeof sheetScrollTopId&&clearInterval(sheetScrollTopId),isCellSelection=!1,isScrollTopSet=!1,isScrollLeftSet=!1,jsTHROWAWAY_VIEW||(userpresenceintvl=window.setTimeout(function(){userPresence.send(!0)},userPresence.HOLD_ON_TIME))}function resetCellRange(){if(isCellRange()){var e=getCellRange();isRowSelected()?blurColHeadTable():blurColHead(e.startCol,e.endCol),isColSelected()?blurRowHeadTable():(browser_ie&&!colSelected||!browser_ie)&&blurRowHead(e.startRow,e.endRow),hideTransSpan(),currCellRange="",selectedCellRange={}}selRow=selCol=-1}function blurCellRange(e,l,t,o){isCellRange()?(blurColHead(l,o),blurRowHead(e,t)):blurCell(currRow,currCol)}function focusCellRange(e,l,t,o,r,n,a,s,c){window.clearTimeout(fCRDebounceTimerId),fCRDebounceTimerId=setTimeout(function(){decideMergeIcon(getCellRange()),isCellRange()?(menutabListener.doAction(TOOLBAR.INSERT,{id:"inserthyperlink",action:"disable",callback:callbackHyperlink,args:["inserthyperlink"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"merge",action:"enable",callback:decideMergeIcon,args:["merge"]})):(menutabListener.doAction(TOOLBAR.INSERT,{id:"inserthyperlink",action:"disable",callback:callbackHyperlink,args:["inserthyperlink"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"merge",action:"enable",callback:decideMergeIcon,args:["merge"]}))},500),appEvent.off("scrollCallBack",focusCellRange);var i,g,R,C="";if(r&&(r=r.toUpperCase()),-1==l&&(rowSelection=!0,l=0),-1===e&&(colSelection=!0,e=0),RangeSelector.isActive())return void focusCellRangeFill(e,l,t,o);var u=o>l?l:o,d=l>o?l:o,f=t>e?e:t,p=e>t?e:t,w=getCellRange(),S=t>e?"N":"S",D=o>l?"E":"W",I=!1;if(!(p>=getRowMax()||d>=getColMax())){if("COLUMN"!=r&&"COLUMNINMOUSE"!=r&&"COLUMNINKEY"!=r&&"WHOLESHEET"!=r&&p>=totRows&&appendBlankRows("ROWS_EXCEEDED",p+1),totCols>u&&d>=totCols)l>=totCols&&(l=totCols-1),o>=totCols&&(o=totCols-1);else if(d>=totCols&&u>=totCols)return;if("ROW"!=r&&"COLUMN"!=r&&"COLUMNINMOUSE"!=r&&"COLUMNINKEY"!=r&&"WHOLESHEET"!=r&&"ROWINMOUSE"!=r){var u=o>l?l:o,d=l>o?l:o,f=t>e?e:t,p=e>t?e:t,v=new Range(f,u,p,d);Merge.extendRange(v),e=v.startRow,l=v.startCol,t=v.endRow,o=v.endCol,I=!0}else if("COLUMN"==r||"COLUMNINMOUSE"==r||"COLUMNINKEY"==r){var u=o>l?l:o,d=l>o?l:o,f=0,p=getRowMax()-1,v=new Range(f,u,p,d);Merge.extendCol(v),e=v.startRow,l=v.startCol,t=v.endRow,o=v.endCol,I=!0}else if("ROW"==r||"ROWINMOUSE"==r){var f=t>e?e:t,p=e>t?e:t,u=0,d=getColMax()-1,v=new Range(f,u,p,d);Merge.extendRow(v),e=v.startRow,l=v.startCol,t=v.endRow,o=v.endCol,I=!0}if(!r||!isCellRange()||w.startRow!=f||w.endRow!=p||w.startCol!=u||w.endCol!=d){switch(r){case"ROWINKEY":case"ROWINMOUSE":case"ROW":var h=getCellRangeDIM(e,l,t,o);if(C=0,R=getSheetTableWidth(),i=h.top,g=h.height,selectColHeadTable(),"ROW"==r){if(isCellRange()){var w=getCellRange();isColSelected()?blurRowHeadTable():t>=e?blurRowHead(w.startRow,w.endRow):blurRowHead(w.endRow,w.startRow)}else blurRowHead(currRow,currRow);t>=e?selectRowHead(e,t):selectRowHead(t,e)}else if(t>=e){var T=t+1,E=w.endRow,m=w.endRow,b=t;w.startRow<currRow&&t>=currRow?(blurRowHead(w.startRow,w.endRow-1),selectRowHead(e,t)):(blurRowHead(T,E),selectRowHead(m,b))}else{var T=w.startRow,E=t-1,m=t,b=w.startRow;w.endRow>currRow&&currRow>t?(blurRowHead(w.startRow+1,w.endRow),selectRowHead(t,e)):(blurRowHead(T,E),selectRowHead(m,b))}break;case"COLUMNINKEY":case"COLUMNINMOUSE":case"COLUMN":var h=getCellRangeDIM(e,l,t,o);if(i=0,g=getSheetTableHeight(),C=h.left,R=h.width,selectRowHeadTable(),"COLUMN"==r){if(isCellRange()){var w=getCellRange();isRowSelected()?blurColHeadTable():o>=l?blurColHead(w.startCol,w.endCol):blurColHead(w.endCol,w.startCol)}else blurColHead(currCol,currCol);o>=l?selectColHead(l,o):selectColHead(o,l)}else o>=l?w.startCol<currCol&&o>=currCol?(blurColHead(w.startCol,w.endCol-1),selectColHead(l,o)):(blurColHead(o+1,w.endCol),selectColHead(l,o)):w.endCol>currCol&&currCol>o?(blurColHead(w.startCol+1,w.endCol),selectColHead(o,l)):(blurColHead(w.startCol,o-1),selectColHead(o,w.startCol));break;case"WHOLESHEET":C=0,R=getSheetTableWidth(),i=0,g=getSheetTableHeight(),selectRowHeadTable(),selectColHeadTable();break;case"KEYSELECTION":case"INCREMENT":var h=getCellRangeDIM(e,l,t,o);C=h.left,R=h.width,i=h.top,g=h.height;var y=w.startCol,L=w.endCol,P=Selection.changeInPosition(y,L,l,o);if(P){var O=P.reset,F=P.set;O&&(blurColHead(O[0].start,O[0].end),O[1]&&blurColHead(O[1].start,O[1].end)),F&&(selectColHead(F[0].start,F[0].end),F[1]&&selectColHead(F[1].start,F[1].end))}var H=w.startRow,A=w.endRow,N=Selection.changeInPosition(H,A,e,t);if(N){var O=N.reset,F=N.set;O&&(blurRowHead(O[0].start,O[0].end),O[1]&&blurRowHead(O[1].start,O[1].end)),F&&(selectRowHead(F[0].start,F[0].end),F[1]&&selectRowHead(F[1].start,F[1].end))}break;default:var h=getCellRangeDIM(e,l,t,o);if(C=h.left,R=h.width,i=h.top,g=h.height,isCellRange()){var w=getCellRange();isColSelected()?blurRowHeadTable():t>=e?blurRowHead(w.startRow,w.endRow):blurRowHead(w.endRow,w.startRow),isRowSelected()?blurColHeadTable():o>=l?blurColHead(w.startCol,w.endCol):blurColHead(w.endCol,w.startCol)}else blurCell(currRow,currCol);t>=e?selectRowHead(e,t):selectRowHead(t,e),o>=l?selectColHead(l,o):selectColHead(o,l)}var M=Merge.getCellInfo(e,l);if(M)var V=l-o+M.getColSpan()-1==0&&e-t+M.getRowSpan()-1==0;if(!r){currRow=e,currCol=l,I&&(currRow="N"==S?e:t,currCol="E"==D?l:o),ActiveCellInfo.reset(currRow,currCol);var x=getCell(currRow,currCol);x&&(currCell=x,updateActiveCellDependencies(x))}if(e-t==0&&l-o==0||V){if(M)var k=M.startRow,W=M.startCol;else var k=e,W=l;setCurrCellIndicator(k,W,k,W),currCellRange=""}else{var _=o,q=getAvailableEndCol();_>q&&(_=q),setCurrCellIndicator(e,l,t,_)}if(!n){var U=t,B=o;switch(I&&(U="N"==S?t:e,B="E"==D?o:l),r){case"WHOLESHEET":break;case"ROWINKEY":case"ROWINMOUSE":case"ROW":c||scrollRowIntoView(U);break;case"COLUMNINKEY":case"COLUMN":case"COLUMNINMOUSE":c||scrollColIntoView(B);break;case"INCREMENT":break;default:c||scrollCellIntoView(U,B)}}if(e-t==0&&l-o==0||V?hideTransSpan():showTransSpan(),appEvent.trigger("range.focus",[currRow,currCol]),setFocusDIVPos(C,i),setFocusDIVDim(R,g),CellUtils.displayCellName(e,l,t,o,CURRSHEETNAME),s||(rowToFocusOnPageNavigation=void 0),timer=browser_ie?500:300,window.clearTimeout(initFormatTimeoutIdForFocusRange),initFormatTimeoutIdForFocusRange=setTimeout(function(){(isColumnSelected||isRowSelectd)&&$("#insert").disable(),window.clearTimeout(userpresenceintvl),jsTHROWAWAY_VIEW||(userpresenceintvl=window.setTimeout(function(){userPresence.send(!0)},userPresence.HOLD_ON_TIME))},timer),Row.isHidden(currRow)){var Y=getHiddenCellFormula(currRow,currCol);isUndefined(Y)?requestHiddenRowData(currRow):updateExprFieldWithHiddenRowData(currRow,Y)}colSelection&&rowSelection?(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"disable",callback:changebuttonsState,args:["insertRowColumn","disable",["insrowstbtn","insrowsmenu"]]}),menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"disable",callback:changebuttonsState,args:["insertRowColumn","disable",["inscolstbtn","inscolsmenu"]]})):colSelection?(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"disable",callback:changebuttonsState,args:["insertRowColumn","disable",["insrowstbtn","insrowsmenu"]]}),menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["inscolstbtn","inscolsmenu"]]})):rowSelection&&(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["insrowstbtn","insrowsmenu"]]}),menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"disable",callback:changebuttonsState,args:["insertRowColumn","disable",["inscolstbtn","inscolsmenu"]]}))}}}function selectCol(e){var l=(browser_ie?window.event.srcElement:e.target,scrollHelper.pointerOffsetPosCalculator(e,!0,!1));if(RangeSelector.isActive()){var t=ActiveFormulaInfo,o=t.getActiveCol();if(void 0===funCol&&(funCol=t.getStartCol()),l.x>getColLeft(o)){var r=l.x>functionLeft?increaseReqCellLeft(l.x,funCol,functionLeft):decreaseReqCellLeft(l.x,funCol,functionLeft);funCol=r.col,functionLeft=r.left}else{var r=l.x<functionLeft?decreaseReqCellLeft(l.x,funCol,functionLeft):increaseReqCellLeft(l.x,funCol,functionLeft);funCol=r.col,functionLeft=r.left}var n=t.getStartCol(),a=funCol}else{if(x>getColLeft(currCol)){var r=l.x>selectionLeft?increaseReqCellLeft(l.x,selCol,selectionLeft):decreaseReqCellLeft(l.x,selCol,selectionLeft);selCol=r.col,selectionLeft=r.left}else{var r=l.x<selectionLeft?decreaseReqCellLeft(l.x,selCol,selectionLeft):increaseReqCellLeft(l.x,selCol,selectionLeft);selCol=r.col,selectionLeft=r.left}var n=currCol,a=selCol}var s={startCol:n,endCol:a},c={doNotHandleForYPos:!0,onScrollCallback:selection,defaultCallBack:focusCol,callbackParams:s};focusCol(n,a),appEvent.on("scrollCallBack",focusCol,"startCol","endCol"),scrollHelper.handleCursorPos(c),appEvent.trigger("grid.onrangeselect")}function endSelectCol(){applyFormatting(),window.clearTimeout(userpresenceintvl),document.removeEventListener("mousemove",selectCol,!1),document.removeEventListener("mouseup",endSelectCol,!1),appEvent.trigger("grid.rangeselect.end"),jsTHROWAWAY_VIEW||(userpresenceintvl=window.setTimeout(function(){userPresence.send()},userPresence.HOLD_ON_TIME)),"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),colSelected=!1,isScrollLeftSet=!1}function selectRow(e){var l=(browser_ie?window.event.srcElement:e.target,scrollHelper.pointerOffsetPosCalculator(e,!1,!0));if(RangeSelector.isActive()||isCellEdited()&&0==cellField.value.indexOf("=")||formulaCell||isExprFunc||isFuncDlgOpen&&null!=getObj("funcList")||isRangeEdit||isChartDialogOpened&&null!=getObj("chartDataDIV")&&"none"!=getObj("chartDataDIV").style.display){var t=ActiveFormulaInfo,o=t.getActiveRow();if(void 0===funRow&&(funRow=o),l.y>getRowTop(o)){var r=l.y>functionTop?increaseReqCellTop(l.y,funRow,functionTop):decreaseReqCellTop(l.y,funRow,functionTop);funRow=r.row,functionTop=r.top}else{var r=l.y<functionTop?decreaseReqCellTop(l.y,funRow,functionTop):increaseReqCellTop(l.y,funRow,functionTop);funRow=r.row,functionTop=r.top}var n=t.getStartRow(),a=funRow}else{if(l.y>getRowTop(currRow)){var r=l.y>selectionTop?increaseReqCellTop(l.y,selRow,selectionTop):decreaseReqCellTop(l.y,selRow,selectionTop);selRow=r.row,selectionTop=r.top}else{var r=l.y<selectionTop?decreaseReqCellTop(l.y,selRow,selectionTop):increaseReqCellTop(l.y,selRow,selectionTop);selRow=r.row,selectionTop=r.top}var n=currRow,a=selRow}var s={startRow:n,endRow:a},c={handleFreezedCase:!0,doNotHandleForXPos:!0,onScrollCallback:selection,defaultCallBack:focusRow,callbackParams:s};appEvent.on("scrollCallBack",focusRow,"startRow","endRow"),scrollHelper.handleCursorPos(c),appEvent.trigger("grid.onrangeselect")}function endSelectRow(){applyFormatting(),window.clearTimeout(userpresenceintvl),document.removeEventListener("mousemove",selectRow,!1),document.removeEventListener("mouseup",endSelectRow,!1),"undefined"!=typeof sheetScrollTopId&&clearInterval(sheetScrollTopId),rowSelected=!1,jsTHROWAWAY_VIEW||(userpresenceintvl=window.setTimeout(function(){userPresence.send()},userPresence.HOLD_ON_TIME)),isScrollTopSet=!1,appEvent.trigger("grid.rangeselect.end")}function clearCellRangeFill(){RangeHighlighter.clearDashedSelection(),ClipRange.getClipObject().cutStatus&&ClipRange.removeClipFromServer()}function hideFlashDIV(){isSSActive&&hideCellRangeFillDIV()}function resetCellRangeFill(){isSSActive&&(rangeFill=!1,hideCellRangeFillDIV(),colSelection=!1,rowSelection=!1)}function focusCellRangeInit(e){resetCellRangeFill(),clearTextSelection();var l=browser_ie?window.event.srcElement:e.target;rangeFill=!0;var t=browser_ie&&"filterIconContainer"===l.className;if(l&&isCell(l)||isCellRangeFlashInnerDIV(l)||isFocusDIV(l.id)||"undefined"!=typeof userPresence&&(userPresence.isOwnDiv(l)||auditTrail.isOwnDiv(l))||isTransSPAN(l.id)||t||"undefined"!=typeof mask&&mask.isGridDiv(l)){var o=getRowPosInMouseEvent(e),r=getColPosInMouseEvent(e);if(e.shiftKey){var n=ActiveFormulaInfo;if(n.isAvailable())var a=n.getStartRow(),s=n.getStartCol();else{ActiveFormulaInfo.set(o,r);var a=o,s=r}focusCellRangeFill(a,s,o,r)}else{var n=ActiveFormulaInfo,a=o,s=r;funRow=a,funCol=s,functionLeft=n.getLeft(),functionTop=n.getTop(),focusCellRangeFill(a,s,a,s)}}functionLeft=-1,functionTop=-1,RangeSelector.isRangeSelectionSupported()||document.addEventListener("mousemove",selectCellRangeFill,!1),document.addEventListener("mouseup",endCellRangeFill,!1)}function selectCellRangeFill(e){clearTextSelection();var l=(browser_ie?window.event.srcElement:e.target,scrollHelper.pointerOffsetPosCalculator(e,!0,!0)),t=ActiveFormulaInfo,o=t.getActiveRow(),r=t.getActiveCol();if(l.x>getColLeft(r)){var n=l.x>functionLeft?increaseReqCellLeft(l.x,funCol,functionLeft):decreaseReqCellLeft(l.x,funCol,functionLeft);funCol=n.col,functionLeft=n.left}else{var n=l.x<functionLeft?decreaseReqCellLeft(l.x,funCol,functionLeft):increaseReqCellLeft(l.x,funCol,functionLeft);funCol=n.col,functionLeft=n.left}if(l.y>getRowTop(o)){var a=l.y>functionTop?increaseReqCellTop(l.y,funRow,functionTop):decreaseReqCellTop(l.y,funRow,functionTop);funRow=a.row,functionTop=a.top}else{var a=l.y<functionTop?decreaseReqCellTop(l.y,funRow,functionTop):increaseReqCellTop(l.y,funRow,functionTop);funRow=a.row,functionTop=a.top}var s={startRow:t.getStartRow(),startCol:t.getStartCol(),funRow:funRow,funCol:funCol,doNotInsertCellRange:!0},c={onScrollCallback:formulaFillRange,defaultCallBack:focusCellRangeFill,callbackParams:s};appEvent.on("scrollCallBack",focusCellRangeFill,"startRow","startCol","funRow","funCol","doNotInsertCellRange"),focusCellRangeFill(t.getStartRow(),t.getStartCol(),funRow,funCol,!0),scrollHelper.handleCursorPos(c),appEvent.trigger("grid.onrangeselect")}function endCellRangeFill(){document.removeEventListener("mousemove",selectCellRangeFill,!1),document.removeEventListener("mouseup",endCellRangeFill,!1),isCellSelection=!1,isScrollTopSet=!1,isScrollLeftSet=!1,"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),"undefined"!=typeof sheetScrollTopId&&clearInterval(sheetScrollTopId),RangeSelector.isActive()&&(RangeSelector.isRangeSelectionSupported()||focusCellRangeFill(cellRangeStartRow,cellRangeStartCol,cellRangeEndRow,cellRangeEndCol,!0)),appEvent.trigger("grid.rangeselect.end")}function insertCellRange(){var e=!1,l=ActiveFormulaInfo,t=l.getStartCol(),o=l.getStartRow(),r=l.getEndCol(),n=l.getEndRow(),a=!1;t===cellRangeStartCol&&r===cellRangeEndCol&&o===cellRangeStartRow&&n===cellRangeEndRow&&(e=l.isMerged(),a=!0),RangeSelector.isActive()&&(e||a?appEvent.trigger("grid.rangeselect.update",[cellRangeStartRow,cellRangeStartCol]):appEvent.trigger("grid.rangeselect.update",[cellRangeStartRow,cellRangeStartCol,cellRangeEndRow,cellRangeEndCol]))}function focusCellRangeFill(e,l,t,o,r,n){RangeHighlighter.drawDashedSelection(e,l,t,o,r,n),appEvent.off("scrollCallBack",focusCellRangeFill)}function resetFillRanges(){formulaSIdxTemp=formulaEIdxTemp=0,cellRangeStartRow=currRow,cellRangeStartCol=currCol,cellRangeEndRow=-1,cellRangeEndCol=-1}function focusAllCells(){(isCellFieldSPANHided()||!isPivotOrArrayRange(currRow,currCol,currRow,currCol))&&(isCellEdited()&&!isFormulaCell()&&submitCell(),RangeSelector.isActive()?RangeSelector.isRangeSelectionSupported()||(focusCellRangeFill(-1,-1,getRowMax()-1,getColMax()-1),appEvent.trigger("grid.rangeselect.end")):(totRows=totRows>=getRowMax()?getRowMax():totRows,focusCellRange(-1,-1,totRows-1,totCols-1,"WHOLESHEET")),isColumnSelected=!0,applyFormatting())}function increaseReqCellLeft(e,l,t){if(totCols-1>l)for(;e>t&&totCols-1>l;)l+=1,t=getEndLeftOfCol(l);return{col:l,left:t}}function increaseReqCellTop(e,l,t){if(totRows-1>l)for(;e>t&&totRows-1>l;)l+=1,t=getEndTopOfRow(l);return{row:l,top:t}}function decreaseReqCellLeft(e,l,t){if(l>0)for(;e<t-getColWidth(l)&&l>0;)l-=1,t=getEndLeftOfCol(l);return{col:l,left:t}}function decreaseReqCellTop(e,l,t){if(l>0)for(;e<t-getRowHeight(l)&&l>0;)l-=1,t=getEndTopOfRow(l);return{row:l,top:t}}function getCellRangeDIM(e,l,t,o){if(o>=l)var r=getColLeft(l),n=getColLeft(o)+getColWidth(o);else var r=getColLeft(o),n=getColLeft(l)+getColWidth(l);if(t>e)var a=getRowTop(e),s=getRowTop(t)+getRowHeight(t);else var a=getRowTop(t),s=getRowTop(e)+getRowHeight(e);return{left:r,width:n-r,top:a,height:s-a}}function setCurrCellIndicator(e,l,t,o){if(currCellRange="R"+e+"C"+l+":R"+t+"C"+o,setFocusInCellField(),currCellIndicator.title="",e-t==0&&l-o==0?currCellIndicator.value=getColHeadLabel(o+1)+(t+1):t>=e&&o>=l?currCellIndicator.value=isRowSelected()?t-e+1+"R x "+getColMax()+"C":t-e+1+"R x "+(o-l+1)+"C":e>t&&l>o?currCellIndicator.value=isRowSelected()?e-t+1+"R x "+getColMax()+"C":e-t+1+"R x "+(l-o+1)+"C":t>=e&&l>o?currCellIndicator.value=isRowSelected()?t-e+1+"R x "+getColMax()+"C":t-e+1+"R x "+(l-o+1)+"C":e>t&&o>=l&&(currCellIndicator.value=isRowSelected()?e-t+1+"R x "+getColMax()+"C":e-t+1+"R x "+(o-l+1)+"C"),isWholeSheetSelected()&&(currCellIndicator.value=getRowMax()+"R x "+getColMax()+"C"),t>=e)var r=e,n=t;else var r=t,n=e;if(o>=l)var a=l,s=o;else var a=o,s=l;selectedCellRange={startRow:r,endRow:n,startCol:a,endCol:s}}function scrollSheetVertical(e,l){var t,o,r,n=-1,a=1;e-getSheetScrollTop()<0?(t=!0,r=getSheetScrollTop()-e):e-getSheetScrollTop()>getSheetHeight()&&(o=!0,r=e-(getSheetHeight()+getSheetScrollTop())+16),18>=r?n=200:r>=18&&36>=r?n=175:r>=36&&54>r?(n=100,a=2):r>=54&&(n=75,a=3),r&&(clearInterval(sheetScrollTopId),sheetScrollTopId=setInterval(function(){o&&l(a,"bottom"),t&&l(a,"top")},n))}function scrollSheetHorizontal(e,l){if(e-getSheetScrollLeft()<0){var t=getScrollLeftTime("TO_LEFT",e),o=getCountOfRowToScroll("TO_LEFT",e);"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),sheetScrollLeftId=setInterval(function(){l(o,"left")},t)}else if(e-getSheetScrollLeft()>getSheetWidth()){var t=getScrollLeftTime("TO_RIGHT",e),o=getCountOfRowToScroll("TO_RIGHT",e);"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),sheetScrollLeftId=setInterval(function(){RangeSelector.isActive()?formulaFillRange(o,"right"):l(o,"right")},t)}}function getScrollLeftTime(e,l){var t=-1;switch(e){case"TO_RIGHT":var o=l+16-(getSheetWidth()+getSheetScrollLeft());20>=o?t=500:o>20&&30>o?t=400:o>=30&&40>=o?t=300:o>40&&(t=150);break;case"TO_LEFT":var r=getSheetScrollLeft()-l;t=15>=r?500:r>15&&25>=r?400:r>25&&34>=r?300:150}return t}function getCountOfRowToScroll(e,l){var t=0;switch(e){case"TO_RIGHT":var o=l+16-(getSheetWidth()+getSheetScrollLeft());2>=o?t=1:o>2&&8>o?t=2:o>=8&&14>=o?t=3:o>14&&(t=4);break;case"TO_LEFT":var r=getSheetScrollLeft()-l;t=15>=r?1:r>15&&25>=r?2:r>25&&34>=r?3:4}return t}function setSheetScrollDIM(e,l,t,o,r){var n=getCellRangeDIM(e,t,l,o);setSheetScrollDimentions(n.top,n.left,n.width,n.height,r,e,l,t,o)}function setSheetScrollDimentions(e,l,t,o,r,n,a,s,c){switch(r){case"LEFT":if(s>=c)var i=l-80;else if(t)var i=l+t-80;else var i=l-80;break;case"RIGHT":if(c>s)if(t)var i=l+t-getSheetWidth();else var i=l-getSheetWidth();else var i=l-getSheetWidth();break;case"TOP":if(n>a)var g=e-32;else if(o)var g=e+o-32;else var g=e-32;break;case"BOTTOM":if(a>n)if(o)var g=e+o-getSheetHeight();else var g=e-getSheetHeight();else var g=e-getSheetHeight()}"undefined"!=typeof g&&setScrollTop(g),"undefined"!=typeof i&&setScrollLeft(i)}function showCellRangeFillDIV(){isCellRangeFillDivAvailable=!0,ISFREEZED&&(cellRangeFillDIV1.style.display=cellRangeFillDIV2.style.display=cellRangeFillDIV3.style.display="block",cellRangeFillSPAN1.style.display=cellRangeFillSPAN2.style.display=cellRangeFillSPAN3.style.display="block"),cellRangeFillDIV.style.display="",cellRangeFillSPAN.style.display=""}function hideCellRangeFillDIV(){isCellRangeFillDivAvailable=!1;var e="none";ISFREEZED&&(cellRangeFillDIV1.style.display=cellRangeFillDIV2.style.display=cellRangeFillDIV3.style.display=e,cellRangeFillSPAN1.style.display=cellRangeFillSPAN2.style.display=cellRangeFillSPAN3.style.display=e),cellRangeFillDIV.style.display=e,ClipObject.clearClip()}function resetCellRangeFillDIV(){var e=ClipRange.getClipObject().getRangeFillDim();setCellRangeFillDIVPos(e.left,e.top),setCellRangeFillDIVDim(e.width,e.height)}function setCellRangeFillDIVPos(e,l){e--,l--,cellRangeFillDIV.style[isRTL?"right":"left"]=e+1+"px",cellRangeFillDIV.style.top=l+1+"px",ISFREEZED&&(cellRangeFillDIV1.style[isRTL?"right":"left"]=cellRangeFillDIV2.style[isRTL?"right":"left"]=cellRangeFillDIV3.style[isRTL?"right":"left"]=e+1+"px",cellRangeFillDIV1.style.top=cellRangeFillDIV2.style.top=cellRangeFillDIV3.style.top=l+1+"px")}function setCellRangeFillDIVDim(e,l){e++,l++,isNumber(e)&&isNumber(l)&&(ISFREEZED&&(cellRangeFillDIV1.style.width=cellRangeFillDIV2.style.width=cellRangeFillDIV3.style.width=e-1+"px",cellRangeFillDIV1.style.height=cellRangeFillDIV2.style.height=cellRangeFillDIV3.style.height=l-1+"px"),cellRangeFillDIV.style.width=parseInt(e-1)+"px",cellRangeFillDIV.style.height=parseInt(l-2)+"px")}function showTransSpan(){var e="block";ISFREEZED&&(isRowsOnlyFreezed?transSPAN2.style.display=e:isColsOnlyFreezed?transSPAN3.style.display=e:isColsAndRowsFreezed&&(transSPAN1.style.display=e,transSPAN2.style.display=e,transSPAN3.style.display=e)),transSPAN.style.display=e}function hideTransSpan(){var e="none";ISFREEZED&&(transSPAN1.style.display=e,transSPAN2.style.display=e,transSPAN3.style.display=e),transSPAN.style.display=e}function cancelDragCellOrCellRange(e){return 27==e.keyCode?(cellDragProps.isDraggable=!1,endDragCellOrCellRange(e),stopEvt(e),!1):void 0}function dragCellOrCellRange(e){if(browser_ie)var l=e.srcElement;else if(browser_nn6)var l=e.target;var t=cellDragProps.cellDragRange.ASR,o=cellDragProps.cellDragRange.ASC,r=cellDragProps.cellDragRange.AER,n=cellDragProps.cellDragRange.AEC;if(isPartOfArray(t,o,r,n))return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),cellDragProps.isDraggable=!1,endDragCellOrCellRange(e),stopEvt(e),!1;if(cellDragProps.isDraggable){("dragDIV"==l.id||"dragDIV1"==l.id||"dragDIV2"==l.id||"dragDIV3"==l.id)&&(l.style.cursor="move");var a=cellDragProps.ADR,s=cellDragProps.ADC,c=getRowPosInMouseEvent(e),i=getColPosInMouseEvent(e),g=new Range(t,o,r,n);g.isCol()&&(a=0,c=0),g.isRow()&&(s=0,i=0);var R=c-(a-t),C=i-(s-o);0>R&&(R=0),0>C&&(C=0),t=R,o=C,r=R+rowsInRange,n=C+colsInRange,selCol=n,selRow=r;var u=(scrollHelper.pointerOffsetPosCalculator(e,!0,!0),getCursorPos(e));null!=moveCursorDIV&&(moveCursorDIV.style.left=u.x-20,moveCursorDIV.style.top=u.y-20),browser_ie||(sheetTable.style.cursor=sheetTable1.style.cursor=sheetTable2.style.cursor=sheetTable3.style.cursor="move",sheetPane.style.cursor=sheetPane1.style.cursor=sheetPane2.style.cursor=sheetPane3.style.cursor="move");var d={SR:t,SC:o,ER:r,EC:n,range:g},f={handleMoveCursorDIV:!0,checkFolColVal:!0,onScrollCallback:setDragRange,defaultCallBack:setDragDIVPosAndDim,callbackParams:d};appEvent.on("scrollCallBack",setDragDIVPosAndDim,"SR","SC","ER","EC","range"),scrollHelper.handleCursorPos(f)}}function endDragCellOrCellRange(e){if("undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),"undefined"!=typeof sheetScrollTopId&&clearInterval(sheetScrollTopId),browser_ie){e.srcElement}else if(browser_nn6){e.target}var l=cellDragProps.cellDragRange.ASR,t=cellDragProps.cellDragRange.ASC,o=cellDragProps.cellDragRange.AER,r=cellDragProps.cellDragRange.AEC,n=cellDragProps.cellDragRange.CSR,a=cellDragProps.cellDragRange.CSC,s=cellDragProps.cellDragRange.CER,c=cellDragProps.cellDragRange.CEC;dragDIV.style.display="none",dragDIV1.style.display="none",dragDIV2.style.display="none",dragDIV3.style.display="none",cellDragProps.isDraggable&&((-1!=n&&n!=l||-1!=a&&a!=t||-1!=s&&s!=o||-1!=c&&c!=r)&&(e.ctrlKey||e.metaKey?ClipRange.getClipObject().copy("dragDrop"):ClipRange.getClipObject().cut(!0),ClipRange.getClipObject().paste(n,a)),cellDragProps.isDraggable=!1),-1!=n&&-1!=a&&(currRow=n,currCol=a,ActiveCellInfo.reset(currRow,currCol)),document.removeEventListener("mousemove",dragCellOrCellRange,!1),document.removeEventListener("mouseup",endDragCellOrCellRange,!1),document.removeEventListener("keydown",cancelDragCellOrCellRange,!1),browser_ie||(sheetTable.style.cursor=sheetTable1.style.cursor=sheetTable2.style.cursor=sheetTable3.style.cursor="",sheetPane.style.cursor=sheetPane1.style.cursor=sheetPane2.style.cursor=sheetPane3.style.cursor=""),moveCursorDIV&&""==moveCursorDIV.style.display&&(moveCursorDIV.style.display="none"),cellDragProps.cellDragRange.CSR=-1,cellDragProps.cellDragRange.CSC=-1,cellDragProps.cellDragRange.CER=-1,cellDragProps.cellDragRange.CEC=-1}function setDragDIVPosAndDim(e,l,t,o,r){if((!(o>totCols&&r)||r.isRow())&&(appEvent.off("scrollCallBack",setDragDIVPosAndDim),cellDragProps.isDraggable)){{var n=getColLeft(l)-1,a=getRowTop(e)-1,s=0,c=0;getCellRange()}s=getColLeft(o)-getColLeft(l),s+=getColWidth(o)+1,c=getRowTop(t)-getRowTop(e),c+=getRowHeight(t)+1;var i=n-findSecondPaneXPos(),g=a-findThirdPaneYPos();ISFREEZED&&(FREEZED_ROW>0&&(dragDIV2.style[isRTL?"right":"left"]=i+"px",dragDIV2.style.top=a+"px",dragDIV2.style.width=s+"px",dragDIV2.style.height=c+"px"),FREEZED_COL>0&&(dragDIV3.style[isRTL?"right":"left"]=n+"px",dragDIV3.style.top=g+"px",dragDIV3.style.width=s+"px",dragDIV3.style.height=c+"px"),FREEZED_ROW>0&&FREEZED_COL>0&&(dragDIV1.style[isRTL?"right":"left"]=n+"px",dragDIV1.style.top=a+"px",dragDIV1.style.width=s+"px",dragDIV1.style.height=c+"px")),dragDIV.style[isRTL?"right":"left"]=i+"px",dragDIV.style.top=g+"px",dragDIV.style.width=s+"px",dragDIV.style.height=c+"px",cellDragProps.cellDragRange.CSR=e,cellDragProps.cellDragRange.CSC=l,cellDragProps.cellDragRange.CER=t,cellDragProps.cellDragRange.CEC=o,dragDIV.style.display="",dragDIV1.style.display="",dragDIV2.style.display="",dragDIV3.style.display=""}}function selection(e,l){var t,o,r,n;"top"===l&&getSheetScrollTop()>0||"bottom"===l&&getSheetScrollHeight()>getSheetScrollTop()+getSheetHeight()?("top"===l?selRow=selRow-e>=0?selRow-e:0:"bottom"===l&&(selRow=totRows>selRow+e?selRow+e:totRows-1),("top"===l&&selRow>=0||"bottom"===l&&totRows>selRow)&&(t=currRow,o=currCol,r=selRow,n=selCol,selectionTop=getEndTopOfRow(selRow),isRowSelected()?focusRow(t,r,"ROWINMOUSE"):focusCellRange(t,o,r,n,"INCREMENT")),"bottom"===l&&totRows>selRow&&selRow>=totRows-1&&appendBlankRows(),"top"===l?setSheetScrollDIM(t,r,o,n,"TOP"):setSheetScrollDIM(t,r,o,n,"BOTTOM")):("top"===l||"bottom"===l)&&(isRowSelected()?focusRow(currRow,selRow,"ROWINMOUSE"):focusCellRange(currRow,currCol,selRow,selCol,"INCREMENT")),"right"===l&&getSheetScrollWidth()+findSecondPaneXPos()>getSheetScrollLeft()+getSheetWidth()||"left"===l&&getSheetScrollLeft()>0?(selCol="right"===l?totCols>selCol+e?selCol+e:totCols-1:selCol-e>=0?selCol-e:0,("right"===l&&totCols>selCol||"left"===l&&selCol>=0)&&(t=currRow,o=currCol,r=selRow,n=selCol,selectionLeft=getEndLeftOfCol(selCol),isColSelected()?focusCol(o,n,"COLUMNINMOUSE"):focusCellRange(t,o,r,n,"INCREMENT")),"right"===l?setSheetScrollDIM(t,r,o,n,"RIGHT"):"left"===l&&setSheetScrollDIM(t,r,o,n,"LEFT")):("right"===l||"left"===l)&&(isColSelected()?focusCol(currCol,selCol,"COLUMNINMOUSE"):focusCellRange(currRow,currCol,selRow,selCol,"INCREMENT"))}function formulaFillRange(e,l){var t,o,r,n;if("top"===l&&getSheetScrollTop()>0||"bottom"===l&&getSheetScrollHeight()>getSheetScrollTop()+getSheetHeight()){if("top"===l?funRow=funRow-e>=0?funRow-e:0:"bottom"===l&&(funRow=totRows>funRow+e?funRow+e:totRows-1),"top"===l&&funRow>=0||"bottom"===l&&totRows>funRow){var a=ActiveFormulaInfo;t=a.getActiveRow(),o=a.getActiveCol(),r=funRow,n=funCol,functionTop=getEndTopOfRow(funRow),focusCellRangeFill(t,o,r,n)}"top"===l?setSheetScrollDIM(t,r,o,n,"TOP"):"bottom"===l&&setSheetScrollDIM(t,r,o,n,"BOTTOM")}else if("top"===l&&0!==funRow&&funRow>0||"top"===l&&funRow!==totRows-1&&totRows-1>funRow){var a=ActiveFormulaInfo;t=a.getActiveRow(),o=a.getActiveCol(),funRow="top"===l?0:totRows-1,focusCellRangeFill(t,o,funRow,funCol)}if("right"===l&&getSheetScrollWidth()+findSecondPaneXPos()>getSheetScrollLeft()+getSheetWidth()||"left"===l&&getSheetScrollLeft()>0){if("right"===l?funCol=totCols>funCol+e?funCol+e:totCols-1:"left"===l&&(funCol=funCol-e>=0?funCol-e:0),"right"===l&&totCols>funCol||"left"===l&&funCol>=0){var a=ActiveFormulaInfo;t=a.getActiveRow(),o=a.getActiveCol(),r=funRow,n=funCol,functionLeft=getEndLeftOfCol(funCol),focusCellRangeFill(t,o,r,n)}"right"===l?setSheetScrollDIM(t,r,o,n,"RIGHT"):"left"===l&&setSheetScrollDIM(t,r,o,n,"LEFT")}else if("right"===l&&funCol!==totCols-1&&totCols-1>funCol||"left"===l&&0!==funCol&&funCol>0){var a=ActiveFormulaInfo;t=a.getActiveRow(),o=a.getActiveCol(),funCol="left"===l?0:totCols-1,focusCellRangeFill(t,o,funRow,funCol)}}function setDragRange(e,l){var t,o,r,n;"top"===l&&getSheetScrollTop()>0||"bottom"===l&&getSheetScrollHeight()>getSheetScrollTop()+getSheetHeight()?(t=cellDragProps.cellDragRange.CSR,o=cellDragProps.cellDragRange.CSC,r=cellDragProps.cellDragRange.CER,n=cellDragProps.cellDragRange.CEC,"top"===l?(t>0&&(t-=e,r=t+rowsInRange),0>=t&&(t=0,r=t+rowsInRange,selRow=t),totCols-1>n&&(n=selCol,o=n-colsInRange,setDragDIVPosAndDim(t,o,r,n))):"bottom"===l&&(totCols>selCol&&(n=selCol,o=n-colsInRange),r>=totRows&&appendBlankRows(),totRows>r&&(t+=e,r=t+rowsInRange),setDragDIVPosAndDim(t,o,r,n)),("top"===l||"bottom"===l)&&(cellDragProps.cellDragRange.CSR=t,cellDragProps.cellDragRange.CER=r,cellDragProps.cellDragRange.CSC=o,cellDragProps.cellDragRange.CEC=n),"top"===l?setSheetScrollDIM(t,t,o,n,"TOP"):"bottom"===l&&setSheetScrollDIM(t,r,o,n,"BOTTOM")):"top"===l?(t=cellDragProps.cellDragRange.CSR,o=cellDragProps.cellDragRange.CSC,r=cellDragProps.cellDragRange.CER,n=cellDragProps.cellDragRange.CEC,0>=t&&(t=0,r=t+rowsInRange,selRow=t,cellDragProps.cellDragRange.CSR=t,cellDragProps.cellDragRange.CER=r,cellDragProps.cellDragRange.CSC=o,cellDragProps.cellDragRange.CEC=n,totCols-1>n&&(n=selCol,o=n-colsInRange,setDragDIVPosAndDim(t,o,r,n)))):"bottom"===l&&appendBlankRows(),"right"===l&&getSheetScrollWidth()+findSecondPaneXPos()>getSheetScrollLeft()+getSheetWidth()||"left"===l&&getSheetScrollLeft()>0?(t=cellDragProps.cellDragRange.CSR,o=cellDragProps.cellDragRange.CSC,r=cellDragProps.cellDragRange.CER,n=cellDragProps.cellDragRange.CEC,"right"===l?totCols>n&&(setDragDIVPosAndDim(t,o,r,n),o+=e,n=o+colsInRange,n>=totCols&&(n=totCols,o=n-colsInRange,selCol=n),r=selRow,t=r-rowsInRange):"left"===l&&(o-=e,n=o+colsInRange,r=selRow,t=r-rowsInRange,0>=o&&(o=0,n=o+colsInRange),setDragDIVPosAndDim(t,o,r,n),cellDragProps.cellDragRange.CSR=t,cellDragProps.cellDragRange.CER=r),cellDragProps.cellDragRange.CSC=o,cellDragProps.cellDragRange.CEC=n,"left"===l&&(n=o),"right"===l?(setSheetScrollDIM(t,r,n,n,"RIGHT"),n>=totCols&&(n=totCols-1,o=n-colsInRange,selCol=n,r=selRow,t=r-rowsInRange,setDragDIVPosAndDim(t,o,r,n))):"left"===l&&setSheetScrollDIM(t,r,o,n,"LEFT")):("right"===l||"left"===l)&&(t=cellDragProps.cellDragRange.CSR,o=cellDragProps.cellDragRange.CSC,r=cellDragProps.cellDragRange.CER,n=cellDragProps.cellDragRange.CEC,r=selRow,t=r-rowsInRange,"right"===l?(0>=t&&(t=0,r=t+rowsInRange),setDragDIVPosAndDim(t,o,r,n)):"left"===l&&(o-=e,n=o+colsInRange,0>=o&&(o=0,n=o+colsInRange),cellDragProps.cellDragRange.CSC=o,cellDragProps.cellDragRange.CEC=n,cellDragProps.cellDragRange.CSR=t,cellDragProps.cellDragRange.CER=r),setDragDIVPosAndDim(t,o,r,n))}var isScrollTopSet=!1,isScrollLeftSet=!1,fCRDebounceTimerId,initFormatTimeoutIdForFocusRange=0,funRow=-1,funCol=-1,functionLeft=-1,functionTop=-1,formulaSIdxTemp=0,formulaEIdxTemp=0,formulaKeyPressed=!1,isCellRangeFillDivAvailable=!1;appEvent.on("grid.shift",function(){resetCellRangeFillDIV(),focusSheet(),activateCellField()});
function insertCutColumns(e,t,o,l,r,i,s){if(menutabListener.doAction(TOOLBAR.INSERT,{id:"inscolstbtn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["insrowstbtn","insrowsmenu"]]}),!isColSelected())return void showAlertDialog(jsMsg.TheContentCopiedIsBigger);var a,n=getCellRange(),C=n.startCol,d=n.endCol,c=_initInsertCol(e,t,o,void 0,void 0,void 0,void 0,s);o=c.cnt;var u=c.currColIdx;s=c.afterRTC;getAvailableStartRow(),getAvailableEndRow();l=isUndefined(l)?ClipRange.getClipObject().startCol:l,r=isUndefined(r)?ClipRange.getClipObject().endCol:r;var i=i?i:ClipRange.getClipObject().endRow;if(o=r-l+1,u="before"!=e?d+1:u,ClipObject.hideFillDiv(),ClipRange.getClipObject().isSameSheet()){if(ISFREEZED&&(isColsOnlyFreezed||isColsAndRowsFreezed)&&FREEZED_COL>l)return showAlertDialog(jsMsg["FreezePanes.Columndeletionnotsupported"]),!1;if(C>l&&r>=C)return showAlertDialog(jsMsg["InsertCopiedRows.NotAllowed.Alert.CopyPasteAreasOverlap"]),!1;if(a=insertCol(e,u,o,!0,!0,!0))return!1;l>=u&&(l+=o,r+=o),n=getCellRange();if(a=deleteCol(l,r-l+1,!0,!0,s))return!1}else{if(a=insertCol(e,u,o,!0,!0,!0))return;n=getCellRange()}if(ProtectedRanges.isRangeLocked(0,u,getRowMax()-1,u+o-1,ActionConstants.INSERT_CUT_COLUMN))return!0;var g=new RequestParameters(ActionConstants.INSERT_CUT_COLUMN);g.setParameters(WorkSheets.getAssociatedActiveSheetName(),u);var f=new AjaxRequest;f.init("POST",g.getURL(),!0,g.getParametersAsString()),actionManager.addRequest(f)}function insertCopiedCols(e,t,o,l,r,i,s){if(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["insrowstbtn","insrowsmenu"]]}),!isColSelected())return void showAlertDialog(jsMsg.TheContentCopiedIsBigger);var a,n=getCellRange(),C=n.startCol,d=n.endCol,c=_initInsertCol(e,t,o,void 0,void 0,void 0,void 0,s);o=c.cnt;var u=c.currColIdx;s=c.afterRTC;getAvailableStartRow(),getAvailableEndRow();l=isUndefined(l)?ClipRange.getClipObject().startCol:l,r=isUndefined(r)?ClipRange.getClipObject().endCol:r;var i=i?i:ClipRange.getClipObject().endRow;u="before"!=e?d+1:u;var g=n.startCol,f=n.endCol,R=f-g+1,v=r-l+1;if(ClipObject.hideFillDiv(),R>v){var h=0;h=Math.floor(R/v),o=v*h}else u="before"!=e?d+1:u,o=v;var p;if(ClipRange.getClipObject().isSameSheet()){if(p=!0,C>l&&r>=C)return showAlertDialog(jsMsg["InsertCopiedRows.NotAllowed.Alert.CopyPasteAreasOverlap"]),!1;if(a=insertCol(e,u,o,!0,!0,!0))return!1;l>=u&&(l+=o,r+=o),n=getCellRange()}else if(p=!1,a=insertCol(e,u,o,!0,!0,!0))return;if(ProtectedRanges.isRangeLocked(0,u,getRowMax()-1,u+o-1,ActionConstants.INSERT_COPY_COLUMN))return!0;var E=new RequestParameters(ActionConstants.INSERT_COPY_COLUMN);E.setParameters(WorkSheets.getAssociatedActiveSheetName(),u,u+o-1,p,o);var w=new AjaxRequest;w.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(w)}function focusCol(e,t,o,l){if("undefined"==typeof t)var t=e;appEvent.off("scrollCallBack",focusCol),rowSelection=!1,RangeSelector.isActive()?RangeSelector.isRangeSelectionSupported()||appEvent.trigger("RangeSelector.RowColSelect",["Col",e,t]):(isCellEdited()&&submitCell(),o||(o="COLUMN"),focusCellRange(-1,e,getRowMax()-1,t,o,l)),appEvent.trigger("grid.focusCol",["focusCol"])}function colHeadClick(e,t){var o=appEvent.isDefaultPrevented(appEvent.trigger("colHead.mousedown",[e]));if(!o){if(RangeSelector.isActive()&&(funRow=getRowMax()-1),triggering)return triggering=!1,void colHeadDblClick(e,t);if(triggering=!0,setTimeout(function(){triggering=!1},350),isCellFieldSPANHided()||!isPivotOrArrayRange(currRow,currCol,currRow,currCol)){if(isFilterOptionsDIVOpened&&Filter.hideFilterOptions(),!cellField||isCellFieldSPANHided()||isFormulaCell()||submitCell(),browser_ie)var l=window.event.srcElement,r=2==e.button;else if(browser_nn6)var l=e.target,r=3==e.which;if(!r||!isWholeSheetSelected()){if((browser_opera&&e.altKey||r)&&"DIV"==l.tagName&&isColHead(l)&&"colHeadFocus"==l.className&&isColSelected())return!1;if("DIV"==l.tagName&&(isColHead(l)||mask.isGridDiv(l))){var i=!1,s=getCursorPos(e);s.x=isRTL?clientDim.width-s.x:s.x;var a=getColPosInMouseEvent(e),n=s.x,C=rowHeadWidth+getColLeft(a)-getNormalizedScrollLeft(),d=getColWidth(a),c=4;if(n>=C&&C+c>=n?(i=!0,currColHeadCnt=a-1,currColHeadCnt=0>currColHeadCnt?0:currColHeadCnt,currColHead=getColHead(currColHeadCnt),currColHeadLeft=rowHeadWidth+getColLeft(currColHeadCnt)-getNormalizedScrollLeft(),currColHeadWidth=getColWidth(currColHeadCnt)):n>=C+d-c&&C+d+c>=n&&(i=!0,currColHeadCnt=a,currColHeadCnt=currColHeadCnt>totCols?totCols:currColHeadCnt,currColHead=getColHead(currColHeadCnt),currColHeadLeft=C,currColHeadWidth=d),i&&isServerComponentLoaded(!0)){if(jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE)return;if(ISFREEZED&&(isColsOnlyFreezed||isColsAndRowsFreezed)){var u,g=currColHeadCnt;if(isCellRange()&&(u=getCellRange(),g=currColHeadCnt<u.startCol?currColHeadCnt:u.startCol),FREEZED_COL>g)return void(isCellRange()&&u.endCol>=FREEZED_COL&&currColHeadCnt>=FREEZED_COL&&showAlertDialog(jsMsg["FreezePanes.Columnresizingnotsupported"]))}colHeadTableWidth=getSheetTableWidth(),READ_WRITE&&(resizePane.style[isRTL?"right":"left"]=currColHeadLeft+currColHeadWidth+(browser_ie6?1:-1)+"px",resizePane.style.top=findPosY(colHead)+"px",resizePane.style.width="1px",resizePane.style.height=colHead.offsetHeight+sheet.offsetHeight+"px",resizePane.style.cursor="col-resize",colHeadTable.style.cursor="col-resize"),colHeadTable.onmouseover=null,currColHeads=getColHeads(currColHeadCnt+1,totCols-1),currColHeadWidth=getColWidth(currColHeadCnt),READ_WRITE&&(browser_ie&&(resizeOverlay.style.left=findPosX(rowHead)+"px",resizeOverlay.style.top=findPosY(colHead)+"px",resizeOverlay.style.width=sheet.offsetWidth+"px",resizeOverlay.style.height=sheet.offsetHeight+"px",resizeOverlay.style.cursor="col-resize"),showColWidthResizeTooltip(e,"colHeadClick",d),document.addEventListener("mousemove",resizeCol,!1),document.addEventListener("mouseup",endResizeCol,!1),stopEvt(e))}else{var f=Merge.getCellInfo(0,a);if(f&&f.isCol()&&(a=f.startCol),RangeSelector.isActive()||isCellEdited()&&0==cellField.value.indexOf("=")||formulaCell||isExprFunc||isFuncDlgOpen&&null!=getObj("funcList")||isRangeEdit)if(e.shiftKey){var f=ActiveFormulaInfo;if(f.isAvailable())var R=ActiveFormulaInfo.getActiveCol();else{ActiveFormulaInfo.set(0,a);var R=a}var v=a}else{ActiveFormulaInfo.set(0,a);var R=a,v=a}else{if(isCellRange()?resetCellRange():blurCell(currRow,currCol),currRow=0,selCol=a,vertArea="DEFAULT",selectionLeft=getEndLeftOfCol(a),e.shiftKey)clearTextSelection();else{currCol=a,currRow=findRowInYPos(getSheetScrollTop()),currRow=ISFREEZED&&FREEZED_ROW>0?0:findRowInYPos(getSheetScrollTop()),ActiveCellInfo.reset(currRow,currCol);var f=ActiveCellInfo;if(f.isMerged()){var h=f.getStartRow()+f.getRowSpan(),p=getRowMax();p-1>h&&(currRow=h)}ActiveCellInfo.reset(currRow,currCol)}var E=new Cell(currRow,currCol);E.executeMethod(function(e){currCell=e,updateActiveCellDependencies(e)}),setFocusInCellField();var R=currCol,v=a}colSelected=!0,colSelection=!0,funCol=void 0,focusCol(R,v),RangeSelector.isRangeSelectionSupported()&&RangeSelector.isActive()||document.addEventListener("mousemove",selectCol,!1),document.addEventListener("mouseup",endSelectCol,!1)}}}}}}function resizeCol(e){isColResized=!0,clearTextSelection();var t=getCursorPos(e).x;t=isRTL?clientDim.width-t:t;var o=t-currColHeadLeft;if(o>0&&sheetRight-currColHeadLeft>=o);else if(o>sheetRight-currColHeadLeft)o=rowHeadWidth+getSheetWidth()-currColHeadLeft,t=rowHeadWidth+getSheetWidth();else{var o=1;t=o+currColHeadLeft}resizePane.style.left="",isRTL?resizePane.style.right=t-1+"px":resizePane.style.left=t-1+"px",currColHead.style.width=o+"px",showColWidthResizeTooltip(e,"colHeadResize",o);for(var l=0,r=currColHeads.length;r>l;l++){var i=getColLeft(l+currColHeadCnt+1)+(o-currColHeadWidth);shiftColHead(currColHeads[l],{mode:"VAL",val:i})}}function endResizeCol(){if(hideElement(resizePane),browser_ie&&hideElement(resizeOverlay),document.removeEventListener("mousemove",resizeCol,!1),document.removeEventListener("mouseup",endResizeCol,!1),colHeadTable.onmouseover=function(e){setCursor(e,colHeadTable)},isColResized){var e=currColHeadCnt,t=currColHeadCnt;if(isColSelected()){var o=getCellRange(),l=o.startCol,r=o.endCol;currColHeadCnt>=l&&r>=currColHeadCnt&&(e=l,t=r)}width_height_action("width",parseInt(currColHead.style.width),e,t),isColResized=!1,currColHeadWidth=0}hideColWidthResizeTooltip()}function showColWidthResizeTooltip(e,t,o){var l=getCursorPos(e).x;l=isRTL?clientDim.width-l:l;var r;if("colHeadClick"==t){var i=getResizeColPosInMouseEvent(e),s=getColHead(i);r=parseInt(s.style.width)}else"colHeadResize"==t&&(r=o);colWdCueEl||(colWdCueEl=$('<div id="colWdCue" class="rCwHTt" style="display:none">'+jsMsg["Ole.Width"]+":<span></span></div>").appendTo($("#cHCont"))),$("#colWdCue span").text(r+"px"),colWdCueLeft=parseInt(r)+$(colWdCueEl).outerWidth()>sheetRight-currColHeadLeft?sheetRight-($(colWdCueEl).outerWidth()+rowHeadWidth):l-rowHeadWidth,0>colWdCueLeft&&(colWdCueLeft=0),isRTL?($(colWdCueEl).css("left",""),$(colWdCueEl).css("right",colWdCueLeft+"px")):$(colWdCueEl).css("left",colWdCueLeft+"px"),$(colWdCueEl).show()}function hideColWidthResizeTooltip(){$("#colWdCue")&&($("#colWdCue").remove(),colWdCueEl="")}function resetCols(e,t,o,l){switch(l){case"INSERT":for(var r=e;t>r;r+=1){var i=getColHead(r);i.className="",i.innerHTML=getColHeadLabel(r+o+1)}break;case"DELETE":for(var r=e;t-o>r;r+=1){var i=getColHead(r);e+o>r&&(i.className="colHeadFocus"),i.innerHTML=getColHeadLabel(r+1)}}}function insertCol(e,t,o,l,r,i,s,a,n,C,d,c,u){if(!jsPUBLIC_VIEW||PUBLIC_EDIT_MODE){var g=appEvent.isDefaultPrevented(appEvent.trigger("grid.onBeforeInsertCol"));if(!g){var f=_initInsertCol(e,t,o,l,r,i,s,a);o=f.cnt,e=f.pos,l=f.doNotFocus,r=f.doNotSlide,i=f.jsOnly,a=f.afterRTC,currColIdx=f.currColIdx;var R=getColMax();if(totCols+o>=R&&usedCursCol+o>=R||currColIdx===R||currColIdx+o>R||Merge.isRowMergeXists()&&"append"!=e)return d||showAlertDialog(jsMsg["InsertCol.Alert.InsertingNotPossibleBeyondMaxCol"]),!0;if(usedCursCol>currColIdx&&"append"!=e&&usedCursCol+o>=R)return d||showAlertDialog(jsMsg["InsertCol.Alert.InsertingNotPossibleBeforUsedCol"]),!0;if(ISFREEZED&&(isColsOnlyFreezed||isColsAndRowsFreezed)&&FREEZED_COL>currColIdx)return d||showAlertDialog(jsMsg["FreezePanes.Columninsertionnotsupported"]),!0;var v=arrayDetails;if(updateArrayDetails("INSERTCOL",currColIdx,o,currRow,currCol),"append"!=e&&isPivotOrArrayRange(0,currColIdx,65535,currColIdx+o-1,void 0,ActionConstants.INSERT_COL))return arrayDetails=v,!0;if(currColIdx>totCols)return!0;if("append"==e){Column.shiftOperationsCallback.INSERT({si:totCols,count:o,pos:"append",skipCellUpdate:!!u});var h=getAvailableStartRow();FREEZED_ROW&&0!=h&&readRangeDetails(0,totCols-o,FREEZED_ROW-1,totCols-1),readRangeDetails(h,totCols-o,getAvailableEndRow(),totCols-1)}else if(!i){if(ProtectedRanges.isRangeLocked(0,currColIdx,getRowMax()-1,currColIdx+o-1,ActionConstants.INSERT_COL))return!0;if(FormObj.isValidColumnOperations(currColIdx,void 0,ActionConstants.INSERT_COL))return!0;var p=new RequestParameters(ActionConstants.INSERT_COL);p.setParameters(WorkSheets.getAssociatedActiveSheetName(),currColIdx,o);var E=new AjaxRequest;E.init("POST",p.getURL(),!0,p.getParametersAsString()),actionManager.addRequest(E)}}}}function _initInsertCol(e,t,o,l,r,i,s,a){if(isUndefined(a)&&(a="false"),isUndefined(t)||isNaN(t))var n=isCellRange()?getCellRange().startCol:currCol;else var n=t;if(isUndefined(o)||isNaN(o)){if(isCellRange())var C=getCellRange(),o=C.endCol-C.startCol+1;else var o=1;("after"==e||"append"==e)&&(n+=o)}if(isUndefined(r)&&(r=!1),isUndefined(l)&&(l=!1),browser_ie&&(r=!0),"after"!=e&&"append"!=e||isWholeSheetSelected()||(l=!0),"undefined"==typeof i)var i=!1;return{pos:e,cnt:o,doNotFocus:l,doNotSlide:r,jsOnly:i,currColIdx:n,afterRTC:a}}function _getColsToInsert(e,t,o,l,r,i,s){var a=0==i?!0:!1;if(a||s)var n=getDefaultColHdr().cloneNode(!0);else var n=getColHead(l).cloneNode(!0);return n.className=e?"":"colHeadFocus",n}function _insertColHead(e,t,o,l,r){var i=document.createDocumentFragment(),s=0==o?!0:!1,a=o==totCols?!0:!1;if(a)var n=getColLeft(o-1)+getColWidth(o-1);else if(s)var n=0;else var n=getColLeft(o);for(var C=0,d=0;e>d;d+=1)t=t.cloneNode(!0),"append"==l&&(r=colWidthAry[o+d],t.style.width=r+"px"),t.innerHTML=getColHeadLabel(o+d+1),t.style[isRTL?"right":"left"]=n+"px",i.appendChild(t),n+=r,C+=r;colHeadTable.insertBefore(i,getColHead(o));for(var c=getColHeads(o+e,totCols-1+e),u=0;u<c.length;u++)c[u].style[isRTL?"right":"left"]=parseInt(c[u].style[isRTL?"right":"left"])+C+"px"}function deleteCol(e,t,o,l,r){if(!r&&isCellEdited()&&submitCell(),"undefined"==typeof r&&(r="false"),"undefined"==typeof o)var o=!1;if("undefined"==typeof e&&"undefined"==typeof t)if(isCellRange())var e=getCellRange().startCol,i=getCellRange(),t=i.endCol-i.startCol+1;else var e=currCol,t=1;if(ISFREEZED&&(isColsOnlyFreezed||isColsAndRowsFreezed)&&FREEZED_COL>e)return o||showAlertDialog(jsMsg["FreezePanes.Columndeletionnotsupported"]),!0;if(Merge.isSheetMergeXists())return splitCells(0,0,0,0),!0;if(!Discussion.isDisRangeDelete(CURRSHEETNAME,!1,e,t)){if(ProtectedRanges.isRangeLocked(0,e,getRowMax()-1,e+t-1))return!0;if(isPivotOrArrayRange(0,e,65535,e+t-1,void 0,ActionConstants.DELETE_COL))return!0;if(FormObj.isValidColumnOperations(e,void 0,ActionConstants.DELETE_COL))return!0;if(!l){var s=new RequestParameters(ActionConstants.DELETE_COL);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t);var a=new AjaxRequest;a.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(a)}}}function _removeColHeadsDeleteCol(e,t,o){for(var l=getColHeads(t,t+e-1),r=getColHeads(t,totCols-1),i=0;i<r.length;i++)isRTL?r[i].style.right=parseInt(r[i].style.right)-o+"px":r[i].style.left=parseInt(r[i].style.left)-o+"px";for(var i=0,s=l.length;s>i;i++)colHeadTable.removeChild(l[i])}function setColumnWidth(e){if((isColsOnlyFreezed||isColsAndRowsFreezed)&&FREEZED_COL>currCol)return void showAlertDialog(jsMsg["FreezePanes.Columnresizingnotsupported"]);var t=0;$.dialogutil.dialogs.colwidthdialog||(t=50);var o=getColWidth(currCol),l={autoOpen:!1,width:210,resizable:!1,minHeight:0,title:jsMsg.ColumnWidth,value:o,target:$(currCell),submitfunction:{fn:width_height_action,arg:"width"},buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){var e=width_height_action("width");e!==!1&&sheetdialog.close()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};$.sheetPrompt.showdialog("colwidthdialog",l);var r=e.originalEvent.clientX,i=e.originalEvent.clientY;setTimeout(function(){var e=sheetdialog.getOpenedDialog(),t=$("#sheetdiv").width(),o=r,l=t-o,s=220;s>l&&(o=o-s+l),e.css({top:i+"px",left:o+"px"})},t)}function drawColsRows(){drawCols(),drawRows()}function drawRows(){var e=getSheetTableHeight();if(!(getSheetHeight()<e)){var t=getSheetHeight();if(t>e){for(var o=totRows;t>e;)e+=getRowHeight(o),o+=1;totRows=getCeilRow(o),setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1)),ISFREEZED&&FREEZED_COL>0&&setVFreezeCueHeight()}}}function drawCols(){var e=getSheetTableWidth();if(!(getSheetWidth()<e)&&getSheetWidth()>e){var t=getColMax();if(t>totCols){for(var o=getSheetWidth()-e,l=0;o>0&&!(totCols+l+1>=t);)o-=getColWidth(totCols+l),l+=1;l>0&&insertCol("append",totCols,l,!0,!0,!1,void 0,void 0,void 0,void 0,!0),(isWholeSheetSelected()||isRowSelected())&&focusAllCells()}}}function colHeadDblClick(e){if(READ_WRITE){if(isCellFieldSPANHided()||submitCell(),clearTextSelection(),browser_ie){var t=window.event.srcElement;2==e.button}else if(browser_nn6){var t=e.target;3==e.which}if("DIV"==t.tagName&&isColHead(t)){var o=!1,l=isRTL?clientDim.width-getCursorPos(e).x:getCursorPos(e).x,r=getColPosInMouseEvent(e),i=rowHeadWidth+getColLeft(r)-getNormalizedScrollLeft(),s=getColWidth(r),a=4;if(l>=i&&i+a>=l?(o=!0,currColHeadCnt=r-1):l>=i+s-a&&i+s+a>=l&&(o=!0,currColHeadCnt=r),o){var n=getCellRange();if(ISFREEZED&&(isColsOnlyFreezed||isColsAndRowsFreezed)){var n,C=currColHeadCnt;if(isCellRange()&&(n=getCellRange(),C=currColHeadCnt<n.startCol?currColHeadCnt:n.startCol),FREEZED_COL>C)return void(isCellRange()&&n.endCol>=FREEZED_COL&&currColHeadCnt>=FREEZED_COL&&showAlertDialog(jsMsg["FreezePanes.Columnresizingnotsupported"]))}width_height_action("OptimalWidth","",currColHeadCnt,currColHeadCnt)}else clearTextSelection()}}}function autoFitColumnWidth(){if(currColHeadCnt=getCellRange().startCol,ISFREEZED&&(isColsOnlyFreezed||isColsAndRowsFreezed)){var e,t=currColHeadCnt;if(isCellRange()&&(e=getCellRange(),t=currColHeadCnt<e.startCol?currColHeadCnt:e.startCol),FREEZED_COL>t)return currColHeadCnt=getCellRange().endCol,void((currColHeadCnt>=FREEZED_COL||FREEZED_COL>currCol)&&showAlertDialog(jsMsg["FreezePanes.Columnresizingnotsupported"]))}width_height_action("OptimalWidth","",currColHeadCnt,currColHeadCnt)}function handleBordersInInsertCol(e,t){if(isObject(e)&&isObject(t)&&null!=t){var o=e.className,l=t.className,r=getCSSStyleRegex("borderRight"),i=getCSSStyleRegex("borderLeft"),s=getCSSStyleRegex("borderBottom"),a=getCSSStyleRegex("borderTop"),n=r.exec(o),C=i.exec(o),d=s.exec(o),c=a.exec(o);if(null!=n){var u=r.exec(l);(null==u||n[0]!=u[0])&&removeCSSStyle("borderRight",e)}if(null!=C){var g=i.exec(l);(null==g||C[0]!=g[0])&&removeCSSStyle("borderLeft",e)}if(null!=d){var f=s.exec(l);(null==f||d[0]!=f[0])&&removeCSSStyle("borderBottom",e)}if(null!=c){var R=a.exec(l);(null==R||c[0]!=R[0])&&removeCSSStyle("borderTop",e)}}}var triggering=!1,currColHeads,colWdCueEl,colWdCueLeft,Column={};Column.shiftOperationsCallback={INSERT:function(e){var t,o,l=e.si,r=e.count,i=e.pos,s="after"===i||"append"===i,a="append"==i?!0:!1,n=l?l-1:void 0,C="undefined"==typeof n||a?getCellDefaultWidth():getColWidth(n),d=e.skipCellUpdate,c=_getColsToInsert(s,C,o,n,i,l,a);if(_insertColHead(r,c,l,i,C),!d){resetCols(l,totCols,r,"INSERT",i);var u=_getCellArrToInsert(n,r,l,i,C,a);_insertCells(u.newCellArr,l,u.insertCellArr,r,C,i)}"append"!=i&&(Merge.shiftColumn(l,r,!0),setColDetails("INSERT",l,r,C)),!t||null==cellField||isCellFieldSPANHided()||isFormulaCell()||(currCol>idx?currCol+=r:currCol==idx&&(currCol+=r)),totCols+=r,ClipRange.getClipObject().updateOnInsertOrDeleteRowOrCol(ActionConstants.INSERT_COL,l,r),usedCursCol>=l&&(usedCursCol+=r);var g=getColLeft(totCols-1)+getColWidth(totCols-1);setSheetTableWidth(g);getCellRange();if(currCell=getCell(currRow,currCol),"append"!=i)for(var f=[],R=ole.getObjects(),v=0;v<R.length;v++){l<=OLE[R[v].id].sCol&&(OLE[R[v].id].sCol=parseInt(OLE[R[v].id].sCol)+parseInt(r));var h=parseInt(OLE[R[v].id].sColDiff),p=parseInt(OLE[R[v].id].sCol),g=parseInt(getColWidth(p)),E=parseInt(getColLeft(p));f[v]=h>g?E+g:E+h,OLE[R[v].id].setLeft(f[v])}ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.INSERT_COL,l,r),resetCols(0,totCols,0,"INSERT",i);var w=getCellRange(),S=ProtectedRanges.counterValuesForProtectRangeWithinAvailableRows();!fromDeleteCol&&afterConstructTilesFromJson&&appEvent.trigger("grid.insertCol",[l,totCols,S]),fromDeleteCol&&(fromDeleteCol=!1);for(var v=w.startCol,H=w.endCol;H>=v;v+=1){var L=getColHead(v);L&&(L.className="colHeadFocus")}totCols>getColMax()&&(totCols=getColMax());var m={doNotSkipCoveredCells:!1};clearBorder(availableStartRow,l-1,availableEndRow,l+r-1,m)},DELETE:function(e){var t,o,l=e.si,r=e.count;clearOldArrayPosition(0,l,65535,l+r-1),updateArrayDetails("DELETECOL",l,r,currRow,currCol),0==l&&r>=totCols&&(t=!0);var i=l,s=l+r-1,a=[],n=[],C={doNotSkipCoveredCells:!1};if(clearBorder(0,l,availableEndRow,l+r-1,C),r>1)var n=ole.getObjectsByPositionX(getColLeft(i),getColLeft(s+1)),d=ole.getObjectsByPositionX(getColLeft(s+1));else var c=getColLeft(s)+getColWidth(s),n=ole.getObjectsByPositionX(getColLeft(i),c),d=ole.getObjectsByPositionX(getColLeft(s+1));if(0!=n.length)for(var u=0;u<=n.length-1;u++)OLE[n[u].id].sColDiff=0,OLE[n[u].id].sCol=i;for(var u=0;u<d.length;u++){OLE[d[u].id].sCol=OLE[d[u].id].sCol-r;var g=parseInt(OLE[d[u].id].sColDiff),f=parseInt(OLE[d[u].id].sCol),R=parseInt(getColWidth(f)),v=parseInt(getColLeft(f));a[u]=g>R?v+R:v+g,OLE[d[u].id].setLeft(a[u])}ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.DELETE_COL,l,r);for(var h=0,u=l;l+r>u;u++)h+=getColWidth(u);_removeColHeadsDeleteCol(r,l,h),_removeCellsDeleteCol(r,l,h),resetCols(l,totCols,r,"DELETE"),setColDetails("DELETE",l,r,h),Merge.shiftColumn(l,r,!1),ClipRange.getClipObject().updateOnInsertOrDeleteRowOrCol(ActionConstants.DELETE_COL,l,r),!o||null==cellFieldSPAN||isCellFieldSPANHided()||isFormulaCell()||currCol>l&&(currCol-=r);var R=getSheetTableWidth()-h;setSheetTableWidth(R),totCols-=r,totCols+r-1<getColMax()&&(t?(fromDeleteCol=!0,insertCol("append",totCols,r-1,!0,!0,!0,void 0,void 0,void 0,void 0,!0)):(fromDeleteCol=!0,insertCol("append",totCols,r,!0,!0,!0,void 0,void 0,void 0,void 0,!0))),drawCols();var p=getCellRange();resetCols(0,totCols,0,"INSERT",void 0);for(var u=p.startCol,E=p.endCol;E>=u;u+=1){var w=getColHead(u);w&&(w.className="colHeadFocus")}var S=ProtectedRanges.counterValuesForProtectRangeWithinAvailableRows(l);appEvent.trigger("grid.deleteCol",[l,totCols,r,S])},INSERT_COPY_COLUMN:function(){var e={};e.onAfterComplete={},e.onAfterComplete.method=function(){scrollY=getSheetScrollTop(),focusSheet()},reloadPage(scrollY,void 0,e)},INSERT_CUT_COLUMN:function(){var e={};e.onAfterComplete={},e.onAfterComplete.method=function(){scrollY=getSheetScrollTop()},reloadPage(scrollY,void 0,e)}};
function focusRow(e,t,o,r){if("undefined"==typeof t)var t=e;appEvent.off("scrollCallBack",focusRow),colSelection=!1,RangeSelector.isActive()?RangeSelector.isRangeSelectionSupported()||appEvent.trigger("RangeSelector.RowColSelect",["Row",e,t]):(isCellEdited()&&submitCell(),o||(o=isColSelected()?"WHOLESHEET":"ROW"),focusCellRange(e,-1,t,getColMax()-1,o,r)),appEvent.trigger("grid.focusRow",["focusRow"])}function rowHeadClick(e){RangeSelector.isActive()&&(funCol=getRowMax()-1);var t=appEvent.isDefaultPrevented(appEvent.trigger("rowHead.mousedown",[e]));if(!t&&(isCellFieldSPANHided()||!isPivotOrArrayRange(currRow,currCol,currRow,currCol))){if(isFilterOptionsDIVOpened&&Filter.hideFilterOptions(),isCellEdited()&&!isFormulaCell()&&submitCell(),browser_ie)var o=window.event.srcElement,r=2==e.button;else if(browser_nn6)var o=e.target,r=3==e.which;if(r&&"DIV"==o.tagName&&isRowHead(o)&&"rowHeadFocus"==o.className&&getCellRange().endCol==totCols-1)return!1;if(!(r&&isWholeSheetSelected()||"DIV"!=o.tagName||!isRowHead(o)&&!mask.isGridDiv(o))){var i=!1,n=getCursorPos(e).y,s=getRowPosInMouseEvent(e),a=sheetTop+getRowTop(s)-rowHead.scrollTop,d=getRowHeight(s);if(10>d)var R=1;else var R=4;if(n>=a&&a+R>=n?(i=!0,currRowHeadCnt=Row.findNextNonHiddenRow(s,!1),currRowHeadCnt=0>currRowHeadCnt?0:currRowHeadCnt,currRowHead=getRowHead(currRowHeadCnt),currRowHeadTop=sheetTop+getRowTop(currRowHeadCnt)-rowHead.scrollTop,currRowHeadHeight=currRowHeadNewHeight=getRowHeight(currRowHeadCnt)):n>=a+d-R&&a+d+R>=n&&(i=!0,currRowHeadCnt=s,currRowHeadCnt=currRowHeadCnt>totRows?totRows:currRowHeadCnt,currRowHead=getRowHead(currRowHeadCnt),currRowHeadTop=a,currRowHeadHeight=currRowHeadNewHeight=d),i&&isServerComponentLoaded(!0)){if(jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE)return;if(ISFREEZED&&(isRowsOnlyFreezed||isColsAndRowsFreezed)){var l,w=currRowHeadCnt;if(isCellRange()&&(l=getCellRange(),w=currRowHeadCnt<l.startRow?currRowHeadCnt:l.startRow),FREEZED_ROW>w)return void(isCellRange()&&l.endRow>=FREEZED_ROW&&currRowHeadCnt>=FREEZED_ROW&&showAlertDialog(jsMsg["FreezePanes.Rowresizingnotsupported"]))}rowHeadTableHeight=getSheetTableHeight()+"px",resizePane.style.left="",resizePane.style.right="",READ_WRITE&&(resizePane.style[isRTL?"right":"left"]=findPosX(rowHead),resizePane.style.top=currRowHeadTop+currRowHeadHeight+(browser_ie?1:-1)+"px",resizePane.style.width=addSTDMode(rowHead.offsetWidth+sheet.offsetWidth),resizePane.style.height="1px",resizePane.style.cursor="row-resize",rowHeadTable.style.cursor="row-resize"),rowHeadTable.onmouseover=null,currRowHeads=getRowHeads(currRowHeadCnt+1,getLastRowInRowHdr()),currRowHeadHeight=getRowHeight(currRowHeadCnt),READ_WRITE&&(browser_ie&&(resizeOverlay.style[isRTL?"right":"left"]=findPosX(rowHead)+"px",resizeOverlay.style.top=findPosY(colHead)+"px",resizeOverlay.style.width=sheet.offsetWidth+"px",resizeOverlay.style.height=sheet.offsetHeight+"px",resizeOverlay.style.cursor="row-resize"),showRowHeightResizeTooltip(e,"rowHeadClick",d),document.addEventListener("mousemove",resizeRow,!1),document.addEventListener("mouseup",endResizeRow,!1),stopEvt(e))}else{var g=Merge.getCellInfo(s,0);if(g&&g.isRow()&&(s=g.startRow),RangeSelector.isActive()||isCellEdited()&&0==cellField.value.indexOf("=")||formulaCell||isExprFunc||isFuncDlgOpen&&null!=getObj("funcList")||isRangeEdit)if(e.shiftKey){var g=ActiveFormulaInfo;if(g.isAvailable())var u=ActiveFormulaInfo.getActiveRow();else{ActiveFormulaInfo.set(s,0);var u=s}var c=s}else{ActiveFormulaInfo.set(s,0);var u=s,c=s}else{isCellRange()?resetCellRange():blurCell(currRow,currCol),rowSelected=!0,rowSelection=!0,currCol=0,selRow=s,horiArea="DEFAULT",selectionTop=getEndTopOfRow(s),e.shiftKey?clearTextSelection():(currRow=s,ActiveCellInfo.reset(currRow,currCol)),currCell=getCell(currRow,currCol),currCell&&updateActiveCellDependencies(currCell);var u=currRow,c=s}funRow=void 0,focusRow(u,c),RangeSelector.isRangeSelectionSupported()&&RangeSelector.isActive()||document.addEventListener("mousemove",selectRow,!1),document.addEventListener("mouseup",endSelectRow,!1)}}}}function resizeRow(e){clearTextSelection();var t=getCursorPos(e).y,o=t-currRowHeadTop;o>0&&sheetBottom-currRowHeadTop>=o||(o>sheetBottom-currRowHeadTop?(o=sheetTop+sheetHeight-currRowHeadTop,t=sheetTop+sheetHeight):(o=1,t=o+currRowHeadTop));var r=o-currRowHeadNewHeight;resizePane.style.top=t+"px",currRowHead.style.height=o+"px",showRowHeightResizeTooltip(e,"rowHeadResize",o),currRowHeadNewHeight=o;for(var i=0,n=currRowHeads.length;n>i;i++)shiftRowHead(currRowHeads[i],{mode:"DIFF",val:r})}function endResizeRow(){setTimeout(function(){hideElement(resizePane),browser_ie&&hideElement(resizeOverlay)},150),document.removeEventListener("mousemove",resizeRow,!1),document.removeEventListener("mouseup",endResizeRow,!1),rowHeadTable.onmouseover=function(e){setCursor(e,rowHeadTable)},hideRowHeightResizeTooltip();var e=currRowHeadNewHeight-currRowHeadHeight;if(0!=e){var t=currRowHeadCnt,o=currRowHeadCnt;if(isRowSelected()){var r=getCellRange(),i=r.startRow,n=r.endRow;currRowHeadCnt>=i&&n>=currRowHeadCnt&&(t=i,o=n)}width_height_action("height",currRowHeadNewHeight,t,o)}}function showRowHeightResizeTooltip(e,t,o){var r,i=getCursorPos(e).y;if("rowHeadClick"==t){var n=getResizeRowPosInMouseEvent(e),s=getRowHead(n);r=parseInt(s.style.height)}else(t="rowHeadResize")&&(r=o);rowHtCueEl||(rowHtCueEl=$('<div id="rowHtCue" class="rCwHTt" style="display:none;">'+jsMsg["Ole.Height"]+":<span></span></div>").appendTo($("#rHCont"))),$("#rowHtCue span").text(r+"px"),parseInt(r)<sheetBottom-currRowHeadTop&&(rowHtCueTop=i-(sheetTop+$(rowHtCueEl).outerHeight()+4)),0>rowHtCueTop&&(rowHtCueTop=0),isRTL?($(rowHtCueEl).css("left",""),$(rowHtCueEl).css("right","44px")):$(rowHtCueEl).css("left","44px"),$(rowHtCueEl).css("top",rowHtCueTop+"px"),$(rowHtCueEl).show()}function hideRowHeightResizeTooltip(){$("#rowHtCue")&&($("#rowHtCue").remove(),rowHtCueEl="")}function setRowHeight(e){if(isRowsOnlyFreezed||isColsAndRowsFreezed){var t,o=ActiveCellInfo.getStartRow();if(isCellRange()&&(t=getCellRange(),o=t.startRow),FREEZED_ROW>o)return void showAlertDialog(jsMsg["FreezePanes.Rowresizingnotsupported"])}var r=0;$.dialogutil.dialogs.rowheightdialog||(r=50);var i=getRowHeight(currRow),n={autoOpen:!1,width:210,resizable:!1,minHeight:0,title:jsMsg.RowHeight,value:i,submitfunction:{fn:width_height_action,arg:"height"},buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){var e=width_height_action("height");e!==!1&&sheetdialog.close()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};$.sheetPrompt.showdialog("rowheightdialog",n);var s=e.originalEvent.clientX,a=e.originalEvent.clientY;setTimeout(function(){var e=sheetdialog.getOpenedDialog();e.css({top:a+"px",left:s+"px"})},r)}function adjustRowHeightNodes(e,t){var o=0,r=usedCursRow;"undefined"!=typeof e&&(o=e),"undefined"!=typeof t&&(r=t);var i,n;i=sheetTable.getElementsByTagName("tr");var s=rowHeadTable.getElementsByTagName("tr");for(rowNum=o;r>=rowNum;rowNum++){var a,d=i[rowNum-FREEZED_ROW].childNodes[0];null!=n&&"undefined"!=typeof n&&(a=n[rowNum-FREEZED_ROW].childNodes[0]);var R=parseInt(d.offsetHeight),l=parseInt(d.style.height),w=s[rowNum-FREEZED_ROW].childNodes[0];stdCellHeight>R&&(R=stdCellHeight),R!=l&&(w.style.height=R,d.style.height=R,null!=a&&"undefined"!=typeof a&&(a.style.height=R),w.childNodes[0].style.height=R-rowHeadDIVAdjust)}}function rowHeadDblClick(e){if(READ_WRITE){if(isCellFieldSPANHided()||submitCell(),clearTextSelection(),browser_ie){var t=window.event.srcElement;2==e.button}else if(browser_nn6){var t=e.target;3==e.which}if("DIV"==t.tagName&&isRowHead(t)||UTIL.DOM.contains(resizePane,t)){var o=!1,r=getCursorPos(e).y,i=getRowPosInMouseEvent(e),n=sheetTop+getRowTop(i)-rowHead.scrollTop,s=getRowHeight(i);if(10>s)var a=1;else var a=4;if(r>=n&&n+a>=r?(o=!0,currRowHeadCnt=i-1):r>=n+s-a&&n+s+a>=r&&(o=!0,currRowHeadCnt=i),o){var d=getCellRange();if(ISFREEZED&&(isRowsOnlyFreezed||isColsAndRowsFreezed)){var d,R=currRowHeadCnt;if(isCellRange()&&(d=getCellRange(),R=currRowHeadCnt<d.startRow?currRowHeadCnt:d.startRow),FREEZED_ROW>R)return void(isCellRange()&&d.endRow>=FREEZED_ROW&&currRowHeadCnt>=FREEZED_ROW&&showAlertDialog(jsMsg["FreezePanes.Rowresizingnotsupported"]))}width_height_action("OptimalHeight","",currRowHeadCnt,currRowHeadCnt)}else clearTextSelection()}}}function autoFitRowHeight(){if(currRowHeadCnt=getCellRange().startRow,ISFREEZED&&(isRowsOnlyFreezed||isColsAndRowsFreezed)){var e,t=currRowHeadCnt;if(isCellRange()&&(e=getCellRange(),t=currRowHeadCnt<e.startRow?currRowHeadCnt:e.startRow),FREEZED_ROW>t)return currRowHeadCnt=getCellRange().endRow,void((currRowHeadCnt>=FREEZED_ROW||FREEZED_ROW>currRow)&&showAlertDialog(jsMsg["FreezePanes.Rowresizingnotsupported"]))}width_height_action("OptimalHeight","",currRowHeadCnt,currRowHeadCnt)}function setRowsHeightAndModifyDOM(e,t,o,r,i,n){var s,a,d,R,l,w,g=!0;if(o&&(d=o.passiveReload,R=o.onBeforeReload,l=o.onAfterReload,w=o.reloadFrozenRows,isExecuteActionIdNeeded=o.isExecuteActionIdNeeded),s=isArray(e)?e:JSON.parse(e),s.length){var u=rowHeightAry[f],c=s[0].v;d&&(a=findRowInYPos(getSheetScrollTop()));var h=setRowDetails("RANGEOBJ",s),f=h.sr,C=h.er,v=Row.findMaxRowToRender();if(totRows=totRows>v?totRows:v,setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1)),!t&&f>getAvailableEndRow()&&(g=!1),t){R&&R();var E=getRowTop(a),H={};H.onAfterComplete={},isExecuteActionIdNeeded&&(H.isExecuteActionIdNeeded=isExecuteActionIdNeeded),H.onAfterComplete.method=function(e,t,o){e&&setScrollTop(o),focusSheet(),t&&t(),jsTHROWAWAY_VIEW||userPresence.send(),ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.HEIGHT,f)},H.onAfterComplete.params=[d,l,E],reloadPage(E,w,H)}else if(g){var p=FREEZED_ROW;if(p>f){if(p>C)return;f=Row.findNextNonHiddenRow(p-1)}Row.dom.setRowsHeight(f,C),Merge.resizeDOM(f,C,"ROWS"),ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.HEIGHT,f),insertRowHdrs(),focusSheet()}if(appEvent.trigger("grid.afterRowResize",[s]),jsTHROWAWAY_VIEW||userPresence.send(),Filter.hasFilter){var A=Filter.getInstance();A&&f<=A.range.sr&&A.reconstructIcons()}(f!=C||u!=c)&&(Filter.positionFilterIcons(f,!0),ole.shiftObjects("HEIGHT",f,C),i||appEvent.trigger("grid.shift",[r,n]),jsTHROWAWAY_VIEW||userPresence.tuneDivsHeight(f)),!t&&loadXTileIfVacantInViewPort(),appEvent.trigger("cmtRangeUpdate")}}function getCloneRow(e){for(var t=[],o=getDefaultCellHTML(),r=0;totCols>r;r++){var i=o.cloneNode(!0);i.style[isRTL?"right":"left"]=getColLeft(r)+"px",i.style.width=getColWidth(r)+"px",i.style.height=e+"px",i.style.zIndex="",setDefaultValueForCell(i),removeCSSStyle("cellComment",i),null!=i.getAttribute("comment")&&i.removeAttribute("comment"),null!=i.getAttribute("onmouseover")&&i.removeAttribute("onmouseover"),null!=i.getAttribute("onmouseout")&&i.removeAttribute("onmouseout"),t.push(i)}return t}function getDummyRow(){for(var e=[],t=getDefaultCellHTML(),o=0;totCols>o;o++){var r=t.cloneNode(!0);r.style[isRTL?"right":"left"]=getColLeft(o)+"px",r.style.width=getColWidth(o)+"px",e.push(r)}return e}function resetRowsInPage(){var e=getNonHiddenRowsInPage(),t=Row.getAvailableRows();e.length=t.length,Row.setAvailableRows(e)}function getNonHiddenRowsInPage(e,t){e=void 0===e?getAvailableStartRow():e,t=void 0===t?getAvailableEndRow():t;for(var o=Filter.getInstance(),r=[],i=e;t>=i;i++){if(o){var n=o.range;if(0==getRowHeight(i)&&i>=n.sr&&i<=n.er)continue}r.push(i)}return r}function _resettingRowHdrs(){insertRowHdrs(Row.getAvailableRows(),"UNLOADED_SHEET")}function _initInsertRow(e,t,o,r,i,n,s,a,d){if(a=isUndefined(a)?!1:a,isUndefined(t)||isNaN(t))if(isCellRange())var R=getCellRange().startRow;else var R=currRow;else var R=t;var i=isUndefined(i)?!1:i;if(isUndefined(r))var r="below"!=e||isWholeSheetSelected()?!1:!0;if(isUndefined(o)||isNaN(o)){if(isCellRange()){var l=getCellRange(),o=l.endRow-l.startRow+1;d&&(o-=Row.getHiddenRowCount(l.startRow,l.endRow))}else var o=1;"below"===e&&(o>1?R=Row.findNthNonHiddenRow(o-1,R)+1:R+=o)}return isUndefined(n)&&(n=!1),{pos:e,cnt:o,doNotFocus:r,doNotSlide:i,jsOnly:n,afterRTC:a,currRowIdx:R}}var currRowHeads,currRowHeadNewHeight=0,rowHtCueEl,rowHtCueTop;Row={HIDDENROW_INDEX_INTERVAL:1e3,DO_NOT_USE_MINIFIED_ARY:!1,MINIFIED_HIDDEN_INFO_THRESHOLD:1e4,predictNthNonHiddenRow:function(e,t,o){for(var r=0,i=Row.isHidden,n=o,s=o,a=getRowMax();a>s;s++){if(r===e){n=s;break}i(s)||-1!==t.indexOf(s)||r++}return n},hide:function(e,t,o,r){var i,t,n=[];if(isFirstArgumentArray=isArray(e))n=e,i=n[0];else if(void 0===e){var s=getCellRange();i=s.startRow,t=s.endRow,n=isColSelected()?"all":Row.getNonHiddenRowsInRange(i,t)}else i=e,n=0===i&&65535===t?"all":Row.getNonHiddenRowsInRange(i,t);n.length&&(setRowDetails("HIDE",n),r!==!1&&width_height_action("HIDE_ROWS",void 0,i,t,o),Row.dom.hide(n))},isHidden:function(e){var t,o=filterMetaInfo?filterMetaInfo.isCriteriaApplied:Filter.isApplied();return o&&(t=Filter.getInstance().range,e>=t[JSONConstants.START_ROW]&&e<=t[JSONConstants.END_ROW]&&0===rowHeightAry[e])},isAppendable:function(e){return e>=totRows&&e<=Row.lastNonHiddenRow?!0:!1},getHiddenRowsInRange:function(e,t){var o=[];if(!Row.hasHiddenRows())return o;var r=this.trimHiddenRange(e,t);e=r.startRow,t=r.endRow;var i=this.getFloorIdxInMinifiedAry(e);if(void 0!==i){for(var n=hiddenRowEndIdxAry[i]>t?t:hiddenRowEndIdxAry[i],s=e;n>=s;s++)o.push(s);for(;hiddenRowStartIdxAry[++i]<=t;){n=t<hiddenRowEndIdxAry[i]?t:hiddenRowEndIdxAry[i];for(var s=hiddenRowStartIdxAry[i];n>=s;s++)o.push(s)}}return o},getHiddenRowCount:function(e,t){if(!Row.hasHiddenRows())return 0;var o=0,r=this.trimHiddenRange(e,t);e=r.startRow,t=r.endRow;var i=this.getFloorIdxInMinifiedAry(e);if(void 0!==i){var n=hiddenRowEndIdxAry[i];for(o=e>n?0:(t>n?n:t)+1-e;hiddenRowStartIdxAry[++i]<=t;){var s=t<hiddenRowEndIdxAry[i]?t:hiddenRowEndIdxAry[i];o+=s-hiddenRowStartIdxAry[i]+1}}return 0>o&&(o=0),o},findNextNonHiddenRow:function(e,t){return void 0===t&&(t=!0),this.findNthNonHiddenRow(1,e,t)},getNonHiddenRowsInRange:function(e,t){var o=[];if(!Row.hasHiddenRows()){if(-1!=e&&-1!=t)for(var r=e;t>=r;r++)o.push(r);return o}var i=this.trimNonHiddenRange(e,t);e=i.startRow,t=i.endRow;var n=this.getFloorIdxInMinifiedAry(e);if(void 0!==n){for(var s=hiddenRowStartIdxAry[0]<=t?hiddenRowStartIdxAry[0]-1:t,r=e;s>=r;r++)o.push(r);for(;hiddenRowEndIdxAry[n]<t;){var a=hiddenRowStartIdxAry[n+1];s=t>=a?a:t+1;for(var d=e<=hiddenRowEndIdxAry[n]+1?hiddenRowEndIdxAry[n]+1:e,r=d;s>r;r++)o.push(r);n++}}else for(var r=e;t>=r;r++)o.push(r);return o},getNNonHiddenRows:function(e,t){var o=[];if(!Row.hasHiddenRows()){for(var r=t;t+e>r;r++)o.push(r);return o}if(0===e||e>65535||0>t||t>65535)return void 0;var i=this.getFloorIdxInMinifiedAry(t),n=0;if(void 0!==i){for(var s=!1,a=Row.lastNonHiddenRow,r=t;r<hiddenRowStartIdxAry[i]&&n!==e;r++)o.push(r),n++;var d=hiddenRowEndIdxAry[i]+1;for(d=t>d?t:d;e>n;){var R=hiddenRowStartIdxAry[i+1]?hiddenRowStartIdxAry[i+1]:d+e;R>a+1&&(R=a+1,s=!0);for(var r=d;R>r&&(o.push(r),++n!==e);r++);if(s)break;i++,d=hiddenRowEndIdxAry[i]+1}}else for(var r=t;t+e>r;r++)o.push(r);return o},findNthNonHiddenRow:function(e,t,o){if(void 0===o&&(o=!0),0>t||0>e)return void 0;var r,i=this.lastNonHiddenRow,n=this.firstNonHiddenRow;if(!Row.hasHiddenRows())return o?(r=t+e,r>i&&(r=i)):(r=t-e,n>r&&(r=n)),r;var s=0;if(o){if(-1===this.lastHiddenRow)return r=t+e,i>=r?r:i;var a=this.getFloorIdxInMinifiedAry(t);if(void 0!==a){var d=0;for(t<hiddenRowStartIdxAry[a]&&(s=hiddenRowStartIdxAry[a]-t-1,s>=e&&(r=t+e));e>s;){var R=t>hiddenRowEndIdxAry[a]?t:hiddenRowEndIdxAry[a],l=hiddenRowStartIdxAry[a+1];if(u=void 0!==l?l-1:R+e,d=u-R,s+d>=e)return r=R+e-s,i>=r?r:i;s+=d,a++}}else r=t+e;return i>=r?r:i}var w=!1;if(-1===this.lastHiddenRow)return r=t-e,n>r?n:r;var a=this.getFloorIdxInMinifiedAry(t);if(void 0!==a){var g=t-1,d=g-hiddenRowEndIdxAry[a];if(d=0>d?0:d,d>=e&&(r=g-e+1,w=!0),!w)for(;a>0;){s+=d,g=hiddenRowStartIdxAry[a]-1;var u=hiddenRowEndIdxAry[a-1];if(d=g-u,d+s>=e){r=g-(e-s)+1,w=!0;break}a--}w||(g=(t<hiddenRowStartIdxAry[0]?t:hiddenRowStartIdxAry[0])-1,s+=d,d=g-n+1,0>d&&(d=0),s+d>=e&&(w=!0,r=g-(e-s)+1))}else r=t-e;return void 0===r&&(r=n),n>r?n:r},getFloorIdxInMinifiedAry:function(e){var t=this.getCeilIdxInMinifiedAry(e);return t>0&&t--,t},getCeilIdxInMinifiedAry:function(e){var t=indexedHiddenRowAry[e/Row.HIDDENROW_INDEX_INTERVAL|0];if(void 0===t)return void 0;for(;hiddenRowStartIdxAry[t]<=e;)t++;return t},getAvailableRowsInFrozenRange:function(e){var t;return t=e?e:FREEZED_ROW,visibleRowsInFrozenRange=[],visibleRowsInFrozenRange=Row.getNonHiddenRowsInRange(0,t-1)},getAvailableRowsInRange:function(e,t,o){var r=ArrayUtils.getSortedIndex,i=Row.getAvailableRows();if(o||0===i[0]||(i=Row.getAvailableRowsInFrozenRange().concat(i)),e instanceof Array){var n=e,s=r(n,getAvailableStartRow()),a=r(n,getAvailableEndRow()+1);return n.slice(s,a)}var s=r(i,e),a=r(i,t);return t<i[0]||Row.isHidden(t)||(a+=1),i.slice(s,a)},trimHiddenRange:function(e,t){return this.firstHiddenRow>=0&&(e=e>this.firstHiddenRow?e:this.firstHiddenRow),this.lastHiddenRow>=0&&(t=t>this.lastHiddenRow?this.lastHiddenRow:t),{startRow:e,endRow:t}},trimNonHiddenRange:function(e,t){return e<this.firstNonHiddenRow&&(e=this.firstNonHiddenRow),t>this.lastNonHiddenRow&&(t=this.lastNonHiddenRow),{startRow:e,endRow:t}},minifyHiddenRowInfo:function(){var e=0,t=0,o=!1,r=1,i=0,n=window.rowHeightAry,s=n.length,a=!1;hiddenRowStartIdxAry=[],hiddenRowEndIdxAry=[],indexedHiddenRowAry=[],i++;for(var d=0;s>d;d++){var R=Row.isHidden(d);R?(a=!0,o||(e=d,o=!0)):o&&(hiddenRowStartIdxAry[t]=e,hiddenRowEndIdxAry[t++]=d-1,o=!1),r===Row.HIDDENROW_INDEX_INTERVAL&&a&&(indexedHiddenRowAry[i++]=t>0?t-1:t,r=0),r++}o&&(hiddenRowStartIdxAry[t]=e,hiddenRowEndIdxAry[t++]=s-1,o=!1);var l=hiddenRowStartIdxAry.length;return l>0&&(indexedHiddenRowAry[0]=0),l>0?(this.firstHiddenRow=hiddenRowStartIdxAry[0],this.lastHiddenRow=hiddenRowEndIdxAry[l-1],this.firstNonHiddenRow=0<this.firstHiddenRow?0:hiddenRowEndIdxAry[0]+1===getRowMax()?-1:hiddenRowEndIdxAry[0]+1,this.lastNonHiddenRow=this.lastHiddenRow===getRowMax()-1?hiddenRowStartIdxAry[l-1]-1:getRowMax()-1,this.lastNonHiddenRowY=this.lastNonHiddenRow<0?0:getRowTop(this.lastNonHiddenRow)+getRowHeight(this.lastNonHiddenRow)):(this.firstHiddenRow=-1,this.lastHiddenRow=-1,this.firstNonHiddenRow=0,this.lastNonHiddenRow=65535,this.lastNonHiddenRowY=getRowTop(this.lastNonHiddenRow)+getRowHeight(this.lastNonHiddenRow)),this},unhide:function(e,t,o,r,i){var n,t,s,a=[];isFirstArgumentArray=isArray(e),isFirstArgumentArray?(a=e,n=a[0]):void 0===e?(s=getCellRange(),n=s.startRow,t=s.endRow,a=isColSelected()?"all":Row.getHiddenRowsInRange(n,t)):0===n&&65535===t?rowsToHide="all":(n=e,a=Row.getHiddenRowsInRange(n,t)),a.length&&(i!==!1&&(updateTileCallbackInfo.isCallbackAvailable=!0,updateTileCallbackInfo.actionDetails={callbackMethod:function(){"all"===a?focusCellRange(-1,s.startCol,s.endRow,s.endCol,"WHOLESHEET",!0):focusCellRange(s.startRow,s.startCol,s.endRow,s.endCol,void 0,!0)}},width_height_action("UNHIDE_ROWS",void 0,n,t,r)),o&&Row.unhideHelper(a,o))},unhideHelper:function(e,t){setRowDetails("RANGEOBJ",t),Row.dom.unhide(e)},isAllRowsHidden:function(){return 0===hiddenRowStartIdxAry[0]&&hiddenRowEndIdxAry[0]===getRowMax()-1},findMaxRowToRender:function(){var e=getCeilRow(totRows+1),t=getRowTop(e)+getRowHeight(e),o=getSheetHeight(),r=Row.lastNonHiddenRow,i=-1===r?0:getRowTop(r)+getRowHeight(r);if(o>=i)maxRowToRender=Row.lastNonHiddenRow+1;else if(o>t){for(var n=t;o>n;)n=getRowTop(e)+getRowHeight(e),e+=1;maxRowToRender=getCeilRow(e)+ROWS_PER_TILE}else maxRowToRender=Math.max(getCeilRow(totRows),e);return maxRowToRender},getAvailableRows:function(e){var t=[];if(e&ISFREEZED){var o=Row.getAvailableRowsInFrozenRange();o[0]!==rowsInPage[0]&&(t=t.concat(o))}return t.concat(rowsInPage)},getAvailableRowsExcludedFreezedRow:function(){var e=rowsInPage,t=[];if(ISFREEZED){var o=ArrayUtils.indexOf(e,FREEZED_ROW);-1!=o&&(e=e.slice(o))}return t.concat(e)},setAvailableRows:function(e){var t=e[0],o=e[e.length-1];availableStartRow=void 0!=t?t:-1,availableEndRow=void 0!=o?o:-1,rowsInPage=e},getVisibleRowsInViewPortAsJSONStr:function(){var e=Row.getAvailableRowsExcludedFreezedRow();if(0==e.length)return'[{"sr":0 ,"er":0}]';for(var t=e[0],o="[",r=1,i=e.length;i>=r;r++){var n=e[r-1];if(r!==i)var s=e[r];s-n!==1&&r!==i&&(o+='{"sr":'+t+',"er":'+n+"},",t=s)}return o+='{"sr":'+t+',"er":'+n+"}",o.concat("]")}},Row.dom={hide:function(e){function t(){totRows=Row.findMaxRowToRender();var e=totRows>0?getRowTop(totRows-1)+getRowHeight(totRows-1):0;setSheetTableHeight(e),setScrollTop(getRowTop(r));var t=isWholeSheetSelected()?"WHOLESHEET":void 0,i=isWholeSheetSelected()?!0:!1;focusCellRange(o.startRow,o.startCol,o.endRow,o.endCol,t,i)}var o=getCellRange(),r=o.startRow,i=o.endRow,n=r;if("all"===e)t(),reloadPage(getRowTop(r));else if(isRowAvailable(n)){var s=Row.dom.removeAndShiftRows(e),a=s.availableRows;a?(Row.setAvailableRows(a),submitScrollForm(s.rowsToLoad,"SCROLLDOWN","END_OF_PAGE"),focusCellRange(r,o.startCol,i,o.endCol,void 0,!0)):(d.onAfterComplete={},d.onAfterComplete.method=t,reloadPage(getRowTop(r),void 0,d))}else{var d={};d.onAfterComplete={},d.onAfterComplete.method=t,reloadPage(getRowTop(r),void 0,d)}},unhide:function(e){{var t=getCellRange();t.startRow}totRows=Row.findMaxRowToRender(),setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1));var o={};return o.onAfterComplete={},o.onAfterComplete.method=function(e,t){"all"===e?focusCellRange(-1,t.startCol,t.endRow,t.endCol,"WHOLESHEET",!0):focusCellRange(t.startRow,t.startCol,t.endRow,t.endCol,void 0,!0)},o.onAfterComplete.params=[e,t],reloadPage(void 0,void 0,o),this},getCellsInRow:function(e,t,o){var r=getRowIndex(e),i=r/ROWS_PER_TILE|0;t=t||0,o=void 0===o||o>totCols?o=totCols:o+=1;var n=r%ROWS_PER_TILE;return ArrayUtils.slice(sheetTable.childNodes[i].childNodes,n*totCols+t,n*totCols+o)}},Row.clientData={rows:[],meta:[],hiddenRowsInfo:{},data:[]},Row.hasHiddenRows=function(){return hiddenRowStartIdxAry.length>0},Row.validateInsertRows=function(e,t,o,r,i){var n=getRowMax();if(usedCursRow+o>=n||t===n||t+o>n)return i||showAlertDialog(jsMsg["InsertRow.Alert.InsertingNotPossibleBeyondMaxRow"]),!0;if(usedCursRow>t&&usedCursRow+o>=n)return i||showAlertDialog(jsMsg["InsertRow.Alert.InsertingNotPossibleBeforeUsedRow"]),!0;if(r=!1,!r||null==cellField||isCellFieldSPANHided()||isFormulaCell()||(currRow>e?currRow+=o:currRow==e&&(currRow+=o)),null==cellField||isCellFieldSPANHided()||isFormulaCell()||hideCellField(),ProtectedRanges.isRangeLocked(t,0,t+o-1,getColMax()-1,ActionConstants.INSERT_ROW))return!0;if(ISFREEZED&&(isRowsOnlyFreezed||isColsAndRowsFreezed)&&FREEZED_ROW>t)return showAlertDialog(jsMsg["FreezePanes.Rowinsertionnotsupported"]),!0;var s=arrayDetails;return updateArrayDetails("INSERTROW",t,o,currRow,currCol),isPivotOrArrayRange(t,0,t+o-1,255,void 0,ActionConstants.INSERT_ROW)?(arrayDetails=s,!0):FormObj.isValidRowOperations(t)?!0:void 0},Row.shiftOperations={INSERT:function(e,t,o,r,i,n,s,a){var d=_initInsertRow(e,t,o,r,i,n,s,a,!0),R=d.currRowIdx;if(o=d.cnt,e=d.pos,r=d.doNotFocus,i=d.doNotSlide,n=d.jsOnly,a=d.afterRTC,isNotAValidUserRequest=Row.validateInsertRows(t,R,o,a),!isNotAValidUserRequest){cellRange=getCellRange();var l=new RequestParameters(ActionConstants.INSERT_ROW);l.setParameters(WorkSheets.getAssociatedActiveSheetName(),R,o);var w=new AjaxRequest;w.init("POST",l.getURL(),!0,l.getParametersAsString()),w.addEventListener("onComplete",function(){currRow=R}),actionManager.addRequest(w)}},DELETE:function(e,t,o,r,i){if(isUndefined(i)&&(i="false"),isUndefined(o))var o=!1;if(isUndefined(e)&&isUndefined(t))if(isCellRange()){var e=getCellRange().startRow,n=getCellRange(),t=n.endRow-n.startRow+1;Filter.isApplied()&&(t-=Row.getHiddenRowCount(n.startRow,n.endRow))}else var e=currRow,t=1;if(null==cellField||isCellFieldSPANHided()||isFormulaCell()||hideCellField(),ISFREEZED&&FREEZED_ROW>e)return showAlertDialog(jsMsg["FreezePanes.Rowdeletionnotsupported"]),!0;if(ProtectedRanges.isRangeLocked(e,0,e+t-1,255))return!0;if(isPivotOrArrayRange(e,0,e+t-1,255,void 0,ActionConstants.DELETE_ROW))return!0;if(!Discussion.isDisRangeDelete(CURRSHEETNAME,!0,e,t)){if(FormObj.isValidRowOperations(e))return!0;if(clearOldArrayPosition(e,0,e+t-1,255),updateArrayDetails("DELETEROW",e,t,currRow,currCol),!i||null==cellField||isCellFieldSPANHided()||isFormulaCell()||(currRow>e?currRow-=t:currRow==e&&(currRow-=t)),!r){resetCellRangeFill();var s=new RequestParameters(ActionConstants.DELETE_ROW);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t);var a=new AjaxRequest;a.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(a)}}},INSERT_CUT_ROWS:function(e,t,o,r,i,n,s){if(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["inscolstbtn","inscolsmenu"]]}),!isRowSelected())return void showAlertDialog(jsMsg.TheContentCopiedIsBigger);var a=getCellRange(),d=a.startRow,R=a.endRow,l=_initInsertRow(e,t,o,void 0,void 0,void 0,void 0,s);o=l.cnt;var w=l.currRowIdx;s=l.afterRTC;getAvailableStartRow(),getAvailableEndRow();r=isUndefined(r)?ClipRange.getClipObject().startRow:r,i=isUndefined(i)?ClipRange.getClipObject().endRow:i;var n=n?n:ClipRange.getClipObject().endCol;if(o=i-r+1,ClipObject.hideFillDiv(),w="below"!=e?w:R+1,isNotAValidUserRequest=Row.validateInsertRows(t,w,o,s),!isNotAValidUserRequest){if(ISFREEZED&&ClipRange.getClipObject().isSameSheet()&&FREEZED_ROW>r)return showAlertDialog(jsMsg["FreezePanes.Rowdeletionnotsupported"]),!1;if(ClipRange.getClipObject().isSameSheet()&&d>r&&i>=d)return showAlertDialog(jsMsg["InsertCopiedRows.NotAllowed.Alert.CopyPasteAreasOverlap"]),!1;if(r>=w&&ClipRange.getClipObject().isSameSheet()&&(r+=o,i+=o),ProtectedRanges.isRangeLocked(w,0,w+o-1,getColMax()-1,ActionConstants.INSERT_CUT_ROW))return!0;var g=new RequestParameters(ActionConstants.INSERT_CUT_ROW);g.setParameters(WorkSheets.getAssociatedActiveSheetName(),w);var u=new AjaxRequest;u.init("POST",g.getURL(),!0,g.getParametersAsString()),actionManager.addRequest(u)}},INSERT_COPIED_ROWS:function(e,t,o,r,i,n,s){if(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertRowColumn",action:"enable",callback:changebuttonsState,args:["insertRowColumn","enable",["inscolstbtn","inscolsmenu"]]}),!isRowSelected())return void showAlertDialog(jsMsg.TheContentCopiedIsBigger);var a=getCellRange(),d=a.startRow,R=a.endRow,l=_initInsertRow(e,t,o,void 0,void 0,void 0,void 0,s,o);o=l.cnt;var w=l.currRowIdx;s=l.afterRTC;getAvailableStartRow(),getAvailableEndRow();r=isUndefined(r)?ClipRange.getClipObject().startRow:r,i=isUndefined(i)?ClipRange.getClipObject().endRow:i;var n=n?n:ClipRange.getClipObject().endCol;w="below"!=e?w:R+1,ClipObject.hideFillDiv();var g=a.startRow,u=a.endRow,c=u-g+1,h=i-r+1;if(c>h){var f=0;f=Math.floor(c/h),o=h*f}else o=h;if(isNotAValidUserRequest=Row.validateInsertRows(t,w,o,s))return!1;var C=!1;if(ClipRange.getClipObject().isSameSheet()){if(d>r&&i>=d)return showAlertDialog(jsMsg["InsertCopiedRows.NotAllowed.Alert.CopyPasteAreasOverlap"]),!1;r>=w&&(r+=o,i+=o,C=!0)}if(ProtectedRanges.isRangeLocked(w,0,w+o-1,getColMax()-1,ActionConstants.INSERT_COPY_ROW))return!0;var v=new RequestParameters(ActionConstants.INSERT_COPY_ROW);v.setParameters(WorkSheets.getAssociatedActiveSheetName(),w,w+o-1,o);var E=new AjaxRequest;E.init("POST",v.getURL(),!0,v.getParametersAsString()),actionManager.addRequest(E);var H=getCellRange().startRow+o-1;"below"!=e?(H=getCellRange().startRow+o-1,focusRow(getCellRange().startRow,H)):(H=getCellRange().endRow+o,focusRow(getCellRange().endRow+1,H))}},Row.validateDeleteRows=function(){if(isUndefined(afterRTC)&&(afterRTC="false"),isUndefined(e))var e=!1;if(isUndefined(t)&&isUndefined(r))if(isCellRange())var t=getCellRange().startRow,o=getCellRange(),r=o.endRow-o.startRow+1;else var t=currRow,r=1;return null==cellField||isCellFieldSPANHided()||isFormulaCell()||hideCellField(),ISFREEZED&&FREEZED_ROW>t?(showAlertDialog(jsMsg["FreezePanes.Rowdeletionnotsupported"]),!0):Merge.isSheetMergeXists()?(splitCells(0,0,0,0),!0):isPivotOrArrayRange(t,0,t+r-1,255,void 0,ActionConstants.DELETE_ROW)?!0:(clearOldArrayPosition(t,0,t+r-1,255),updateArrayDetails("DELETEROW",t,r,currRow,currCol),void(!afterRTC||null==cellField||isCellFieldSPANHided()||isFormulaCell()||currRow>t&&(currRow-=r)))},Row.shiftOperationsCallback={INSERT:function(e){if(e.sn===CURRSHEETNAME){var t,o=("true"===e.afterRTC,e.si),r=e.count,i=e.doNotModifyDOM,n=e.rHt?e.rHt:getDefaultCellHeight();if(setRowDetails("INSERT",o,r,n),totRows=Row.findMaxRowToRender(),setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1)),!i)if(!isRowInAvailableRowRange(o)||o&&!isRowInAvailableRowRange(o-1)){var s={};s.onAfterComplete={},s.onAfterComplete.method=function(){t=getSheetScrollTop(),focusSheet()},reloadPage(t,void 0,s)}else insertAndShiftRows(o,r,void 0,n),_resettingRowHdrs(),Merge.shiftRow(o,e.count,!0);void 0!==typeof ole&&ole.shiftObjects("INSERT",o,o+r-1),ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.INSERT_ROW,o,r),ClipRange.getClipObject().updateOnInsertOrDeleteRowOrCol(ActionConstants.INSERT_ROW,o,r),appEvent.trigger("grid.insertRow",[o,totCols,r])}},DELETE:function(e){if(e.sn===CURRSHEETNAME){var t=e.si,o=e.count,r=Row.getNNonHiddenRows(o,t);if(!r.length)return;setRowDetails("DELETE",r),totRows=Row.findMaxRowToRender(),setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1));var i,n=e.doNotModifyDOM;if(!n){if(isRowInAvailableRowRange(r[0])){var s=Row.dom.removeAndShiftRows(r,!0);s.availableRows&&(Row.setAvailableRows(s.availableRows),insertRowHdrs()),s.pageReload&&(i=!0)}else i=!0;i?reloadPage():(getRowTop(availableEndRow+1)<getSheetScrollTop()+(extraViewPorts+1)*getSheetHeight()?loadXTileIfVacantInViewPort(!0):loadXTileIfVacantInViewPort(),Merge.shiftRow(r[0],r.length,!1))}void 0!==typeof ole&&ole.shiftObjects("DeleteRow",t,t+o-1),ProtectedRanges.getObject().onMoveOrResizeAction(ActionConstants.DELETE_ROW,t,o),ClipRange.getClipObject().updateOnInsertOrDeleteRowOrCol(ActionConstants.DELETE_ROW,t,cnt),appEvent.trigger("grid.deleteRow",[t,totCols])}var a={doNotSkipCoveredCells:!1};clearBorder(t,0,t+o-1,totCols-1,a)},INSERT_CUT_ROWS:function(){var e=Row.findMaxRowToRender();totRows=totRows>e?totRows:e,setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1));var t={};t.onAfterComplete={},t.onAfterComplete.method=function(e){focusCellRange(e.startRow,e.startCol,e.endRow,e.endCol,void 0,!0)},t.onAfterComplete.params=[cellRange],reloadPage(void 0,void 0,t)},INSERT_COPIED_ROWS:function(e){e.sN===CURRSHEETNAME&&setRowsHeightAndModifyDOM(e.rH,!0)}},Range.meta={shiftOperations:{ROW:{INSERT:Row.shiftOperations.INSERT,DELETE:Row.shiftOperations.DELETE,INSERT_CUT_ROWS:Row.shiftOperations.INSERT_CUT_ROWS,INSERT_COPIED_ROWS:Row.shiftOperations.INSERT_COPIED_ROWS,HIDE:Row.shiftOperations.HIDE,UNHIDE:Row.shiftOperations.UNHIDE},COLUMN:{}},shiftOperationsCallback:{ROW:{INSERT:Row.shiftOperationsCallback.INSERT,DELETE:Row.shiftOperationsCallback.DELETE,INSERT_CUT_ROWS:Row.shiftOperationsCallback.INSERT_CUT_ROWS,INSERT_COPIED_ROWS:Row.shiftOperationsCallback.INSERT_COPIED_ROWS,HIDE:Row.shiftOperationsCallback.HIDE,UNHIDE:Row.shiftOperationsCallback.UNHIDE},COLUMN:{INSERT:Column.shiftOperationsCallback.INSERT,DELETE:Column.shiftOperationsCallback.DELETE,INSERT_COPY_COLUMN:Column.shiftOperationsCallback.INSERT_COPY_COLUMN,INSERT_CUT_COLUMN:Column.shiftOperationsCallback.INSERT_CUT_COLUMN}}};
function isCell(e){if(null!=e&&isObject(e)){var t=e.parentNode,r=t.className;featureSupport.boxAlign||"object"==typeof r||(-1!=r.indexOf("vab-od")||t&&-1!=r.indexOf("vam-od")?t=t.parentNode.parentNode:(-1!=r.indexOf("vab")||t&&-1!=r.indexOf("vam"))&&(t=t.parentNode));var l=t.id,n=t.parentNode;return t&&t&&n==sheetTable||t&&n==sheetTable1||t&&n==sheetTable2||t&&n==sheetTable3||t&&"mCC"==l||t&&"mCC1"==l||t&&"mCC2"==l||t&&"mCC3"==l||t&&"prDiv"==l||t&&"prDiv1"==l||t&&"prDiv2"==l||t&&"prDiv3"==l}return!1}function getRowIndex(e,t,r){var l=t===sheetPane1Id||t===sheetPane2Id?r?Row.getLoadedRowsInFrozenRange():Row.getAvailableRowsInFrozenRange():Row.getAvailableRows();return l.indexOf(e)}function findMergedCell(e,t,r){if(r)switch(r){case sheetPane1Id:var l=getObj(mCC1Id);break;case sheetPane2Id:var l=getObj(mCC2Id);break;case sheetPane3Id:var l=getObj(mCC3Id);break;default:var l=getObj("mCC")}else var l=getObj("mCC");for(var n=0,o=l.childNodes.length;o>n;n+=1){var i=getChildNode(l,n),a=parseInt(i.style.left),s=parseInt(i.style.top);if(a==t&&s==e)var c=i}return c}function getCellPos(e){if(e){var t=e.parentNode.parentNode.parentNode.id,r=findIndex(e.parentNode),l=findIndex(e),n=totCols>l?0:Math.floor(l/totCols),o=0==r?n:r*ROWS_PER_TILE+n,i=totCols>l?l:l+totCols-(n+1)*totCols;return(t==t||t==sheetPane3Id)&&(o=addAvailStartRow(o)),{row:o,col:i}}}function getCellContent(e,t){isUndefined(e)&&(e=currCell);var r="";if(null!=e){var l=getCellFormula(e),n=e.getAttribute("cV");l&&"null"!=l&&"cV"!=t?((null==l||"null"==l)&&(l=""),"hide"==l&&("fn"==t||(l=e.getAttribute("cV"),(null==l||"null"==l)&&(l=""))),r=l):((null==n||"null"==n)&&(n=""),r=n)}return r}function getCellFormula(e){return e?e.getAttribute("fn"):""}function getCellFormat(e){return e?e.getAttribute("format"):""}function checkTwoElemsInSamePos(e,t){var r=parseInt(e.style.left),l=parseInt(e.parentNode.style.top),n=parseInt(e.style.width),o=r+n,i=parseInt(e.style.height),a=l+i,s=!1,c=parseInt(t.style.left),d=parseInt(t.parentNode.style.top),u=parseInt(t.style.width),f=c+u,h=parseInt(t.style.height),g=d+h,w=!1,R=!1,p=!1,C=!1,v=!1,E=!1;return a>d&&g>a&&(w=!0),l>d&&g>a&&(R=!0),g>l&&a>g&&(p=!0),o>c&&f>o&&(C=!0),r>c&&f>o&&(v=!0),f>r&&o>f&&(E=!0),(w||R||p)&&(C||v||E)&&(s=!0),s}function getCellLabel(e,t){return isSSActive?getColHeadLabel(t+1)+(e+1):void 0}function encodeBlankSpaces(e,t){if(t=!0){var r=e.length;firstNonWhiteSpaceCharRegex=/\S/,lastWhiteSpaceCharGroupRegex=/\s+$/;var l=e.match(firstNonWhiteSpaceCharRegex),n=e.match(lastWhiteSpaceCharGroupRegex),o=l&&l.index||0,i=n&&n.index||r,a=e.substring(0,o).replace(/ /g,"&nbsp;"),s=e.substring(o,i),c=e.substring(i,r).replace(/ /g,"&nbsp;");e=a+s+c}else e=e.replace(/ /g,"&nbsp;");return e}function isCellRange(){return"undefined"!=typeof currCellRange&&""!=currCellRange?!0:!1}function getCellRange(){return isCellRange()?selectedCellRange:(startC=endC=ActiveCellInfo.getStartCol(),startR=endR=ActiveCellInfo.getStartRow(),{startRow:endR>startR?startR:endR,startCol:endC>startC?startC:endC,endRow:endR>startR?endR:startR,endCol:endC>startC?endC:startC})}function getCellRangeFromString(e){if(e.indexOf(":")>-1){e.indexOf(";")>-1&&(e=e.substring(0,e.indexof(";")-1));var t=e.substring(0,e.indexOf(".")),r=e.split(":");for(i=0;i<r.length;i++)splitSheetName=r[i].split("."),2==splitSheetName.length&&(e=e.replace(splitSheetName[0]+".",""));var l=CellUtils.getCellPosByLabel(replace(e.split(":")[0],"$","")),n=CellUtils.getCellPosByLabel(replace(e.split(":")[1],"$",""));return{startRow:l.row,startCol:l.col,endRow:n.row,endCol:n.col,sheetName:t}}}function getServerRange(e,t,r,l){var n=r,o=l;if(isUndefined(r)){var i=getCellRange();e=i.startRow,t=i.startCol,n=i.endRow,o=i.endCol}var a=isColSelected()?getRowMax()-1:n,s=isRowSelected()?getColMax()-1:o;return{startRow:e,startCol:t,endRow:a,endCol:s}}function hideElement(e){e.style.left="-100000px",e.style.top="-100000px"}function clearSelection(){"undefined"!=typeof tableClicked&&tableClicked&&cellField&&isCellFieldSPANHided()&&clearTextSelection()}function setCursor(e){if(sheet&&!colSelected&&!rowSelected){var t=browser_ie?event.srcElement:e.target,r=getCursorPos(e);r.x=isRTL?clientDim.width-r.x:r.x;var l=r.x,n=r.y,o=getColPosInMouseEvent(e),i=getRowPosInMouseEvent(e),a=fPainter.fPaintersingleclick||fPainter.fPainterdoubleclick,s="url("+ctxpath+"images/fp-cur.cur)"+(browser_ie?"":" 8 8")+", default";if(isColHead(t)){var c=rowHeadWidth+getColLeft(o)-getNormalizedScrollLeft(),d=getColWidth(o),u=2,f=!1;READ_WRITE&&(l>=c&&c+u>=l?f=!0:l>=c+d-u&&c+d+u>=l&&(f=!0));var h=o>FREEZED_COL&&f?"col-resize":a?s:"";colHeadTable.style.cursor=h,colHeadTable1.style.cursor=h}else if(isRowHead(t)){var g=sheetTop+getRowTop(i)-getSheetScrollTop(),w=getRowHeight(i),R=10>w?1:4,p=!1;READ_WRITE&&(p=i>FREEZED_ROW&&(0!=i&&R>=n-g||R>=g+w-n));var h=p?"row-resize":a?s:"";rowHeadTable.style.cursor=h,rowHeadTable1.style.cursor=h}}}function isColHead(e){return e.parentNode==colHeadTable||e.parentNode==colHeadTable1}function getColHead(e,t){return"undefined"==typeof t||t==colHeadId?getChildNode(colHeadTable,e):getChildNode(colHeadTable1,e)}function getColHeadLabel(e){if(e){if(26>=e)return String.fromCharCode(e+64);var t=e%26,r=Math.floor(e/26);return 0==t?getColHeadLabel(r-1)+"Z":getColHeadLabel(r)+String.fromCharCode(t+64)}}function getRowHeadLabel(e){return isNumber(e)?e+1:void 0}function isRowHead(e){return e.parentNode==rowHeadTable||e.parentNode==rowHeadTable1}function getRowHead(e,t){var r=t===rowHead1Id,l=r?e:getRowIndex(e),n=r?rowHeadTable1:rowHeadTable;return l>=0?n.childNodes[l]:void 0}function findCellLeft(e){return e&&parseInt(e.style[isRTL?"right":"left"])}function findCellTop(e){if(null==e)return 0;var t=e.parentNode.id;t=t.substring(0,3);var r;return r="mCC"==t?parseInt(e.style.top):parseInt(e.parentNode.style.top)+(isNaN(parseInt(e.style.top))?0:parseInt(e.style.top))}function getCellWidth(e){return parseInt(e.style.width)}function getCellHeight(e){return parseInt(e.style.height)}function getMaxLineWidth(e){for(var t=0,r=0;r<e.length;r+=1)t=getCellValueWidth(e[r])>t?getCellValueWidth(e[r]):t;return t}function getCellContentHeightForMultiline(e){return contentHeight*e.split("\n").length}function getCellValueWidth(e){return dummyCANVAS.measureText(e).width}function getCellValueHeight(e){return dummySPAN.innerHTML=ZSEC.Encoder.encodeForHTML(e),dummySPAN.offsetHeight}function setCellFieldSPANHeight(e){cellField.style.height=e>sheetHeight?sheetHeight+"px":e-2+"px"}function setCellFieldSPANWidth(e){e>sheetWidth?cellField.style.height=sheetWidth+"px":cellField.style.width=e-2+"px"}function isCellFieldInNewMode(){return!(isF2KeyPressed||isDblClicked||isenterKeyPressed)}function isCellFieldInEditMode(){return isF2KeyPressed||isDblClicked||isenterKeyPressed}function isMultilineInCellField(){return-1!=exprField.value.indexOf("\n")||-1!=cellField.value.indexOf("\n")}function resetGlobalVariables(){exprField.value="",cellField.value="",currFocusFld="",clearCellRangeFill(),isDvListCell=void 0,hideCellFieldSPAN(),sheetdialog.close(),exprField.blur(),exprFieldKeyPressed=!1,isEditingInExprField=!1,requiredCellHeight=0,cellContentHeight=0,cellContentWidth=0,requiredCellWidth=0,currRowOfCellfield=0,currColOfCellfield=0,isSuggestAvailable=!1,maxCellFieldWidthInExprFieldNewMode=0,posOfCaret=0,startPosOfSelection=0,endPosOfSelection=0,scrolledHeightForExprField=0,scrolledHeightForCellField=0,isStylesAssignedForCellField=!1,contentHeight=0,sheetHeightMaxInViewPort=0,sheetWidthMaxInViewPort=0,contentNotReachedMaximumheight=!0,isTextWrapped=!1,contentNotReachedMaximumWidth=!0,COLLAB_DOCUMENT_ID="",isRegistered=!0,isMouseEventInSheetScrollBar=!1,editMode_enableButtons(),grantRequest=!0,ActiveCellInfo.isEditingCellDeleted=!1,appEvent.trigger("grid.resetGlobalVariables"),jsREMOTE_SAVE_VIEW&&REMOTE.ISSAVEABLE&&(SAVED=!1)}function isCellFieldContentOverflowsViewPortHeight(e){return sheetHeightMaxInViewPort<getRowTop(e)+getRowHeight(e)}function isCellFieldContentOverflowsViewPortWidth(e){return sheetWidthMaxInViewPort<getColLeft(e)+getColWidth(e)}function isCellWrapped(e){return e&&-1!=e.className.indexOf(" nW")?!1:!0}function isFormulaCell(){return isFuncDlgOpen||!isCellFieldSPANHided()&&0==cellField.value.indexOf("=")||isExprFunc?!0:!1}function scrollCellIntoView(e,t){isUndefined(arguments[0])&&isUndefined(arguments[1])&&(e=currRow,t=currCol),scrollRowIntoView(e),scrollColIntoView(t)}function scrollRowIntoView(e){var t=getRowTop(e),r=getRowHeight(e),l=0,n=0;e>=FREEZED_ROW&&(n=findThirdPaneYPos(),l=getSheetScrollTop()),l>t-n?(setScrollTop(t-n),scrollPanesIntoView(t-n)):t+r>l+sheetHeight&&(setScrollTop(t+r-sheetHeight),scrollPanesIntoView(t+r-sheetHeight))}function scrollPanesIntoView(e){ISFREEZED&&(rowHead.scrollTop=sheetPane3.scrollTop=sheetPane.scrollTop=ssVScrollbar.scrollTop=e)}function scrollColIntoView(e){var t=getColLeft(e),r=getColWidth(e),l=(ssHScrollbar.scrollWidth,0),n=0;if(e>=FREEZED_COL&&(n=findSecondPaneXPos(),l=getNormalizedScrollLeft()),isRTL){var o=ssHScrollbar.scrollWidth-parseInt(ssHScrollbar.style.width);l>t-n?setScrollLeft(o-(t-n)):t+r>l+sheetWidth&&setScrollLeft(r>sheetWidth?o-t:o-(t+r-sheetWidth))}else l>t-n?setScrollLeft(t-n):t+r>l+sheetWidth&&setScrollLeft(r>sheetWidth?t:t+r-sheetWidth);setTimeout(function(){appEvent.trigger("Discussion.setFocusOn")},200)}function onlyNumber(e,t,r){var l,n;if(window.event)l=window.event.keyCode;else{if(!t)return!0;l=t.which}return n=String.fromCharCode(l),13==l&&("col_width"==e.id?width_height_action("width"):"row_height"==e.id&&width_height_action("height")),null==l||0==l||8==l||9==l||13==l||27==l?!0:"0123456789".indexOf(n)>-1?!0:r&&"."==n?(e.form.elements[r].focus(),!1):!1}function findCol(e,t,r){for(var l=t,n=r,o=-1;n>=l;){o=parseInt(l+(n-l)/2);var i=getSheetScrollLeft(),a=getColWidth(o),s=getColLeft(o);if(s-i>e)n=o-1;else{if(e>=s-i&&s+a-i>=e)break;l=o+1}}return o}function findRow(e,t,r){for(var l=t,n=r,o=-1;n>=l;){o=parseInt(l+(n-l)/2);var i=getSheetScrollTop(),a=getRowTop(o),s=getRowHeight(o);if(a-i>e)n=o-1;else{if(e>=a-i&&a+s-i>=e)break;l=o+1}}return o}function getEndTopOfRow(e){return getRowTop(e)+getRowHeight(e)}function selectColHead(e,t){for(var r=e;t>=r;r+=1){var l=getColHead(r);if(null!=l&&(l.className="colHeadFocus"),FREEZED_COL>r){var l=getColHead(r,colHead1Id);null!=l&&(l.className="colHeadFocus")}}}function getRowHeads(e,t,r){var l=r===rowHead1Id,n=l?Row.getAvailableRowsInFrozenRange():Row.getAvailableRows();if(0===n.length)return[];var o=ArrayUtils.getSortedIndex,i=Row.isHidden,a=o(n,e),s=o(n,t)+(i(t)||t<n[0]?0:1),c=l?rowHeadTable1:rowHeadTable;return ArrayUtils.slice(c.childNodes,a,s)}function styleRowHeadRangeWithClass(e,t,r){for(var l=getRowHeads(e,t),n=getRowHeads(e,t,rowHead1Id),o=0,i=l.length;i>o;o++)l[o].className=r;for(var o=0,i=n.length;i>o;o++)n[o].className=r}function selectRowHead(e,t){styleRowHeadRangeWithClass(e,t,"rowHeadFocus")}function blurRowHead(e,t){styleRowHeadRangeWithClass(e,t,"")}function blurRowHeadTable(){blurRowHead(getAvailableStartRow(),getAvailableEndRow()),isColumnSelected=!1}function selectRowHeadTable(){selectRowHead(getAvailableStartRow(),getAvailableEndRow()),isColumnSelected=!0}function selectColHeadTable(){var e=0,t=totCols-1;selectColHead(e,t),isRowSelectd=!0}function blurColHead(e,t){for(var r=e;t>=r;r+=1){var l=getColHead(r);if("undefined"!=typeof l&&null!=l&&(l.className=""),FREEZED_COL>r){var n=getColHead(r,colHead1Id);null!=n&&(n.className="")}}}function blurColHeadTable(){var e=getCellRange();blurColHead(e.startCol,e.endCol),isRowSelectd=!1}function blurSheetHeadTables(){blurColHeadTable(),blurRowHeadTable()}function getCellContentWOF(e){var t=getCellContent(e),t=e.getAttribute("cV");if("hi"!=docLocale.substring(0,2)&&null!=t&&(t=encodeURIComponent(t).trim().toUpperCase(),0==t.indexOf("%24")&&(t=t.replace("%24","")),-1!=t.indexOf("%E2%82%AC")&&(t=t.replace("%E2%82%AC","")),0==t.indexOf("%C2%A3")&&(t=t.replace("%C2%A3","")),0==t.indexOf("RS.")&&(t=t.replace("RS.","")),0==t.indexOf("%EF%BF%A5")&&(t=t.replace("%EF%BF%A5","")),-1!=t.indexOf("%25")&&(t=t.replace("%25","")),-1!=t.indexOf("%2C")&&(t=t.replace(/%2C/g,""))),null!=t&&(t=t.replace(/\'/g,"").replace(/\xA0/g,""),44==decSymbol?(t=t.replace(/\./g,""),t=t.replace(/,/g,".")):t=t.replace(/,/g,"")),"hi"==docLocale.substring(0,2)){var r=encodeURIComponent(t);r=r.replace("%24","").replace("%C2%A3","").replace("Rs.","").replace("%E2%82%AC","").replace("%E2%82%B9","").replace("%EF%BF%A5","").replace("%25","").replace(/%2C/g,"");var l=r.replace(/%E0%A5%A6/g,"0").replace(/%E0%A5%A7/g,"1").replace(/%E0%A5%A8/g,"2").replace(/%E0%A5%A9/g,"3").replace(/%E0%A5%AA/g,"4").replace(/%E0%A5%AB/g,"5").replace(/%E0%A5%AC/g,"6").replace(/%E0%A5%AD/g,"7").replace(/%E0%A5%AE/g,"8").replace(/%E0%A5%AF/g,"9");t=l}var n=new RegExp("[0-9-]*[0-9][[.,]?[0-9]+]?");if(isNaN(t)){var o=e.getAttribute("format");isNaN(t)&&"DATE"!=o&&"TIME"!=o&&"STRING"!=o&&"DATETIME"!=o&&(t=n.exec(t))}return t=decodeURIComponent(t).trim()}function getValidCellWithDetails(e,t){for(var r=getCell(e,t);isNotValidCell(r);)t-=1,r=getCell(e,t);return{obj:r,col:t}}function isNotValidCell(e){return null==e?!0:!1}function isColSelected(){return isColumnSelected}function isRowSelected(){return isRowSelectd}function isWholeSheetSelected(){return isColSelected()&&isRowSelected()?!0:!1}function isMouseCursorXInViewPort(e){return e<findSecondPaneXPos()?isNumber(e)&&0>e||e>getSheetWidth():isNumber(e)&&!(e-getSheetScrollLeft()<0)||e-getSheetScrollLeft()>getSheetWidth()}function isMouseCursorYInViewPort(e){return e<findThirdPaneYPos()?isNumber(e)&&e>getSheetHeight()||0>e:!(!isNumber(e)||e-getSheetScrollTop()>getSheetHeight()||e-getSheetScrollTop()<0)}function isMouseCursorYInOutOfViewPort(e){return e<findThirdPaneYPos()?isNumber(e)&&e>getSheetHeight()||0>e:isNumber(e)&&e-getSheetScrollTop()>getSheetHeight()||e-getSheetScrollTop()<0}function isMouseCursorXInOutOfViewPort(e){return e<findSecondPaneXPos()?isNumber(e)&&0>e||e>getSheetWidth():isNumber(e)&&e-getSheetScrollLeft()<0||e-getSheetScrollLeft()>getSheetWidth()}function isCellContainingContent(e){return isCell(e)&&""!=getCellContent(e)?!0:!1}function getTotalColumn(){return totCols-1}function getTotalRows(){return totRows-1}function getHyperLinkInCell(e){if(e){var t=(e.className,getCellContentNode(e)),r=$(t).children("A");return r.length?(title=r.attr("title"),r=r[0]):(title=null,r=null),{title:title,childTag:r}}return{title:null,childTag:null}}function isHyperLink(e){return isObject(e)&&e.tagName&&"A"==e.tagName.toUpperCase()?!0:!1}function getDefaultCellHTML(){var e=document.createElement("DIV");return e.className=" cD nW",e.style.width=getCellDefaultWidth()+"px",e.style.height=getDefaultCellHeight()+"px",e.style.top="0px",e.style[isRTL?"right":"left"]="0px",e}function getDefaultColHdr(){var e=document.createElement("DIV");return e.style.width=getCellDefaultWidth()+"px",e.style[isRTL?"right":"left"]="0px",e}function getDefaultRowHdrHTML(){var e=document.createElement("DIV");return e.style.height=getDefaultCellHeight()+"px",e.style.top="0px",e}function getMouseWheelData(e){if(browser_safari||browser_ie)var t=e.wheelDelta/SCROLL_PER_MOUSEWHEEL;else if(browser_nn6)var t=-1*e.detail;return t}function getTile(e,t){return isUndefined(t)&&(t=sheetPaneId),t==sheetPane1Id?getChildNode(sheetTable1,e):t==sheetPane2Id?getChildNode(sheetTable2,e):t==sheetPane3Id?getChildNode(sheetTable3,e):getChildNode(sheetTable,e)}function getAvailableTiles(e){return isUndefined(e)&&(e=sheetPaneId),e==sheetPane1Id?browser_ie?sheetTable1.children:sheetTable1.childNodes:e==sheetPane2Id?browser_ie?sheetTable2.children:sheetTable2.childNodes:e==sheetPane3Id?browser_ie?sheetTable3.children:sheetTable3.childNodes:browser_ie?sheetTable.children:sheetTable.childNodes}function getTilesCount(e){var t=getTable(e);return t.childNodes.length}function getTable(e){var t;return t=e==sheetPane1Id?sheetTable1:e==sheetPane2Id?sheetTable2:e==sheetPane3Id?sheetTable3:sheetTable}function getFirstTile(e){return isUndefined(e)&&(e=sheetPaneId),e==sheetPane1Id?browser_ie?sheetTable1.children[0]:sheetTable1.childNodes[0]:e==sheetPane3Id?browser_ie?sheetTable3.children[0]:sheetTable3.childNodes[0]:browser_ie?sheetTable.children[0]:sheetTable.childNodes[0]}function getLastTile(e){return isUndefined(e)&&(e=sheetPaneId),e==sheetPane1Id?browser_ie?sheetTable1.children[sheetTable1.children.length-1]:sheetTable1.childNodes[sheetTable1.childNodes.length-1]:e==sheetPane2Id?browser_ie?sheetTable2.children[sheetTable2.children.length-1]:sheetTable2.childNodes[sheetTable2.childNodes.length-1]:e==sheetPane3Id?browser_ie?sheetTable3.children[sheetTable3.children.length-1]:sheetTable3.childNodes[sheetTable3.childNodes.length-1]:browser_ie?sheetTable.children[sheetTable.children.length-1]:sheetTable.childNodes[sheetTable.childNodes.length-1]}function getAvailableStartRow(){return availableStartRow?availableStartRow:availableStartRow=0}function getAvailableEndRow(){return availableEndRow?availableEndRow:availableEndRow=0}function getAvailableStartCol(){return 0}function getAvailableEndCol(){return totCols-1}function getFloorRow(e){e<Row.firstNonHiddenRow&&(e=Row.firstNonHiddenRow);var t=(e-Row.getHiddenRowCount(0,e-1))%ROWS_PER_TILE;return 0===t?e:Row.findNthNonHiddenRow(t,e,!1)}function getCeilRow(e){if(Row.lastNonHiddenRow>=0&&e>=Row.lastNonHiddenRow)return Row.lastNonHiddenRow+1;e<Row.firstNonHiddenRow&&(e=Row.firstNonHiddenRow);var t=(e-Row.getHiddenRowCount(0,e-1))%ROWS_PER_TILE;return 0===t?e:Row.findNthNonHiddenRow(ROWS_PER_TILE-(Row.isHidden(e)?--t:t),e,!0)}function getOleUsedRow(e){var t=ole.getObjects(),r=e;for(i=0;i<t.length;i++){var l=t[i].top,n=t[i].height,o=findRowInYPos(l+n,!0);o>r&&(r=o+ROWS_PER_TILE)}return r}function isTiledRow(e){if(e===Row.firstNonHiddenRow)return!0;var t=Row.getHiddenRowCount(0,e);return(e-t)%ROWS_PER_TILE===0?!0:!1}function getLoadedAreaYs(){var e,t,r=getAvailableStartRow(),l=getAvailableEndRow();return-1===r?(e=0,t=0):(e=getRowTop(r),t=getRowTop(l)+getRowHeight(l)),{startY:e,endY:t}}function isYInLoadedArea(e){var t=getLoadedAreaYs();return e>t.startY&&e<=t.endY}function findRowInYPos(e,t,r){var l=Row.getAvailableRows(),n=l.length;if(!r&&n>0&&isYInLoadedArea(e)){for(var o=0,i=l.length,a=-1;n;){a=~~(i/2);var s=getRowTop(l[a]),c=getRowHeight(l[a]);if(s>=e)l=l.slice(0,a);else{if(!(e>s+c))break;l=l.slice(a+1)}if(i=l.length,1===i)return l[0]}return l[a]}var o=0,i=totRows,a=-1;for(t&&(i=getRowMax());i>=o;){a=parseInt(o+(i-o)/2);var s=parseInt(getRowTop(a))+1,c=parseInt(getRowHeight(a));if(s>e)i=a-1;else{if(e>=s&&s+c>e)break;o=a+1}}return a}function findColInXPos(e,t){var r=0,l=totCols,n=-1;for(t&&(l=getColMax());l>=r;){n=parseInt(r+(l-r)/2);var o=parseInt(getColLeft(n))+1,i=parseInt(getColWidth(n));if(o>e)l=n-1;else{if(e>=o&&o+i>e)break;r=n+1}}return n}function isSheetScrolledDown(){return currScrollTop<=getSheetScrollTop()?!0:!1}function getFallenRowRangeToRemove(e){var t,r;if(isStr(e)){var l=getSheetScrollTop(),n=getSheetHeight();switch(e){case"START_OF_PAGE":case"PAGE_BEFORE_CURRENT_PAGE":t=findRowInYPos(l+2*n),r=findRowInYPos(l+3*n);break;case"END_OF_PAGE":case"PAGE_AFTER_CURRENT_PAGE":t=findRowInYPos(l-2*n),r=findRowInYPos(l-n)}return{firstRow:t,lastRow:r}}}function getTileCountToRemove(e,t){return(t-e)/ROWS_PER_TILE}function getRowRangeForPageInView(e,t){var r,l;if(isStr(e)){var n=void 0===t?getSheetScrollTop():t,o=getSheetPaneHeight();switch(e){case"END_OF_PAGE":r=findRowInYPos(n),l=findRowInYPos(n+(extraViewPorts+1)*o);break;case"START_OF_PAGE":r=findRowInYPos(n-o),l=findRowInYPos(n+extraViewPorts*o);break;case"UNLOADED_PAGE":r=findRowInYPos(n-o,void 0,!0),l=findRowInYPos(n+(extraViewPorts+1)*o,void 0,!0);break;case"PAGE_AFTER_CURRENT_PAGE":r=findRowInYPos(n),l=findRowInYPos(n+(extraViewPorts+1)*o);break;case"PAGE_BEFORE_CURRENT_PAGE":r=findRowInYPos(n-extraViewPorts*o),l=findRowInYPos(n+o)}return{firstRow:r,lastRow:l}}}function getTileContainerMarkup(){var e=document.createElement("DIV");return e.style.left="0px",e.style.width="0px",e.style.height="0px",e.style.top="0px",e.style.overflow="visible",e.style.position="absolute",e}function getCellsInTile(e,t){var r=isElement(arguments[0])?e:getTile(arguments[0],t);return r.childNodes}function getCellsInColumn(e,t,r,l){var n=l!=sheetPane1Id&&l!=sheetPane2Id?Row.getAvailableRows():Row.getAvailableRowsInFrozenRange();void 0===t&&(t=n[0]),void 0===r&&(r=n[n.length-1]);for(var o=ArrayUtils.getSortedIndex,i=Row.isHidden(t)?o(n,t):getRowIndex(t),a=Row.isHidden(r)?o(n,r):getRowIndex(r),s=~~(i/ROWS_PER_TILE),c=~~(a/ROWS_PER_TILE),d=i%ROWS_PER_TILE*totCols+e,u=[],f=s;c>=f;f++){for(var h=getTile(f).childNodes,g=f===c?a%ROWS_PER_TILE*totCols+e+1:h.length,w=d;g>w;w+=totCols)u.push(h[w]);d=e}return u}function isSheetScrollTopCrossedLastRow(){return getSheetScrollTop()+getSheetHeight()>=getSheetTableHeight()?!0:!1}function setColDetails(e,t,r,l,n){switch(e){case"RANGE":for(var o=t,i=r,a=parseInt(l),s=(i+1-o)*a-(colLeftAry[i+1]-colLeftAry[o]),c=colLeftAry[o],d=colLeftAry.length,u=o;i>=u;u++)colWidthAry[u]=a,colLeftAry[u+1]=c+a,c=colLeftAry[u+1];for(var u=i+2;d>u;u++)colLeftAry[u]+=s;break;case"RANGEOBJ":var f=n;for(var h in f)if("undefined"!=typeof f[h]&&"undefined"!=typeof f[h].sc){for(var o=f[h].sc,i=f[h].ec,a=parseInt(f[h].v),s=(i+1-o)*a-(colLeftAry[i+1]-colLeftAry[o]),c=colLeftAry[o],d=colLeftAry.length,u=o;i>=u;u++)colWidthAry[u]=a,colLeftAry[u+1]=c+a,c=colLeftAry[u+1];for(var u=i+2;d>u;u++)colLeftAry[u]+=s}break;case"RESIZE":var g=t,a=parseInt(r),s=colWidthAry[g]-a;colWidthAry[g]=a;for(var d=colLeftAry.length,u=g+1;d>u;u++)colLeftAry[u]+=s;break;case"INSERT":for(var o=t,w=r,a=parseInt(l),s=w*a,R=[],p=[],d=colLeftAry.length,u=0;w>u;u++)R[u]=a;for(var c=colLeftAry[o],u=0;w>u;u++)p[u]=c+u*a;for(var C=colWidthAry.slice(0,o),v=colWidthAry.slice(o,d-w),E=colLeftAry.slice(0,o),A=colLeftAry.slice(o,d-w),u=0,b=A.length;b>u;u++)A[u]=s+parseInt(A[u]);colWidthAry=C.concat(R).concat(v),colLeftAry=E.concat(p).concat(A);break;case"DELETE":for(var o=t,w=r,d=colLeftAry.length,E=colLeftAry.slice(0,o),A=colLeftAry.slice(o+w,d),s=colLeftAry[o+w]-colLeftAry[o],u=0,b=A.length;b>u;u++)A[u]=A[u]-s;colWidthAry.splice(o,w),colLeftAry=E.concat(A);for(var u=d-w;d>u;u++){var T=getCellDefaultWidth();colWidthAry[u]=T,colLeftAry[u]=colLeftAry[u-1]+T}break;case"INSERT_COPY_COLUMN":for(var S=t,y=S.ssc,I=S.sc,m=S.totCols,P=S.cpyTimes,R=[],p=[],H=colLeftAry.length,D=0,s=0,c=parseInt(colLeftAry[I]),u=0;P>u;u++)for(var L=0;m>L;L++)R[D]=colWidthAry[y+L],c+=parseInt(colWidthAry[y+L]),p[D]=c,D+=1;s=parseInt(colLeftAry[y+m])-parseInt(colLeftAry[y]),s*=P;for(var C=colWidthAry.slice(0,I),v=colWidthAry.slice(I,H-m*P),E=colLeftAry.slice(0,I+1),A=colLeftAry.slice(I+1,H-m*P),u=0,b=A.length;b>u;u++)A[u]=s+parseInt(A[u]);colWidthAry=C.concat(R).concat(v),colLeftAry=E.concat(p).concat(A)}}function getColLeft(e){return colLeftAry[e]}function getColWidth(e){return colWidthAry[e]}function getRowTop(e){return rowTopAry[e]}function getRowHeight(e){return rowHeightAry[e]}function getEndLeftOfCol(e){return getColLeft(e)+getColWidth(e)}function setRowDetails(e,t,r,l){switch(e){case"LOAD":case"RANGEOBJ":var n=t,o=0;rowTopAry[0]=0;var i,a=!1,s=getRowMax()+1,c=-1;for(var d in n)if("undefined"!=typeof n[d]&&"undefined"!=typeof n[d].sr){var u=n[d].sr,f=n[d].er,h=n[d].v;if(s=Math.min(s,n[d].sr),c=Math.max(c,n[d].er),"undefined"!=typeof i&&i+1!==u)for(var g=i+1;u>g;g++)0!=g&&(rowTopAry[g]=rowTopAry[g-1]+rowHeightAry[g-1]);for(var g=u;f>=g;g++)rowHeightAry[g]=h,0!==g&&(rowTopAry[g]=rowTopAry[g-1]+rowHeightAry[g-1]);a=!0,o=f,i=f}if(a){for(;o<getRowMax();)0!=o&&(rowTopAry[o]=rowTopAry[o-1]+rowHeightAry[o-1]),o++;Row.minifyHiddenRowInfo(!0)}return{sr:s,er:c};case"RANGE":for(var u=t,f=r,w=parseInt(l),R=(f+1-u)*w-(rowTopAry[f+1]-rowTopAry[u]),p=rowTopAry[u],g=u;f>=g;g++)rowHeightAry[g]=w,rowTopAry[g+1]=p+w,p=rowTopAry[g+1];for(var g=f+2,C=rowTopAry.length;C>g;g++)rowTopAry[g]+=R;break;case"RESIZE":var v=t,w=parseInt(r),R=rowHeightAry[v]-w;rowHeightAry[v]=w;for(var g=v+1,C=rowHeightAry.length;C>g;g++)rowTopAry[g]+=R;break;case"INSERT":for(var u=t,E=r,w=parseInt(l),R=E*w,A=[],b=[],T=rowTopAry.length,g=0;E>g;g++)A[g]=w;for(var p=rowTopAry[u],g=0;E>g;g++)b[g]=p+g*w;for(var S=rowHeightAry.slice(0,u),y=rowHeightAry.slice(u,T-E),I=rowTopAry.slice(0,u),m=rowTopAry.slice(u,T-E),g=0,C=m.length;C>g;g++)m[g]=R+parseInt(m[g]);rowHeightAry=S.concat(A).concat(y),rowTopAry=I.concat(b).concat(m),Row.minifyHiddenRowInfo(!0);break;case"DELETE":for(var P=t,E=P.length,C=rowHeightAry.length,H=P[0],D=P[P.length-1]+1,L=rowHeightAry.slice(0,H),x=rowHeightAry.slice(D,C),F=rowHeightAry.slice(H,D),O=[],s=1,g=1;E>g;g++){var c=P[g]-H;O=O.concat(F.slice(s,c)),s=c+1}for(var N=[],W=getDefaultCellHeight(),g=0;E>g;g++)N.push(W);window.rowHeightAry=L.concat(O).concat(x).concat(N),0===H&&(H=1,rowTopAry[0]=0);for(var g=H,C=rowHeightAry.length;C>g;g++)rowTopAry[g]=rowTopAry[g-1]+rowHeightAry[g-1];Row.minifyHiddenRowInfo(!0);break;case"HIDE":var C,_,M=t;if("all"===M){C=rowHeightAry.length-1;do rowHeightAry[C]=0;while(C--);_=0}else{_=M[0];for(var g=0,V=M.length;V>g;g++)rowHeightAry[M[g]]=0}for(var g=_+1,C=rowHeightAry.length;C>g;g++)rowTopAry[g]=rowTopAry[g-1]+rowHeightAry[g-1];for(var g=rowIndex+1,C=rowDetails.length;C>g;g++)rowDetails[g].t=getRowTop(g)+R;break;case"RESIZE":var v=t,k=convertNumber(r),U=getRowHeight(v),R=k-U;rowDetails[v].h=k;for(var g=v,C=rowDetails.length;C>g;g++)rowDetails[g].t=getRowTop(g)+R;break;case"INSERT":for(var u=t,E=r,k=convertNumber(l),R=0,g=u;u+E>g;g++){var U=getRowHeight(g);R+=k-U}for(var g=u+E,C=rowDetails.length+E;C>g;g++){var Z={};Z.h=getRowHeight(g-E),Z.t=getRowTop(g)+R,rowDetails[g]=Z}R=0;for(var g=u;u+E>g;g++){var U=getRowHeight(g);rowDetails[g].h=k,rowDetails[g].t=getRowTop(g)+R,R+=k-U}var R=E*k,C=rowDetails.length,B=rowDetails.slice(0,u),Y=rowDetails.slice(u,C),z=u==totRows?!0:!1;if(z)var G=k,j=getRowTop(u-1)+getRowHeight(u-1);else var G=k,j=getRowTop(u);for(var g=0;E>g;g++){var X=getRowColDetailsTemplate("ROW");X.h=k,X.t=j,B[u+g]=X,j+=G;var X={};X.h=k,X.t=j,B[u+g]=X,j+=G}for(var g=0,C=Y.length;C>g;g++)Y[g].t=Y[g].t+R;rowDetails=B.concat(Y),Row.minifyHiddenRowInfo(!0);break;case"INSERT_COPIED_ROWS":var $=t,_=r,q=l,K=rowHeightAry.slice(_,q+1),Q=rowHeightAry.slice(0,$),J=rowHeightAry.slice($,getRowMax());rowHeightAry=Q.concat(K).concat(J),rowHeightAry.length=getRowMax();for(var g=_+1,C=rowHeightAry.length;C>g;g++)rowTopAry[g]=rowTopAry[g-1]+rowHeightAry[g-1];Row.minifyHiddenRowInfo(!0)}}function updateRowDetails(e){var t=e[e.length-1];t>=totRows&&(totRows=t+1,setSheetTableHeight(getRowTop(t)+getRowHeight(t)))}function getDefaultCellHeight(){return cellDefaultHeight}function getCellDefaultWidth(){return cellDefaultWidth}function isCellField(e){return e==cellField?!0:!1}function setSheetTableHeight(e){if(isNumber(e)&&e>=0){var t,r=getSheetHeight();r>e?t=e:parseInt(sheetPane.style.height)<r&&(t=r);var l=!isUndefined(t);rowHeadTable.style.height=e+"px",sheetTable.style.height=e+"px",ISFREEZED&&(t-=getRowTop(FREEZED_ROW),0>t&&(t=0),FREEZED_ROW>0&&(sheetTable2.style.height=e+"px"),FREEZED_COL>0&&(sheetTable3.style.height=e+"px",l&&(sheetPane3.style.height=t+"px")),FREEZED_ROW>0&&FREEZED_COL>0&&(sheetTable1.style.height=e+"px")),l&&(sheetPane.style.height=t+"px"),ssVScrollDIV.style.height=e+"px",totalTableHeight=e,appEvent.trigger("tableHeightChanged",[e])}}function setSheetTableWidth(e){if(isNumber(e)&&e>=0){sheetTable.style.width=colHeadTable.style.width=e+"px",ISFREEZED&&(FREEZED_ROW>0&&(sheetTable2.style.width=e+"px"),FREEZED_COL>0&&(sheetTable3.style.width=e+"px"),FREEZED_ROW>0&&FREEZED_COL>0&&(sheetTable1.style.width=e+"px"));var t=e-(parseInt(sheet.style.width)-parseInt(ssHScrollbar.style.width));totalTableWidth=e,ssHScrollDIV.style.width=t>=0?t+"px":"0px"}var r=ssHScrollbar.scrollLeft;ssHScrollbar.scrollLeft!=sheetScrollInfo.scrollLeft&&(sheetScrollInfo.scrollLeft=r),sheetPane.scrollLeft!=r&&(sheetPane.scrollLeft=r,ISFREEZED&&sheetPane2.scrollLeft!=r&&(sheetPane2.scrollLeft=r)),appEvent.trigger("tableWidthChanged",[totalTableWidth])}function getSheetTableWidth(){return totalTableWidth}function getSheetTableHeight(){return totalTableHeight}function getSheetScrollHeight(){return sheetPane.scrollHeight}function getSheetScrollWidth(){return sheetPane.scrollWidth}function setSheetHeight(e){isNumber(e)&&(rowHead.style.height=ssVScrollbar.style.height=sheet.style.height=sheetPane.style.height=e+"px",sheetHeight=e,FREEZED_COL>0&&(sheetPane3.style.height=e+"px"))}function getSheetHeight(){var e=parseInt(sheet.style.height);return 0!==e&&(sheetHeight=e),sheetHeight}function getSheetPaneHeight(){return parseInt(sheetPane.style.height)}function setSheetWidth(e){isNumber(e)&&(colHead.style.width=e+"px",sheet.style.width=e+"px",sheetPane.style.width=e+"px",ssHScrollbar.style.width=ssHScrollbar.parentNode.offsetWidth+"px",totalTableWidth&&(ssHScrollDIV.style.width=getSheetTableWidth()-getSheetWidth()+parseInt(ssHScrollbar.style.width)+"px"),FREEZED_ROW>0&&(sheetPane2.style.width=e+"px"))}function getSheetWidth(){return sheetWidth=parseInt(sheet.style.width)}function isColExceedsMaxColumn(e){if(isNumber(e)){if(ISFREEZED){var t,r=getActivePane();switch(r){case 1:case 3:t=FREEZED_COL>e+1;break;case 2:case 4:t=totCols>e+1}return t}var t=totCols>e+1;return t}}function isRowExceedsMaxRow(e){if(isNumber(e)){if(ISFREEZED){var t=getActivePane();switch(t){case 1:case 2:r=FREEZED_ROW>e+1;break;case 3:case 4:r=totRows>e+1}}else var r=totRows>e+1;return r}}function getSheetTabScroll(){var e=getObj("sheetsTab"),t=e.scrollLeft;return RTLlang&&(t=Math.abs(t),$.browser.webkit&&(t=e.scrollWidth-e.clientWidth-t)),t}function getNormalizedScrollLeft(){if(isRTL){var e=document.getElementById("ssHScrollbar"),t=e.scrollLeft,t=Math.abs(t),r=navigator.userAgent;if(-1!=r.indexOf("Edge/"))return sheetScrollInfo.scrollLeft;if($.browser.webkit){var l=r.indexOf("Version/");if(-1!=l){var n=r.substring(l+("Version/".length+10));if(-1!=n.indexOf("10."))return sheetScrollInfo.scrollLeft}else t=e.scrollWidth-e.clientWidth-t}}else t=sheetScrollInfo.scrollLeft;return t}function getSheetScrollLeft(){return sheetScrollInfo.scrollLeft}function getSheetScrollTop(){return sheetScrollInfo.scrollTop}function addAvailStartRow(e){return e+getAvailableStartRow()}function getExcessiveRowInRowHdr(e){return e+getFirstRowInRowHdr()}function isRowInsideCurrCellRange(e){if(isCellRange()){var t=getCellRange();return e>=t.startRow&&e<=t.endRow}var r=ActiveCellInfo;return e>=r.getStartRow()&&e<=r.getEndRow()}function isBlankAreaInViewPort(){return isBlankAreaInTopOfViewPort()||isBlankAreaInBottomOfViewPort()}function isBlankAreaInBelowViewPort(){return isBlankAreaInBottomOfViewPort(0)}function isBlankAreaInAboveViewPort(){return isBlankAreaInTopOfViewPort(0)}function isBlankAreaInTopOfViewPort(e){isUndefined(e)&&(e=PAGES_PER_LOAD);var t=getAvailableStartRow(),r=getRowTop(t),l=getSheetHeight(),n=getSheetScrollTop()-e*l;return n=0>n?0:n,r>n}function isBlankAreaInBottomOfViewPort(e){isUndefined(e)&&(e=PAGES_PER_LOAD);var t=getAvailableEndRow()+1;if(t>=0)var r=getRowTop(t)+getRowHeight(t);else var r=0;var l=getSheetPaneHeight(),n=getSheetScrollTop()+(e+1)*l,o=getSheetTableHeight();return n=o>n?n:o,n>r}function getBoundaryRowInViewPort(){var e=getSheetScrollTop(),t=findRowInYPos(e+findThirdPaneYPos())+1,r=findRowInYPos(e+getSheetHeight())+1,l=getRowMax();return t=ISFREEZED?FREEZED_ROW>=t?FREEZED_ROW+1:t:t>0?t:1,r=l>=r?r:l,{firstRow:t,lastRow:r}}function getXYPositions(){var e,t,r=getSheetScrollTop(),l=getSheetScrollLeft();return e=0==r?0:findRowInYPos(r+findThirdPaneYPos())+1,t=0==l?0:findColInXPos(l+findSecondPaneXPos())+1,{firstRow:e,firstCol:t}}function getColHeads(e,t,r){var r=r||colHeadTable;return ArrayUtils.slice(r.childNodes,e,t+1)}function shiftColHead(e,t){null!=e&&(e.style[isRTL?"right":"left"]="DIFF"==t.mode?parseInt(e.style[isRTL?"right":"left"])+t.val+"px":t.val+"px")}function shiftColHeads(e,t,r,l){if(isUndefined(l))var l=getColHeads(e,t);for(var n=0,o=e;n<l.length;n++){var i=n+e,a=0;a="DIFF"==r.mode?getColLeft(i):r.val,isRTL?l[n].style.right=a+"px":l[n].style.left=a+"px",o=o==t?0:o+1}}function shiftRowHead(e,t){if(null!=e)if("DIFF"==t.mode)e.style.top=parseInt(e.style.top)+t.val+"px";else{var r=t.val;e.style.top=r+"px"}}function shiftCellsHorizontally(e,t,r,l){var n=Row.getAvailableRowsInFrozenRange(),o=0;n&&n.length&&(o=n.length);var i=[];o&&(i=ColumnUtil.getCellsInCols(e,t,sheetPane2Id));var a=ColumnUtil.getCellsInCols(e,t,l);i=i?i.concat(a):a;var s=t-e+1;s>0&&doShiftCellsHorizontally(i,e,t,r)}function doShiftCellsHorizontally(e,t,r,l){for(var n=0,o=t,i=e.length;i>n;n++){if("DIFF"==l.mode)var a=getColLeft(o)+l.val;else var a=l.val;e[n].style[isRTL?"right":"left"]=a+"px",o=o==r?t:o+1}}function getTileTop(e){return parseInt(e.style.top)}function getTileIndex(e){return~~(getRowIndex(e)/ROWS_PER_TILE)}function getRowMax(){return 65536}function isRowInViewPort(e){if(isNumber(e)){if(ISFREEZED&&FREEZED_ROW>e)return!0;var t=getRowTop(e),r=getRowHeight(e);return t>getSheetScrollTop()&&t+r<=getSheetScrollTop()+getSheetHeight()||t==getSheetScrollTop()}return!1}function isColInViewPort(e){if(isNumber(e)){if(ISFREEZED&&FREEZED_COL>e)return!0;var t=getColLeft(e),r=getColWidth(e);return t>getNormalizedScrollLeft()&&t+r<=getNormalizedScrollLeft()+getSheetWidth()||t==getNormalizedScrollLeft()}return!1}function fixArrayFormulaNotation(e,t,r,l){for(var n=getArraysInRange(e,t,r,l,!0),o=0;o<n.length;o++){var i=n[o],a=i[0],s=i[1],c=i[2],d=i[3],u=getCell(a,c),f=getCellFormula(u);if(f&&0!=f.indexOf("{"))for(var h="{"+f+"}",g=a;s>=g;g++)for(var w=c;d>=w;w++)u=getCell(g,w),u.setAttribute("fn",h)}}function isPartOfArray(e,t,r,l){for(var n=0;n<arrayDetails.length;n++){var o=arrayDetails[n];if(!isUndefined(o)){var i=new Range(e,t,r,l),a=new Range(o[0],o[2],o[1],o[3]),s=isPartOfRange(i,a);if(s)return!0}}return!1}function isPartOfMergeOrArray(e,t,r,l,n){if("merge"==n)for(var o in mergeInfo.mergeList)if(!isUndefined(o)){var i=new Range(e,t,r,l),a=new Range(mergeInfo.mergeList[o].startRow,mergeInfo.mergeList[o].startCol,mergeInfo.mergeList[o].endRow,mergeInfo.mergeList[o].endCol),s=isPartOfRange(i,a);if(s)return!0}if("Array"==n)for(var c=0;c<arrayDetails.length;c++){var d=arrayDetails[c];if(!isUndefined(d)){var i=new Range(e,t,r,l),a=new Range(d[0],d[2],d[1],d[3]),s=isPartOfRange(i,a);if(s)return!0}}return!1}function isPartOfRange(e,t){var r=t.startRow,l=t.startCol,n=t.endRow,o=t.endCol,i=e.startRow,a=e.startCol,s=e.endRow,c=e.endCol;if(i>=r&&n>=i||s>=r&&n>=s){if(a>=l&&o>=a||c>=l&&o>=c||l>a&&c>o)return l>=a&&c>=o&&r>=i&&s>=n?!1:!0}else if((a>=l&&o>=a||c>=l&&o>=c)&&(i>=r&&n>=i||s>=r&&n>=s||r>i&&s>n))return l>=a&&c>=o&&r>=i&&s>=n?!1:!0;return!1}function clearOldArrayPosition(e,t,r,l){for(var n=0;n<arrayDetails.length;n++){var o=arrayDetails[n];if(!isUndefined(o)){var i=o[0],a=o[1],s=o[2],c=o[3];e>=i&&a>=e||r>=i&&a>=r?(t>=s&&c>=t||l>=s&&c>=l||s>t&&l>c)&&s>=t&&l>=c&&i>=e&&r>=a&&(arrayDetails.splice(n,1),n--):t>=s&&c>=t||l>=s&&c>=l?(e>=i&&a>=e||r>=i&&a>=r||i>e&&r>a)&&s>=t&&l>=c&&i>=e&&r>=a&&(arrayDetails.splice(n,1),n--):i>=e&&r>=a&&s>=t&&l>=c&&(arrayDetails.splice(n,1),n--)}}}function containsAnyArray(e,t,r,l){for(var n=0;n<arrayDetails.length;n++){var o=arrayDetails[n];if(!isUndefined(o)){var i=o[0],a=o[1],s=o[2],c=o[3];if(e>=i&&a>=e||r>=i&&a>=r){if((t>=s&&c>=t||l>=s&&c>=l||s>t&&l>c)&&s>=t&&l>=c&&i>=e&&r>=a)return!0}else if(t>=s&&c>=t||l>=s&&c>=l){if((e>=i&&a>=e||r>=i&&a>=r||i>e&&r>a)&&s>=t&&l>=c&&i>=e&&r>=a)return!0}else if(i>=e&&r>=a&&s>=t&&l>=c)return!0}}return!1}function getArray(e,t){for(var r=null,l=0;l<arrayDetails.length;l++)if(r=arrayDetails[l],!isUndefined(r)){var n=r[0],o=r[1],i=r[2],a=r[3];if((t==i||t>i&&a>=t)&&(e==n||e>n&&o>=e))return r}return r}function getArraysInRange(e,t,r,l,n){for(var o=[],i=0;i<arrayDetails.length;i++){var a=arrayDetails[i];if(!isUndefined(a)){var s=a[0],c=a[1],d=a[2],u=a[3];if(e>=s&&c>=e||r>=s&&c>=r){if(t>=d&&u>=t||l>=d&&u>=l||d>t&&l>u)if(d>=t&&l>=u&&s>=e&&r>=c){var f=[];f[0]=s,f[1]=c,f[2]=d,f[3]=u,o.push(f)}else if(n){var f=getPartArray(e,t,r,l,s,d,c,u);o.push(f)}}else if(t>=d&&u>=t||l>=d&&u>=l){if(e>=s&&c>=e||r>=s&&c>=r||s>e&&r>c)if(d>=t&&l>=u&&s>=e&&r>=c){var f=[];f[0]=s,f[1]=c,f[2]=d,f[3]=u,o.push(f)}else if(n){var f=getPartArray(e,t,r,l,s,d,c,u);o.push(f)}}else if(s>=e&&r>=c&&d>=t&&l>=u){var f=[];f[0]=s,f[1]=c,f[2]=d,f[3]=u,o.push(f)}}}return o}function getPartArray(e,t,r,l,n,o,i,a){var s=[];return isArrayCell(e,t)&&e>n&&t>o?(s[0]=e,s[2]=t):isArrayCell(e,o)&&e>n?(s[0]=e,s[2]=o):isArrayCell(n,t)&&t>o?(s[0]=n,s[2]=t):(s[0]=n,s[2]=o),isArrayCell(r,l)&&i>r&&a>l?(s[1]=r,s[3]=l):isArrayCell(r,a)&&i>r?(s[1]=r,s[3]=a):isArrayCell(i,l)&&a>l?(s[1]=i,s[3]=l):(s[1]=i,s[3]=a),s}function isArrayCell(e,t){for(var r=0;r<arrayDetails.length;r++){var l=arrayDetails[r];if(!isUndefined(l)){var n=l[0],o=l[1],i=l[2],a=l[3];if((t==i||t>i&&a>=t)&&(e==n||e>n&&o>=e))return!0}}return!1}function updateArrayDetails(e,t,r,l,n){switch(e){case"SUBMIT":var o=t,i=r,a=l,s=n;clearOldArrayPosition(o,i,a,s);var c=[];c[0]=o,c[1]=a,c[2]=i,c[3]=s,arrayDetails.push(c);break;case"INSERTROW":for(var d=t,u=r,f=0;f<arrayDetails.length;f++){var c=arrayDetails[f],o=c[0];o>=d&&(c[0]=o+u,c[1]=c[1]+u,arrayDetails[f]=c)}break;case"DELETEROW":for(var d=t,u=r,f=0;f<arrayDetails.length;f++){var c=arrayDetails[f],o=c[0];o>=d&&(c[0]=o-u,c[1]=c[1]-u,arrayDetails[f]=c)}break;case"INSERTCOL":for(var h=t,u=r,f=0;f<arrayDetails.length;f++){var c=arrayDetails[f],i=c[2];i>=h&&(c[2]=i+u,c[3]=c[3]+u,arrayDetails[f]=c)}break;case"DELETECOL":for(var h=t,u=r,f=0;f<arrayDetails.length;f++){var c=arrayDetails[f],i=c[2];i>=h&&(c[2]=i-u,c[3]=c[3]-u,arrayDetails[f]=c)}}}function getFirstRowInRowHdr(){return getAvailableStartRow()}function getLastRowInRowHdr(){return getAvailableEndRow()}function getCellDIM(e,t){var r,l,n,o,i=Merge.getCellInfo(e,t);if(i){var a=i.startRow,s=i.startCol,c=i.endRow,d=i.endCol;l=getRowTop(a),o=getRowTop(c)+getRowHeight(c)-getRowTop(a),r=getColLeft(s),n=getColLeft(d)+getColWidth(d)-getColLeft(s)}else l=getRowTop(e),o=getRowHeight(e),r=getColLeft(t),n=getColWidth(t);return{left:r,top:l,width:n,height:o}}function getCellInnerHTML(e){var t=e.querySelector(".w100");return t?t.innerHTML:e.innerHTML}function setCellInnerHTML(e,t){var r=getCellContentNode(e);r.innerHTML=t}function setCellHeightForVAlignedCell(e){if(!featureSupport.boxAlign){e.className}}function setCellWidthForVAlignedCell(e){e.className}function addFlexBoxDiv(e,t){var r="<div class='w100'>"+t+"</div>";hasFlexBoxDiv(e)||(e.innerHTML=r)}function removeFlexBoxDiv(e){var t=e.querySelector(".w100");if(t){var r=t.innerHTML;e.removeChild(t),e.innerHTML=r}}function getCellContentNode(e){var t=e.querySelector(".w100");return t?t:e}function hasFlexBoxDiv(e){var t=e.querySelector(".w100");return t?!0:!1}function getRowPosInMouseEvent(e){var t=getCursorPos(e),r=t.y-sheetTop;return r>=findThirdPaneYPos()&&(r+=getSheetScrollTop()),findRowInYPos(r)}function getColPosInMouseEvent(e){var t=getCursorPos(e);if(isRTL){var r=clientDim.width-t.x-rowHeadWidth;"none"!=$("#docPanel").css("display")&&(r-=parseInt($("#docPanel").css("width")))}else var r=t.x-sheetLeft;return r>=findSecondPaneXPos()&&(r+=getNormalizedScrollLeft()),findColInXPos(r)}function loadXTileIfVacantInViewPort(e){(isBlankAreaInViewPort()||e)&&(currScrollTop=isBlankAreaInBelowViewPort()?getSheetScrollTop()-1:isBlankAreaInAboveViewPort()?getSheetScrollTop()+1:isBlankAreaInBottomOfViewPort()?getSheetScrollTop()-1:getSheetScrollTop()+1,isVScrollFaceClicked&&showRowNoInfo(),loadXTiles(getSheetScrollTop(),void 0,void 0,e))}function isFocusDIV(){var e=arguments[0];return isUndefined(e)?!1:isStr(e)?"fD"==e||"fD1"==e||"fD2"==e||"fD3"==e:isElement(e)?e==focusDIV||e==focusDIV1||e==focusDIV2||e==focusDIV3:!1}function isSheetTable(){var e=arguments[0];return e?isStr(e)?"sT"==e||"sT1"==e||"sT2"==e||"sT3"==e:isElement(e)?e==sheetTable||e==sheetTable1||e==sheetTable2||e==sheetTable3:!1:!1}function isTransSPAN(){var e=arguments[0];return isUndefined(e)?!1:isStr(e)?"tS"==e||"tS1"==e||"tS2"==e||"tS3"==e:isElement(e)?e==transSPAN||e==transSPAN1||e==transSPAN2||e==transSPAN3:!1}function isCellRangeFlashInnerDIV(){var e=arguments[0];return isUndefined(e)?!1:isStr(e)?"fCRID"==e||"fCRID1"==e||"fCRID2"==e||"fCRID3"==e:isElement(e)?e==cellRangeFillSPAN||e==cellRangeFillSPAN1||e==cellRangeFillSPAN2||e==cellRangeFillSPAN3:!1}function getActivePane(){return getSheetPane(currRow,currCol)}function getTileSeperator(){return"<!---tileSep--->"}function isRowInAvailableRowRange(e){return e>=getAvailableStartRow()&&e<=getAvailableEndRow()}function isRowAvailable(e){return getRowIndex(e)>=0}function isRowAvailable(e,t){if(isNumber(e)&&totRows>e&&!Row.isHidden(e)){t||(t=1);var r=e,l=e+t-1,n=getAvailableStartRow(),o=getAvailableEndRow();return!(r>o||n>l)}return!1}function activateCellField(e){if(e&&isSSActive){var t=dialogEl;isEditorClosed||t&&(!t||"none"!=t.style.display)||sheetdialog.isDialogOpen()||isNotEditorElement(e)&&"undefined"!=typeof Discussion&&!Discussion.isPanelEl(e)&&(gridFormulaEditController.isFormula()||(isCellFieldSPANHided()||0!=cellField.value.indexOf("=")?setFocusInCellField():setCaretPos(cellField,formulaEIdxTemp)))}}function isNotEditorElement(e){var t=e.tagName;if("INPUT"==t)var r=e.type;return!("OPTION"==t||"SELECT"==t||"TEXTAREA"==t||"DIV"==t&&"true"==e.getAttribute("contenteditable")||"INPUT"==t&&"text"==r||"IFRAME"==t||"password"==r||"email"==r||isChildOfContentEditableElement(e))}function isChildOfContentEditableElement(e){return"true"===e.getAttribute("contenteditable")?!0:e===document.body?!1:isChildOfContentEditableElement(e.parentElement)}function getCellValue(e){return e.getAttribute("cV")}function getSheetPane(e,t){var r=4;return ISFREEZED&&(r=1,e>=FREEZED_ROW&&(r+=2),t>=FREEZED_COL&&(r+=1)),r}function getSheetPaneId(e){var t="sP";return 4!=e&&(t+=e),t}function isCellinView(e,t){var r=getSheetScrollTop(),l=getSheetScrollLeft(),n=getRowTop(e),o=getColLeft(t);return n>=r&&o>=l?!0:!1}function getViewPortRoundedDetails(e,t){var r=e,l=!1,n=FREEZED_ROW>0&&FREEZED_ROW-1>=e,o=-1;return n&&(o=FREEZED_ROW-1>=t?t:FREEZED_ROW-1),t>=getAvailableStartRow()&&e<=getAvailableEndRow()&&(t=t>getAvailableEndRow()?getAvailableEndRow():t,e=e<getAvailableStartRow()?getAvailableStartRow():e,e=FREEZED_ROW>e&&t>=FREEZED_ROW?FREEZED_ROW:e,l=!0),{isInViewPort:l,isInFreezedRange:n,startRowIdx:e,endRowIdx:t,freezedStartRowIdx:r,freezedEndRowIdx:o}}function setFocusInCellField(){if(!jsEMBED_VIEW||!updateTileCallbackInfo.actionDetails){var e=getObj("fD");e&&null==ole.getCurrObj()&&(e.style.visibility=""),cellField&&(cellField.focus(),""==cellField.value&&cellField.select(),cellField.focus())}}function getCellMarkUp(){var e=document.createElement("DIV");return e}function concat(e,t){return browser_ie?e.push(t):e+=t,e}function findSheetObjectOptimalPos(e,t){var r=Math.round((sheet.offsetWidth-e)/2+getSheetScrollLeft()),l=Math.round((sheet.offsetHeight-t)/2+getSheetScrollTop());return 0>r&&(r=0),0>l&&(l=0),{left:r,top:l}}function saveEveCheck(e){var t=e.keyCode;return 83==t&&e.ctrlKey?!1:void 0}function replaceDisallowedCharsInDocName(e){var t=new RegExp("['\"<>#?/%&\\\\]","g");return e.replace(t,"-")}function showAlertDialog(e){isUndefined(e)||0==e.length||sheetdialog.showAlertDialog(e),lastTime=(new Date).getTime()}function showConfirmDialog(e){var t=confirm(e);return lastTime=(new Date).getTime(),t}function showPromptDialog(e,t){t=t?t:"";var r=prompt(e,t);return lastTime=(new Date).getTime(),r}function getCellFunctionValueWOF(e){var t=e.getAttribute("fn"),r=e.getAttribute("cv");if(void 0!=t&&0==t.indexOf("=")&&(t=r,null!=t&&(t=t.replace(/\'/g,"").replace(/\xA0/g,""),44==decSymbol?(t=t.replace(/\./g,""),t=t.replace(/,/g,".")):t=t.replace(/,/g,""))),(void 0==t||0==t.indexOf("{="))&&(t=r,null!=t&&44==decSymbol&&(t=t.replace(/\./g,""),t=t.replace(/,/g,"."))),"hi"==docLocale.substring(0,2)&&null!=t){var l=encodeURIComponent(t).toUpperCase();l=l.replace("%24","").replace("%C2%A3","").replace("Rs.","").replace("%E2%82%AC","").replace("%E2%82%B9","").replace("%EF%BF%A5","").replace("%25","").replace(/%2C/g,"");var n=l.replace(/%E0%A5%A6/g,"0").replace(/%E0%A5%A7/g,"1").replace(/%E0%A5%A8/g,"2").replace(/%E0%A5%A9/g,"3").replace(/%E0%A5%AA/g,"4").replace(/%E0%A5%AB/g,"5").replace(/%E0%A5%AC/g,"6").replace(/%E0%A5%AD/g,"7").replace(/%E0%A5%AE/g,"8").replace(/%E0%A5%AF/g,"9");t=n}if(null!=t&&"hi"!=docLocale.substring(0,2)&&(t=encodeURIComponent(t).trim().toUpperCase(),0==t.indexOf("%24")&&(t=t.replace("%24","")),-1!=t.indexOf("%E2%82%AC")&&(t=t.replace("%E2%82%AC","")),0==t.indexOf("%C2%A3")&&(t=t.replace("%C2%A3","")),0==t.indexOf("RS.")&&(t=t.replace("RS.","")),0==t.indexOf("%EF%BF%A5")&&(t=t.replace("%EF%BF%A5","")),-1!=t.indexOf("%25")&&(t=t.replace("%25",""))),null!=t){var o=t.match(/^%2C|%2C$/g);if(44!=decSymbol||o?o||-1==t.indexOf("%2C")||(t=t.replace(/%2C/g,"")):t=t.replace(/%2C/g,"."),"NULL"!=t){var i=new RegExp("[0-9-]*[0-9][[.,]?[0-9]+]?");isNaN(t)&&(t=i.exec(decodeURIComponent(t)))}t=decodeURIComponent(t).trim()}return t}function getPaneId(e,t){var r;if(ISFREEZED){var l=FREEZED_ROW,n=FREEZED_COL;r=l>e&&n>t?sheetPane1Id:l>e&&t>=n?sheetPane2Id:e>=l&&n>t?sheetPane3Id:sheetPaneId}else r=sheetPaneId;return r}function getCellPosInPage(e,t){var r=isRTL?getOffsetRight(sheet):findPosX(sheet),l=findPosY(sheet);return r+=getColLeft(t),l+=getRowTop(e)+getRowHeight(e),t>=FREEZED_COL&&(r-=getNormalizedScrollLeft()),e>=FREEZED_ROW&&(l-=getSheetScrollTop()),{left:r,top:l}}function getDocFragment(){var e=document.createDocumentFragment();return e}function submitFuction(e,t){var r;return window.event?r=window.event.keyCode:e&&(r=e.which),13==r&&"JA"!==USER_LOCALE.toUpperCase()?(t(),!1):!0}function focusActiveElement(){document.activeElement.blur(),"BODY"==document.activeElement.tagName&&("undefined"!=typeof ole&&ole.getCurrObj()?ole.focus():setFocusInCellField())}function isCellRangeLabel(e){if(-1!=e.indexOf(":")){var t=e.split(":");return CellUtils.isCellLabel(t[0])&&CellUtils.isCellLabel(t[1])}return CellUtils.isCellLabel(e)}function isPivotOrArrayRange(e,t,r,l,n,o,i){return isPartOfArray(e,t,r,l)?(showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),!0):pivot.Collection.isPivotRange(e,t,r,l,n,o,i)?(showAlertDialog(jsMsg["Error.Pivot.Table.Part.Change"]),!0):!1}function resetCurrCellValue(){if(null!=currCell){var e=currCell.querySelector("span");appEvent.trigger("addlink",[currCell,currCellValue]),currCell.setAttribute("cV",currCellValue),currCellFormula&&currCellValue!=currCellFormula&&currCell.setAttribute("fn",currCellFormula),exprField.value=getCellContent(),e&&(hasFlexBoxDiv(currCell)?currCell.querySelector(".w100").prepend(e):currCell.prepend(e))}else{var t=getHiddenCellFormula(currRow,currCol);exprField.value=t}resetGlobalVariables(),focusCell(currRow,currCol),formulaSyntaxTip.hideMe()}function getResizeColPosInMouseEvent(e){var t=getCursorPos(e);t.x=isRTL?clientDim.width-t.x:t.x;var r=t.x-(rowHeadWidth+2);return r>=findSecondPaneXPos()&&(r+=getNormalizedScrollLeft()),findColInXPos(r)}function getResizeRowPosInMouseEvent(e){var t=getCursorPos(e),r=t.y-(sheetTop+2);return r>=findThirdPaneYPos()&&(r+=getSheetScrollTop()),findRowInYPos(r)}var extraViewPorts=1,ColumnUtil={getCellsInCol:function(e){return this.getCellsInCols(e,e)},getCellsInCols:function(e,t,r){var l=[],n=0,o=t-e,i=FREEZED_COL,a=totCols-i-(t-i-1)+(e-i-1),s=e;isUndefined(r)&&(r=sheetPaneId),i&&(s=r==sheetPane1Id||r==sheetPane3Id?e:e-i);for(var c=getAvailableTiles(r),d=getTilesCount(r),u=0;d>u;u++)for(var f=c[u],h=getCellsInTile(f,r),g=h.length,w=s,R=0;g>w;){var p=h[w];l[n]=p,n++,R==o?(w+=a,R=0):(w++,R++)}return l}};!function(e){e.sheetPrompt={options:{label:"",inputValue:"",submitfunction:void 0,callback:void 0},_init:function(e){this.options.label=e.label,this.options.inputValue=e.value,this.options.submitfunction=e.submitfunction,this.options.callback=e.callback},showdialog:function(t,r){this._init(r),sheetdialog.open(t,r,{init:function(){var t=e.sheetPrompt.options;if(e("#promptlbl").html(t.label),e("#promptTxt").val(t.inputValue),t.submitfunction){var r=t.submitfunction;e("#promptTxt").keypress(function(e){var t;window.event?t=window.event.keyCode:e&&(t=e.which),13==t&&r.fn(r.arg)})}t.callback&&t.callback(),setTimeout(function(){e("#promptTxt").focus(),e("#promptTxt").select()},200)}})}}}(jQuery);var sheetMenu={currMenu:void 0,openedMenus:[],target:void 0,clearcache:!1,menuoptions:{},_ismenuopened:!1,initOptions:function(e){e.target&&(this.target=e.target),e.clearcache&&(this.clearcache=e.clearcache),e.menuoptions&&(this.menuoptions=e.menuoptions)},showMenu:function(e,t,r){this.hideOpenedMenu(),this.initOptions(r),this.openedMenus.contains(e)?this.clearcache&&($("#"+e).remove(),$.ui.zmenu.createMenu(e,t,this.menuoptions)):($.ui.zmenu.createMenu(e,t,this.menuoptions),this.openedMenus.push(e));var l=$("#"+e);if(this._ismenuopened=!0,this.currMenu=l,this.currMenu.unbind("menuitemclicked").bind("menuitemclicked",function(e,t){contextMenu._bindrclickevent(e,t)}),this.currMenu.zmenu("show",{target:this.target}),r.position){var n=r.position,o=n[0],i=n[1],a=clientDim.width,s=clientDim.height,c=l.outerWidth(),d=l.outerHeight();i+d>s&&(i=s-d),o+c>a&&(o-=c),l.css({left:o-3,top:i-3})}window.event;l.keydown(function(e){var t=e.keyCode;27===t&&(sheetMenu.hideMenu(),focusActiveElement())})},hideMenu:function(e){e&&(!this.isMenuOpened()||this.isCursorOverMenu(e)||ole.contextMenuStatus||("versionMenu"==sheetMenu.currMenu[0].id&&$(".atSetting").removeAttr("style"),sheetMenu.currMenu.zmenu("hide"),this.resetMenuOptions(),focusActiveElement()),setTimeout(function(){jQuery.ZContextMenu._isMenuShowing||ole.contextMenuStatus||featurePermission.setPermission({allowToScroll:!0})},100))},hideOpenedMenu:function(){this.currMenu&&(this.currMenu.zmenu("hide"),this.resetMenuOptions()),jQuery.ZContextMenu._isMenuShowing&&jQuery.ZContextMenu.currentMenu.hide()},resetMenuOptions:function(){this.target=void 0,this.clearcache=!1,this.menuoptions={},this._ismenuopened=!1,this.currMenu=void 0},isCursorOverMenu:function(e){var t=$(e.target||e.srcElement);if(t){var r=t.attr("class");return r&&-1!=r.indexOf("zmenu")?!0:!1}return!1},isMenuOpened:function(){var e=$(".ui-zmenu").filter(":visible");return e.length&&this._ismenuopened?!0:!1}},TileUtil={getMarkup:function(){var e=document.createElement("DIV");return e.className="tile",isRTL&&(e.style.right="0px"),e},getClonedTile:function(){return this.getMarkup().cloneNode("false")}},isValidRangeGlobal=function(e){for(var e=e.split(";"),t=0;t<e.length;t++){var r=getDataFrom2DRangeText(e[t].replace(/\$/g,""));if(!r)return!1}return!0};
function arrowCheckFormulaCase(e){switch(e){case 37:return 0===cellField.value.indexOf("=")&&cellField.selectionStart===cellField.selectionEnd&&0===cellField.selectionStart;case 39:return 0===cellField.value.indexOf("=")&&cellField.selectionStart===cellField.selectionEnd&&cellField.selectionEnd===cellField.value.length;case 13:return!0;case 9:return!0;default:return!1}}function isValueChangedInCellField(e){var l=cellField.value,t=getCellContent(e);return-1!==t.indexOf("{=")&&-1!==t.indexOf("}")&&(t=t.substring(1,t.length-1)),t!==l}function enableRangeSelector(e){RangeSelector.on({el:e,directInput:!0,multiRangeSelection:!0,removeSourceSheetName:!0,grid:!0,skipReregisterCheck:!0,onupdate:function(l){setCellFieldWidth(),updateCellFieldAndExprField(e),setCellFieldValue(l)}})}function updateCellFieldAndExprField(e){var l;l=e==exprField?cellField:exprField,l.value=e.value}function setCellFieldValue(e){if(RangeSelector.isActive()&&(isCellEdited()&&0===cellField.value.indexOf("=")||formulaCell))exprField.value=cellField.value;else if(RangeSelector.isActive()&&isExprFunc&&!$("#rangeSelectorDialog").is(":visible"))setCellContent(currCell,exprField.value);else if(RangeSelector.isActive()&&isExprFunc&&$("#rangeSelectorDialog").is(":visible"))$("#sRange").val(e);else if(Discussion.rangeEdit){var l=exprField.value;-1==exprField.value.indexOf(".")&&(l=CURRSHEETNAME+"."+exprField.value),$(Discussion.currRangeTF).val(l),$(Discussion.currRangeTF).attr("asn",WorkSheets.getSheetCodeFromName(CURRSHEETNAME));{8*$(Discussion.currRangeTF).val().length+5+"px"}Discussion.Utilities.setRangeAttr($(Discussion.currRangeTF),void 0,cellRangeStartRow,cellRangeStartCol,cellRangeEndRow,cellRangeEndCol)}}function focusCurCelWhileEditing(e){var l=ActiveCellInfo,t=l.getTop(),i=getSheetHeight(),r=l.getHeight(),o=l.getStartRow(),d=l.getStartCol();if(r>i){scrollColIntoView(d);var s=dummyTextArea;s.style="";var a=s.style;a.width=l.getWidth()+"px",a.boxSizing="border-box",s.className=cellField.className,s.value=e;var n=s.scrollHeight,c=0;c=n>r?t+r-i/4:t+n-i/4,cellField.scrollTop=n,setScrollTop(c)}else scrollCellIntoView(o,d)}function focusCellField(e,l,t){var i="string"==(typeof e).toLowerCase();if(e=i?e:"",(!l||"fSC"!=l.target.id)&&(appEvent.trigger("cellfield.focus"),jsVERSION_VIEW||!READ_WRITE||!ProtectedRanges.isCellLocked(currRow,currCol)&&!PivotUtil.isPivotCell(currRow,currCol))){if(checkbox.isPresent())return checkbox.edit(e),!1;var r=(cellField.value,e);t&&(e=""),isDblClicked&&!isCellWrapped(currCell)&&isTextWrapped&&(isTextWrapped=!1);var o=appEvent.isDefaultPrevented(appEvent.trigger("cell.onBeforeFocusCellfield"));if(o!==!0){var d=Row.isHidden(currRow);if(l&&isObject(l)){var s=browser_ie?l.srcElement:l.target;if(!isCell(s)&&!isFocusDIV(s)&&!userPresence.isOwnDiv(s))return}if(!isServerComponentLoaded(!0))return!1;if(d||currCell){{var a=ActiveCellInfo;a.getStartRow(),a.getStartCol()}if(UTIL.DOM.removeClass(cellField,"noBoxShadow"),READ_WRITE){if(currCellWidth=a.getWidth(),cellField.setAttribute("wrap","on"),initMaxStylePropertyForSheet(),focusCurCelWhileEditing(),initCellFieldStyles(r),toCheckCFUnderOleObj(),e="undefined"==typeof e?"":replace(e,"<br>","\n"),isArrayCell(currRow,currCol)&&null!=e&&"null"!=e&&"{"==e.charAt(0)&&(e=e.substring(1,e.length-1)),i&&(exprField.value=e,cellField.value=e),setDummySpanStyles(),initCellContentDetails(),isCellFieldSPANHided.isHided=!1,isCellWrapped(currCell)?(dummyTextArea.value=e,setDummyTextAreaStyles(),isTextWrapped=!0):(isCellFieldInEditMode()||isCellFieldInNewMode()&&"undefined"!=typeof l)&&(setCellFieldWidth("EDITMODE"),setCellFieldHeight("EDITMODE","CELLFIELD")),setCellFieldWidth(),checkCellFieldPos(),browser_safari||browser_opera||cellField.focus(),editMode_disableButtons(),browser_safari||!browser_ie||browser_opera)setCaretPos(cellField,e.length);else if(browser_ie){var n=getCountOfOccrnceOfCharInStr(e,"\n");setCaretPos(cellField,e.length+n)}if(REMOTE.ISRMVIEW&&SAVED&&ALLOW_TO_WRITE&&btn_enabled(),browser_safari||browser_opera||cellField.focus(),editMode_disableButtons(),browser_safari||!browser_ie||browser_opera)setCaretPos(cellField,e.length);else if(browser_ie){var n=getCountOfOccrnceOfCharInStr(e,"\n");setCaretPos(cellField,e.length+n)}appEvent.trigger("collabpanal.senduseredit",[!0]),appEvent.trigger("cellField.focus",[cellField.id,!0]),isRTL&&$("#cFC").css("left","")}}}}}function formulaCellKeydown(e){13===e||9===e?sheetSwitchBeforeSubmit():27==e&&sheetSwitchBeforeSubmit(!0)}function sheetSwitchBeforeSubmit(e){if(cellPrevState){var l=cellPrevState.row,t=cellPrevState.col,i=cellPrevState.sourceSheet;if(!e){var r=cellField.value;submitCell(!1,{sheetName:i,row:l,col:t,value:r})}Goto.doGoto(i,l,l,t,t,!1)}}function cellFieldKeyDown(e){cellField.selectionStart!==cellField.selectionEnd&&RangeSelector.isActive()&&RangeSelector.off();var l=browser_ie?window.event.keyCode:e.which;if(27==l&&chartPreview.hideColorPallate(l),isFilterOptionsDIVOpened)return 9===e.keyCode||40===e.keyCode||39===e.keyCode||37===e.keyCode||38===e.keyCode||27===e.keyCode||32===e.keyCode||13===e.keyCode?(Filter.shortCutHandler(e),Event.stop(e),stopEvt(e),!1):void 0;var t=appEvent.isDefaultPrevented(appEvent.trigger("grid.cFKeyDownInDvCell",[e]));if(!(t||isCellEdited()&&gridFormulaEditController.isFormula()&&9===l&&e.altKey)){if(appEvent.trigger("grid.cellFieldKeyDown",[e]),!isCellFieldSPANHided()&&!e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&l>47&&90>=l&&browser_firefox&&59!=l){var i=getBoundaryRowInViewPort(),r=ActiveCellInfo.getStartRow();return void((r<i.firstRow||r>i.lastRow)&&scrollRowIntoView(r))}if((40==l||38==l||13==l||33==l||34==l||9==l)&&formulaMenuUtil.isFMenuOpened)return!1;if(RangeSelector.isActive()&&l>=37&&40>=l&&(e.preventDefault(),e.stopPropagation(),RangeSelector.arrowKeyDownCheck(e)),isCellFieldSPANHided())return cellKeyDown(e);if(e.altKey&&38==l)return void formulaMenuUtil.disableAutoComplete(cellField.id);if(0==cellField.value.indexOf("=")){var o=$("#"+cellField.id);113==l&&o.autocomplete("close");var d=e.shiftKey;if(d&&48==l||d&&57==l||d&&222==l||8==l||46==l){(d&&48==l||d&&57==l)&&o.autocomplete("close");var s=cellField.value.substr(0,getCaretPos(cellField)),a=isTextSelected(cellField);formulaSyntaxTip.showTip(s,o,l,a,d)}13!=l&&9!=l&&27!=l||e.altKey||e.ctrlKey||formulaSyntaxTip.hideMe()}if(e.altKey&&browser_ie&&13==l||os_mac&&browser_nn6&&e.ctrlKey&&77==l||e.altKey&&browser_safari&&13==l){if(posOfCaret=getCaretPos(cellField),startPosOfSelection=posOfCaret,endPosOfSelection=getSelectionEnd(cellField),Event.stop(e),stopEvt(e),addLineBreak("CELLFIELD"),$formulaSyntaxDiv&&formulaSyntaxTip.isVisible()){var n=$formulaSyntaxDiv.data("formulaData"),c=n.indx;formulaSyntaxTip.setLeftAndTop(c,$("#"+this.id))}}else{if(27==l)return formulaCellKeydown(l),resetCurrCellValue(),appEvent.trigger("cell.escapeEdit",[currRow,currCol]),!1;if(83==l){if((e.ctrlKey||e.metaKey)&&!e.altKey)return isCellEdited()&&submitCell(),!1}else if(59==l||186==l){if(e.ctrlKey||e.metaKey)return insertDateOrTime(e.shiftKey?"time":"date"),!1}else if(9==l||13==l&&!e.altKey&&!e.ctrlKey||33==l||34==l||l>=37&&40>=l&&(isCellFieldInNewMode()&&!isMultilineInCellField()||formulaCell)){if((37==l||38==l||39==l||40==l)&&rangeSelection(),formulaCell){if(9!==l&&13!==l&&37!==l&&38!==l&&39!==l&&40!==l&&(parseInt(cellField.style.width)>getColWidth(currCol)||isF2KeyPressed||isDblClicked||DataValidation.isDvRetryMode()))return}else if(9!==l&&13!==l&&38!==l&&40!==l&&(isF2KeyPressed||isDblClicked||DataValidation.isDvRetryMode()))return;if(formulaCell&&(isF2KeyPressed||isDblClicked||DataValidation.isDvRetryMode())&&(37===l||38===l||39===l||40===l))return;if(!formulaCell&&l>=37&&40>=l&&isenterKeyPressed)return;if(!isArrayCell(currRow,currCol)&&(!RangeSelector.isActive()||37!=l&&38!=l&&39!=l&&40!=l)){if(gridFormulaEditController.isFormula()&&!arrowCheckFormulaCase(l))return;if(cellPrevState&&cellPrevState.sourceSheet!==CURRSHEETNAME)return formulaCellKeydown(l),void e.preventDefault();submitCell()}switch(isRTL&&(37==l?l=39:39==l&&(l=37)),l){case 33:return 0>currRow-10?focusCell(0,currCol):focusCell(currRow-10,currCol),!1;case 34:return currRow+10>10?focusCell(10,currCol):focusCell(currRow+10,currCol),!1;case 37:if(!RangeSelector.isActive()){var u=ActiveCellInfo,C=u.getStartCol()-1;focusCell(currRow,C)}return!1;case 38:if(!RangeSelector.isActive()){var u=ActiveCellInfo,F=Row.findNextNonHiddenRow(u.getStartRow(),!1);focusCell(F,currCol)}return!1;case 39:if(!RangeSelector.isActive()){var u=ActiveCellInfo,f=u.getEndCol()+1;focusCell(currRow,f)}return!1;case 9:if(!RangeSelector.isActive())if(e.shiftKey){var u=ActiveCellInfo,C=u.getStartCol()-1;focusCell(currRow,C)}else{var u=ActiveCellInfo,f=u.getEndCol()+1;focusCell(currRow,f)}return!1;case 13:if(isArrayCell(currRow,currCol)){if(isPartOfArray(currRow,currCol,currRow,currCol))return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),exprField.value=currCellFormula,!1;submitCell(!1);var u=ActiveCellInfo,g=Row.findNextNonHiddenRow(u.getEndRow());return focusCell(g,currCol),!1}if(e.shiftKey&&!e.ctrlKey&&!e.altKey){var u=ActiveCellInfo,p=u.getStartRow();return focusCell(Row.findNextNonHiddenRow(p,!1),currCol),!1}if(!RangeSelector.isActive()){var t=appEvent.isDefaultPrevented(appEvent.trigger("celledit.enterkeypressed"));if(t)return!1;var u=ActiveCellInfo,g=Row.findNextNonHiddenRow(u.getEndRow());focusCell(g,currCol)}return!1;case 40:if(e.altKey&&pickFromList(),!RangeSelector.isActive()){var u=ActiveCellInfo,g=Row.findNextNonHiddenRow(u.getEndRow());focusCell(g,currCol)}return!1}}else{if(e.ctrlKey&&e.shiftKey&&85==l)return isExprFieldExpanded?collapseExprField():expandExprField(),!1;if(e.ctrlKey&&e.shiftKey&&13==l){var h=getCellRange(),v=h.startRow,E=h.startCol,x=h.endRow,S=h.endCol;return submitCell(!0),focusCellRange(v,E,x,S),!1}if(e.ctrlKey&&68==l)return isCellEdited()&&isCellRange()&&!gridFormulaEditController.isFormula()?(browser_firefox||e.stopPropagation(),e.preventDefault(),Event.stop(e),stopEvt(e),submitCell(),fillSeriesDown(),!1):void 0;if(e.ctrlKey&&82==l)return isCellEdited()?(browser_firefox||e.stopPropagation(),e.preventDefault(),Event.stop(e),stopEvt(e),submitCell(),fillSeriesRight(),!1):void 0}if(browser_opera&&(9==l||13==l&&!e.ctrlKey)&&hideCellField(),8==l){posOfCaret=getCaretPos(cellField);var y=posOfCaret!=cellField.value.length?cellField.value.substring(0,posOfCaret):cellField.value.substring(0,posOfCaret-1),R=cellField.value.substring(0,posOfCaret-1)+cellField.value.substring(posOfCaret,cellField.value.length);exprField.value=exprField.value.length!=cellField.value.length?y:R,(!browser_ie&&10==cellField.value.charCodeAt(posOfCaret-1)||browser_ie&&13==cellField.value.charCodeAt(posOfCaret)||-1!=getSelectedText(cellField).indexOf("\n"))&&isMultilineInCellField()&&currRowOfCellfield>=currRow&&(setCellFieldHeight("BACKSPACE","CELLFIELD"),setCellFieldWidth("BACKSPACE")),isTextWrapped&&setCellFieldHeight("BACKSPACE","CELLFIELD")}else if(35==l&&!e.altKey||36==l&&!e.altKey)exprField.value=cellField.value;else if(46==l){posOfCaret=getCaretPos(cellField),endPosOfSelection=getSelectionEnd(cellField);var w=isTextSelected(cellField)?0:1;exprField.value=cellField.value.substring(0,posOfCaret)+cellField.value.substring(endPosOfSelection+w,cellField.value.length),(!browser_ie&&10==cellField.value.charCodeAt(posOfCaret)||browser_ie&&13==cellField.value.charCodeAt(posOfCaret)&&posOfCaret+2!=cellField.value.length||-1!=getSelectedText(cellField).indexOf("\n"))&&isMultilineInCellField()&&(setCellFieldHeight("DELETE","CELLFIELD"),setCellFieldWidth("DELETE")),isTextWrapped&&setCellFieldHeight("BACKSPACE","CELLFIELD")}if(37==l)posOfCaret=getSelectionStart(cellField),(!browser_ie&&10==cellField.value.charCodeAt(posOfCaret-1)||browser_ie&&13==cellField.value.charCodeAt(posOfCaret))&&(scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.substring(0,posOfCaret-1).split("\n").length-EXPRCONTENTHEIGHT,exprField.scrollTop=scrolledHeightForExprField);else if(39==l)posOfCaret=getSelectionStart(cellField),(10==cellField.value.charCodeAt(posOfCaret)||browser_ie&&10==cellField.value.charCodeAt(posOfCaret+1))&&(scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.substring(0,posOfCaret-1).split("\n").length,exprField.scrollTop=scrolledHeightForExprField,exprField.scrollLeft=0);else if(38==l){posOfCaret=getSelectionStart(cellField);var O=cellField.value.substring(0,posOfCaret);-1!=O.indexOf("\n")&&(scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.substring(0,posOfCaret).split("\n").length-2*EXPRCONTENTHEIGHT,exprField.scrollTop=scrolledHeightForExprField)}else if(40==l){posOfCaret=getSelectionStart(cellField);var O=cellField.value.substring(posOfCaret+1,cellField.value.length);-1!=O.indexOf("\n")&&(scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.substring(0,posOfCaret-1).split("\n").length,exprField.scrollTop=scrolledHeightForExprField)}else if(36==l)(e.ctrlKey||e.ctrlKey&&e.shiftKey)&&(scrolledHeightForExprField=0,exprField.scrollTop=scrolledHeightForExprField);else if(35==l)(e.ctrlKey||e.ctrlKey&&e.shiftKey)&&(scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.split("\n").length,exprField.scrollTop=scrolledHeightForExprField);else if(70==l&&e.ctrlKey&&e.shiftKey)return setCaretPos(exprField,exprField.value.length),!1;setTimeout(function(){isCellEdited()&&(updateCellFieldAndExprField(cellField),setCellFieldWidth())},10),e.stopPropagation()}}}function cellFieldKeyPress(e){if(allowtowrite){if(isCellFieldSPANHided()){if(exprFieldKeyPressed)return;var l=cellKeyPress(e);return appEvent.trigger("cellField.keyPress",[e]),l}appEvent.trigger("cellField.keyPress",[e]);var t=browser_ie?window.event.keyCode:e.which;if(posOfCaret=getCaretPos(cellField),startPosOfSelection=posOfCaret,endPosOfSelection=getSelectionEnd(cellField),13==t&&!e.ctrlKey&&!e.altKey&&formulaMenuUtil.isFMenuOpened)return formulaMenuUtil.isFMenuOpened=!1,!1;if(44==t||59==t){var i=cellField.value;if(0==i.indexOf("=")){var r=i.substr(0,getCaretPos(cellField)),o=String.fromCharCode(t),d=r+o,s=isTextSelected(cellField),a=cellField.id;formulaSyntaxTip.showTip(d,$("#"+a),t,s)}}if(e.ctrlKey&&(13==e.keyCode||10==e.keyCode)||13==t&&e.altKey){if(addLineBreak("CELLFIELD"),$formulaSyntaxDiv&&formulaSyntaxTip.isVisible()){var n=$formulaSyntaxDiv.data("formulaData"),c=n.indx,a=cellField.id;formulaSyntaxTip.setLeftAndTop(c,$("#"+a))}return!1}return 8==t||0==t||e.ctrlKey||e.altKey||e.metaKey||(exprField.value=browser_ie?13!=exprField.value.charCodeAt(startPosOfSelection)?cellField.value.substring(0,startPosOfSelection)+String.fromCharCode(t)+cellField.value.substring(endPosOfSelection,cellField.value.length):cellField.value.substring(0,startPosOfSelection+2)+String.fromCharCode(t)+cellField.value.substring(endPosOfSelection,cellField.value.length):cellField.value.substring(0,startPosOfSelection)+String.fromCharCode(t)+cellField.value.substring(endPosOfSelection,cellField.value.length),setCellFieldWidth(),isTextSelected(cellField)&&!isSuggestAvailable&&setCellFieldHeight("KEYUP","CELLFIELD")),browser_nn6&&(exprField.scrollTop=scrolledHeightForExprField,contentNotReachedMaximumheight||(cellField.scrollTop=scrolledHeightForCellField)),browser_opera&&(9==t||13==t&&!e.ctrlKey)?(hideCellField(),!1):void 0}}function cellFieldKeyUp(e){if(isCellFieldSPANHided())return cellKeyUp(e);var l=appEvent.isDefaultPrevented(appEvent.trigger("grid.cFKeyUpInDvCell",[e]));if(!l){appEvent.trigger("grid.cellFieldKeyUp",[e]);var t=browser_ie?window.event.keyCode:e.which;if(37!=t&&38!=t&&39!=t&&40!=t||!formulaMenuUtil.isFMenuOpened){if(0==cellField.value.indexOf("=")){var i=isTextSelected(cellField);if(t>=32&&126>=t&&i||35==t||36==t||37==t||39==t){var r=cellField.value.substr(0,getCaretPos(cellField)),o=cellField.id;formulaSyntaxTip.showTip(r,$("#"+o),t,i)}}if(13==t&&setCellFieldWidth(),browser_opera)if(9==t||13==t&&!e.ctrlKey)hideCellField();else if(27==t){if(null!=currCell)appEvent.trigger("addlink",[currCell,currCellValue]),currCell.setAttribute("cV",currCellValue),""!=currCellFormula&&currCellValue!=currCellFormula&&currCell.setAttribute("fn",currCellFormula);else{var d=getHiddenCellFormula(currRow,currCol);exprField.value=d}return resetGlobalVariables(),focusCell(currRow,currCol),!1}86==t&&e.ctrlKey&&(exprField.value=cellField.value,setCellFieldWidth("PASTE"),setCellFieldHeight("PASTE","CELLFIELD")),90==t&&e.ctrlKey&&(exprField.value=cellField.value,setCellFieldWidth("UNDO"),setCellFieldHeight("UNDO","CELLFIELD")),89==t&&e.ctrlKey&&(exprField.value=cellField.value,setCellFieldWidth("REDO"),setCellFieldHeight("REDO","CELLFIELD")),88==t&&e.ctrlKey&&(exprField.value=cellField.value,setCellFieldWidth("CUT"),setCellFieldHeight("CUT","CELLFIELD"))}}}function exprFieldKeyDown(e){exprField.selectionStart!==exprField.selectionEnd&&RangeSelector.isActive()&&RangeSelector.off();var l=appEvent.isDefaultPrevented(appEvent.trigger("exprField.keyDown",[e]));if(l)return void e.preventDefault();var t=browser_ie?window.event.keyCode:e.which,i=ProtectedRanges.isCellLocked(currRow,currCol,!0);if(!READ_WRITE||i)return(os_mac&&(e.metaKey||e.ctrlKey)||!os_mac&&e.ctrlKey&&!e.altKey&&!e.metaKey)&&(65==t||67==t)||t>=37&&40>=t||16==t||17==t||18==t||20==t||27==t||91==t||93==t?void e.stopPropagation():(i&&showAlertDialog(jsMsg["ProtectedRange.alert.ProtectRangeMessage"]),!1);if(RangeSelector.isActive()&&t>=37&&40>=t)return e.preventDefault(),e.stopPropagation(),void RangeSelector.arrowKeyDownCheck(e);if(!gridFormulaEditController.isFormula()||9!==t||!e.altKey){if(checkbox.isPresent())return checkbox.edit(String.fromCharCode(t)),!1;var r=exprField.id,o=$("#"+r);if(113==t&&o.autocomplete("close"),(13==t||9==t)&&o.autocomplete("widget").is(":visible"))return formulaMenuUtil.isFMenuOpened=!0,!1;if(e.altKey&&38==t)return void formulaMenuUtil.disableAutoComplete(r);var d=e.shiftKey;if(d&&48==t||d&&57==t||d&&222==t||8==t||46==t){(d&&48==t||d&&57==t)&&o.autocomplete("close");var s=exprField.value.substr(0,getCaretPos(exprField)),a=isTextSelected(exprField);formulaSyntaxTip.showTip(s,o,t,a,d)}if(isStylesAssignedForCellField||(isCellFieldSPANHided.isHided=!1,initCellFieldWhileEditInExprField()),e.altKey&&browser_ie&&13==t||os_mac&&browser_nn6&&e.ctrlKey&&77==t)return posOfCaret=getCaretPos(exprField),startPosOfSelection=getSelectionStart(exprField),endPosOfSelection=getSelectionEnd(exprField),Event.stop(e),stopEvt(e),void addLineBreak("EXPRFIELD");if(8==t){posOfCaret=getCaretPos(exprField);var n=posOfCaret;browser_ie&&13==exprField.value.charCodeAt(posOfCaret)&&(n=posOfCaret+2);var c=posOfCaret!=exprField.value.length?exprField.value.substring(0,n):exprField.value.substring(0,n-1),u=exprField.value.substring(0,n-1)+exprField.value.substring(n,exprField.value.length),C=cellField.value.length!=exprField.value.length?c:u;if(cellField.value=C,isCellFieldInEditMode())(10==exprField.value.charCodeAt(posOfCaret-1)||-1!=getSelectedText(exprField).indexOf("\n"))&&isMultilineInCellField()&&(setCellFieldHeight("BACKSPACE","EXPRFIELD"),setCellFieldWidth());else if(isCellFieldInNewMode()&&browser_ie){var F=cellField.value.substring(0,posOfCaret+2);13==exprField.value.charCodeAt(posOfCaret)&&(scrolledHeightForCellField=getCellContentHeightForMultiline(exprField.value.substring(0,posOfCaret-1))-contentHeight,cellField.scrollTop=scrolledHeightForCellField,F=cellField.value.substring(0,posOfCaret)),cellFieldScrollLeft(F)}}else(35==t||36==t||37==t||39==t)&&(cellField.value=exprField.value);if(46==t){posOfCaret=getSelectionStart(exprField),endPosOfSelection=getSelectionEnd(exprField);var f=isTextSelected(exprField)?0:1,g=exprField.value.substring(0,posOfCaret)+exprField.value.substring(endPosOfSelection+f,exprField.value.length);cellField.value=g;var n=browser_ie||browser_opera?posOfCaret+1:posOfCaret;isCellFieldInEditMode()&&(10==exprField.value.charCodeAt(n)||-1!=getSelectedText(exprField).indexOf("\n"))&&isMultilineInCellField()&&(setCellFieldHeight("DELETE","EXPRFIELD"),setCellFieldWidth())}if(27==t){if(null!=currCell)appEvent.trigger("addlink",[currCell,currCellValue]),setCellContent(currCell,currCellValue),currCellFormula&&currCellValue!=currCellFormula&&currCell.setAttribute("fn",currCellFormula),exprField.value=getCellContent();else{var p=getHiddenCellFormula(currRow,currCol);exprField.value=p}return resetGlobalVariables(),focusCell(currRow,currCol),appEvent.trigger("exprField.escapeEdit"),!1}if(9==t||13==t&&!e.altKey&&!e.ctrlKey){if(isCellFieldSPANHided()&&0!=exprField.value.indexOf("=")||("hide"==getCellContent(currCell,"fn")&&jsPUBLIC_VIEW&&!showFormulas?(focusCell(currRow,currCol),resetGlobalVariables()):isPartOfArray(currRow,currCol,currRow,currCol)||submitCell()),9==t){var h=ActiveCellInfo,v=h.getStartCol();focusCell(currRow,v+1)}else{var h=ActiveCellInfo,E=h.getStartRow();focusCell(Row.findNextNonHiddenRow(E),currCol)}return browser_opera&&hideCellField(),!1}if(e.ctrlKey&&e.shiftKey&&85==t)return isExprFieldExpanded?collapseExprField():expandExprField(),!1;if(e.ctrlKey&&e.shiftKey&&13==t)return submitCell(!0),focusCellRange(startRow,startColumn,endRow,endColumn),!1;if(isCellFieldInNewMode())if(37==t){posOfCaret=getSelectionStart(exprField);var F=exprField.value.substring(0,posOfCaret);cellFieldScrollLeft(F),(!browser_ie&&10==exprField.value.charCodeAt(posOfCaret-1)||browser_ie&&13==exprField.value.charCodeAt(posOfCaret))&&(scrolledHeightForCellField=getCellContentHeightForMultiline(exprField.value.substring(0,posOfCaret-1))-contentHeight,cellField.scrollTop=scrolledHeightForCellField)}else if(39==t){posOfCaret=getSelectionStart(exprField);var F=exprField.value.substring(0,posOfCaret);cellFieldScrollLeft(F),(10==exprField.value.charCodeAt(posOfCaret)||browser_ie&&10==exprField.value.charCodeAt(posOfCaret+1))&&(scrolledHeightForCellField=getCellContentHeightForMultiline(exprField.value.substring(0,posOfCaret-1)),cellField.scrollTop=scrolledHeightForCellField,cellField.scrollLeft=0)}else if(38==t){posOfCaret=getSelectionStart(exprField);var x=exprField.value.substring(0,posOfCaret);-1!=x.indexOf("\n")?(scrolledHeightForCellField=getCellContentHeightForMultiline(x)-2*contentHeight,cellField.scrollTop=scrolledHeightForCellField):(scrolledHeightForCellField=0,cellField.scrollTop=scrolledHeightForCellField)}else if(40==t){posOfCaret=getSelectionStart(exprField);var x=exprField.value.substring(posOfCaret+1,exprField.value.length);-1!=x.indexOf("\n")?(scrolledHeightForCellField=getCellContentHeightForMultiline(exprField.value.substring(0,posOfCaret)),cellField.scrollTop=scrolledHeightForCellField):(scrolledHeightForCellField=0,cellField.scrollTop=scrolledHeightForCellField)}else if(36==t)cellField.scrollLeft=0,(e.ctrlKey||e.ctrlKey&&e.shiftKey)&&(scrolledHeightForCellField=0,cellField.scrollTop=scrolledHeightForCellField);else if(35==t){var F=exprField.value.substring(0,posOfCaret);cellFieldScrollLeft(F),(e.ctrlKey||e.ctrlKey&&e.shiftKey)&&(scrolledHeightForCellField=getCellContentHeightForMultiline(exprField.value),cellField.scrollTop=scrolledHeightForCellField)}27!=t&&(exprFieldKeyPressed=!0),e.shiftKey||resetFillRanges("exprField",e.shiftKey,t),setTimeout(function(){updateCellFieldAndExprField(exprField),setCellFieldWidth()},10)}}function exprFieldKeyUp(e){var l=browser_ie?window.event.keyCode:e.which,t=exprField.id,i=$("#"+t);if(27==l&&formulaSyntaxTip.hideMe(),37!=l&&38!=l&&39!=l&&40!=l||!i.autocomplete("widget").is(":visible")){if(35==l||36==l||37==l||39==l){var r=exprField.value.substr(0,getCaretPos(exprField));formulaSyntaxTip.showTip(r,i,l)}if(browser_opera){if(9==l||13==l&&!e.altKey&&!e.ctrlKey)return exprField.blur(),focusCell(currRow,currCol),!1;if(27==l){if(null!=currCell)appEvent.trigger("addlink",[currCell,currCellValue]),""!=currCellFormula&&currCellValue!=currCellFormula&&currCell.setAttribute("fn",currCellFormula);else{var o=getHiddenCellFormula(currRow,currCol);exprField.value=o}return focusCell(currRow,currCol),resetGlobalVariables(),!1}}if(86==l&&e.ctrlKey)if(cellField.value=exprField.value,isCellFieldInEditMode())setCellFieldWidth("PASTE"),setCellFieldHeight("PASTE","EXPRFIELD");else{var d=cellField.value.substring(0,browser_ie?posOfCaret+2:posOfCaret);cellFieldScrollLeft(d)}if(90==l&&e.ctrlKey)if(cellField.value=exprField.value,isCellFieldInEditMode())setCellFieldWidth("UNDO"),setCellFieldHeight("UNDO","CELLFIELD");else{var d=cellField.value.substring(0,browser_ie?posOfCaret+2:posOfCaret);cellFieldScrollLeft(d)}if(89==l&&e.ctrlKey)if(cellField.value=exprField.value,isCellFieldInEditMode())setCellFieldWidth("REDO"),setCellFieldHeight("REDO","CELLFIELD");else{var d=cellField.value.substring(0,browser_ie?posOfCaret+2:posOfCaret);cellFieldScrollLeft(d)}}}function exprFieldKeyPress(e){if(!READ_WRITE)return!1;var l=browser_ie?window.event.keyCode:e.which;if(posOfCaret=getCaretPos(exprField),startPosOfSelection=getSelectionStart(exprField),endPosOfSelection=getSelectionEnd(exprField),(10==l||13==l)&&e.ctrlKey||13==l&&e.altKey)return addLineBreak("EXPRFIELD"),!1;if(13==l&&!e.ctrlKey&&!e.altKey&&formulaMenuUtil.isFMenuOpened)return formulaMenuUtil.isFMenuOpened=!1,!1;var t=isTextSelected(exprField);if(l>=32&&126>=l&&t||44==l||59==l){var i=exprField.id;i="#"+i;var r=$(i),o=exprField.value.substr(0,getCaretPos(exprField)),d=String.fromCharCode(l),s=o+d;formulaSyntaxTip.showTip(s,r,l,t)}if(8==l||0==l||e.shiftKey&&e.ctrlKey||e.metaKey||e.ctrlKey||browser_opera&&(27==l||e.shiftKey||e.altKey||36==l||35==l)||(cellField.value=browser_ie?13!=cellField.value.charCodeAt(startPosOfSelection)?exprField.value.substring(0,startPosOfSelection)+String.fromCharCode(l)+exprField.value.substring(endPosOfSelection,exprField.value.length):exprField.value.substring(0,startPosOfSelection+2)+String.fromCharCode(l)+exprField.value.substring(endPosOfSelection,exprField.value.length):exprField.value.substring(0,startPosOfSelection)+String.fromCharCode(l)+exprField.value.substring(endPosOfSelection,exprField.value.length),setCellFieldWidth(),isTextSelected(exprField)&&!isSuggestAvailable&&setCellFieldHeight("KEYUP","EXPRFIELD")),isCellFieldInEditMode())setCellFieldWidth();else if(isCellFieldInNewMode()){browser_nn6&&(cellField.scrollTop=scrolledHeightForCellField);var a=cellField.value.substring(0,browser_ie?posOfCaret+2:posOfCaret);cellFieldScrollLeft(a)}return!browser_opera||9!=l&&(13!=l||e.altKey||e.ctrlKey)?void 0:(exprField.blur(),!1)}function checkCellFunction(e){if(e.id===exprField.id){0==e.value.indexOf("=")&&(isExprFunc=!0);var l=e.value;isArrayCell(currRow,currCol)&&null!=l&&"null"!=l&&"{"==l.charAt(0)&&(l=l.substring(1,l.length-1),exprField.value=l,cellField.value=l)}else 0==e.value.indexOf("=")&&(formulaFill=!0);isEditingInExprField=!0,appEvent.trigger("collabpanal.senduseredit",[!0]),appEvent.trigger("exprField.focus",[exprField.id])}function getSuggestList(){var e=getCellRange(),l=new RequestParameters(ActionConstants.PICK_LIST);l.setParameters(WorkSheets.getAssociatedActiveSheetName(),e.startRow,e.startCol,e.startRow,e.startCol,!1);var t=new AjaxRequest;t.init("POST",l.getURL(),!0,l.getParametersAsString()),t.addEventListener("onComplete",function(e){var l=parseJSON(e.responseText);picklistCallBack(l.result)}),t.sendRequest()}function picklistCallBack(e){var l=getSuggestMenuArrayFormat(e),t={target:$(currCell),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("picListMenu",l,t)}function getSuggestMenuArrayFormat(e){var l=[];if(0!=e.length)for(var t=0;t<e.length;t+=1){var i=decodeURIComponent(e[t]),r={};if(-1==i.indexOf("&")&&-1==i.indexOf("<")){var o={dynamic:!0,callback:"setSuggestValue",arg:escapeSpecialChar(i)};r.label=i,r.appData=o,l.push(r)}}else l.push({data:"{label:'none', appData:{dynamic:true} }"});return l}function setSuggestValue(e){var l=ActiveCellInfo,t=l.getStartRow(),i=l.getStartCol();scrollCellIntoView(t,i),e=unescapeSpecialChar(e),cellField.value=e,exprField.value=e,submitCell(),userPresence.send(!0)}function initCellFieldWhileEditInExprField(){if(currCell){isCellWrapped(currCell)&&isCellFieldInEditMode()?cellField.setAttribute("wrap","on"):cellField.setAttribute("wrap","off");var e=exprField.value;e="undefined"==typeof e?"":replace(e,"<br>","\n"),isArrayCell(currRow,currCol)&&null!=e&&"null"!=e&&"{"==e.charAt(0)&&(e=e.substring(1,e.length-1)),focusCurCelWhileEditing(e),initCellFieldStyles(e),setDummySpanStyles(),initCellContentDetails(),cellField.value=getCellContent(),initMaxStylePropertyForSheet(),isCellWrapped(currCell)&&(dummyTextArea.value=cellField.value,setDummyTextAreaStyles(),isTextWrapped=!0),maxCellFieldWidthInExprFieldNewMode=getColWidth(currCol)}}function initCellContentDetails(){cellContentHeight=contentHeight,cellContentWidth=getCellValueWidth(cellField.value);var e=ActiveCellInfo,l=e.getStartCol(),t=e.getEndCol(),i=e.getStartRow(),r=e.getEndRow();currRowOfCellfield=r,currColOfCellfield=t,requiredCellWidth=FREEZED_COL>l&&t>FREEZED_COL?getColLeft(FREEZED_COL)-getColLeft(l):e.getWidth(),requiredCellHeight=FREEZED_ROW>i&&r>FREEZED_ROW?getRowTop(FREEZED_ROW)-getRowTop(i):e.getHeight()}function initCellFieldStyles(e){var l={width:ActiveCellInfo.getWidth(),left:ActiveCellInfo.getLeft(),height:ActiveCellInfo.getHeight(),top:ActiveCellInfo.getTop()},t=Row.isHidden(currRow);if(ISFREEZED){var i=ActiveCellInfo,r=i.getStartCol(),o=i.getEndCol(),d=i.getStartRow(),s=i.getEndRow();requiredCellHeight=FREEZED_ROW>d&&s>=FREEZED_ROW?getRowTop(FREEZED_ROW)-getRowTop(d):i.getHeight(),FREEZED_COL>r&&o>=FREEZED_COL?(requiredCellWidth=getColLeft(FREEZED_COL)-getColLeft(r),wrapCellFieldValue("NORMAL")):requiredCellWidth=i.getWidth(),l.height=requiredCellHeight,l.width=requiredCellWidth}if(setCellFieldTop(),setCellFieldLeft(),setCellFieldSPANWidth(l.width),setCellFieldSPANHeight(l.height),isRTL?isFormulaCell()?$(cF).css("direction","ltr"):$(cF).css("direction","rtl"):$(cF).css("direction","ltr"),$("#cF").css("border","1px solid #17A366"),$("#cFC").css("zIndex",120+BASEZINDEX),browser_safari&&!browser_chrome&&(cellField.style.paddingLeft="0px",cellField.style.paddingRight="0px"),!t){var a="";if("="===e.charAt(0))cellField.style.backgroundColor="white",cellField.style.color="black",cellField.style.fontSize="";else{if(cellField.style.backgroundColor=currCell.style.backgroundColor,cellField.style.color=currCell.style.color,"transparent"===cellField.style.color&&(cellField.style.color="black"),cellField.style.fontSize=currCell.style.fontSize,cellField.style.fontFamily=currCell.style.fontFamily,c+=" ",-1!==c.indexOf("is-")){var n=c.substring(c.indexOf("is-"),c.indexOf(" ",c.indexOf("is-")));c=c.replace(n,"")}var c=currCell.className;a=c.replace(/ vab| hcc| vam| nW| bbt| brt/g,"")}a+=" cF",cellField.className=a}var u=t?getHiddenCellFormula(currRow,currCol):getCellFormula(currCell),C=getCellFormat(currCell);(!t&&u&&0==u.indexOf("=")||isArrayCell(currRow,currCol)||"DATE"==C||"DATETIME"==C||"TIME"==C)&&removeCSSStyle("textAlign",cellField),isStylesAssignedForCellField=!0}function checkCellFieldPos(){if(!isCellFieldSPANHided()){var e={width:ActiveCellInfo.getWidth(),left:ActiveCellInfo.getLeft(),height:ActiveCellInfo.getHeight(),top:ActiveCellInfo.getTop()},l=e.width,t=parseInt($("#cFC").css(isRTL?"right":"left"));"none"!=$("#docPanel").css("display")&&isRTL&&(sheetWidth+=parseInt($("#docPanel").css("width")));var i=sheetWidth+rowHeadWidth;t+l>=i&&(showCell(),sheetWidth>=l?$("#cFC").css(isRTL?"right":"left",i):(cellField.style.width=sheetWidth+"px",$("#cFC").css(isRTL?"right":"left",sheetLeft)));var r=e.height,o=parseInt($("#cFC").css("top")),d=sheetHeight+sheetTop;o+r>=d&&(showCell(),sheetHeight>=r?$("#cFC").css("top",d-r):(cellField.style.height=sheetHeight+"px",$("#cFC").css("top",sheetTop))),isRTL&&isFormulaCell()&&isCellEdited()&&$(cF).css("direction","ltr")}}function setCellFieldTop(){var e={top:ActiveCellInfo.getTop()};e.top=sheetTop+e.top;var l=getSheetPane(currRow,currCol);(3==l||4==l)&&getSheetScrollTop()>0&&e.top>getSheetScrollTop()&&(e.top=e.top-getSheetScrollTop()),isRowInViewPort(currRow)||(e.top=sheetTop),$("#cFC").css("top",e.top-2+"px")}function showCell(){if(!isCellFieldSPANHided()){$("#showCell").css({display:"block",zIndex:cellField.style.zIndex});var e=getCellLabel(currRow,currCol);if(cellPrevState){row=cellPrevState.row,col=cellPrevState.col,e=getCellLabel(row,col);var l=RangeSelector.returnsourceSheet();e=CURRSHEETNAME!==l?l+"."+e:e}$("#showCell").text(e)}}function setCellFieldLeft(){var e={left:ActiveCellInfo.getLeft()};e.left=rowHeadWidth+e.left;var l=getSheetPane(currRow,currCol);if((2==l||4==l)&&getNormalizedScrollLeft()>0&&(e.left=e.left-getNormalizedScrollLeft()),isColInViewPort(currCol)||(e.left=rowHeadWidth),isRTL){var t=e.left-1;"none"!=$("#docPanel").css("display")&&(t+=parseInt($("#docPanel").css("width"))),$("#cFC").css("right",t+"px"),document.getElementById("cFC").style.direction="rtl"}else $("#cFC").css("left",e.left-1+"px"),document.getElementById("cFC").style.direction="ltr"}function setDummySpanStyles(){Row.isHidden(currRow)||(dummySPAN.style.fontSize=getCurrentStyle(currCell,"fontSize"),dummySPAN.style.fontWeight=getCurrentStyle(currCell,"fontWeight"),dummySPAN.style.fontFamily=getCurrentStyle(currCell,"fontFamily"),contentHeight=getCellValueHeight("$"),setDummyCanvasStyles())}function setDummyCanvasStyles(){dummyCANVAS.font=getCurrentStyle(currCell,"fontWeight")+" "+getCurrentStyle(currCell,"fontSize")+" "+getCurrentStyle(currCell,"fontFamily")}function toCheckCFUnderOleObj(e,l,t,i){if(doOlePosCheck)return!1;var r=getColLeft(l?l:currCol),o=getRowTop(e?e:currRow),d=parseInt(t?t.style.width:cellField.style.width),s=r+d,a=parseInt(t?t.style.height:cellField.style.height),n=o+a,c=!1,u=ole.getObjects();doOlePosCheck=i?!1:!0;for(var C=0;C<u.length;C++){c=!1;var F=u[C],f=(F.id,F[isRTL?"right":"left"]),g=F.top,p=F.width,h=F.height,v=f+p,E=g+h,x=!1,S=!1,y=!1,R=!1,w=!1,O=!1;if(n>g&&E>n&&(x=!0),o>g&&E>n&&(S=!0),E>o&&n>E&&(y=!0),s>f&&v>s&&(R=!0),r>f&&v>s&&(w=!0),v>r&&s>v&&(O=!0),(x||S||y)&&(R||w||O)&&(c=!0),c){var m=F.getSelectLayer();m.classList.add("imagehideTrick"),$("#"+F.id).addClass("imagehideTrick"),oleObjectsAry.push(u[C].id)}}return c}function initMaxStylePropertyForSheet(){setMaxDimInViewPort(),contentNotReachedMaximumheight=!0,contentNotReachedMaximumWidth=!0,isMouseEventInSheetScrollBar=!1,sheetScrollLeftMaxInViewPort=getSheetScrollLeft()}function setCellFieldHeight(e,l){isTextWrapped||isMultilineInCellField()?setWrappedCellFieldHeight(e,l):setUnWrappedCellFieldHeight(e,l)}function setUnWrappedCellFieldHeight(e,l){var t="CELLFIELD"==l?cellField:exprField,i=ActiveCellInfo,r=i.getStartRow(),o=i.getEndRow(),d=i.getHeight();switch(ISFREEZED&&FREEZED_ROW>r&&o>=FREEZED_ROW&&(d=getRowTop(FREEZED_ROW)-getRowTop(ActiveCellInfo.getStartRow())),e){case"KEYUP":case"CUT":case"DELETE":case"BACKSPACE":if(isTextSelected(t))for(var s=getCountOfOccrnceOfCharInStr(getSelectedText(t),"\n");s>0;)cellContentHeight-=contentHeight,s-=1,requiredCellHeight>d&&decreaseRequiredCellFieldHeight();else cellContentHeight-=contentHeight,requiredCellHeight>d&&decreaseRequiredCellFieldHeight();setCellFieldSPANHeight(requiredCellHeight);break;case"PASTE":case"FOCUSMODE":cellContentHeight=-1!=cellField.value.indexOf("\n")?getCellContentHeightForMultiline(cellField.value):contentHeight,increaseRequiredCellFieldHeight(),setCellFieldSPANHeight(requiredCellHeight);break;case"UNDO":case"REDO":var a=t.value.indexOf("\n"),n=t.value.length;cellContentHeight=-1!=a?getCellContentHeightForMultiline(t.value):contentHeight,a!=n-1&&(cellContentHeight>=requiredCellHeight?increaseRequiredCellFieldHeight():decreaseRequiredCellFieldHeight(),setCellFieldSPANHeight(requiredCellHeight));break;case"SUGGEST":if(t==cellField){var c=getCellContentHeightForMultiline(t.value),u=requiredCellHeight,C=currRowOfCellfield;if(c>d)for(;c>u&&isRowExceedsMaxRow(row);)C+=1,u+=getRowHeight(C);setCellFieldSPANHeight(u)}break;case"EDITMODE":cellContentHeight=-1!=cellField.value.indexOf("\n")?getCellContentHeightForMultiline(cellField.value):contentHeight;var i=ActiveCellInfo;requiredCellHeight=i.getHeight(),setCellFieldSPANHeight(requiredCellHeight);break;default:cellContentHeight+=contentHeight,increaseRequiredCellFieldHeight(),setCellFieldSPANHeight(requiredCellHeight)}}function setCellFieldWidth(e){isTextWrapped?setCellFieldHeight(e):setUnWrappedCellFieldWidth(e)}function setUnWrappedCellFieldWidth(e){var l={};switch(l=isEditingInExprField?exprField:cellField,e){case"BACKSPACE":case"DELETE":var t=-1,i=-1,r="",o=-1;"BACKSPACE"==e?(t=posOfCaret-1,i=posOfCaret):"DELETE"==e&&(t=posOfCaret,i=posOfCaret+1),r=browser_ie?l.value.substring(l.value.substring(0,posOfCaret).lastIndexOf("\r\n")+1,-1!=l.value.indexOf("\r\n",posOfCaret+1)?l.value.indexOf("\r\n",posOfCaret):l.value.length):l.value.substring(l.value.substring(0,posOfCaret).lastIndexOf("\n")+1,-1!=l.value.indexOf("\n",posOfCaret+1)?l.value.indexOf("\n",posOfCaret):l.value.length),o=getCellValueWidth(r),o>requiredCellWidth&&(cellContentWidth=o),increaseRequiredCellFieldWidth(),setCellFieldSPANWidth(requiredCellWidth);break;case"PASTE":case"FOCUSMODE":cellContentWidth=-1!=cellField.value.indexOf("\n")?getMaxLineWidth(cellField.value.split("\n")):getCellValueWidth(cellField.value),increaseRequiredCellFieldWidth(),setCellFieldSPANWidth(requiredCellWidth);break;case"UNDO":case"REDO":cellContentWidth=-1!=cellField.value.indexOf("\n")?getMaxLineWidth(cellField.value.split("\n")):getCellValueWidth(cellField.value),requiredCellWidth>cellContentWidth?increaseRequiredCellFieldWidth():decreaseRequiredCellFieldWidth(),setCellFieldSPANWidth(requiredCellWidth);break;case"SUGGEST":var d=getColWidth(currCol),s=-1!=cellField.value.indexOf("\n")?getMaxLineWidth(cellField.value.split("\n")):getCellValueWidth(cellField.value),a=currColOfCellfield;if(s>d)for(;s>d&&isColExceedsMaxColumn(a);)a+=1,d+=getColWidth(a);setCellFieldSPANWidth(d);break;case"EDITMODE":cellContentWidth=-1!=cellField.value.indexOf("\n")?getMaxLineWidth(cellField.value.split("\n")):getCellValueWidth(cellField.value)+10;var n=ActiveCellInfo;requiredCellWidth=n.getWidth(),increaseRequiredCellFieldWidth(),setCellFieldSPANWidth(requiredCellWidth);break;default:var r="",o=-1,c=browser_safari||browser_firefox?14:10;r=-1!=l.value.indexOf("\n")?l.value.substring(l.value.substring(0,posOfCaret).lastIndexOf("\n")+1,-1!=l.value.indexOf("\n",posOfCaret)?l.value.indexOf("\n",posOfCaret):l.value.length):l.value,o=getCellValueWidth(r),o>cellContentWidth&&(cellContentWidth=o),cellContentWidth+c>requiredCellWidth&&(cellContentWidth+=c,increaseRequiredCellFieldWidth(),cellContentWidth-=c,setCellFieldSPANWidth(requiredCellWidth))}}function setWrappedCellFieldHeight(e){var l=-1,t=ActiveCellInfo,i=t.getStartRow(),r=t.getEndRow(),o=t.getHeight();ISFREEZED&&FREEZED_ROW>i&&r>=FREEZED_ROW&&(o=getRowTop(FREEZED_ROW)-getRowTop(ActiveCellInfo.getStartRow())),dummyTextArea.value=isEditingInExprField?cellField.value:exprField.value,(browser_safari||os_mac)&&dummyTextArea.scrollHeight>o&&(os_mac?dummyTextArea.style.width=requiredCellWidth+V_SCROLLBAR_WIDTH:browser_safari&&(dummyTextArea.style.width=requiredCellWidth+V_SCROLLBAR_WIDTH-1)),l=getCellValueWidth(-1!=dummyTextArea.value.indexOf(" ")?dummyTextArea.value.substring(dummyTextArea.value.lastIndexOf(" ")+1,dummyTextArea.value.length):dummyTextArea.value),cellField.scrollLeft=l+10>getColWidth(currCol)?l+50:0,getWrappedCellFieldHeight(e),setCellFieldSPANHeight(requiredCellHeight)}function cellFieldMouseUp(){var e=cellField;posOfCaret=getCaretPos(e);var l=e.value.substring(0,posOfCaret);isEditingInExprField?(initCellContentDetails(),setCellFieldWidth("FOCUSMODE"),setCellFieldHeight("FOCUSMODE","CELLFIELD"),e.scrollTop=0,e.scrollLeft=0,isEditingInExprField=!1):exprField.scrollTop=-1!=l.indexOf("\n")?EXPRCONTENTHEIGHT*l.split("\n").length-EXPRCONTENTHEIGHT:0;var t=e.id,i=$("#"+t);i.autocomplete("close"),formulaSyntaxTip.showTip(l,i),appEvent.trigger("cellField.MouseUp",[t])}function exprFieldMouseUp(e){appEvent.trigger("exprField.MouseUp",["Tv"]),isEditingInExprField=!0;var l=exprField;if(isCellFieldInNewMode()){posOfCaret=getCaretPos(l);var t=l.value.substring(0,posOfCaret);-1!=t.indexOf("\n")?(scrolledHeightForCellField=getCellContentHeightForMultiline(t)-contentHeight,cellField.scrollTop=scrolledHeightForCellField):cellField.scrollTop=0;var i=l.value.substring(0,browser_ie?posOfCaret+2:posOfCaret);cellFieldScrollLeft(i)}var r=$("#Tv");r.autocomplete("close"),formulaSyntaxTip.showTip(l.value.substring(0,getCaretPos(l)),r),e.stopPropagation()}function toggleExprField(){isEditingInExprField&&submitCell(),isExprFieldExpanded?collapseExprField():expandExprField(),appEvent.trigger("docpanel.resetDim")}function expandExprField(){$("#eFTCE").removeClass("fB_Exd"),exprField.style.height=EXPRFIELD_EXPAND_HEIGHT+"px",isExprFieldExpanded=!0,resetWorkSheetDim(),exprField.value=cellField.value,isCellFieldSPANHided()&&(exprField.value=getCellContent())}function collapseExprField(){$("#eFTCE").addClass("fB_Exd"),exprField.style.height=EXPRFIELD_COLLAPSE_HEIGHT+"px",isExprFieldExpanded=!1,resetWorkSheetDim(),exprField.value=cellField.value,isCellFieldSPANHided()&&(exprField.value=getCellContent())}function cellFieldScrollLeft(e){var l=-1!=e.indexOf("\n")?e.substring(e.lastIndexOf("\n")+1,e.length):e,t=getCellValueWidth(l);cellField.scrollLeft=t>maxCellFieldWidthInExprFieldNewMode-10?t-maxCellFieldWidthInExprFieldNewMode+25:0}function setCellFieldPosition(e,l){$("#cFC").css({top:l+"px",left:e+"px"})}function setFocusDIVPos(e,l){ole.currObj&&ole.isActive()&&!ole.onDrag&&ole.currObj.deSelect(),isNumber(e)&&isNumber(l)&&(e-=1,l-=1,isRTL?(focusDIV.style.right=e+"px",focusDIV.style.transform="scaleX(-1)"):(focusDIV.style.left=e+"px",focusDIV.style.transform=""),focusDIV.style.top=l+"px",ISFREEZED&&(isRTL?(focusDIV1.style.right=focusDIV2.style.right=focusDIV3.style.right=e+"px",focusDIV1.style.transform=focusDIV2.style.transform=focusDIV3.style.transform="scaleX(-1)"):(focusDIV1.style.left=focusDIV2.style.left=focusDIV3.style.left=e+"px",focusDIV1.style.transform=focusDIV2.style.transform=focusDIV3.style.transform=""),focusDIV1.style.top=focusDIV2.style.top=focusDIV3.style.top=l+"px"))}function setFocusDIVDim(e,l){isNumber(e)&&isNumber(l)&&(l=l+1+"px",e=e+1+"px",focusDIV.style.height=l,focusDIV.style.width=e,ISFREEZED&&(focusDIV1.style.height=focusDIV2.style.height=focusDIV3.style.height=l,focusDIV1.style.width=focusDIV2.style.width=focusDIV3.style.width=e))}function setDummyTextAreaStyles(){if(!Row.isHidden(currRow)&&(dummyTextArea.style.fontSize=getCurrentStyle(currCell,"fontSize"),dummyTextArea.style.fontWeight=getCurrentStyle(currCell,"fontWeight"),dummyTextArea.style.fontFamily=getCurrentStyle(currCell,"fontFamily"),dummyTextArea.style.width=requiredCellWidth+1,dummyTextArea.style.height="19px",browser_ie&&(dummyTextArea.style.width=requiredCellWidth+20+"px"),browser_safari||os_mac)){dummyTextArea.style.width=requiredCellWidth-2+"px",dummyTextArea.scrollTop>0&&(os_mac?dummyTextArea.style.width=requiredCellWidth+V_SCROLLBAR_WIDTH+"px":os_windows&&browser_safari&&(dummyTextArea.style.width=requiredCellWidth+V_SCROLLBAR_WIDTH-1+"px"));var e=parseInt(dummyTextArea.style.height)+dummyTextArea.scrollTop-2;e>parseInt(cellField.style.height)&&setCellFieldSPANHeight(e)}}function decreaseRequiredCellFieldHeight(){var e=ActiveCellInfo,l=e.getHeight(),t=e.getStartRow(),i=e.getEndRow();if(ISFREEZED&&FREEZED_ROW>t&&i>=FREEZED_ROW)var l=getRowTop(FREEZED_ROW)-getRowTop(e.getStartRow());for(;requiredCellHeight-getRowHeight(currRowOfCellfield)>cellContentHeight;){var r=getRowHeight(currRowOfCellfield);if(l>requiredCellHeight-r){contentNotReachedMaximumheight=!0;break}requiredCellHeight-=r,currRowOfCellfield-=1}}function increaseRequiredCellFieldHeight(){if(contentNotReachedMaximumheight){if(ISFREEZED){var e=ActiveCellInfo,l=e.getStartRow(),t=e.getEndRow(),i=getRowTop(FREEZED_ROW)-getRowTop(ActiveCellInfo.getStartRow());if(FREEZED_ROW>l&&t>=FREEZED_ROW&&requiredCellHeight>=i)return void(contentNotReachedMaximumheight=!1)}for(;cellContentHeight>requiredCellHeight;){if(!isRowExceedsMaxRow(currRowOfCellfield)){scrollTopCellField(),contentNotReachedMaximumheight=!1;break}if(currRowOfCellfield+=1,isCellFieldContentOverflowsViewPortHeight(currRowOfCellfield)){scrollTopCellField(),contentNotReachedMaximumheight=!1;break}var r=getRowHeight(currRowOfCellfield);if(ISFREEZED&&FREEZED_ROW>l&&t>=FREEZED_ROW&&requiredCellHeight+r>i){contentNotReachedMaximumheight=!1;break}requiredCellHeight+=r}}else scrollTopCellField()}function increaseRequiredCellFieldWidth(){if(contentNotReachedMaximumWidth)for(;cellContentWidth>requiredCellWidth;){if(!isColExceedsMaxColumn(currColOfCellfield)){wrapCellFieldValue("INCREASEWIDTH");break}if(currColOfCellfield+=1,parseInt($("#cFC").css(isRTL?"right":"left"))+parseInt(cellField.style.width)+getNormalizedScrollLeft()+getColWidth(currColOfCellfield)>getColLeft(totCols)){requiredCellWidth=window.innerWidth-parseInt($("#cFC").css(isRTL?"right":"left"))-14,wrapCellFieldValue("INCREASEWIDTH");break}if(isCellFieldContentOverflowsViewPortWidth(currColOfCellfield)){requiredCellWidth=sheetWidthMaxInViewPort-getColLeft(currCol),wrapCellFieldValue("INCREASEWIDTH");break}requiredCellWidth+=getColWidth(currColOfCellfield)}}function decreaseRequiredCellFieldWidth(){for(;requiredCellWidth-getColWidth(currColOfCellfield)>cellContentHeight;)requiredCellWidth-=getColWidth(currColOfCellfield),currColOfCellfield-=1}function scrollTopCellField(){var e="";e=isEditingInExprField?cellField.value.substring(0,posOfCaret):exprField.value.substring(0,posOfCaret),isTextWrapped?(dummyTextArea.value=e,scrolledHeightForCellField=dummyTextArea.scrollHeight+contentHeight):scrolledHeightForCellField=getCellContentHeightForMultiline(e),cellField.scrollTop=scrolledHeightForCellField}function getWrappedCellFieldHeight(e){cellContentHeight=dummyTextArea.scrollHeight,browser_ie&&"SCROLLSHEET"==e&&(cellContentHeight=dummyTextArea.scrollTop+19),"NORMAL"==e&&(cellContentHeight+=contentHeight),cellContentHeight>parseInt(cellField.style.height)?increaseRequiredCellFieldHeight():decreaseRequiredCellFieldHeight()}function wrapCellFieldValue(e){dummyTextArea.value=isEditingInExprField?cellField.value:exprField.value,setDummyTextAreaStyles(),getWrappedCellFieldHeight(e),isTextWrapped=!0,contentNotReachedMaximumWidth=!1,"SCROLLSHEET"!==e&&setCellFieldSPANHeight(requiredCellHeight)}function setMaxDimInViewPort(){sheetWidthMaxInViewPort=getSheetWidth()+getNormalizedScrollLeft(),sheetHeightMaxInViewPort=getSheetHeight()+getSheetScrollTop()}function AdjustScrollInIE(){var e=1e3;browser_ie&&(dummyTextArea.value=exprField.value,dummyTextArea.scrollTop=e)}function afterResetSheetDimension(e){(isCellEdited()||isEditingInExprField)&&(exprField.value=cellField.value),isCellEdited()&&(setMaxDimInViewPort(),isCellWrapped(currCell)||("SCROLL"==e?contentNotReachedMaximumWidth||(requiredCellWidth=sheetWidthMaxInViewPort-findCellLeft(currCell)-(V_SCROLLBAR_WIDTH-1),requiredCellWidth+getColLeft(currCol)<=getSheetTableWidth(),AdjustScrollInIE(),wrapCellFieldValue("SCROLLSHEET")):(requiredCellWidth=sheetWidthMaxInViewPort-findCellLeft(currCell)-(V_SCROLLBAR_WIDTH-1),requiredCellWidth+getColLeft(currCol)<=getSheetTableWidth()&&setCellFieldSPANWidth(requiredCellWidth),AdjustScrollInIE(),wrapCellFieldValue("SCROLLSHEET"))))}function addLineBreak(e){if(insertLineBreakAtSelection(),"CELLFIELD"==e)setCellFieldHeight("NORMAL","CELLFIELD"),browser_ie&&posOfCaret+2!=cellField.value.length&&(posOfCaret-=getCountOfOccrnceOfCharInStr(cellField.value.substring(0,posOfCaret),"\n")),browser_opera?setCaretPos(cellField,posOfCaret+2):setCaretPos(cellField,posOfCaret+1),scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.split("\n").length,exprField.scrollTop=scrolledHeightForExprField,contentNotReachedMaximumheight||(cellField.scrollTop=scrolledHeightForCellField);else{if(scrolledHeightForExprField=EXPRCONTENTHEIGHT*cellField.value.split("\n").length,exprField.scrollTop=scrolledHeightForExprField,isCellFieldInEditMode()?setCellFieldHeight("NORMAL","EXPRFIELD"):isCellFieldInNewMode()&&(scrolledHeightForCellField=getCellContentHeightForMultiline(exprField.value),cellField.scrollTop=scrolledHeightForCellField,cellField.scrollLeft=0),browser_ie&&posOfCaret+2!=exprField.value.length){var l=getCountOfOccrnceOfCharInStr(exprField.value.substring(0,posOfCaret),"\n");posOfCaret-=l}browser_opera?setCaretPos(exprField,posOfCaret+2):setCaretPos(exprField,posOfCaret+1)}}function hideCellFieldSPAN(){hideCellField(),isF2KeyPressed=!1,isDblClicked=!1,isenterKeyPressed=!1}function isCellFieldSPANHided(){return cellField?(isUndefined(isCellFieldSPANHided.isHided)&&(isCellFieldSPANHided.isHided=!0),isCellFieldSPANHided.isHided):void 0}function hideCellField(){if(cellField.value="",cellField.className=" cF",cellField.style.backgroundColor="transparent",cellField.style.color="transparent",$("#cF").css("border",""),$("#cFC").css("zIndex","-1"),$("#showCell").css("display","none"),diminishCellField(),doOlePosCheck)for(var e=0;e<oleObjectsAry.length;e++){var l=OLE[oleObjectsAry[e]],t=l.getSelectLayer();t.classList.remove("imagehideTrick"),$("#"+oleObjectsAry[e]).removeClass("imagehideTrick")}doOlePosCheck=!1,oleObjectsAry=[];{var i=findThirdPaneYPos();getSheetScrollTop()+parseInt((getSheetPaneHeight()-i)/2)+i}UTIL.DOM.addClass(cellField,"noBoxShadow"),RangeSelector.isActive()&&RangeSelector.off(),gridFormulaEditController.isFormula()&&gridFormulaEditController.off(),setFocusInCellField(),isCellFieldSPANHided.isHided=!0}function diminishCellField(){var e="0px";browser_safari&&(e="1px"),cellField.style.width=e,cellField.style.height=e}var cellFieldDom=$(".cF");appEvent.on("book.onaftersheetswitch",function(){RangeSelector.isActive()&&CURRSHEETNAME!==RangeSelector.returnsourceSheet()&&setTimeout(function(){focusDIV.style.visibility="hidden"},50)});var focusDIVBufferSize=200,focusDIVIncrementCount=3;
function submitCell(e,t){if(DataValidation.isDvErrorThrown()!==!0){if(ActiveCellInfo.isEditingCellDeleted)return resetGlobalVariables(),showAlertDialog(jsMsg["Error.Cell.Deleted"]),!1;if(!isEditorClosed&&isSSActive&&(READ_WRITE||t)){if("hide"==getCellContent(currCell,"fn")&&jsPUBLIC_VIEW&&!showFormulas)return void resetGlobalVariables();formulaSyntaxTip.hideMe();var o="";isRangeSelection=!1,""!=tempFocusRow&&""!=tempFocusCol&&(focusCell(tempFocusRow,tempFocusCol),tempFocusRow="",tempFocusCol=""),o=isEditingInExprField?exprField.value:cellField.value,!isNaN(parseInt(o))&&currCell&&(currCell.style.justify="right");var a=o;if(e||(e=!1),pivot.Collection.isPivotRange(currRow,currCol,currRow,currCol))return showAlertDialog(jsMsg["Error.Pivot.Table.Part.Change"]),!1;if(isPartOfArray(currRow,currCol,currRow,currCol)&&!e)return showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray),!1;clearOldArrayPosition(currRow,currCol,currRow,currCol);var r,l,s,n;if(e){var i=getCellRange();if(r=i.startRow,l=i.startCol,s=i.endRow,n=i.endCol,pivot.Collection.isPivotRange(r,l,s,n))return showAlertDialog(jsMsg["Error.Pivot.Table.Part.Change"]),!0;if(isPartOfArray(r,l,s,n)){if(r!=s||l!=n)return void showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray);var d=getArray(r,l);null!=d&&(r=d[0],s=d[1],l=d[2],n=d[3]),clearOldArrayPosition(r,l,s,n)}else{if(cellRangeContainsMergeCells(r,l,s,n))return showAlertDialog(jsMsg.ArrayFormulasAreNotValidInMergedCells),!1;clearOldArrayPosition(r,l,s,n)}if(ProtectedRanges.isRangeLocked(r,l,s,n))return;clearOldArrayPosition(r,l,s,n)}var R,c,C=a,u=null,g=WorkSheets.getAssociatedActiveSheetName();if(t){var E=t.sheetName;g=WorkSheets.getSheetCodeFromName(E),R=t.row,c=t.col,C=t.value}else{R=ActiveCellInfo.getStartRow(),c=ActiveCellInfo.getStartCol(),cellRangeStartRow=currRow,cellRangeStartCol=currCol,cellRangeEndRow=currRow,cellRangeEndCol=currCol;var w=replace(a,"\n","<br>"),h=!1;isNaN(w)||(h=!0);var f=new Cell(currRow,currCol);f.executeMethod(function(e){if(appEvent.trigger("cell.setcontent",[e,currRow,currCol,totCols,a]),setCellContent(e,a),h){e.className}}),cellField.value=""}if((ClipSheet.getClipObject().hasClip()||ClipRange.getClipObject().hasClip())&&ClipObject.clearClip(),C.length>32768)return showAlertDialog(jsMsg.ErrorExceedingSubmitData),resetCurrCellValue(),!1;appEvent.trigger("cell.onBeforeSubmit",[{row:R,col:c,v:C}]);var S=new RequestParameters(ActionConstants.SUBMIT),v=getServerRange(r,l,s,n);e||(v=getServerRange(R,c,s,n)),S.setParameters(g,encodeURIComponent(C),e,v.startRow,v.startCol,v.endRow,v.endCol,u,DataValidation.validateDV);var p=new AjaxRequest;p.init("POST",S.getURL(),!0,S.getParametersAsString()),p.addEventListener("onComplete",function(e){if(submitCallBack.action){var t=parseJSON(e.responseText);fireRegisteredEvent(),submitCallBack[ResponseKey.QUEUED]=t[ResponseKey.QUEUED]}DataValidation.validateDV=void 0}),actionManager.addRequest(p),resetGlobalVariables();var m=ActiveCellInfo;m.getEndRow()+1===totRows&&appendBlankRows(),m.getEndCol()+1===totCols&&m.getEndCol()+1<getColMax()&&insertCol("append",totCols,1,!1,!0,!1)}}}function deleteCell(e){if(READ_WRITE){"undefined"==typeof e&&(e="ClearContent");var t=getCellRange();if(void 0!=Merge.getCellInfo(t.startRow,t.startCol)&&!Merge.isCovered(t.startRow,t.startCol)){var o=Merge.getCellInfo(t.startRow,t.startCol);t.endRow=t.endRow<o.endRow?o.endRow:t.endRow,t.endCol=t.endCol<o.endCol?o.endCol:t.endCol}if(!ProtectedRanges.isRangeLocked(t.startRow,t.startCol,t.endRow,t.endCol)){var a=getViewPortRoundedDetails(t.startRow,t.endRow),r=ActionConstants.CLEARALL;if("ClearStyles"!==e){if(isPivotOrArrayRange(t.startRow,t.startCol,t.endRow,t.endCol))return;clearOldArrayPosition(t.startRow,t.startCol,t.endRow,t.endCol),a.isInViewPort&&clearContents(a.startRowIdx,t.startCol,a.endRowIdx,t.endCol,null,!0),a.isInFreezedRange&&clearContents(a.freezedStartRowIdx,t.startCol,a.freezedEndRowIdx,t.endCol,null,!0),"ClearContent"===e&&(r=ActionConstants.CLEARCONTENTS)}"ClearContent"!==e&&(a.isInViewPort&&clearFormatting(a.startRowIdx,t.startCol,a.endRowIdx,t.endCol),a.isInFreezedRange&&clearFormatting(a.freezedStartRowIdx,t.startCol,a.freezedEndRowIdx,t.endCol),"ClearStyles"===e&&(r=ActionConstants.CLEARSTYLES));var l=getServerRange(t.startRow,t.startCol,t.endRow,t.endCol),s=new RequestParameters(r);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),t.startRow,t.startCol,l.endRow,l.endCol);var n=new AjaxRequest;n.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(n)}}}function setOptimalSize(e){var t=getCellRange();switch(e.toUpperCase()){case"WIDTH":width_height_action("OptimalWidth","",t.startCol,t.endCol);break;case"HEIGHT":width_height_action("OptimalHeight","",t.startRow,t.endRow)}}function width_height_action(e,t,o,a,r){var l="";switch(isUndefined(r)&&(r="false"),e){case"width":if("undefined"==typeof t){if(t=getObj("promptTxt").value,t=Number(t),isNaN(t)||0>=t)return showAlertDialog("Enter a positive number to set the width"),!1}else t=t;if(t=parseInt(t),t>0){if(isCellRange()||"undefined"!=typeof o){var s=getCellRange();startCol="undefined"!=typeof o?o:s.startCol,endCol="undefined"!=typeof a?a:s.endCol}else startCol=currCol,endCol=currCol;"true"==ISSAMESHEET&&(isUpdateClientFirst&&setSheetColumnsWidth(startCol,endCol,t),sheetdialog.close());var n=new RequestParameters(ActionConstants.WIDTH);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),null,startCol,null,isWholeSheetSelected()?getColMax()-1:endCol,parseFloat(t),!1);var i=new AjaxRequest;i.init("POST",n.getURL(),!0,n.getParametersAsString()),actionManager.addRequest(i)}break;case"height":if("undefined"==typeof t){if(t=getObj("promptTxt").value,t=Number(t),isNaN(t)||0>=t)return showAlertDialog("Enter a positive number to set the height"),!1}else t=t;if(t=parseInt(t),!(t>0))return;if(isCellRange()||"undefined"!=typeof o){var s=getCellRange();startRow="undefined"!=typeof o?o:s.startRow,endRow="undefined"!=typeof a?a:s.endRow}else startRow=currRow,endRow=currRow;"true"==ISSAMESHEET&&(browser_safari&&rowHead.scrollTop!=sheetPane.scrollTop&&setScrollTop(rowHead.scrollTop),sheetdialog.close());var n=new RequestParameters(ActionConstants.HEIGHT);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),startRow,null,isWholeSheetSelected()?getRowMax()-1:endRow,null,parseFloat(t),!1);var i=new AjaxRequest;i.init("POST",n.getURL(),!0,n.getParametersAsString()),actionManager.addRequest(i);break;case"OptimalWidth":var s=getCellRange();if(s.startCol<=o&&o<=s.endCol)var d=s.startCol,R=s.endCol;else var d=o,R=a;var n=new RequestParameters(ActionConstants.WIDTH);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),null,d,null,isWholeSheetSelected()?getColMax()-1:R,null,!0);var i=new AjaxRequest;i.init("POST",n.getURL(),!0,n.getParametersAsString()),actionManager.addRequest(i);break;case"OptimalHeight":var s=getCellRange();if(s.startRow<=o&&o<=s.endRow)var d=s.startRow,R=s.endRow;else var d=o,R=a;var n=new RequestParameters(ActionConstants.HEIGHT);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),d,null,isWholeSheetSelected()?getRowMax()-1:R,null,null,!0);var i=new AjaxRequest;i.init("POST",n.getURL(),!0,n.getParametersAsString()),actionManager.addRequest(i);break;case"HIDE_ROWS":var c=getCellRange();l="startRow="+o+"&endRow="+a+"&startColumn="+c.startCol+"&endColumn="+c.endCol+"&type=hide",l+="&totalRows="+totRows+"&curtime="+CURRENTTIME+"&sheetname="+encodeURIComponent(CURRSHEETNAME);break;case"UNHIDE_ROWS":var c=getCellRange();l="startRow="+o+"&endRow="+a+"&startColumn="+c.startCol+"&endColumn="+c.endCol+"&type=unhide",l+="&totalRows="+totRows+"&curtime="+CURRENTTIME+"&sheetname="+encodeURIComponent(CURRSHEETNAME)}l+="&fromUNDO="+WIDTHHEIGHTUNDO,WIDTHHEIGHTUNDO=!1}function submitScrollForm(e,t,o,a,r,l,s){if(errorMsgShown&&restrictScroll){if(r&&r.onFailure){var n=r.onFailure.params?r.onFailure.params:[];r.onFailure.method.apply(void 0,n)}}else{var i;if(a&&(i=Row.getAvailableRowsInFrozenRange(FREEZED_ROW),i[0]===e[0]&&(i=[]),e=i.concat(e)),e.length){if(!isRespondedInScroll&&!s)return void(r&&r.onWait&&(r.onWait.params.unshift(r.onWait.method),Thread.getThread("scroll").wait.apply(Thread.getThread("scroll"),r.onWait.params)));if(isRespondedInScroll||s){var d=getSheetHeight(),R=getSheetTableHeight(),c=0,C=totCols,u=1.25*ROWS_PER_TILE*getColMax(),g=(endRow-startRow)*(C-c);if(g>u){for(var E=ROWS_PER_TILE*totCols,w=0;g>u;)g-=E,w+=1;"SCROLLDOWN"==t?endRow-=w*ROWS_PER_TILE:"SCROLLUP"==t&&(startRow+=w*ROWS_PER_TILE)}if(d>R){for(;d>R&&!(totRows>=getRowMax());)R+=getRowHeight(totRows),totRows+=1;totRows=getCeilRow(totRows),setSheetTableHeight(getRowTop(totRows-1)+getRowHeight(totRows-1)),endRow=totRows}isChangeMadeAfterScroll=!1,isRespondedInScroll=!1,r&&r.onBeforeSend&&r.onBeforeSend.method.apply(void 0,r.onBeforeSend.params);var h=new RequestParameters(ActionConstants.SCROLL),f=!!r&&r.isExecuteActionIdNeeded,S=f?getSheetHeight():void 0;if(jsPUBLIC_VIEW)h.setParameters(WorkSheets.getAssociatedActiveSheetName(),0,totCols-1,t,e.toString(),f,S,showFormulas,null,null,null,isVeryFirstScroll,Math.round(getSheetScrollTop()),l);else if(!jsVERSION_VIEW||cdview)h.setParameters(WorkSheets.getAssociatedActiveSheetName(),0,totCols-1,t,e.toString(),f,S,null,null,null,null,isVeryFirstScroll,Math.round(getSheetScrollTop()),l);else{var v=jsVERSION_VIEW&&""==DOCUMENT_VERSION?!0:void 0,p=!1,m=!1;"undefined"!=typeof AuditTrail&&(p=AuditTrail.highlightChanges,m=AuditTrail.isCloseVersionHistory),h.setParameters(WorkSheets.getAssociatedActiveSheetName(),0,totCols-1,t,e.toString(),f,S,null,p,m,v,isVeryFirstScroll,Math.round(getSheetScrollTop()),l,DOCUMENT_VERSION)}var A=new AjaxRequest;A.init("POST",h.getURL(),!0,h.getParametersAsString()),A.addEventListener("onComplete",function(e,t){isVeryFirstScroll&&insertImage.loadSheetImages(),isVeryFirstScroll=void 0;parseJSON(e.responseText);updateTile(e.responseText,e.status,void 0,t,o,a,i,l)},r),A.addEventListener("onError",function(e,t){if(isRespondedInScroll=!0,Thread.getThread("scroll").notifyAll(),t&&t.onFailure){var o=t.onFailure.params?t.onFailure.params:[];t.onFailure.method.apply(void 0,o)}try{var a=JSON.parse(e.responseText)}catch(e){}a||(a=ErrorMsg.getDefaultErrorMsg()),ErrorMsg.show(a)},r),A.sendRequest()}}else if(r&&r.onFailure){var n=r.onFailure.params?r.onFailure.params:[];r.onFailure.method.apply(void 0,n)}}}function updateTile(e,t,o,a,r,l,s,n){if(isRespondedInScroll=!0,Thread.getThread("scroll").notifyAll(),errorMsgShown&&restrictScroll){if(a&&a.onFailure){var i=a.onFailure.params?a.onFailure.params:[];a.onFailure.method.apply(void 0,i)}return void message("","none")}if(errorMsgShown&&isCollabJoined&&(READ_WRITE=!1),""!=e){try{var d=parseJSON(e)}catch(e){if(a&&a.onFailure){var i=a.onFailure.params?a.onFailure.params:[];a.onFailure.method.apply(void 0,i)}return}hideRowNoInfo();var R=d[0],c=R[0],C=R[1],u=R[2],g=u[0],E=g[0],w=(g[g.length-1],u[1]),h=u[2],f=R[3],S=d.showGrid,v=r,p=d.executedActionId,m=d.SHEETNAMES,A=d.ASC_SHEET_NAME;updateSheetObjects(p,m,A);var T=d.u,I=d.r,O=d.fr;if(void 0!==S&&gridFunctionality(S?"show":"hide"),a&&a.tileUpdateBreaker){var P=a.tileUpdateBreaker.call(void 0,p);if(P){if(a.onFailure){var i=a.onFailure.params?a.onFailure.params:[];a.onFailure.method.apply(void 0,i)}return}}if(v){var F={fakeReload:v,reloadFrozenRows:l,frozenRows:s},b=Row.getAvailableRows();Merge.remove(b[0],0,b[b.length-1],getTotalColumn())}var D=d[1],M=D[0],y=D[2];if(D[4])var N=D[4];if(c==DOCUMENT_ID&&C==CURRSHEETNAME||jsVERSION_VIEW){switch(M){case 0:M="SCROLLDOWN";break;case 1:M="SCROLLUP"}var W=(getAvailableStartRow(),getAvailableEndRow(),!0);if(window.isFakeReloadModeOn=!1,p){var H=d[ActionConstants.HEIGHT],L=d[ActionConstants.WIDTH];if(H){filterMetaInfo=D[5],filterMetaInfo&&0!==Object.keys(filterMetaInfo).length?Filter.create(CURRSHEETNAME,filterMetaInfo,filterMetaInfo.fc,!0):(filterMetaInfo=void 0,Filter.remove());var _;_=isArray(H)?H:JSON.parse(H),setRowDetails("RANGEOBJ",_)}L&&setColDetails("RANGEOBJ",void 0,void 0,void 0,L),d.usedRow&&(usedCursRow=d.usedRow,totRows=usedCursRow,totRows=Math.max(usedCursRow,Row.findMaxRowToRender()),totalTableHeight=totRows>0?getRowTop(totRows-1)+getRowHeight(totRows-1):0,setSheetTableHeight(totalTableHeight)),d.usedCol&&(usedCursCol=d.usedCol,totCols=Math.max(usedCursCol+1,h+1),h=totCols-1,totalTableWidth=getColLeft(totCols-1)+getColWidth(totCols-1),setSheetTableWidth(totalTableWidth)),insertColHeadTable()}if(O){var V=O[0],k=O[1];if(V!=FREEZED_ROW||k!=FREEZED_COL){var U="";U=0==V?"COLS":0==k?"ROWS":"ROWS/COLS";var x=SHEET.dom.freeze;0!=V||0!=k?ISFREEZED?(SHEET.FREEZE.setVars(V,k),SHEET.dom.freeze.setCues(V,k),x.setSheetPanesDim(U)):(menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePane",action:"disable",callback:zbutton_hide,args:["showgrid"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"unfreezePane",action:"enable",callback:zbutton_show_mouseout,args:["unfreezePane"]}),SHEET.dom.freeze.setCues(V,k),SHEET.FREEZE.customizeDom(V,k,!0,!0),SHEET.FREEZE.setVars(V,k)):(x.mergeSheetPanes(),x.hideSheetPanes(),x.resetSheetPaneDim(),SHEET.FREEZE.resetVariables()),updateViewPort(void 0,a,A,m,p)}jsVERSION_VIEW&&(secondPaneLeft=fourthPaneLeft=getColLeft(k),thirdPaneTop=fourthPaneTop=getRowTop(V),SHEET.FREEZE.customizeDom(FREEZED_ROW,FREEZED_COL,!0,!1),SHEET.dom.freeze.setCues(FREEZED_ROW,FREEZED_COL),FREEZED_ROW&&(rowHead1.style.height=getRowTop(FREEZED_ROW)+"px"),rowHead.style.height=sheetPane.style.height,FREEZED_COL&&(colHead1.style.width=getColLeft(FREEZED_COL)+"px"),colHead.style.width=sheetPane.style.width)}var j=!0;if(updateRowDetails(g),v&&n&&(setScrollTop(FREEZED_ROW>n?0:getRowTop(n)),prevScrollTop=getSheetScrollTop()),insertTiles(M,f,g,w,h,j,F),Logger.isEnabled&&(Logger.storeSomething("rowsAry:",g),Logger.storeSomething("mergeDetails",y)),Merge.update(y,E),W&&N)for(var q=N,z=0;z<q.length;z++)updateJson(q[z]);"undefined"!=typeof WebMessanger.getRawSid()&&updateViewPort(void 0,a,A,m,p),void 0!=T&&setUNDO(T),void 0!=I&&setREDO(I);var B=R[5];if(B){B=decodeURIComponent(B);for(var Z=B.substring(1,B.length-1).split(","),z=0;z<Z.length;z++){var J=CellUtils.getRangeFromCellLbl(Z[z].trim());checkbox.addToRange(J.startRow,J.startCol,J.endRow,J.endCol)}}for(var G=R[4],Y=G,z=0;z<Y.length;z++)updateRangeStyleJson(Y[z],!0,!1,!0);var K=!1;if(updateTileCallbackInfo.isCallbackAvailable){var K=!0;updateTileCallbackInfo.isCallbackAvailable=!1;var Q=updateTileCallbackInfo.actionDetails;switch(Q.action){case"FREEZE":Q.callbackMethod(Q.freezeeRow,Q.freezeeCol,Q.afterRTC,Q.jsOnly);break;case"SHEET_OPEN":Q.callbackMethod();break;default:Q.callbackMethod()}}var X=d.chartsInfo;X&&chartOnLoad.reloadChartsInfo(X);var $=d.protectionInfo;$&&ProtectedRanges.getObject().updateResponse($);var et=d[JSONConstants.PIVOT_DETAILS];if(et)for(var tt=JSON.parse(decodeURIComponent(JSON.stringify(et))),ot=0;ot<tt.length;ot++){var at=tt[ot];pivot.Collection.remove(at[JSONConstants.ID]),PivotUtil.createPivotObject(at)}d.vc&&AuditTrail.addToCellsJson(d.vc),!jsVERSION_VIEW||cdview||isPreview||AuditTrail.showViewPortVersionChanges(),focusSheet(),!updateTileCallbackInfo.isCallbackAvailable&&K&&(updateTileCallbackInfo.actionDetails=void 0),(browser_safari||browser_ie)&&(jsEMBED_VIEW||activateCellField())}(documentBakeStatus.isBaked()||jsREMOTE_VIEW||jsVERSION_VIEW)&&message("","none")}else if(a&&a.onFailure){var i=a.onFailure.params?a.onFailure.params:[];a.onFailure.method.apply(void 0,i)}}function updateViewPort(e,t,o,a,r){if(documentBakeStatus.isBaked()){var l=new RequestParameters(ActionConstants.UPDATE_VIEWPORT),s=Row.getVisibleRowsInViewPortAsJSONStr(!1),n='[{"sc": 0 ,"ec":'+(totCols-1)+"}]";appEvent.trigger("viewport.update",[s]),l.setParameters(WorkSheets.getAssociatedActiveSheetName(),s,n,totRows,totCols,FREEZED_ROW);var i=new AjaxRequest;i.init("POST",l.getURL(),!0,l.getParametersAsString()),i.addEventListener("onComplete",function(){if(t&&t.onAfterComplete){var e=t.onAfterComplete.params?t.onAfterComplete.params:[];t.isExecuteActionIdNeeded&&t.isXaidToBeAppended&&(e.unshift(o),e.unshift(a),e.unshift(r)),t.onAfterComplete.method.apply(void 0,e)}}),i.sendRequest(),appEvent.trigger("viewport.afterUpdate",[])}}var reloadFrozenRows=!1,isVeryFirstScroll=!0;
function beforeFillSeries(){if(isCellEdited()&&submitCell(),fillseriesrange=isCellRange()?!0:!1,isCellRange()){var e=getCellRange();beforeFillSeriesStartR=e.startRow,beforeFillSeriesStartC=e.startCol,beforeFillSeriesEndR=e.endRow,beforeFillSeriesEndC=e.endCol}else{var l=ActiveCellInfo;beforeFillSeriesStartR=l.getStartRow(),beforeFillSeriesStartC=l.getStartCol(),beforeFillSeriesEndR=l.getEndRow(),beforeFillSeriesEndC=l.getEndCol()}fillRow=beforeFillSeriesEndR,fillCol=beforeFillSeriesEndC,selRow=beforeFillSeriesEndR,selCol=beforeFillSeriesEndC,selectionLeft=getEndLeftOfCol(beforeFillSeriesEndC),selectionTop=getEndTopOfRow(beforeFillSeriesEndR),cellRangeContainsMergeCells(beforeFillSeriesStartR,beforeFillSeriesStartC,beforeFillSeriesEndR,beforeFillSeriesEndC)&&(fillSeriesProps.isMergeCellExists=!0,fillSeriesProps.mergedRightColSpan=beforeFillSeriesEndC-beforeFillSeriesStartC+1,fillSeriesProps.mergedRightEndCol=beforeFillSeriesEndC+fillSeriesProps.mergedRightColSpan,fillSeriesProps.mergedRightEndCol>totCols-1&&(fillSeriesProps.mergedRightEndCol=totCols-1),fillSeriesProps.mergedBottomRowSpan=beforeFillSeriesEndR-beforeFillSeriesStartR+1,fillSeriesProps.mergedBottomEndRow=beforeFillSeriesEndR+fillSeriesProps.mergedBottomRowSpan,fillSeriesProps.mergedBottomEndRow>totRows-1&&(fillSeriesProps.mergedBottomEndRow=totRows-1),fillSeriesProps.mergedLeftColSpan=beforeFillSeriesEndC-beforeFillSeriesStartC+1,fillSeriesProps.mergedLeftEndCol=beforeFillSeriesStartC-fillSeriesProps.mergedLeftColSpan,fillSeriesProps.mergedLeftEndCol<0&&(fillSeriesProps.mergedLeftEndCol=0),fillSeriesProps.mergedTopRowSpan=beforeFillSeriesEndR-beforeFillSeriesStartR+1,fillSeriesProps.mergedTopEndRow=beforeFillSeriesStartR-fillSeriesProps.mergedTopRowSpan,fillSeriesProps.mergedTopRowSpan<0&&(fillSeriesProps.mergedTopRowSpan=0))}function focusFillSeries(e){if(READ_WRITE){var l=appEvent.isDefaultPrevented(appEvent.trigger("cell.focusFillSeries"));l||(stopEvt(e),beforeFillSeries(),document.addEventListener("mousemove",selectAutoFill,!1),document.addEventListener("mouseup",endAutoFill,!1))}}function selectAutoFill(e){clearTextSelection(),autoFillSeries=!0,changeCursor(!0,e);{var l=scrollHelper.pointerOffsetPosCalculator(e,!0,!0),r=beforeFillSeriesStartR,i=beforeFillSeriesEndR,s=beforeFillSeriesStartC,o=beforeFillSeriesEndC;getCell(i,o),getCell(r,s)}if(l.y>getEndTopOfRow(i)){var t=l.y>selectionTop?increaseReqCellTop(l.y,selRow,selectionTop):decreaseReqCellTop(l.y,selRow,selectionTop);selRow=t.row,selectionTop=t.top,isMouseCursorYInViewPort(l.y)?(clearInterval(sheetScrollTopId),fillSeriesProps.isMergeCellExists?(selRow>fillSeriesProps.mergedBottomEndRow&&(fillSeriesProps.mergedBottomEndRow=fillSeriesProps.mergedBottomEndRow+fillSeriesProps.mergedBottomRowSpan,fillSeriesProps.mergedBottomEndRow>totRows-1&&(fillSeriesProps.mergedBottomEndRow=totRows-1)),focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,fillSeriesProps.mergedBottomEndRow,beforeFillSeriesEndC)):focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,selRow,beforeFillSeriesEndC)):focusCellRangeforAutoFill(beforeFillSeriesEndR,beforeFillSeriesStartC,selRow,beforeFillSeriesEndC),direction="TO_BOTTOM"}else if(l.y<getRowTop(r)){var t=l.y<selectionTop?decreaseReqCellTop(l.y,selRow,selectionTop):increaseReqCellTop(l.y,selRow,selectionTop);selRow=t.row,selectionTop=t.top,isMouseCursorYInViewPort(l.y)?(clearInterval(sheetScrollTopId),fillSeriesProps.isMergeCellExists?(selRow<fillSeriesProps.mergedTopEndRow&&(fillSeriesProps.mergedTopEndRow=fillSeriesProps.mergedTopEndRow-fillSeriesProps.mergedTopRowSpan,fillSeriesProps.mergedTopEndRow<0&&(fillSeriesProps.mergedTopEndRow=0)),focusCellRangeforAutoFill(beforeFillSeriesEndR,beforeFillSeriesStartC,fillSeriesProps.mergedTopEndRow,beforeFillSeriesEndC)):focusCellRangeforAutoFill(beforeFillSeriesEndR,beforeFillSeriesStartC,selRow,beforeFillSeriesEndC)):focusCellRangeforAutoFill(beforeFillSeriesEndR,beforeFillSeriesStartC,selRow,beforeFillSeriesEndC),direction="TO_TOP"}else if(l.x>getEndLeftOfCol(o)){var S=l.x>selectionLeft?increaseReqCellLeft(l.x,selCol,selectionLeft):decreaseReqCellLeft(l.x,selCol,selectionLeft);selCol=S.col,selectionLeft=S.left,isMouseCursorXInViewPort(l.x)?("undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),fillSeriesProps.isMergeCellExists?(selCol>fillSeriesProps.mergedRightEndCol&&(fillSeriesProps.mergedRightEndCol=fillSeriesProps.mergedRightEndCol+fillSeriesProps.mergedRightColSpan,fillSeriesProps.mergedRightEndCol>totCols-1&&(fillSeriesProps.mergedRightEndCol=totCols-1)),focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,beforeFillSeriesEndR,fillSeriesProps.mergedRightEndCol)):focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,beforeFillSeriesEndR,selCol)):focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,beforeFillSeriesEndR,selCol),direction="TO_RIGHT"}else if(l.x<getColLeft(s)){var S=l.x<selectionLeft?decreaseReqCellLeft(l.x,selCol,selectionLeft):increaseReqCellLeft(l.x,selCol,selectionLeft);selCol=S.col,selectionLeft=S.left,isMouseCursorXInViewPort(l.x)?("undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),fillSeriesProps.isMergeCellExists?(selCol<fillSeriesProps.mergedLeftEndCol&&(fillSeriesProps.mergedLeftEndCol=fillSeriesProps.mergedLeftEndCol-fillSeriesProps.mergedLeftColSpan,fillSeriesProps.mergedLeftEndCol<0&&(fillSeriesProps.mergedLeftEndCol=0)),focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesEndC,beforeFillSeriesEndR,fillSeriesProps.mergedLeftEndCol)):focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesEndC,beforeFillSeriesEndR,selCol)):focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesEndC,beforeFillSeriesEndR,selCol),direction="TO_LEFT"}else focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,beforeFillSeriesEndR,beforeFillSeriesEndC),direction="";if(ISFREEZED){var f=getCursorPos(e);(f.y>sheetTop+findThirdPaneYPos()||f.y<=sheetTop)&&scrollHelper.scrollSheetVertical(y,fillSeriesCellRange),(f.x>=sheetLeft+findSecondPaneXPos()||f.x<sheetLeft+findSecondPaneXPos())&&beforeFillSeriesStartC>FREEZED_COL&&scrollHelper.scrollSheetHorizontal(x,fillSeriesCellRange)}else scrollHelper.scrollSheetVertical(l.y,fillSeriesCellRange),scrollHelper.scrollSheetHorizontal(l.x,fillSeriesCellRange)}function endAutoFill(e){document.removeEventListener("mousemove",selectAutoFill,!1),document.removeEventListener("mouseup",endAutoFill,!1),"undefined"!=typeof sheetScrollTopId&&clearInterval(sheetScrollTopId),"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),changeCursor(!1,e),hideFillSeriesDIV(),hideFillSeriesSPAN();var l=fillStartCol,r=fillEndCol,i=fillStartRow,s=fillEndRow;if(autoFillSeries&&focusCellRange(i,l,s,r,"FILLSERIES"),""!=direction){ctrlkey=e.ctrlKey||e.metaKey?"TRUE":"FALSE";var o,t,S,f;if("TO_BOTTOM"==direction){if(sourcecnt=beforeFillSeriesEndR-beforeFillSeriesStartR+1,ProtectedRanges.isRangeLocked(i+sourcecnt,l,s,r))return void fillSeriesProps.reset();fillSeriesProps.isMergeCellExists?(fillSeriesProps.selectedStartRow=beforeFillSeriesEndR+1,fillSeriesProps.selectedStartCol=l,fillSeriesProps.selectedEndRow=fillSeriesProps.mergedBottomEndRow,fillSeriesProps.selectedEndCol=r):(fillSeriesProps.selectedStartRow=i,fillSeriesProps.selectedStartCol=l,fillSeriesProps.selectedEndRow=s,fillSeriesProps.selectedEndCol=r),o=beforeFillSeriesEndR+1,t=fillSeriesProps.selectedStartCol,S=fillSeriesProps.selectedEndRow,f=fillSeriesProps.selectedEndCol}else if("TO_TOP"==direction){if(sourcecnt=beforeFillSeriesEndR-beforeFillSeriesStartR+1,i=fillEndRow,s=fillStartRow,ProtectedRanges.isRangeLocked(i+sourcecnt,l,s-sourcecnt,r))return void fillSeriesProps.reset();fillSeriesProps.isMergeCellExists?(fillSeriesProps.selectedStartRow=beforeFillSeriesStartR-1,fillSeriesProps.selectedStartCol=l,fillSeriesProps.selectedEndRow=fillSeriesProps.mergedTopEndRow,fillSeriesProps.selectedEndCol=r):(fillSeriesProps.selectedStartRow=i,fillSeriesProps.selectedStartCol=l,fillSeriesProps.selectedEndRow=s,fillSeriesProps.selectedEndCol=r),o=beforeFillSeriesStartR-1,t=fillSeriesProps.selectedStartCol,S=fillSeriesProps.selectedEndRow,f=fillSeriesProps.selectedEndCol}else if("TO_RIGHT"==direction){if(sourcecnt=beforeFillSeriesEndC-beforeFillSeriesStartC+1,ProtectedRanges.isRangeLocked(i,l+sourcecnt,s,r))return void fillSeriesProps.reset();fillSeriesProps.isMergeCellExists?(fillSeriesProps.selectedStartRow=i,fillSeriesProps.selectedStartCol=beforeFillSeriesEndC+1,fillSeriesProps.selectedEndRow=s,fillSeriesProps.selectedEndCol=fillSeriesProps.mergedRightEndCol):(fillSeriesProps.selectedStartRow=i,fillSeriesProps.selectedStartCol=l,fillSeriesProps.selectedEndRow=s,fillSeriesProps.selectedEndCol=r),o=fillSeriesProps.selectedStartRow,t=beforeFillSeriesEndC+1,S=fillSeriesProps.selectedEndRow,f=fillSeriesProps.selectedEndCol}else if("TO_LEFT"==direction){if(sourcecnt=beforeFillSeriesEndC-beforeFillSeriesStartC+1,l=fillEndCol,r=fillStartCol,ProtectedRanges.isRangeLocked(i,l,s,r-sourcecnt))return void fillSeriesProps.reset();fillSeriesProps.isMergeCellExists?(fillSeriesProps.selectedStartRow=i,fillSeriesProps.selectedStartCol=beforeFillSeriesStartC-1,fillSeriesProps.selectedEndRow=s,fillSeriesProps.selectedEndCol=fillSeriesProps.mergedLeftEndCol):(fillSeriesProps.selectedStartRow=i,fillSeriesProps.selectedStartCol=l,fillSeriesProps.selectedEndRow=s,fillSeriesProps.selectedEndCol=r),o=fillSeriesProps.selectedStartRow,t=beforeFillSeriesStartC-1,S=fillSeriesProps.selectedEndRow,f=fillSeriesProps.selectedEndCol}if(cellRangeContainsMergeCells(fillSeriesProps.selectedStartRow,fillSeriesProps.selectedStartCol,fillSeriesProps.selectedEndRow,fillSeriesProps.selectedEndCol))return fillSeriesProps.reset(),showAlertDialog(jsMsg["FillSeries.YourCannotChangePartOfMergedCell"]),!1;if(isPivotOrArrayRange(o,t,S,f))return void fillSeriesProps.reset();fillSeriesProps.reset(),clearOldArrayPosition(i,l,s,r),fillSeriesType="FILL_DEFAULT";var n=new RequestParameters(ActionConstants.FILLSERIES);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),i,l,s,r,ctrlkey,sourcecnt,direction,"default");var d=new AjaxRequest;d.init("POST",n.getURL(),!0,n.getParametersAsString()),actionManager.addRequest(d),autoFillSeries=!1,fillseriesrange=!1,isScrollTopSet=!1,isScrollLeftSet=!1,direction="",ctrlkey="FALSE"}}function focusCellRangeforAutoFill(e,l,r,i){var s=getCellRangeDIM(e,l,r,i);showFillSeriesDIV(),showFillSeriesSPAN(),setFillSeriesDIVPos(s.left,s.top),setFillSeriesDIVDim(s.width,s.height),fillStartRow=e,fillStartCol=l,fillEndRow=r,fillEndCol=i,fillRow=r,fillCol=i}function changeCursor(e,l){if(READ_WRITE){if(browser_ie)var r=l.srcElement;else var r=l.target;if(isFocusDIV(r)){if("mouseout"==l.type)return r.style.cursor="",r.title="",!1;var i=getCursorPos(l),s=i.x,o=i.y;if(ISFREEZED){if(i.x>sheetLeft+findSecondPaneXPos())var t=i.x-sheetLeft+getSheetScrollLeft();else var t=i.x-sheetLeft;if(i.y>sheetTop+findThirdPaneYPos())var S=i.y-sheetTop+getSheetScrollTop();else var S=i.y-sheetTop}else var t=i.x-sheetLeft+getSheetScrollLeft(),S=i.y-sheetTop+getSheetScrollTop();var f=parseInt(r.style.left),n=f+parseInt(r.style.width),d=parseInt(r.style.top),a=d+parseInt(r.style.height);if(browser_ie&&(t-=2,S-=2),t>=f&&f+2>=t||t>=n-3&&n>=t||S>=d&&d+2>=S||S>=a-3&&a>=S)r.style.cursor="move";else if(checkbox.isPresent(currCell)&&CellUtils.checkBoundaryForTextInDiv(s,o,currCell,"checkbox"))r.style.cursor="pointer";else if(CellUtils.checkBoundaryForTextInDiv(s,o,currCell)){r.style.cursor="pointer";var R=getHyperLinkInCell(currCell).title;r.title=R}else r.style.cursor="",r.title=""}else if(isTransSPAN(r)){var c=$(r);fPainter.fPaintersingleclick||fPainter.fPainterdoubleclick?c.addClass("fpCur"):c.removeClass("fpCur")}}}function fillSeriesDown(){if(READ_WRITE){var e=getServerRange(),l=e.startRow,r=e.startCol,i=e.endRow,s=e.endCol;if(!ProtectedRanges.isRangeLocked(l+1,r,i,s)&&!isPivotOrArrayRange(l+1,r,i,s)){clearOldArrayPosition(l+1,r,i,s),sourcecnt=1,fillSeriesType="FILL_COPY";var o=new RequestParameters(ActionConstants.FILLSERIES);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),l,r,i,s,!1,sourcecnt,"TO_BOTTOM","copy");var t=new AjaxRequest;t.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(t),autoFillSeries=!1,fillseriesrange=!1,ctrlkey="FALSE"}}}function fillSeriesRight(){if(READ_WRITE){var e=getServerRange(),l=e.startRow,r=e.startCol,i=e.endRow,s=e.endCol;if(!ProtectedRanges.isRangeLocked(l,r+1,i,s)&&!isPivotOrArrayRange(l,r+1,i,s)){clearOldArrayPosition(l,r+1,i,s),sourcecnt=1,fillSeriesType="FILL_COPY";var o=new RequestParameters(ActionConstants.FILLSERIES);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),l,r,i,s,!1,sourcecnt,"TO_RIGHT","copy");var t=new AjaxRequest;t.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(t),autoFillSeries=!1,fillseriesrange=!1,ctrlkey="FALSE"}}}function fillRowBySeries(){var e=!1;if(isCellRange()){var l=autoFormula.getAutoFormulas(),r=l.Count;r>0&&(e=!0)}else{var i=getCellContent();i&&(e=!0)}if(e){var s=getCellRange(),o=new RequestParameters(ActionConstants.FILLSERIES_AUTO);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),s.startRow,s.startCol,s.endRow,s.endCol);var t=new AjaxRequest;t.init("POST",o.getURL(),!0,o.getParametersAsString()),t.addEventListener("onComplete",function(){isDblClicked=!1}),actionManager.addRequest(t)}}function showFillSeriesDIV(){var e="block";fillSeriesDIV.style.display=e,ISFREEZED&&(isRowsOnlyFreezed?fillSeriesDIV2.style.display=e:isColsOnlyFreezed?fillSeriesDIV3.style.display=e:isColsAndRowsFreezed&&(fillSeriesDIV1.style.display=fillSeriesDIV2.style.display=fillSeriesDIV3.style.display=e))}function showFillSeriesSPAN(){var e="block";fillSeriesSPAN.style.display=e,ISFREEZED&&(isRowsOnlyFreezed?fillSeriesSPAN2.style.display=e:isColsOnlyFreezed?fillSeriesSPAN3.style.display=e:isColsAndRowsFreezed&&(fillSeriesSPAN1.style.display=fillSeriesSPAN2.style.display=fillSeriesSPAN3.style.display=e))}function hideFillSeriesDIV(){ISFREEZED&&(fillSeriesDIV1.style.display=fillSeriesDIV2.style.display=fillSeriesDIV3.style.display="none"),fillSeriesDIV.style.display="none"}function hideFillSeriesSPAN(){ISFREEZED&&(fillSeriesSPAN1.style.display=fillSeriesSPAN2.style.display=fillSeriesSPAN3.style.display="none"),fillSeriesSPAN.style.display="none"}function setFillSeriesDIVPos(e,l){e--,l--,fillSeriesDIV.style[isRTL?"right":"left"]=e+"px",fillSeriesDIV.style.top=l+"px",ISFREEZED&&(fillSeriesDIV1.style.left=fillSeriesDIV2.style.left=fillSeriesDIV3.style.left=e+"px",fillSeriesDIV1.style.top=fillSeriesDIV2.style.top=fillSeriesDIV3.style.top=l+"px")}function setFillSeriesDIVDim(e,l){e++,l++,e+="px",l+="px",ISFREEZED&&(fillSeriesDIV1.style.width=e,fillSeriesDIV1.style.height=l,fillSeriesDIV2.style.width=e,fillSeriesDIV2.style.height=l,fillSeriesDIV3.style.width=e,fillSeriesDIV3.style.height=l),fillSeriesDIV.style.width=e,fillSeriesDIV.style.height=l}function fillSeriesCellRange(e,l){var r,i,s,o;"top"===l&&getSheetScrollTop()>0||"bottom"===l&&getSheetScrollHeight()>getSheetScrollTop()+getSheetHeight()?("top"===l?selRow=selRow-e>=0?selRow-e:0:"bottom"===l&&(selRow=totRows>selRow+e?selRow+e:totRows-1),("top"===l&&selRow>=0||"bottom"===l&&totRows>selRow)&&(r=beforeFillSeriesStartR,i=beforeFillSeriesStartC,s=selRow,o=beforeFillSeriesEndC,selectionTop=getEndTopOfRow(selRow),focusCellRangeforAutoFill(r,i,s,o)),"bottom"===l&&selRow>=totRows-1&&appendBlankRows(),"top"===l?setSheetScrollDIM(r,s,i,o,"TOP"):"bottom"===l&&setSheetScrollDIM(r,s,i,o,"BOTTOM")):("bottom"===l&&appendBlankRows(),("top"===l&&0!=selRow&&selRow>0||"bottom"===l&&selRow!=totRows-1&&totRows-1>selRow)&&(selRow="top"===l?0:totRows-1,focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,selRow,beforeFillSeriesEndC))),"right"===l&&getSheetScrollWidth()+findSecondPaneXPos()>getSheetScrollLeft()+getSheetWidth()||"left"===l&&getSheetScrollLeft()>0?(selCol="right"===l?totCols>selCol+e?selCol+e:totCols-1:selCol-e>=0?selCol-e:0,("right"===l&&totCols>selCol||"left"===l&&selCol>=0)&&(r=beforeFillSeriesStartR,i=beforeFillSeriesStartC,s=beforeFillSeriesEndR,o=selCol,selectionLeft=getEndLeftOfCol(selCol),focusCellRangeforAutoFill(r,i,s,o)),"right"===l?setSheetScrollDIM(r,s,i,o,"RIGHT"):setSheetScrollDIM(r,s,i,o,"LEFT")):("right"===l&&selCol!=totCols-1&&totCols-1>selCol||"left"===l&&0!=selCol&&selCol>0)&&(selCol="right"===l?totCols-1:0,focusCellRangeforAutoFill(beforeFillSeriesStartR,beforeFillSeriesStartC,beforeFillSeriesEndR,selCol))}var sourcecnt=1,beforeFillSeriesStartR,beforeFillSeriesEndR,beforeFillSeriesStartC,beforeFillSeriesEndC,direction="",ctrlkey="FALSE",fillseriesrange=!1,fillRow="",fillCol="",fillStartRow,fillStartCol,fillEndRow,fillEndCol,cnt=0,autoFillSeries=!1;
function ExcelGraph(t){this.URL="ExcelChart.cc",this.updateConfig=function(t){for(var a in t)this[a]=t[a]},this.additionalParams=null,this.temporaryUrl=null,this.refreshChart=function(t,a){this.additionalParams=t,this.temporaryUrl=a;var e="";for(var n in this)0==n.indexOf("CP_")&&(e+="&"+encodeURIComponent(n.substring(3))+"="+encodeURIComponent(this[n]));var r="";if(this.data)for(var n=0;n<this.data.length;n++){for(var i=0;i<this.data[n].length;i++){var h=null==this.data[n][i]||""==this.data[n][i]?" ":this.data[n][i]+"",s=new RegExp(",","g");h=h.replace(s,"-,"),r+=h+" ,"}r+="\n"}e+="&CHARTDATA="+encodeURIComponent(r),null!=t&&(e+="&"+t),AjaxAPI.sendRequest({URL:null!=a?a:this.URL,PARAMETERS:e,ONSUCCESSFUNC:this.ONSUCCESSFUNC,CHARTREF:this,ONERROR:function(t){999==t.transport.status&&this.refreshChart(this.additionalParams,this.temporaryUrl)}.bind(this)})},this.updateConfig(t)}ExcelGraph.createInstance=function(t){var a=new ExcelGraph(t);return a.CP_CHARTID="ExcelGraph"+ ++ExcelGraph._INSCOUNT,ExcelGraph._INSTANCES[a.CP_CHARTID]=a,a},ExcelGraph._INSCOUNT=0,ExcelGraph._INSTANCES={},ExcelGraph.getInstance=function(t){return this._INSTANCES[t]},ExcelGraph.removeInstance=function(t){delete this._INSTANCES[t]},ExcelGraph.updateDiv=function(t,a){var e=a.v("CHARTREF"),n=document.getElementById(e.DIVTOUPDATE);n.innerHTML=t.getOnlyHtml()};
var scrollAnimator=function(){function e(e,o,l,b,v,V,H){d=!1,u=e,C>=o&&(o=C),F>=l&&(l=F),L=o,T=l,p=b,r=V,M=v,A=!1,H&&(A=H),e?(s=window.scrollY,h=Math.round((o?o:1e3)/(1e3/60)),c=Math.PI/h):(s=getSheetScrollTop(),h=Math.round((o?o:1e3)/(1e3/600)),c=Math.PI/h,i=getSheetScrollLeft(),n=Math.round((l?l:1e3)/(1e3/600)),S=Math.PI/n,"TOP"==V?(getSheetScrollLeft()<l&&!A&&(d=!0),f=getSheetScrollTop()-o):"BOTTOM"==V&&(getSheetScrollLeft()<l&&!A&&(d=!0),f=o-getSheetScrollTop()),m=getSheetScrollLeft()>l?getSheetScrollLeft()-l:l-getSheetScrollLeft()),requestAnimationFrame(t),e?a=0:(a=o,g=l)}function t(){if(u)if(h>=a){requestAnimationFrame(t);var e=s*((1-Math.cos(a*c))/2);window.scrollTo(0,s-e),a++,isScrolling=!0}else isScrolling=!1;else{if(s=getSheetScrollTop(),i=getSheetScrollLeft(),"TOP"==r&&L<ssVScrollbar.scrollTop){var e=f*((1-Math.cos(a*c))/2);if(!A){if(0!=i)var n=i*((1-Math.cos(g*S))/2);else var n=m*((1-Math.cos(g*S))/2);o(i,n,T)}l(s,e,i,n,L,T,void 0,"top",A)}else if("BOTTOM"==r&&p&&L+p>ssVScrollbar.scrollTop||!p&&L>ssVScrollbar.scrollTop){var e=f*((1+Math.cos(a*c))/2);if(!A){if(0!=i)var n=i*((1+Math.cos(g*S))/2);else var n=m*((1+Math.cos(g*S))/2);o(i,n,T)}l(s,e,i,n,L,T,p,"bottom",A)}else if("LEFT"==r&&T<getSheetScrollLeft()){var e=i*((1-Math.cos(g*S))/2);Math.round(i-e)>T?(setScrollLeft(Math.round(i-e)),requestAnimationFrame(t)):(setScrollLeft(T-20),cancelAnimationFrame(t))}else if("RIGHT"==r&&T>getSheetScrollLeft()){if(0!=i)var n=i*((1+Math.cos(g*S))/2);else var n=m*((1+Math.cos(g*S))/2);Math.round(i+e)<T&&Math.round(i+e)<getColLeft(totCols)-getSheetWidth()?(setScrollLeft(Math.round(i+n)),requestAnimationFrame(t)):(setScrollLeft(T-20<getColLeft(totCols)-getSheetWidth()?T-20:getColLeft(totCols)-getSheetWidth()),cancelAnimationFrame(t))}"TOP"==r&&L>=ssVScrollbar.scrollTop?cancelAnimationFrame(t):"BOTTOM"==r&&p&&L+p<=ssVScrollbar.scrollTop||!p&&L<=ssVScrollbar.scrollTop?cancelAnimationFrame(t):"LEFT"==r&&T<getSheetScrollLeft()?cancelAnimationFrame(t):"RIGHT"==r&&T>getSheetScrollLeft()&&cancelAnimationFrame(t)}}function o(e,t,o){setScrollLeft(d&&Math.round(e+t)<o&&Math.round(e+t)<getColLeft(totCols)-getSheetWidth()?Math.round(e+t):!d&&Math.round(e-t)>o?Math.round(e-t):o-20<getColLeft(totCols)-getSheetWidth()?o-20:getColLeft(totCols)-getSheetWidth())}function l(e,o,l,r,a,s,c,h,i){if("top"==h&&Math.round(e-o)>a||"bottom"==h&&!c&&a>e+o||c&&a+c>e+o){if("top"==h)ssVScrollbar.scrollTop=Math.round(e-o);else if(c){if(!(e+o<a+c-getSheetHeight()&&c<getSheetHeight()||a-20>e+o&&c>getSheetHeight()))return ssVScrollbar.scrollTop=c>getSheetHeight()?a-20:a+c-getSheetHeight(),void cancelAnimationFrame(t);ssVScrollbar.scrollTop=e+o}else{if(!(a>e+o))return ssVScrollbar.scrollTop=a,void cancelAnimationFrame(t);ssVScrollbar.scrollTop=e+o}requestAnimationFrame(t)}else d&&Math.round(l+r)<s&&Math.round(l+r)<getColLeft(totCols)-getSheetWidth()?(setScrollLeft(Math.round(l+r)),requestAnimationFrame(t)):!d&&Math.round(l-r)>s?(setScrollLeft(Math.round(l-r)),requestAnimationFrame(t)):(ssVScrollbar.scrollTop="bottom"!=h?a-20:c&&c<getSheetHeight()||!c&&a<e+getSheetHeight()?c?a+c-getSheetHeight():a-getSheetHeight():a-20,i||setScrollLeft(s-20<getColLeft(totCols)-getSheetWidth()?s>20?s-20:0:getColLeft(totCols)-getSheetWidth()),cancelAnimationFrame(t))}var r,a=0,s=0,c=0,h=0,i=0,n=0,S=0,g=0,f=0,m=0,u=!1,M=0,d=!1,L=0,T=0,p=0,C=20,F=20,A=!1;return{scroll:e}}(this);
var scrollHelper=function(){function e(e,l,o){var t=getCursorPos(e);return t.x=isRTL?clientDim.width-t.x:t.x,"none"!=$("#docPanel").css("display")&&isRTL&&(t.x-=parseInt($("#docPanel").css("width"))),r=0,a=0,ISFREEZED?(l&&(r=t.x>=rowHeadWidth+findSecondPaneXPos()||t.x<rowHeadWidth+findSecondPaneXPos()?t.x-rowHeadWidth+getNormalizedScrollLeft():t.x-rowHeadWidth),o&&(a=t.y>sheetTop+findThirdPaneYPos()||t.y<=sheetTop+findThirdPaneYPos()?t.y-sheetTop+getSheetScrollTop():t.y-sheetTop)):(l&&(r=t.x-rowHeadWidth+getNormalizedScrollLeft()),o&&(a=t.y-sheetTop+getSheetScrollTop())),{x:r,y:a}}function l(e){isMouseCursorXInOutOfViewPort(r)&&!e.doNotHandleForXPos?(e&&e.handleMoveCursorDIV&&moveCursorDIV&&"none"==moveCursorDIV.style.display&&(moveCursorDIV.style.display=""),e&&e.immediateCallBack&&e.immediateCallBack.apply(void 0,e.immediateCallBackParams),e&&e.handleFreezedCase&&ISFREEZED?(r-getNormalizedScrollLeft()>0||r-getNormalizedScrollLeft()<0)&&t(r,selection):t(r,e.onScrollCallback)):isMouseCursorYInOutOfViewPort(a)&&!e.doNotHandleForYPos?(e&&e.handleMoveCursorDIV&&moveCursorDIV&&"none"==moveCursorDIV.style.display&&(moveCursorDIV.style.display=""),e&&e.immediateCallBack&&e.immediateCallBack.apply(void 0,e.immediateCallBackParams),e&&e.handleFreezedCase&&ISFREEZED?(a-getSheetScrollTop()>0||a-getSheetScrollTop()<0)&&o(a,e.onScrollCallback):o(a,e.onScrollCallback)):(appEvent.trigger("scrollCallBack",e.callbackParams),"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),"undefined"!=typeof sheetScrollTopId&&clearInterval(sheetScrollTopId))}function o(e,l){var o,t,r,a=-1,i=1;e-getSheetScrollTop()<0?(o=!0,r=getSheetScrollTop()-e):e-getSheetScrollTop()>getSheetHeight()&&(t=!0,r=e-(getSheetHeight()+getSheetScrollTop())+16),18>=r?a=200:r>=18&&36>=r?a=175:r>=36&&54>r?(a=100,i=2):r>=54&&(a=75,i=3),r&&(clearInterval(sheetScrollTopId),sheetScrollTopId=setInterval(function(){t&&l(i,"bottom"),o&&l(i,"top")},a))}function t(e,l){if(e-getNormalizedScrollLeft()<0){var o=getScrollLeftTime("TO_LEFT",e),t=getCountOfRowToScroll("TO_LEFT",e);"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),sheetScrollLeftId=setInterval(function(){l(t,"left")},o)}else if(e-getNormalizedScrollLeft()>getSheetWidth()){var o=getScrollLeftTime("TO_RIGHT",e),t=getCountOfRowToScroll("TO_RIGHT",e);"undefined"!=typeof sheetScrollLeftId&&clearInterval(sheetScrollLeftId),sheetScrollLeftId=setInterval(function(){RangeSelector.isActive()?formulaFillRange(t,"right"):l(t,"right")},o)}}var r=0,a=0;return{pointerOffsetPosCalculator:e,handleCursorPos:l,scrollSheetVertical:o,scrollSheetHorizontal:t}}(this);
function ProtoObj(){}function P(){for(var e=new Array,t=0;t<arguments.length;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e}var Prototype={Version:"1.3.1",emptyFunction:function(){}},Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};Object.objExtendFun=function(e){return Object.extend.apply(this,[this,e])},ProtoObj.prototype.extend=Object.objExtendFun;var Abstract=new Object;Object.extend=function(e,t){for(property in t)e[property]=t[property];return e},Function.prototype.bindAsEventListener=function(e){var t=this;return function(n){t.call(e,n||window.event)}},Number.prototype.toColorPart=function(){var e=this.toString(16);return 16>this?"0"+e:e};var Try={these:function(){for(var e,t=0;t<arguments.length;t++){var n=arguments[t];try{e=n();break}catch(e){}}return e}},PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.callback()}finally{this.currentlyExecuting=!1}}},Object.extend(String.prototype,{stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},escapeHTML:function(){var e=document.createElement("div"),t=document.createTextNode(this);return e.appendChild(t),e.innerHTML},unescapeHTML:function(){var e=document.createElement("div");return e.innerHTML=this.stripTags(),e.childNodes[0].nodeValue}});var Ajax={getTransport:function(){return Try.these(function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new XMLHttpRequest})||!1}};if(Ajax.Base=function(){},Ajax.Base.prototype={setOptions:function(e){this.options=Object.extend({method:"post",asynchronous:!0,parameters:""},e||{})},responseIsSuccess:function(){return void 0==this.transport.status||0==this.transport.status||this.transport.status>=200&&this.transport.status<300},responseIsFailure:function(){return!this.responseIsSuccess()}},Ajax.Request=Class.create(),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Request.prototype=Object.extend(new Ajax.Base,{initialize:function(e,t){this.transport=Ajax.getTransport(),this.setOptions(t),this.request(e)},request:function(e){var t=this.options.parameters||"";t.length>0&&(t+="&_="),"get"==this.options.method&&appendParamsToUrl(e,t),this.transport.open(this.options.method,e,this.options.asynchronous),this.options.asynchronous&&(this.transport.onreadystatechange=this.onStateChange.bind(this),setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)),this.setRequestHeaders();var n=this.options.postBody?this.options.postBody:t;this.transport.send("post"==this.options.method?n:null)},setRequestHeaders:function(){var e=["X-Requested-With","XMLHttpRequest","X-Prototype-Version",Prototype.Version];"post"==this.options.method&&(e.push("Content-type","application/x-www-form-urlencoded"),this.transport.overrideMimeType&&e.push("Connection","close")),this.options.requestHeaders&&e.push.apply(e,this.options.requestHeaders);for(var t=0;t<e.length;t+=2)this.transport.setRequestHeader(e[t],e[t+1])},onStateChange:function(){var e=this.transport.readyState;1!=e&&this.respondToReadyState(this.transport.readyState)},respondToReadyState:function(e){var t=Ajax.Request.Events[e];"Complete"==t&&(this.options["on"+this.transport.status]||this.options.Success||Prototype.emptyFunction)(this.transport),(this.options["on"+t]||Prototype.emptyFunction)(this.transport,this),"Complete"==t&&(this.transport.onreadystatechange=Prototype.emptyFunction)}}),Ajax.Updater=Class.create(),Ajax.Updater.ScriptFragment="(?:<script.*?>)((\n|.)*?)(?:</script>)",Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(e,t,n){this.containers={success:P(e.success?e.success:e),failure:e.failure?P(e.failure):e.success?null:P(e)},this.transport=Ajax.getTransport(),this.setOptions(n);var s=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=function(){this.updateContent(),s(this.transport,this)}.bind(this),this.request(t)},updateContent:function(){var e=this.responseIsSuccess()?this.containers.success:this.containers.failure,t=new RegExp(Ajax.Updater.ScriptFragment,"img"),n=this.transport.responseText.replace(t,""),s=this.transport.responseText.match(t);e&&(this.options.insertion?new this.options.insertion(e,n):e.innerHTML=n),this.responseIsSuccess()&&this.onComplete&&setTimeout(function(){this.onComplete(this.transport)}.bind(this),10),this.options.evalScripts&&s&&invokeScripts(s)}}),Ajax.PeriodicalUpdater=Class.create(),Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base,{initialize:function(e,t,n){this.setOptions(n),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=1,this.updater={},this.container=e,this.url=t,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Ajax.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=setTimeout(this.onTimerEvent.bind(this),this.decay*this.frequency*1e3)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),!window.Element)var Element=new Object;Object.extend(Element,{toggle:function(){for(var e=0;e<arguments.length;e++){var t=P(arguments[e]);t.style.display="none"==t.style.display?"":"none"}},hide:function(){for(var e=0;e<arguments.length;e++){var t=P(arguments[e]);t.style.display="none"}},show:function(){for(var e=0;e<arguments.length;e++){var t=P(arguments[e]);t.style.display=""}},remove:function(e){e=P(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=P(e),e.offsetHeight},hasClassName:function(e,t){if(e=P(e)){for(var n=e.className.split(" "),s=0;s<n.length;s++)if(n[s]==t)return!0;return!1}},addClassName:function(e,t){e=P(e),Element.removeClassName(e,t),e.className+=" "+t},removeClassName:function(e,t){if(e=P(e)){for(var n="",s=e.className.split(" "),r=0;r<s.length;r++)s[r]!=t&&(r>0&&(n+=" "),n+=s[r]);e.className=n}},cleanWhitespace:function(e){for(var e=P(e),t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];3!=n.nodeType||/\S/.test(n.nodeValue)||Element.remove(n)}}});var Toggle=new ProtoObj;Toggle.display=Element.toggle,Abstract.Insertion=function(e){this.adjacency=e},Abstract.Insertion.prototype={initialize:function(e,t){this.element=P(e),this.content=t,this.adjacency&&this.element.insertAdjacentHTML?this.element.insertAdjacentHTML(this.adjacency,this.content):(this.range=this.element.ownerDocument.createRange(),this.initializeRange&&this.initializeRange(),this.fragment=this.range.createContextualFragment(this.content),this.insertContent())}},Abstract.Insertion.prototype.extend=Object.objExtendFun;var Insertion=new ProtoObj;Insertion.Before=Class.create(),Insertion.Before.prototype=new Abstract.Insertion("beforeBegin").extend({initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(){this.element.parentNode.insertBefore(this.fragment,this.element)}}),Insertion.Top=Class.create(),Insertion.Top.prototype=new Abstract.Insertion("afterBegin").extend({initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(!0)},insertContent:function(){this.element.insertBefore(this.fragment,this.element.firstChild)}}),Insertion.Bottom=Class.create(),Insertion.Bottom.prototype=new Abstract.Insertion("beforeEnd").extend({initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(this.element)},insertContent:function(){this.element.appendChild(this.fragment)}}),Insertion.After=Class.create(),Insertion.After.prototype=new Abstract.Insertion("afterEnd").extend({initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(){this.element.parentNode.insertBefore(this.fragment,this.element.nextSibling)}});var Field={clear:function(){for(var e=0;e<arguments.length;e++)P(arguments[e]).value=""},focus:function(e){P(e).focus()},present:function(){for(var e=0;e<arguments.length;e++)if(""==P(arguments[e]).value)return!1;return!0},select:function(e){P(e).select()},activate:function(e){P(e).focus(),P(e).select()}},Form={serialize:function(e){for(var t=Form.getElements(P(e)),n=new Array,s=0;s<t.length;s++){var r=Form.Element.serialize(t[s]);r&&n.push(r)}return n.join("&")},getElements:function(e){var e=P(e),t=new Array;for(tagName in Form.Element.Serializers)for(var n=e.getElementsByTagName(tagName),s=0;s<n.length;s++)t.push(n[s]);return t},getInputs:function(e,t,n){var e=P(e),s=e.getElementsByTagName("input");if(!t&&!n)return s;for(var r=new Array,i=0;i<s.length;i++){var o=s[i];t&&o.type!=t||n&&o.name!=n||r.push(o)}return r},disable:function(e){for(var t=Form.getElements(e),n=0;n<t.length;n++){var s=t[n];s.blur(),s.disabled="true"}},enable:function(e){for(var t=Form.getElements(e),n=0;n<t.length;n++){var s=t[n];s.disabled=""}},focusFirstElement:function(e){for(var e=P(e),t=Form.getElements(e),n=0;n<t.length;n++){var s=t[n];if("hidden"!=s.type&&!s.disabled){Field.activate(s);break}}},reset:function(e){P(e).reset()}};Form.Element={serialize:function(e){var e=P(e),t=e.tagName.toLowerCase(),n=Form.Element.Serializers[t](e);if(n){var s=encodeURIComponent(n[0]),r="";if(n[1]instanceof Array){for(var i=0;i<n[1].length;i++)r+=s+"="+encodeURIComponent(n[1][i])+"&";return r}return s+"="+encodeURIComponent(n[1])}},getValue:function(e){var e=P(e),t=e.tagName.toLowerCase(),n=Form.Element.Serializers[t](e);return n?n[1]:void 0}},Form.Element.Serializers={input:function(e){switch(e.type.toLowerCase()){case"submit":case"hidden":case"password":case"text":case"textfield":case"textarea":return Form.Element.Serializers.textarea(e);case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(e)}return!1},inputSelector:function(e){return e.checked?[e.name,e.value]:void 0},textarea:function(e){return[e.name,e.value]},select:function(e){var t="";if("select-one"==e.type){var n=e.selectedIndex;n>=0&&(t=e.options[n].value||e.options[n].text)}else{t=new Array;for(var s=0;s<e.length;s++){var r=e.options[s];r.selected&&t.push(r.value||r.text)}}return[e.name,t]}};var $F=Form.Element.getValue;if(Abstract.TimedObserver=function(){},Abstract.TimedObserver.prototype={extend:Object.objExtendFun,initialize:function(e,t,n){this.frequency=t,this.element=P(e),this.callback=n,this.lastValue=this.getValue(),this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},onTimerEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)}},Form.Element.Observer=Class.create(),Form.Element.Observer.prototype=(new Abstract.TimedObserver).extend({extend:Object.objExtendFun,getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(),Form.Observer.prototype=(new Abstract.TimedObserver).extend({getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=function(){},Abstract.EventObserver.prototype={extend:Object.objExtendFun,initialize:function(e,t){this.element=P(e),this.callback=t,this.lastValue=this.getValue(),"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){for(var e=Form.getElements(this.element),t=0;t<e.length;t++)this.registerCallback(e[t])},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":e.target=this,e.prev_onclick=e.onclick||Prototype.emptyFunction,e.onclick=function(){this.prev_onclick(),this.target.onElementEvent()};break;case"password":case"text":case"textarea":case"select-one":case"select-multiple":e.target=this,e.prev_onchange=e.onchange||Prototype.emptyFunction,e.onchange=function(){this.prev_onchange(),this.target.onElementEvent()}}}},Form.Element.EventObserver=Class.create(),Form.Element.EventObserver.prototype=(new Abstract.EventObserver).extend({getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(),Form.EventObserver.prototype=(new Abstract.EventObserver).extend({getValue:function(){return Form.serialize(this.element)}}),!window.Event)var Event=new Object;Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},pointerX:function(e){return e.pageX||e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)},pointerY:function(e){return e.pageY||e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)},stop:function(e){e.preventDefault?(e.preventDefault(),e.stopPropagation()):e.returnValue=!1},findElement:function(e,t){for(var n=Event.element(e);n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase());)n=n.parentNode;return n},observers:!1,_observeAndCache:function(e,t,n,s){this.observers||(this.observers=[]),e.addEventListener?(this.observers.push([e,t,n,s]),e.addEventListener(t,n,s)):e.attachEvent&&(this.observers.push([e,t,n,s]),e.attachEvent("on"+t,n))},unloadCache:function(){if(Event.observers){for(var e=0;e<Event.observers.length;e++)Event.stopObserving.apply(this,Event.observers[e]),Event.observers[e][0]=null;Event.observers=!1}},observe:function(e,t,n,s){var e=P(e);s=s||!1,"keypress"==t&&(navigator.appVersion.indexOf("AppleWebKit")>0||e.attachEvent)&&(t="keydown"),this._observeAndCache(e,t,n,s)},stopObserving:function(e,t,n,s){var e=P(e);s=s||!1,"keypress"==t&&(navigator.appVersion.indexOf("AppleWebKit")>0||e.detachEvent)&&(t="keydown"),e.removeEventListener?e.removeEventListener(t,n,s):e.detachEvent&&e.detachEvent("on"+t,n)}}),Event.observe(window,"unload",Event.unloadCache,!1);var Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(e){var t=0,n=0;do t+=e.scrollTop||0,n+=e.scrollLeft||0,e=e.parentNode;while(e);return[n,t]},cumulativeOffset:function(e){var t=0,n=0;do t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;while(e);return[n,t]},within:function(e,t,n){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,n):(this.xcomp=t,this.ycomp=n,this.offset=this.cumulativeOffset(e),n>=this.offset[1]&&n<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,n){var s=this.realOffset(e);return this.xcomp=t+s[0]-this.deltaX,this.ycomp=n+s[1]-this.deltaY,this.offset=this.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){return e?"vertical"==e?(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight:"horizontal"==e?(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth:void 0:0},clone:function(e,t){e=P(e),t=P(t),t.style.position="absolute";var n=this.cumulativeOffset(e);t.style.top=n[1]+"px",t.style.left=n[0]+"px",t.style.width=e.offsetWidth+"px",t.style.height=e.offsetHeight+"px"}};
var storage=function(){var e="st",t=function(t,r){localStorage.setItem(e+"."+t,r)},r=function(t){return localStorage.getItem(e+"."+t)},o=function(){for(var e=localStorage.length,t=[],r=0;e>r;r++){var o=localStorage.key(r);0===o.indexOf("st.")&&t.push(o)}return t},a=function(){for(var e=o(),t=0;t<e.length;t++)l(e(t))},n=function(){var e=JSON.stringify(localStorage).length;return e},l=function(e){localStorage.removeItem(e)},g=function(){window.localStorage.clear()},c=function(e,t){try{if(window.localStorage){var r=storage.getTotSize();r>=4998e3&&(storage.removeSheetKeys(),r>=4998e3&&storage.removeAll()),storage.setItem(e,t)}return!1}catch(e){return storage.removeSheetKeys(),!0}};return{setItem:t,getItem:r,removeSheetKeys:a,getTotSize:n,removeAll:g,setItemInStorage:c}}(jQuery);
var wrapper=function(){var t=function(t){var n=t.key,r=(t.validatorFn,t.callback),a=t.formatterFn,o=t.url;e(n,r,a,o)},e=function(t,e,n,r){if(r){var a=new XMLHttpRequest;a.open("GET",r,!0),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var t=a.responseText;e(t)}},a.send(null)}};return{doAction:t}}(jQuery);
var preprocessor=function(t){var a=function(t){var a=t.menutabs,n=a.currentUserLocale,i=a.htmlFilePath,c=ctxpath+versionPathForHTML+i,l=htmlLocalVersion,s=function(t){return t?o(t,n,l):void 0},m=function(t){appEvent.trigger("Toolbar.Initialized"),jsEMBED_VIEW||jsGADGET_VIEW||isPreview||(r(t,a),initUIComponents()),loadAfterLoadFiles()},u=function(t){return e(t,n,l)},d={key:"htmlfile",validatorFn:s,callback:m,formatterFn:u,url:c};wrapper.doAction(d)},e=function(t,a,e){var r={locale:a,htmlversion:e,htmlfile:t};return JSON.stringify(r)},r=function(a,e){if(jsVERSION_VIEW){t("#versionTDiv").append(a),t("#versionToolbarDiv").show();var r=clientDim.width;t("#versionToolbarDiv").css("width",r+"px"),resetEditorDim()}else{t("#mainOuterDiv").append(a),t("#versionToolbarDiv").insertAfter("#mainOuterDiv");var o=e.homeToolbarValues;if(n(o),!jsSHARE_VIEW||ALLOW_TO_WRITE){var s=e.formatToolbarValues;i(s)}var m=e.fileMenuValues;c(m)}var u=e.disable,d=e.hide;u.forEach(function(a){t("#"+a).attr("disabled","disabled")}),d.forEach(function(a){t("#"+a).remove()});var p=e.versionToolbarValues;l(p)},o=function(t,a,e){var r=storage.getItem("locale"),o=storage.getItem("htmlversion"),n=storage.getItem("htmlfile");return o&&r&&n&&o===e&&r===a?n:void 0},n=function(a){var e=a.fontsListArray,r=a.fontsNameList,o=a.fontsListArrayWithLocale,n=a.defaultFont,i=a.printData[0],c=a.printData[1],l=a.printData[2],s=a.saveTolLocalMsg;if("undefined"!=typeof e&&r.length>0){r.sort();for(var m=document.getElementById("fontFace"),u=0;u<r.length;u++){var d=e.indexOf(r[u]),p=document.createElement("option");p.className=e[d-1],p.title=o[d],p.value=e[d+1],e[d+1]===n&&(p.selected="selected"),p.text=o[d],m&&m.appendChild(p)}}t("#toolbar_print").attr("data","{'icons': {'primary': 'zicon zicon-print'},label:'"+l+"',text: false,appData:{callback: '"+i+"',arg:'"+c+"'}}"),t("#rotoolbar_print").attr("data","{'icons': {'primary': 'zicon zicon-print'},label:'"+l+"',text: true,appData:{callback: '"+i+"',arg:'"+c+"'}}"),formForExistingData&&"true"==formForExistingData?(t("#createForm").attr("popup","formcreatemenu"),t("#createForm").attr("data","{'icons':{'primary':'zsicon zsicon-form-create'},'label':'"+jsMsg["Form.Create"]+"','text':true}")):t("#createForm").attr("data","{'icons':{'primary':'zsicon zsicon-form-create'},'label':'"+jsMsg["Form.Create"]+"','text':true, appData:{'callback':'WebForm.createFormDialog'}}"),pushFormat&&t("#saveToLocal").attr("data","{icons: {primary: 'zsicon zsicon-save'},text: false,label:'"+s+"',appData:{callback:'exportDoc',arg:'"+pushFormat+"'}}")},i=function(a){var e=a.currencyName,r=a.currencySymbol,o=a.thousandSeparatorUiIcon,n=a.workBookLocale,i=a.localUtilCurSymbols;if("undefined"!=typeof e){var c=t("#currency");if(c.attr("title",e),c.attr("currencyType",n),t("#currency").attr("data","{splitbutton:'true',icon:'bold', iconText:'"+r+"',appData:{dynamic:'true',callback: 'format_new',arg:'"+ActionConstants.FORMAT_CURRENCY+",currency'}}"),t("#currency").text(r),r!==i[0].INR&&r!==i[0].USD&&r!==i[0].EUR&&r!==i[0].CNY&&r!==i[0].GBP){var l=document.createElement("li");t(l).attr("id",n),t(l).attr("data","{icon:'bold', iconText:'"+r+"',label:'"+e+"',appData:{dynamic:'true',callback: 'format_new',arg:'"+ActionConstants.FORMAT_CURRENCY+","+n+",this'}}");var s=t("#currencymenu").children()[0];s?currencymenu.insertBefore(l,s):currencymenu.appendChild(l)}var m="ui-individual-icon ";o=m.concat(o),t("#comma").attr("data","{icons: {'primary': '"+o+"'},label:'"+jsMsg["Fotmat.ThousandSeparator"]+"',text:false,appData:{afterclick:activateCellField,callback: 'submit_Inc_Dec_Decimal_And_Comma',arg:'"+ActionConstants.FORMAT_COMMA+"'}}");var u={DOLLAR:"USD",EURO:"EUR",POUND:"GBP",YEN:"CNY",RUPEE:"INR",NONE:""},d={icon:"",text:void 0,iconText:"",label:"",appData:{callback:"format_new",arg:void 0}};Object.keys(u).forEach(function(a){var e=u[a];"NONE"!=a?(d.iconText=e?i[0][e]:"",d.icon=e?"bold":void 0,d.appData.arg=ActionConstants.FORMAT_CURRENCY+","+a+",this"):(d.text=!0,d.iconText="",d.icon="",d.appData.arg=ActionConstants.FORMAT_CURRENCY+","+a),d.label=e?jsMsg["CURRENCYNAME."+e]:"",t("#"+a).attr("data","{icon:'"+d.icon+"', iconText:'"+d.iconText+"',label:'"+d.label+"',appData:{callback: 'format_new',arg:'"+d.appData.arg+"'}}")});var p=a.dateFormat,v=p.dateFormatStrArr,f=p.isContainDateFormatArr,g=p.datevalArr,h=p.locale,D=document.getElementById("dateformat");v=v.reverse(),f=f.reverse(),g=g.reverse();for(var b=0;b<v.length;b++)if(f[b]===!1){var A=v[b].replace(/'/g,"\\'").replace(/,/g,"%2C"),T=document.createElement("li");t(T).attr("id","date"+b),t(T).attr("format",v[b]);var C=v[b].replace(/'/g,"\\'");t(T).attr("data","{'skipshortcutregister':true,skipShortcutFormat:true,shortcutkey:'"+C+"', appData:{callback: 'submitCellValueChangeFormat',arg:'"+ActionConstants.FORMAT_DATE+","+A+","+h+",Date'}}"),t(T).text(g[b]),t(D).after(T)}var E=a.timeFormat,F=E.timeFormatStrArr,y=E.isContainTimeFormatArr,k=E.timevalArr,h=E.locale,R=document.getElementById("timeformat");F=F.reverse(),y=y.reverse(),k=k.reverse();for(var b=0;b<F.length;b++)if(y[b]===!1){var x=F[b].replace(/'/g,"\\'").replace(/,/g,"%2C"),T=document.createElement("li");t(T).attr("id","time"+b),t(T).attr("format",F[b]);var C=F[b].replace(/'/g,"\\'");t(T).attr("data","{'skipshortcutregister':true,skipShortcutFormat:true,shortcutkey:'"+C+"', appData:{callback: 'submitCellValueChangeFormat',arg:'"+ActionConstants.FORMAT_DATE+","+x+","+h+",Time'}}"),t(T).text(k[b]),t(R).after(T)}var O=a.durationFormat,_=O.durationFormatStrArr,I=O.durationValArr,N=document.getElementById("durationformat");_=_.reverse(),I=I.reverse();for(var b=0;b<_.length;b++){var M=_[b],T=document.createElement("li");t(T).attr("id","duration"+b),t(T).attr("format",_[b]);var C=_[b];t(T).attr("data","{'skipshortcutregister':true,skipShortcutFormat:true,shortcutkey:'"+C+"', appData:{callback: 'submitCellValueChangeFormat',arg:'"+ActionConstants.FORMAT_DATE+","+M+","+h+",Time'}}"),t(T).text(I[b]),t(N).after(T)}var S=a.dateTimeFormat,U=S.dateTimeFormatStrArr,L=S.dateTimeFormatStrngArr,V=S.isContainDateTimeFormatArr,w=S.dateTimeValArr,h=S.locale,z=document.getElementById("datetimeformat");U=U.reverse(),V=V.reverse(),w=w.reverse();for(var b=0;b<L.length;b++)if(V[b]===!1){var L=U[b].replace(/'/g,"\\'").replace(/,/g,"%2C"),T=document.createElement("li");t(T).attr("id","dateTime"+b),t(T).attr("format",U[b]);var C=U[b].replace(/'/g,"\\'");t(T).attr("data","{'skipshortcutregister':true,skipShortcutFormat:true,shortcutkey:'"+C+"', appData:{callback: 'submitCellValueChangeFormat',arg:'"+ActionConstants.FORMAT_DATE+","+L+","+h+",DateTime'}}"),t(T).text(w[b]),t(z).after(T)}}},c=function(a){var e=a.DocName,r=a.rid,o=a.isCoOwnerSharedDoc;canShare=a.canShare,isAdmin=a.isAdmin,isCoOwnerSharedDoc=o;var n=document.getElementById("recentDocument");if(n)if(e.length>0)for(var i=0;i<e.length;i++){var c=document.createElement("li");t(c).attr("name","views"),t(c).attr("data","{appData:{callback: 'OpenRecDoc',arg:'"+r[i]+"'}}");var l=e[i];l.length>40&&(l=l.substring(0,40)+"..."),t(c).text(l),n.appendChild(c)}else{var c=document.createElement("li");t(c).attr("name","views"),n.appendChild(c),maskOpenRec=!0}var s=a.isLoggedIn,m=t("#saveToMyAcnt");m&&t(m).attr("data","{icon:'zsicon zsicon-save-to-my-account', appData:{callback: 'saveToMyAccount.getDetails',arg:'"+s+"'}}")},l=function(a){var e=a.versionTimeClassName,r=t("#versionTime");r&&(r.className=e);var o=a.versionUserDetailsImg,n=t("#verImg");n&&t("#verImg").attr("src",o),t("#verActions").css("float","")};return{loadMenutab:a}}(jQuery);
var docPanel=function(e){function i(){return d}function t(i,t){if(!s()&&i==h&&!t)return void o();if(s()&&(resetHScrollDim("DOCPANEL_OPEN"),c.style.display="",a(),resetWorkSheetDim(),resetSheetsTabDim()),parseInt(commentCnt)>0&&e("#commentsPanel").show(),"comments"==i){var r=e("#commentContainer"),d=e(l).height()-(parseInt(r.css("padding-top"))+parseInt(r.css("padding-bottom")));r.height(d),showSheetComments(),e("#versionPanel").hide(),e("#chatContainer").hide(),e("#discussionContainer").hide(),e("#actionStreamPanel").hide(),r.show()}else"chat"==i?(e("#versionPanel").hide(),e("#commentContainer").hide(),e("#discussionContainer").hide(),e("#chatContainer").show(),e("#actionStreamPanel").hide(),Discussion&&Discussion.toggle(),CollabPanel.showCollabPanel()):"discussion"==i?(e("#versionPanel").hide(),e("#commentContainer").hide(),e("#chatContainer").hide(),e("#actionStreamPanel").hide(),e("#discussionContainer").show(),Discussion&&(Discussion.allowAutoOpen=!1)):"actionStream"==i?(e("#versionPanel").hide(),e("#chatContainer").hide(),e("#commentContainer").hide(),e("#discussionContainer").hide(),e("#actionStreamPanel").show()):"pivotBuilder"==i?(e("#versionPanel").hide(),e("#commentContainer").hide(),e("#chatContainer").hide(),e("#actionStreamPanel").hide(),e("#discussionContainer").hide(),e("#pivotRec_container").show(),e("#pivotRec_container .pHdr").text(jsMsg["Data.Pivot"]),e("#pivotRec_container #pBc").show(),e("#pivotRec_container #rPlC").hide(),e("#pivotRec_container #pRmd").removeClass("sel").show(),e("#pivotRec_container #pBldr").addClass("sel").show()):"RecommendedPivotTables"==i?(e("#versionPanel").hide(),e("#commentContainer").hide(),e("#chatContainer").hide(),e("#actionStreamPanel").hide(),e("#discussionContainer").hide(),e("#pivotRec_container").show(),e("#pivotRec_container .pHdr").text(jsMsg["Data.Pivot"]),e("#pivotRec_container #pBc").hide(),e("#pivotRec_container #rPlC").show(),e("#pivotRec_container #pRmd").addClass("sel").show(),e("#pivotRec_container #pBldr").removeClass("sel").show()):"Explore"==i&&(e("#versionPanel").hide(),e("#commentContainer").hide(),e("#chatContainer").hide(),e("#actionStreamPanel").hide(),e("#discussionContainer").hide(),e("#pivotRec_container").show(),e("#pivotRec_container #pBc").hide(),e("#pivotRec_container #rPlC").show(),e("#pivotRec_container #pRmd").addClass("sel").hide(),e("#pivotRec_container #pBldr").removeClass("sel").hide());Discussion&&Discussion.resetHighlightedComments(),n(i),"REMOTE_SAVE_VIEW"!==DOCUMENT_VIEW&&(0===e(".ui-zcollaborator-chatmsg").length&&collabChat.getChat(50),e(e(".ui-zcollaborator-content")[1]).scroll(function(){0==e(e(".ui-zcollaborator-content")[1]).scrollTop()&&collabChat.getChat(50)}))}function n(e){e!=h&&(h=e)}function o(){s()||(resetHScrollDim("DOCPANEL_CLOSE"),c.style.display="none",resetWorkSheetDim(),resetSheetsTabDim()),Discussion&&Discussion.resetHighlightedComments(),"pivotBuilder"==h&&PivotUtil.closePivotBuilder()}function s(){return null==c||"none"==c.style.display}function a(){var i=getObj("docPanelFrame");if(i){var t=e("#ssBottomPanel").height()+wmsBarHt,n=e("#spreadSheet").offset().top;n+=3;var o=findClientDim().height-(n+t);i.style.height=o+"px",Discussion.Panel.resetDim(o)}}function r(){a()}var c=getObj("docPanel"),l=getObj("docPanelFrame"),h="chat",d=isPreview?0:parseInt(getCurrentStyle(c,"width"))+parseInt(getCurrentStyle(c,"paddingLeft"))+parseInt(getCurrentStyle(c,"paddingRight"));return appEvent.on("docpanel.resetDim",function(){r()}),{show:t,close:o,isClosed:s,resetDim:r,getWidth:i,setDocPanelDim:a}}(jQuery);
var NotificationSettings=function(){var t=null,e=function(t){n(t)},n=function(t){var e=new RequestParameters(ActionConstants.NOTIFICATION_SETTINGS),n=new AjaxRequest;e.setParameters(t,ActionConstants.NOTIFICATION_SETTINGS_SETSTATE),n.init("POST",e.getURL(),!0,e.getParametersAsString()),n.addEventListener("onComplete",function(e){e.responseText;"true"===e.responseText&&(NotificationSettings.currentState=t)}),n.sendRequest()},i=function(){var t=new RequestParameters(ActionConstants.NOTIFICATION_SETTINGS),e=new AjaxRequest;t.setParameters(null,ActionConstants.NOTIFICATION_SETTINGS_GETSTATE),e.init("POST",t.getURL(),!0,t.getParametersAsString()),e.addEventListener("onComplete",function(t){var e=t.responseText;NotificationSettings.currentState=parseInt(e),c()}),e.sendRequest()},o=function(t){var e;e=0==t?"#ns_none":1==t?"#ns_all":"#ns_participated",$(e).attr("checked",!0)},a=function(){event.stopPropagation(),$("#dN").show()},s=function(){null==t?i():c()},c=function(){var t={autoOpen:!1,width:540,modal:!0,resizable:!1,title:jsMsg["Notification.EmailSettings"],close:function(){window.location.hash=""},buttons:[{text:jsMsg.Save,class:"ui-zbutton-primary",click:function(){NotificationSettings.change(Number($("input[name='ns']:checked").val())),sheetdialog.close(),window.location.hash=""}},{text:jsMsg.Cancel,click:function(){sheetdialog.close(),window.location.hash=""}}]};sheetdialog.open("notificationsettingdialog",t,{init:function(){o(NotificationSettings.currentState)}}),"#notification-settings"!=window.location.hash&&(window.history.replaceState({state:"NS"},"sheets","/sheet/open/"+RESOURCE_ID),window.location.hash="notification-settings"),$("#notificationsettingdialogzdialog").dialog("option","closeOnEscape",!0)};return{currentState:t,showDialog:s,change:e,updateServer:n,updateClient:o,getState:i,show:a}}(jQuery);
!function(t){var e=t.ui.autocomplete.prototype,i=e._initSource;t.extend(e,{_initSource:function(){this.options.html&&t.isArray(this.options.source)?this.source=function(t,e){e(filter(this.options.source,t.term))}:i.call(this)},_renderItem:function(e,i){return t("<li></li>").data("item.autocomplete",i).append(t("<a></a>")[this.options.html?"html":"text"](i.label)).appendTo(e)}})}(jQuery);
!function(e){var t=document,n=document,i=t.selection?t.selection:t.getSelection();e.widget("ui.rich_textarea",{options:{triggers:[],regexes:[]},_create:function(){var e=this;this.currentTrigger=!1,this.currentRange=!1,this.selectionEntered=!1,this.do_regex=!0,this.autocomplete_open=!1,this._on({keyup:function(e){this._onKeyUp(e)},keypress:function(e){this._onKeyPress(e)},keydown:function(e){this._onKeyDown(e)},mouseup:function(e){this._onMouseUp(e)},focus:function(e){this._onFocus(e)},paste:function(e){this._onPaste(e)}}),this.element.autocomplete({autoFocus:!0,html:"html",blur:function(){},open:function(){e.autocomplete_open=!0;var t=e.element,n=2,i=2,o=t.width()+n+i,r=rich_textarea.getCustomTop(this);r=0==r?"-=3px":r+28+"px",t.autocomplete("widget").css({width:o,top:r}).addClass("full-ui-autocomplete fntSiz12")},close:function(){e.autocomplete_open=!1,e.do_regex=!0},source:function(t,n){var i=e._checkForTrigger();i&&i&&i.word.length&&i.callback(i.word,n)},focus:function(e){return e.preventDefault(),!1},select:function(t,n){e._insertSelection(e.currentTrigger,n.item.value),e._highlightObject(),t.preventDefault(),e.do_regex=!1}})},_onKeyDown:function(n){var o=null,r=null,s=n.which;if(this.autocomplete_open&&(s===e.ui.keyCode.UP||s===e.ui.keyCode.DOWN||s===e.ui.keyCode.ENTER))return n.preventDefault(),!0;if(i=t.getSelection(),i.rangeCount){var d=i.getRangeAt(0);if(!d.collapsed)return}switch(s){case 0:break;case e.ui.keyCode.BACKSPACE:var a=!1;(o=this._checkForAdjacentObject("left"))&&(this.deleteObject(o.dom_node),o.preventDefault&&n.preventDefault());break;case e.ui.keyCode.DELETE:var a=!1;if("stop"==(a=this._deleteZeroSpace()))return;(o=this._checkForAdjacentObject("right"))&&(this.deleteObject(o.dom_node),n.preventDefault());break;case e.ui.keyCode.LEFT:var l=this._getCaretPosition();if(o=this._isEmbeddedObject(l.dom_node)){this._setCaretPositionRelative(o.previousSibling,"end"),n.preventDefault();break}(r=this._moveCaret(l.dom_node,l.offset,"left"))&&(r.checkForObjects&&(o=this._checkForAdjacentObject("left"))&&(this._setCaretPositionRelative(o.dom_node.previousSibling,"end"),n.preventDefault()),r.preventDefault&&n.preventDefault());break;case e.ui.keyCode.RIGHT:var l=this._getCaretPosition();if(o=this._isEmbeddedObject(l.dom_node)){this._setCaretPositionRelative(o.nextSibling,"beginning");break}(r=this._moveCaret(l.dom_node,l.offset,"right"))&&(r.checkForObjects&&(o=this._checkForAdjacentObject("right"))&&this._setCaretPositionRelative(o.dom_node.nextSibling,"beginning"),r.preventDefault&&n.preventDefault());break;case e.ui.keyCode.ENTER:return this._handleEnter(n),!1}},_onKeyPress:function(t){var n=t.which;if(this.autocomplete_open&&(n===e.ui.keyCode.UP||n===e.ui.keyCode.DOWN||n===e.ui.keyCode.ENTER))return t.preventDefault(),!0;switch(n){case e.ui.keyCode.SPACE:this._checkRegexes(t);break;case e.ui.keyCode.ENTER:this._checkRegexes(t)}},_onKeyUp:function(t){var n=null,i=t.which;if(this.autocomplete_open&&(i===e.ui.keyCode.UP||i===e.ui.keyCode.DOWN||i===e.ui.keyCode.ENTER))return t.preventDefault(),!0;if(!this._handleRangeSelection()){switch(this._saveRange(),this._highlightObject(),i){case e.ui.keyCode.ENTER:if(this.element.autocomplete("close"),this.currentTrigger=!1,this.selectionEntered){this.selectionEntered=!1;break}this._onEnterFixUp(t);break;case e.ui.keyCode.SPACE:case e.ui.keyCode.TAB:case e.ui.keyCode.HOME:case e.ui.keyCode.END:this.element.autocomplete("close"),this.currentTrigger=!1;break;case e.ui.keyCode.LEFT:case e.ui.keyCode.RIGHT:case e.ui.keyCode.BACKSPACE:n=this._getCaretPosition();var o=this._clickedOnObject(n.dom_node);if(o)return void this._setCaretPositionRelative(o,"before");this._search()||(this.element.autocomplete("close"),this.currentTrigger=!1);break;case e.ui.keyCode.UP:case e.ui.keyCode.DOWN:n=this._getCaretPosition();var o=this._clickedOnObject(n.dom_node);o&&this._setCaretPositionRelative(o,"before");break;case e.ui.keyCode.ESCAPE:return!1}this._search()}},_onMouseUp:function(t){if(this.element.autocomplete("close"),!e("#"+this.element.attr("id")).is(":focus"))return!0;if(!this._handleRangeSelection()){this._saveRange();var n=this._clickedOnObject(t.target);n&&(this._setCaretPositionRelative(n,"before"),t.preventDefault()),this._highlightObject()}},_search:function(){var e=this._checkForTrigger();return e&&e.word?(this.element.autocomplete("search",e.word),!0):!1},_onFocus:function(e){return this.autocomplete_open?(e.preventDefault(),!1):void 0},_onPaste:function(e){if(handlePasteInRichContent(e,this.element))this._search();else{this._onPrePaste(e);var t=this;setTimeout(function(){t._onPostPaste(e)},75)}return!0},_onPrePaste:function(){e(this.element).find("*").each(function(){e(this).data("uid","1")})},_onPostPaste:function(t){this.element.find("*").each(function(){var t=e(this);t.data("uid")||3==t.get(0).nodeType||"BR"==t.get(0).nodeName||t.replaceWith(t.text())}),this._checkRegexes(t)},_onEnterFixUp:function(){var t=this._getCaretPosition();if(null==t.dom_node.previousSibling?this._checkSibling(t.dom_node.parentNode,"prev"):3!=t.dom_node.previousSibling.nodeType&&(this._insertEmptyNode(t.dom_node.previousSibling,"before"),this._insertEmptyNode(t.dom_node.previousSibling,"after")),0!=e(t.dom_node).filter("[_moz_dirty]").length)this._insertEmptyNode(t.dom_node,"before"),this._insertEmptyNode(t.dom_node,"after");else if("BR"==t.dom_node.nodeName);else if(this._isEmbeddedObject(t.dom_node)){var n=this._insertEmptyNode(t.dom_node,"before");this._selectTextNode(n,0)}else if("DIV"==t.dom_node.nodeName||"SPAN"==t.dom_node.nodeName||"P"==t.dom_node.nodeName){var i=t.dom_node.childNodes;0==i.length?this._insertEmptyNode(t.dom_node,"child"):3!=i[0].nodeType&&(this._insertEmptyNode(i[0],"before"),this._insertEmptyNode(i[0],"after"))}},_handleEnter:function(n){n.preventDefault();var i=t.getSelection(),o=i.getRangeAt(0);i.removeAllRanges(),i.addRange(o);var r=e("<br>"),s=r.get(0);o.insertNode(r.get(0)),o.setStartAfter(r.get(0)),o.setEndAfter(r.get(0)),o.collapse(!1),i.removeAllRanges(),i.addRange(o);var d=(this._insertEmptyNode(s,"before",!0),this._insertEmptyNode(s,"after",!0));return this._selectTextNode(d,1),!1},_handleRangeSelection:function(){var e=t.getSelection();try{var n=e.getRangeAt(0)}catch(e){return!1}var i=null,o=null;return n.collapsed?!1:(0!=(i=this._clickedOnObject(n.startContainer))&&n.setStartBefore(i),0!=(o=this._clickedOnObject(n.endContainer))&&n.setEndAfter(o),(0!=i||0!=o)&&(e.removeAllRanges(),e.addRange(n)),!0)},_saveRange:function(e){if("undefined"==typeof e)try{var e=i.getRangeAt(0)}catch(e){return!1}this.currentRange=e.cloneRange()},_checkForTrigger:function(){var e=this._getCaretPosition();if(!e||-1==e.offset)return!1;var t=this._isTrigger(e.dom_node,e.offset);return this.currentTrigger=t,t},_checkRegexes:function(e){var t=this.options.regexes,n=t.length;if(!n)return!1;var i=null,o=this._getCaretPosition();if(-1==o.offset)return!1;if("keyup"==e.type){if(o.offset<3)return;o.offset--}if(i=this._getWord(o.dom_node,o.offset-1))for(var r=0;n>r;r++)i.word.match(t[r].regex)&&t[r].callback(i)},_isTrigger:function(e,t){var n=null;if(3===e.nodeType&&t>0){var i=e.nodeValue;if(!i)return null;var o=e.previousSibling,r=i.substr(0,t),s=e,d=-1,a=t,l=-1;if(o&&3===o.nodeType){var c=o.nodeValue;l=c.length,r=c+r}if(n=this._isTriggerCharInWord(r)){var f=r.substr(n.index+1),u=f.length;if(0===u)n=null;else{if(l>n.index){var h=r.length-l;h>-1&&(d=n.index,s=o,a=h)}-1==d&&(d=t-u-1),n.startOffset=d,n.startNode=s,n.word=f,n.endNode=e,n.endOffset=a}}}return this.currentTrigger=n,n},_getWordEnd:function(e){var t=200,n="",i=e.startNode,o=e.startOffset;for(e.word="";;){if(t--<=0)return!1;if(o>=i.nodeValue.length){if(null==i.nextSibling)return e.endNode=i,e.endOffset=o-1,e.word=n,e;if(3!=i.nextSibling.nodeType)return e.endNode=i,e.endOffset=o-1,e.word=n,e;if(i=i.nextSibling,o=0,0==i.nodeValue.length)continue}var r=i.nodeValue;if("​"!=r.charAt(o)){if(r.charAt(o).match(/\s+/))return e.endNode=i,e.endOffset=o-1,e.word=n,e;n+=r.charAt(o),o++}else o++}},_isTriggerCharInWord:function(e){var t=this.options.triggers;for(var n in t){var i=e.lastIndexOf(t[n].trigger);if(-1!==i)return t[n].index=i,t[n]}return!1},_isTriggerChar:function(e){var t=this.options.triggers;for(var n in t)if(e==t[n].trigger)return t[n];return!1},_getWord:function(e,t){for(var n=200,i={},o=!1;;){if(n--,0>=n)return!1;if(-1==t){if(null==e.previousSibling)break;if(3!=e.previousSibling.nodeType)break;e=e.previousSibling;var r=e.nodeValue;if(t=r.length-1,-1==t)continue}var r=e.nodeValue;if("​"!=r.charAt(t)){if(r.charAt(t).match(/\s+/))break;o=!0,t--}else t--}return i.startNode=e,i.startOffset=t+1,o?i=this._getWordEnd(i):!1},_checkForAdjacentObject:function(t){var n={},i=null;if(!(n=this._getCaretPosition()))return!1;if(i=n.dom_node,this._isEmbeddedObject(i))return{dom_node:i,container_spanned:!1,preventDefault:!0};if(0==(n=this._treeWalker(n.dom_node,n.offset,t)))return!1;if(0!=e(i).filter("[_moz_dirty]").length){if("left"!=t)return!1;if(0==(n=this._treeWalker(n.dom_node.previousSibling,n.offset,t)))return!1}if(3==n.dom_node.nodeType)if("left"==t&&0==n.offset){if(this._isEmbeddedObject(n.dom_node.previousSibling))return{dom_node:n.dom_node.previousSibling,container_spanned:!n.checkForObjects,preventDefault:n.preventDefault}}else if("right"==t&&n.offset==n.dom_node.nodeValue.length&&this._isEmbeddedObject(n.dom_node.nextSibling))return{dom_node:n.dom_node.nextSibling,container_spanned:!n.checkForObjects,preventDefault:n.preventDefault};return this._isEmbeddedObject(n.dom_node)?{dom_node:n.dom_node,container_spanned:!n.checkForObjects,preventDefault:n.preventDefault}:!1},_clickedOnObject:function(t){for(;e(t).attr("id")!=this.element.attr("id");){if(this._isEmbeddedObject(t))return t;t=t.parentNode}return!1},deleteObject:function(n){var i=t.getSelection(),o=n.parentNode,r=this._getObjectRange(n);r.deleteContents(),r.collapse(!0),i.removeAllRanges(),i.addRange(r),e(o).attr("id")!=this.element.attr("id")&&0==o.childNodes.length&&(r.setStartBefore(o),r.setEndAfter(o),r.deleteContents(),r.collapse(!0),i.removeAllRanges(),i.addRange(r)),this._saveRange()},_moveCaret:function(t,n,i){var o={};if(0==(o=this._treeWalker(t,n,i)))return!1;if("object"==o.type)return"left"==i?this._setCaretPositionRelative(o.dom_node,"after"):this._setCaretPositionRelative(o.dom_node,"before"),o;if("container"==o.type){if("left"==i){var r=o.dom_node.previousSibling;return"DIV"==r.nodeName||"P"==r.nodeName?0==r.childNodes.length?!1:(this._setCaretPositionRelative(r,"end"),o.dom_node=r.childNodes[r.childNodes.length-1],o):3==r.nodeType?(o.dom_node=r,0==o.dom_node.nodeValue.length?!1:(this._setCaretPositionRelative(o.dom_node,"end"),o)):(o.dom_node=r,this._setCaretPositionRelative(o.dom_node,"before"),o)}if(null==o.dom_node.nextSibling)return this._setCaretPositionRelative(o.dom_node,"after"),o;if("DIV"==o.dom_node.nextSibling.nodeName||"P"==o.dom_node.nextSibling.nodeName){if(0==o.dom_node.nextSibling.childNodes.length)return!1;o.dom_node=o.dom_node.nextSibling.childNodes[0]}return this._setCaretPositionRelative(o.dom_node,"after"),o}if("child"==o.type)return 3==o.dom_node.nodeType?0==o.dom_node.nodeValue.length?(this._selectTextNode(o.dom_node,0),o):(this._selectTextNode(o.dom_node,0),o):o;if(3==o.dom_node.nodeType)return o;if("BR"==o.dom_node.nodeName){if(0!=e(o.dom_node).filter("[_moz_dirty]").length)return"left"==i?(o.type="_moz_dirty",o.preventDefault=!0,this._setCaretPositionRelative(o.dom_node,"before"),o):(this._setCaretPositionRelative(o.dom_node,"after"),o);this._setCaretPositionRelative(o.dom_node,"left"==i?"before":"after")}return o},_backspaceZeroSpace:function(o){var r=null,s={},d={},a={},l=null;if(s=this._getCaretPosition(),r=s.dom_node,3!=r.nodeType&&"BR"!=r.nodeName)return!1;if("BR"==r.nodeName){if(e(r).filter("[_moz_dirty]").length)return"stop";var c=r.previousSibling;if(null==c)return this._setCaretPositionRelative(r,"before"),e(r).remove(),!0;if(3!=c.nodeType)return this._setCaretPositionRelative(r,"before"),e(r).remove(),o.preventDefault(),!0;this._setCaretPositionRelative(c,"end"),e(r).remove()}return a=this._getCaretPosition(),0==(d=this._walkTextNode(a.dom_node,a.offset,"left"))?!1:(i=t.getSelection(),l=n.createRange(),3!=d.dom_node.nodeType?l.setStartAfter(d.dom_node):l.setStart(d.dom_node,d.offset),l.setEnd(a.dom_node,a.offset),l.deleteContents(),i.removeAllRanges(),i.addRange(l),this._saveRange(),!0)},_deleteZeroSpace:function(){var e={},i={},o=null,r=null;return e=this._getCaretPosition(),3!=e.dom_node.nodeType?!1:0==(i=this._walkTextNode(e.dom_node,e.offset,"right"))?!1:e.dom_node===i.dom_node&&e.offset==i.offset?!1:(o=t.getSelection(),r=n.createRange(),r.setStart(e.dom_node,e.offset),3!=i.dom_node.nodeType?r.setEndBefore(i.dom_node):r.setEnd(i.dom_node,i.offset),r.deleteContents(),o.removeAllRanges(),o.addRange(r),this._saveRange(),!0)},_treeWalker:function(t,n,i){for(var o={type:""},r=100,s=!1,d=!1;null!=t;){if(r--<=0)return!1;if(3==t.nodeType){if(0==(o=this._walkTextNode(t,n,i)))return!1;switch(o.type){case"text":if(o.dom_node.nodeValue.length>0)return o.preventDefault=s,o;t="left"==i?o.dom_node.previousSibling:o.dom_node.nextSibling,n=-1;continue;case"element":case"object":t=o.dom_node,n=-1;break;case"container":s=!0,d=!0,n=-1,t=o.dom_node;break;case"end":return!1}}if(this._isEmbeddedObject(t)){var a=!0;return d&&(a=!1),{dom_node:t,offset:-1,type:"object",preventDefault:s,checkForObjects:a}}if("BR"==t.nodeName)return 0!=e(t).filter("[_moz_dirty]").length?{dom_node:t,offset:-1,type:"element",preventDefault:s,checkForObjects:!1}:{dom_node:t,offset:-1,type:"element",preventDefault:s,checkForObjects:!1};if("container"==o.type||"DIV"!=t.nodeName&&"SPAN"!=t.nodeName&&"P"!=t.nodeName){if("left"==i&&null==t.previousSibling||"right"==i&&null==t.nextSibling){if(e(t.parentNode).attr("id")==this.element.attr("id"))return!1;t=t.parentNode}t="left"==i?t.previousSibling:t.nextSibling,o.type=""}else{s=!0,d=!0;var l=t.childNodes;if(0==l.length){var c=this._insertEmptyNode(t,"child");return{dom_node:c,offset:0,type:"child",preventDefault:s,checkForObjects:!1}}var f=null;if(f="left"==i?l[l.length-1]:l[0],3!=f.nodeType&&!this._isEmbeddedObject(f)&&"DIV"!=f.nodeName&&"P"!=f.nodeName&&"BR"!=f.nodeName)return{dom_node:t,offset:-1,type:"child",preventDefault:s,checkForObjects:!1};if(3==f.nodeType&&null!=f.nodeValue.match(/^[\u200B]+$/))return{dom_node:f,offset:0,type:"child",preventDefault:s,checkForObjects:!1};t=f}}return!1},_walkTextNode:function(t,n,i){var o=200;if(3!=t.nodeType)return!1;switch(-1==n&&(n="left"==i?t.nodeValue.length:0),i){case"left":var r=!1;for(0==n&&(r=!0);;){if(o--<=0)return!1;if(r){if(r=!1,null==t.previousSibling)return e(t.parentNode).attr("id")==this.element.attr("id")?{dom_node:t,offset:0,type:"end",preventDefault:!1,checkForObjects:!0}:{dom_node:t.parentNode,offset:-1,type:"container",preventDefault:!1,checkForObjects:!0};if(3!=t.previousSibling.nodeType)return t=t.previousSibling,{dom_node:t,offset:-1,type:"element",preventDefault:!1,checkForObjects:!0};if(t=t.previousSibling,0==(n=t.nodeValue.length)){n=0,r=!0;continue}}if("​"!=t.nodeValue.charAt(n-1))return{dom_node:t,offset:n,type:"text",preventDefault:!1,checkForObjects:!1};n--,0==n&&(r=!0)}return!1;case"right":for(;;){if(o--<=0)return!1;if(n==t.nodeValue.length){if(null==t.nextSibling){if(e(t.parentNode).attr("id")==this.element.attr("id"))return{dom_node:t,offset:n,type:"end",preventDefault:!1,checkForObjects:!1};if(e(t.parentNode).attr("id")==this.element.attr("id")){var s=this._insertEmptyNode(t,"after");return{dom_node:s,offset:0,type:"end",preventDefault:!1,checkForObjects:!0}}return{dom_node:t.parentNode,offset:-1,type:"container",preventDefault:!1,checkForObjects:!0}}if(3!=t.nextSibling.nodeType)return t=t.nextSibling,{dom_node:t,offset:-1,type:"element",preventDefault:!1,checkForObjects:!0};if(t=t.nextSibling,n=0,0==t.nodeValue.length)continue}if("​"!=t.nodeValue.charAt(n))return{dom_node:t,offset:n,type:"text",preventDefault:!1,checkForObjects:!0};n++}return!1}},_highlightObject:function(){var t=!1;(t=this._checkForAdjacentObject("left"))&&(t.container_spanned||e(t.dom_node).addClass("highlight")),(t=this._checkForAdjacentObject("right"))&&(t.container_spanned||e(t.dom_node).addClass("highlight"))},_unHighlightObjects:function(t){var n=this;t.children().each(function(){return n._isEmbeddedObject(e(this).get(0))?void e(this).removeClass("highlight"):void(e(this).children().length>0&&n._unHighlightObjects(e(this)))})},_selectTextNode:function(e,i){if(3!=e.nodeType)return!1;var o=t.getSelection(),r=n.createRange();r.setStart(e,i),r.setEnd(e,i),r.collapse(!0),o.removeAllRanges(),o.addRange(r),this._saveRange(r)},_setCaretPositionRelative:function(n,i){var o=t.getSelection(),r=null;if(this._isEmbeddedObject(n)){switch(r=this._getObjectRange(n),i){case"before":case"beginning":r.collapse(!0);break;case"after":case"end":r.collapse(!1)}return o.removeAllRanges(),o.addRange(r),void this._saveRange()}switch(r=o.getRangeAt(0),i){case"before":if("BR"==n.nodeName){var s=this._insertEmptyNode(n,"before");return void this._setCaretPositionRelative(s,"end")}r.setStartBefore(n),r.setEndBefore(n),r.collapse(!0),o.removeAllRanges(),o.addRange(r),this._saveRange();break;case"after":if("BR"==n.nodeName){r.setStartBefore(n),r.setEndBefore(n),r.collapse(!1),o.removeAllRanges(),o.addRange(r),this._saveRange();break}r.setStartAfter(n),r.setEndAfter(n),r.collapse(!1),o.removeAllRanges(),o.addRange(r),this._saveRange();break;case"beginning":if(3!=n.nodeType)return;r.setStart(n,0),r.setEnd(n,0),r.collapse(!1),o.removeAllRanges(),o.addRange(r),this._saveRange();break;case"end":if(3!=n.nodeType)return;r.setStart(n,n.nodeValue.length),r.setEnd(n,n.nodeValue.length),r.collapse(!1),o.removeAllRanges(),o.addRange(r),this._saveRange()}if("DIV"==r.startContainer.nodeName&&e(r.startContainer).attr("id")==this.element.attr("id")&&r.startOffset==r.startContainer.childNodes.length){var s=this._insertEmptyNode(r.startContainer,"child");this._selectTextNode(s,0)}},_getObjectRange:function(e){var t=i.getRangeAt(0),o=null;if(i.rangeCount){var r=e.previousSibling;if(null==r){var s=this._insertEmptyNode(e,"before");t.setStart(s,0)}else if(3!=r.nodeType){var s=this._insertEmptyNode(e,"before");t.setStart(s,0)}else if(null==r.nodeValue){var s=this._insertEmptyNode(e,"before");t.setStart(s,0)}else if(0==r.nodeValue.length){var s=this._insertEmptyNode(e,"before");t.setStart(s,0)}else t.setStart(r,r.nodeValue.length);o=n.createRange();var d=e.nextSibling;if(null==d){var s=this._insertEmptyNode(e,"after");t.setEnd(s,1)}else if(3!=d.nodeType){var s=this._insertEmptyNode(e,"after");t.setEnd(s,1)}else if(null==d.nodeValue){var s=this._insertEmptyNode(e,"after");t.setEnd(s,1)}else if(0==d.nodeValue.length){var s=this._insertEmptyNode(e,"after");t.setEnd(s,1)}else if("​"!=d.nodeValue){var s=this._insertEmptyNode(e,"after");t.setEnd(s,1)}else t.setEnd(d,1);return t}},_getCaretPosition:function(){var n=null,i=null,o=null;try{var r=t.getSelection().getRangeAt(0)}catch(e){return!1}if(!r.collapsed)return!1;if(n=r.startContainer,o=this._isEmbeddedObject(n))return{dom_node:o,offset:-1};if(3==n.nodeType)return{dom_node:n,offset:r.startOffset};if(e(n).attr("id")==this.element.attr("id")||"DIV"==n.nodeName||"P"==n.nodeName){if(0==n.childNodes.length)return i=this._insertEmptyNode(n,"child"),this._selectTextNode(i,0),{dom_node:i,offset:0};if(r.startOffset>=n.childNodes.length)return i=this._insertEmptyNode(n,"after"),this._selectTextNode(i,1),{dom_node:i,offset:1};if(n=n.childNodes[r.startOffset],3==n.nodeType)return this._selectTextNode(n,0),{dom_node:n,offset:0}}return{dom_node:n,prevNode:n.previousSibling,offset:-1}},_insertSelection:function(e,t){this.replaceWord(e,t.content,t.value),this.selectionEntered=!0},replaceWord:function(e,t,i){var o=n.createRange();o.setStart(e.startNode,e.startOffset),o.setEnd(e.endNode,e.endOffset),o.deleteContents(),this._saveRange(o),this.insertObject(t,i)},_insertEmptyNode:function(t,n,i){"undefined"==typeof i&&(i=!1);var o=document.createTextNode("​");switch(n){case"before":if(!i&&null!=t.previousSibling&&3==t.previousSibling.nodeType&&t.previousSibling.nodeValue.length>0)return t.previousSibling;e(o).insertBefore(t);break;case"after":if(!i&&null!=t.nextSibling&&3==t.nextSibling.nodeType&&t.nextSibling.nodeValue.length>0)return t.nextSibling;e(o).insertAfter(t);break;case"child":var r=t.childNodes,s=r.length;if(s&&3==r[s-1].nodeType)return r[s-1];e(o).appendTo(t)}return o},_checkSibling:function(t,n){var i="prev"==n?t.previousSibling:t.nextSibling;if(null!=i){if(this._isEmbeddedObject(i))return this._insertEmptyNode(i,"before"),void this._insertEmptyNode(i,"after");if("BR"==i.nodeName)return this._insertEmptyNode(i,"before"),void this._insertEmptyNode(i,"after");if("SPAN"==i.nodeName||"DIV"==i.nodeName||"P"==i.nodeName){var o=i.childNodes,r=o.length;if(0==r)return void this._insertEmptyNode(i,"child");if(1==r&&"BR"==o[0].nodeName){var s=o[0];return this._insertEmptyNode(s,"before"),void e(s).remove()}this._insertEmptyNode(o[0],"before"),this._insertEmptyNode(o[r-1],"after")}}},_isEmbeddedObject:function(t){return null==t?!1:null!=e(t).attr("data-value")?t:e(t).parents("[data-value]").get(0)},insertObject:function(n,i){if(this.element.focus(),!this.currentRange){var o=this._insertEmptyNode(this.element.get(0),"child");this._selectTextNode(o,1)}var r=t.getSelection(),s=this.currentRange;r.removeAllRanges(),r.addRange(s);var d=document.createElement("div");d.innerHTML=n.replace(/^[\s\u200B]+|[\s\u200B]+$/g,"");var a=e(d).contents();a.attr("data-value",i);var l=a.get(0);s.insertNode(l),s.setStartAfter(l),s.collapse(!0),r.removeAllRanges(),r.addRange(s);var o=this._insertEmptyNode(l,"before",!0),c=this._insertEmptyNode(l,"after",!0);this._selectTextNode(c,1)},getTextContent:function(){var e=this._getTextWithLineBreaks(this.element.get(0).childNodes);return e.replace(/[\u200B]/gm,"")},_getTextWithLineBreaks:function(t){for(var n,i=["BR","DIV","P"],o="",r=0;t[r];r++)n=t[r],this._isEmbeddedObject(n)?o+="[o="+e(n).attr("data-value")+"]":(3==n.nodeType||4==n.nodeType?o+=n.nodeValue.replace(/[\n]/gm,""):-1!=e.inArray(n.nodeName,i)&&(o+="\n"),8!==n.nodeType&&(o+=this._getTextWithLineBreaks(n.childNodes)));return o},clear:function(){this.element.empty()},focus:function(){var e=n.createRange();e.setStart(this.element.get(0),0),this.element.focus()}})}(jQuery);var rich_textarea={getCustomTop:function(){var e=window.getSelection();return e.rangeCount&&(range=e.getRangeAt(0).cloneRange(),range.getClientRects())?(range.collapse(!0),range.getClientRects()[0].top):0}};
function bindUserMentions(e,t){e.rich_textarea({triggers:[{trigger:"@",callback:function(e,n){n($.ui.autocomplete.filter(t,e,10))}}]})}function getRichTextContent(e){e.html(e.html().replace(/&nbsp;/gi," "));var t=actualRichTextContent(e[0].childNodes);return t=t.replace(/\u200B/gm,"").replace(/&nbsp;/g," "),$.trim(t)}function actualRichTextContent(e){for(var t=e.length,n="",a=0;t>a;a++){var i=e[a];if(8!==i.nodeType)if(3===i.nodeType||4===i.nodeType)n+=i.textContent;else if(i.getAttribute("type")&&!isNaN(i.getAttribute("data-value")&&i.textContent.length)){var l=i.getAttribute("type");if("G"===l||"C"===l){var r=("G"===l?"group":"user")+":mention";n+="<"+r+">"+i.getAttribute("data-value")+":"+i.textContent+"</"+r+">"}}else if("BR"===i.tagName)n+="\n";else if("P"===i.tagName)n+="\n"+actualRichTextContent(i.childNodes);else if("DIV"===i.tagName){var s=i.childNodes;n+=1===s.length&&"BR"===s[0].tagName?"\n":"\n"+actualRichTextContent(s)}else n+=i.textContent}return n}function isRichTextNotEmpty(e){for(var t=e[0].childNodes,n=t.length,a=0;n>a;a++){var i=t[a],l="";if(8!==i.nodeType){if(3===i.nodeType||4===i.nodeType)l=i.textContent;else if("BR"===i.tagName||"P"===i.tagName)l+="\n";else if("DIV"===i.tagName){var r=i.childNodes;l=1===r.length&&"BR"===r[0].tagName?"\n":"\n"}else l=i.textContent;if($.trim(l.replace(/\u200B/gm,"")).length)return!0}}return!1}function handlePasteInRichContent(e,t){if(window.clipboardData){e.preventDefault();var n=void 0!=t?t.height():0;return document.selection.createRange().pasteHTML(window.clipboardData.getData("Text")),$("#discussionTray").scrollTop($("#discussionTray").scrollTop()+((void 0!=t?t.height():0)-n)),!0}if(document.queryCommandEnabled("insertHTML")&&(e.originalEvent||e).clipboardData){e.preventDefault();var n=void 0!=t?t.height():0,a=(e.originalEvent||e).clipboardData.getData("text/plain"),i=window.getSelection();return i.rangeCount>0&&document.execCommand("insertHTML",!1,a.replace(/</gm,"&lt;").replace(/>/g,"&gt;").replace(/\u200B/gm,"").replace(/\n/gm,"<br>")),$("#discussionTray").scrollTop($("#discussionTray").scrollTop()+((void 0!=t?t.height():0)-n)),!0}return!1}function convertRichTextContent(e){if(void 0==e)return"";e=e.replace(/<\/?a.*?>/,"");var t=/((<user:mention>[0-9]+:.+?<\/user:mention>)|(<group:mention>[0-9]+:.+?<\/group:mention>))/g,n=e.match(t);if(n)for(var a=n.length,i=0;a>i;i++){var l=n[i];if(0===l.indexOf("<user:mention>")){var r=l.replace(/<\/?user:mention>/g,"").split(":");e=e.replace(l,'​<span type="C" spellcheck="false" class="highlight" contenteditable="false" data-value='+r[0]+">"+r[1]+"</span>&#8203;​")}else if(0===l.indexOf("<group:mention>")){var s=l.replace(/<\/?group:mention>/g,"").split(":");e=e.replace(l,'​<span type="G" spellcheck="false" class="highlight" contenteditable="false" data-value='+s[0]+">"+s[1]+"</span>​")}}return e=e.replace("<br>","<br>​")}function updateEditedContent(e,t){e=e.replace(/<\/?a.*?>/,"");for(var n=/((<user:mention>[0-9]+:.+?<\/user:mention>)|(<group:mention>[0-9]+:.+?<\/group:mention>))/g,a=e.match(n),i=a.length,l=0;i>l;l++){var r=a[l];if(0===r.indexOf("<user:mention>")){var s=r.replace(/<\/?user:mention>/g,"").split(":");e=e.replace(r,'​<span type="C" spellcheck="false" class="highlight" contenteditable="false" data-value='+s[0]+">"+s[1]+"</span>​")}else if(0===r.indexOf("<group:mention>")){var o=r.replace(/<\/?group:mention>/g,"").split(":");e=e.replace(r,'​<span type="G" spellcheck="false" class="highlight" contenteditable="false" data-value='+o[0]+">"+o[1]+"</span>​")}}t.html(e);var c=t.get(0).lastChild;if(c){var p=c.textContent.length,u=document.getSelection(),g=document.createRange();g.setStart(c,p),g.setEnd(c,p),g.collapse(!0),u.removeAllRanges(),u.addRange(g)}e=e.replace("<br>","<br>​"),t.focus(),bindUserMentions(t,mentionsData)}function connectProcessMention(e,t){if(t){var n=t.attr("streamType");if("3"===n||"6"===n||"13"===n)return void t.find(".mention").unbind("paste").bind("paste",function(e){handlePasteInRichContent(e)})}var a=mentionsData,i=e.attr("participantsMentionData");if(i){var l=JSON.stringify(mentionsData);l=l.substring(1),l="["+i+","+l,a=$.parseJSON(l)}bindUserMentions(e,a)}var mentionsData=[];$.ui.autocomplete.filter=function(e,t,n){var a=[],i=0,l=[],r="";t=t.replace(/\u200B/gm,"").replace(/&nbsp;/g," ").replace(/\s/g," ");var s=new RegExp("^"+$.ui.autocomplete.escapeRegex(t),"i"),o=new RegExp($.ui.autocomplete.escapeRegex(t),"i");return $.each(e,function(e,t){if(n===i)return!1;if("G"===t.type&&2!=t.status&&-1===l.indexOf(t.id)&&o.test(t.name)){l.push(t.id);var c={};c.value={value:t.id,content:"<span type="+t.type+' spellcheck="false" contenteditable="false">'+t.name+"</span> "},c.label="<img src='"+r+"'> <span class='nameCont'>"+t.name+"</span>",a.push(c),i++}else if("C"===t.type&&-1===l.indexOf(t.id)&&(s.test(t.name)||s.test(t.email)||s.test(t.fullname))){r=PHOTO_SERVER_URL+"/file?fs=thumb&ID="+t.id,l.push(t.id);var c={};c.value={value:t.id,content:"<span type="+t.type+' spellcheck="false" contenteditable="false">'+t.name+"</span> "},c.label="<img src='"+r+"' class='sI'> <span class='nameCont sN'>"+t.name+"</span>",a.push(c),i++}}),a};
var LinkMaker=function(){var e='style="text-decoration: underline; cursor: pointer;"',l=function(l){var i="HTTP://",t="HTTPS://",s="WWW.",r=!1,a=l.toUpperCase();if(0===a.indexOf(i)||0===a.indexOf(t)||0===a.indexOf(s))if(r=!0,0===a.indexOf(s)){var n="http://";l='<a href="'+n+l+'" title="'+l+'" target="_blank" rel="noreferrer" '+e+" >"+l+"</a>"}else l='<a href="'+l+'" title="'+l+'" target="_blank" rel="noreferrer" '+e+" >"+l+"</a>";return{hasUrl:r,msg:l}},i=function(l){var i=!1;return validateEmail(l)&&(i=!0,l='<a href="mailto:'+l+'" title="mailto:'+l+'" '+e+" >"+l+"</a>"),{hasEmailId:i,msg:l}},t=function(l,i,t){var s=!1;if(l&&0==l.indexOf("#")){l=l.substr(1);var r=l;if(l.indexOf(".")>=0&&2==l.split(".").length&&CellUtils.isDefinedSheet(l.split(".")[0])){var a=l.split(".")[1];a.indexOf(":")>=2?CellUtils.isCellLabel(a.split(":")[0])&&CellUtils.isCellLabel(a.split(":")[1])&&(s=!0):CellUtils.isCellLabel(a)&&(s=!0)}else if(CellUtils.isDefinedSheet(l))s=!0;else if(l.indexOf(":")>=2){if(CellUtils.isCellLabel(l.split(":")[0])&&CellUtils.isCellLabel(l.split(":")[1])&&(s=!0,i&&CellUtils.isDefinedSheet(i)))var r=i+"."+l}else if(CellUtils.isCellLabel(l)&&(s=!0,i&&CellUtils.isDefinedSheet(i)))var r=i+"."+l;l=s?t?"<a onclick=\"Discussion.disableCmtHgltOnFocus=true;Goto.gotoCellInit('"+r+'\');" title="#'+l+'" '+e+" >"+l+"</a>":"<a onclick=\"Goto.gotoCellInit('"+r+'\')" title="#'+l+'" '+e+" >"+l+"</a>":"#"+l}return{hasSheetRef:s,msg:l}},s=function(e){var l=!1;try{if(0==Object.keys(wmsSmiley).length){Smiley.init();for(el in Smiley.defaultsmiley_lookup)wmsSmiley[el.toUpperCase()]=Smiley.defaultsmiley_lookup[el];for(el in Smiley.extrasmiley_lookup)wmsSmiley[el.toUpperCase()]=Smiley.extrasmiley_lookup[el]}var i=wmsSmiley[revertJsonSplChrs(e).toUpperCase()];i&&(l=!0,e='<img src="'+IMAGE_PATH+'spacer.gif" class="wmssmils wmssmil-'+i+'" symbol="'+e+'" title="'+i+'" />')}catch(e){}return{hasSmiley:l,msg:e}},r=function(l){var i=!1;return l&&0==l.indexOf("#")&&Discussion&&Discussion.all[l.substr(1)]&&(i=!0,l=l.substr(1),l="<a onclick=\"Discussion.Notification.gotoCmt('"+l+'\')" title="#'+l+'" '+e+" >"+l+"</a>"),{hasCommentRef:i,msg:l}},a=function(e,a,n){for(var o=!1,m=!1,f=!1,u=!1,c=!1,h=!1,g=e.split("<br>"),C=0;C<g.length;C++){for(var p=g[C],d=p.split(" "),v=0;v<d.length;v++){var y=!1;d[v]=d[v].replace(/[\u200B-\u200D\uFEFF]/g,"");var S=l(d[v]);y=m=S.hasUrl,d[v]=S.msg,y||(S=i(d[v]),y=f=S.hasEmailId,d[v]=S.msg),y||(S=t(d[v],a,n),y=u=S.hasSheetRef,d[v]=S.msg),y||(S=r(d[v]),y=h=S.hasCommentRef,d[v]=S.msg),y||(S=s(d[v]),y=c=S.hasSmiley,d[v]=S.msg),p=d.join(" "),o=o||y}g[C]=p.trim(),e=g.length>1?g.join("<br>"):g[0].toString()}return{hasLinkMsg:o,msg:e}};return{convert:a}}(jQuery);
var Discussion={on:!1,isAddCmtOn:!1,all:{},sJson:{},range:{},prevFDsn:[],cmtLimit:2,isOwnerRCo:!1,rangeEdit:!1,currRangeTF:null,urCount:0,setFocusOn:!1,currRange:{},contentLimit:5e3,mTB:0,unreadDisTrayHeight:0,spotLightColor:"#fff9f3",ellipsesAdded:!1,ellipResAdded:!1,isHlgtEnabled:!1,activeCmtId:null,isHlgtEnabledOnLoad:!1,isPanelClosed:!1,allowAutoOpen:!0,disableCmtHgltOnFocus:!1,animateShowGetter:!0,readNtfn:!1,ntfnJson:{},notifyByTimeJson:{},cmtReady:!1,sheetHglgt:null,CommentsFilterState:"",cardConstructed:!1,cardConstructedRes:!1,getterAfterload:!1,init:function(){void 0!=$("#discussionContainer")[0]?!0:!1;return Discussion.on=-1!=zuid&&!cdview&&ALLOW_TO_COMMENT?!0:!1,Discussion.on?($("#dnPG").mouseenter(function(){featurePermission.setPermission({allowToScroll:!1,contextmenu:!1})}).mouseleave(function(){featurePermission.setPermission({allowToScroll:!0,contextmenu:!0})}),Discussion.reInitHighlightEl(),Discussion.Smiley.populate(),$("body").on("mouseup",function(s){$("#dnFO").is(":visible")&&$("#cBc").click(),$("#dnFO1").is(":visible")&&$("#cBc1").click(),$("#dnFO2").is(":visible")&&$("#cBc2").click(),$("#discussionTray #btnBox :visible").length>0&&Discussion.hideResolveMenu(s),$("#discussionTray #iIt").hide()}),void $("#discussionmenu").unbind("menubeforeshow").bind("menubeforeshow",function(){Object.keys(Discussion.all).length>0?$("#discussionmenu #highlgtAll").enable():$("#discussionmenu #highlgtAll").disable(),Discussion.isHlgtEnabled?$("#discussionmenu").zmenu("changeIcon","highlgtAll","ui-individual-icon ui-icon-ztick"):$("#discussionmenu").zmenu("changeIcon","highlgtAll","ui-zmenu-no-icon")})):!1},showNotificationPanel:function(s){$(".rPdC#discussionTray").css({zIndex:"0"}),$("#dCdA").removeClass("fTnM"),$(".rPdC#discussionTray .dC").is(":visible")&&$(".rPdC#discussionTray .dC").hide(),s&&$(".rPdC").css({transition:"all 0s linear","-webkit-transition":"all 0s linear","-o-transition":"all 0s linear","-ms-transition":"all 0s linear"}),$(".rPdC").css("overflow","hidden").addClass("flip").delay(500).queue(function(){s&&$(".rPdC").css({transition:"all 0.3s linear","-webkit-transition":"all 0.3s linear","-o-transition":"all 0.3s linear","-ms-transition":"all 0.3s linear"}),$(this).css("overflow-y","auto").dequeue()}),Discussion.Ajax.unread()},backToFilter:function(s){s||($(".rPdC#discussionTray").css("zIndex",1),$(".rPdC").css("overflow","hidden").removeClass("flip").delay(500).queue(function(){$(this).css("overflow-y","auto").dequeue()})),$("#displayNotify").hide(),$("#displayFilter").show(),$("#gotoDnCmts").hide(),Discussion.Filter.showNoCmtDiv()},allowComments:function(){var s=void 0!=$("#discussionContainer")[0]?!0:!1;return Discussion.on=s&&-1!=zuid&&!cdview&&ALLOW_TO_COMMENT?!0:!1,Discussion.on},focusComment:function(){Discussion.AttachEvent.showMyRange(Discussion.activeCmtId,!0),$($("#dnC_"+Discussion.activeCmtId)[0]).trigger("click").focus(),Discussion.AttachEvent.showMyRange(Discussion.activeCmtId,!1)},getScrollState:function(){for(var s=$("#discussionTray").children().length,i=$("#discussionTray").children(),e=$("#discussionTray").offset().top,n=$("#discussionTray").height(),t=null,o=null,c=null,l=0;s>l;l++){t=$($(i)[l]).offset().top;var d=$($(i)[l])[0],a=$(d).find("#dnE"),r=$(a).length;if(r>0&&(o=$($(a)[0]).offset().top),o>=e&&e+n>=o){c=$(i)[l];break}if(t>e+n)break}return c},persistScrollState:function(s,i,e){var n=$("#discussionTray").prop("scrollHeight"),t=n-s,o=$(i).offset().top;e!=o&&$("#discussionTray").scrollTop($("#discussionTray").scrollTop()+t)},reInitHighlightEl:function(){if(!Discussion.on)return!1;var s="dnFCA";$("#dnFC").hide(),$("#dnFCA").empty(),$("div[he^="+s+"]").length>0&&$("div[he^="+s+"]").remove(),$("#dnFCA").clone().appendTo("#sP1").attr("id","dnFCA1").attr("he",s),$("#dnFCA").clone().appendTo("#sP2").attr("id","dnFCA2").attr("he",s),$("#dnFCA").clone().appendTo("#sP3").attr("id","dnFCA3").attr("he",s)},setFocus:function(){if(void 0!=$("#ND").find("#dnE")[0]){var s=$("#ND").find("#dnE")[0];range=document.createRange(),range.selectNodeContents(s),range.collapse(!1),selection=window.getSelection(),selection.removeAllRanges(),selection.addRange(range)}},endRangeEdit:function(){Discussion.rangeEdit=!1,RangeSelector.off()},hideDefaultRangeSelector:function(){Discussion.rangeEdit&&$("#rangeSelectorDialog").hide()},showUnread:function(){Discussion.isAddCmtOn=!1,$("#unread_discussionTray").show(),$("#gotoDnCmts").show(),Discussion.urCount=0,Discussion.showNoNtfnDiv(),Discussion.showUnreadCount(),Discussion.Notification.closeFlashMsg();for(var s=$("#unread_discussionTray div[countable^='T']"),i=s.length,e=0;i>e;e++)$(s[e]).find("#dnCM_msg_R").length>0?Discussion.checkEllipse($(s[e]).find("#dnCM_msg_R")[0],void 0,void 0,void 0,!0):Discussion.checkEllipse($(s[e]).find("#dnCM_Content")[0],void 0,void 0,void 0,!0);$("#unread_discussionTray div[id^='ur_']").removeAttr("countable")},showUnreadCount:function(){Discussion.urCount>0?Discussion.isPanelOpened()?$("#cmtUnread").text(Discussion.urCount).show():($("#statusBar #cmtNotify").text(Discussion.urCount).show(),$("#statusBar #sD").addClass("chatBlink")):($("#statusBar #cmtNotify").text("").hide(),$("#statusBar #sD").removeClass("chatBlink"),$("#cmtUnread").text("").hide())},showNoNtfnDiv:function(){Discussion.urCount>0||$("#unread_discussionTray_1 > div").length>0?$("#noNtfn").is(":visible")&&($("#noNtfn").hide(),$("#gotoDnCmts").addClass("dS")):($("#noNtfn").show(),0==Object.keys(Discussion.all)?($("#nNmsg").show(),$("#nCRmsg").hide()):($("#nNmsg").hide(),$("#nCRmsg").show()),$("#gotoDnCmts").removeClass("dS"))},updateSharedUsers:function(s){var i=s.ACTION;("RESOURCE_SHARED"==i||"RESOURCE_UNSHARED"==i)&&Discussion.Ajax.updateSharedUsers()},shRename:function(s,i){Discussion.DJsonUtil.shRename(s,i)},shRemove:function(s){Discussion.DJsonUtil.shRemove(s)},AuthenticateOptions:function(s,i,e){var n=$($(e).find("#dnCM_Delete")[0]),t=$($(e).find("#dnCM_Edit")[0]),o=$($(e).find("#dnCM_ReOpen")[0]).hide(),c=$($(e).find("#dnCM_resolve")[0]).hide(),l=!1;return i?(ALLOW_TO_COMMENT&&($(o).show(),l=!0),(s||Discussion.isOwnerRCo)&&($(n).show(),l=!0)):(s||Discussion.isOwnerRCo?($(n).show(),$(c).show(),l=!0):($(n).hide(),$(c).remove()),s?($(t).show(),l=!0):$(t).remove()),ALLOW_TO_COMMENT||($($("#dnC_"+e).find("#dnR")[0]).hide(),$(c).remove(),$(t).remove(),$(n).remove()),l},highlightComments:function(){Discussion.isHlgtEnabled?($("#discussionContainer #dnFHglt").removeClass("selected"),$("#sheetsTab .cSc").hide(),Discussion.reInitHighlightEl(),Discussion.isHlgtEnabled=!1):($("#discussionContainer #dnFHglt").addClass("selected"),$("#sheetsTab .cSc").css("display","inline-block"),Discussion.highlightAllCmtRange(!1),Discussion.isHlgtEnabled=!0)},showResolveMenu:function(s,i){return $($("#"+i).find("#btnBox")[0]).stop(!0).animate({"border-bottom":"0","border-radius":"0"},200).show(),$($("#"+i).find("#optBox")[0]).stop(!0).animate({top:"12"},200).show(),!1},hideResolveMenu:function(s){return $("#discussionTray #btnBox").stop(!0).animate({"border-bottom":"1","border-radius":"20"},100).hide(),$("#discussionTray #optBox").stop(!0).animate({top:"0"},100).hide(),stopEvent(s),!1},hasComments:function(s){return void 0!=Discussion.range[s]&&(noOfComments=Object.keys(Discussion.range[s]).length)>0?noOfComments:!1},isDisRangeDelete:function(s,i,e,n){if(0==Object.keys(Discussion.all))return!1;for(var t=Object.keys(Discussion.range[s]).length,o=Object.keys(Discussion.range[s]),c=0,l=0;t>l;l++){var d=Discussion.range[s][o[l]],a=d.sc,r=d.ec,u=e+n-1;i&&(a=d.sr,r=d.er),a>=e&&u>=r&&(c+=1)}return c>0&&!showConfirmDialog(replaceParams(jsMsg["Discussion.DeleteCommentsOnRange"],new Array(c+"")))?!0:void 0},shiftRanges:function(s,i,e,n,t,o,c){if(0==Object.keys(Discussion.all))return!1;var l=t,d=e,a=i,r=a+n-1;o&&(l=n,d=i,a=e,r=a+t-1);var u=(Discussion.range[s],Object.keys(Discussion.range[s]).length),D=Object.keys(Discussion.range[s]),h=d+l-1;l=c?-l:l;for(var f=0;u>f;f++){var C=Discussion.range[s][D[f]],$=[],m=o?C.sr:C.sc,g=o?C.er:C.ec,v=o?C.sc:C.sr,p=o?C.ec:C.er;if(g>=d&&v>=a&&r>=p){var S=v>=d?m+l:m;if(c&&h>=g)Discussion.RangeJsonUtil.remove(s,D[f]),Discussion.DJsonUtil.remove(D[f]),Discussion.SJsonUtil.remove(D[f]),Discussion.Panel.remove(D[f]),Discussion.Filter.update();else{var _=g+l;$.sr=o?S:v,$.er=o?_:p,$.sc=o?v:S,$.ec=o?p:_,Discussion.range[s][D[f]]=$;var E=Discussion.Utilities.getCellLabel(void 0,$.sr,$.sc,$.er,$.ec);Discussion.Panel.updateRange(D[f],E),Discussion.DJsonUtil.updateCellRef(D[f],$,s),Discussion.AttachEvent.showMyRange(D[f],!1)}}}},updateRanges:function(s,i,e,n,t){if(0==Object.keys(Discussion.all).length)return!1;for(var o=n+t-1,c=(Discussion.range[s],Object.keys(Discussion.range[s]).length),l=Object.keys(Discussion.range[s]),d=0;c>d;d++){var a=Discussion.range[s][l[d]],r=a.sc,u=a.ec,D=[],h=!0;if(i&&(r=a.sr,u=a.er),e){if(n>u){h=!1;continue}r>=n&&o>=u?(Discussion.RangeJsonUtil.remove(s,l[d]),Discussion.DJsonUtil.remove(l[d]),Discussion.SJsonUtil.remove(l[d]),Discussion.Panel.remove(l[d]),h=!1):n>r&&u>o?(D.er=i?u-t:a.er,D.ec=i?a.ec:u-t,D.sr=a.sr,D.sc=a.sc):r>n&&r>o?(D.sr=i?r-t:a.sr,D.er=i?u-t:a.er,D.sc=i?a.sc:r-t,D.ec=i?a.ec:u-t):r>=n&&o>=r?(r=o+1,D.sr=i?r-t:a.sr,D.er=i?u-t:a.er,D.sc=i?a.sc:r-t,D.ec=i?a.ec:u-t):u>=n&&o>=u&&(D.er=i?n-1:a.er,D.ec=i?a.ec:n-1,D.sr=a.sr,D.sc=a.sc)}else{if(n>u){h=!1;continue}(i?r>=getRowMax():r>=getColMax())?(h=!1,Discussion.RangeJsonUtil.remove(s,l[d]),Discussion.Panel.remove(l[d]),Discussion.DJsonUtil.remove(l[d]),Discussion.SJsonUtil.remove(l[d])):n>r?(D.er=i?u+t:a.er,D.ec=i?a.ec:u+t,D.sr=a.sr,D.sc=a.sc):(r>=o||o>r)&&(D.sr=i?r+t:a.sr,D.er=i?u+t:a.er,D.sc=i?a.sc:r+t,D.ec=i?a.ec:u+t)}if(h){Discussion.range[s][l[d]]=D;var f=Discussion.Utilities.getCellLabel(void 0,D.sr,D.sc,D.er,D.ec);Discussion.Panel.updateRange(l[d],f),Discussion.DJsonUtil.updateCellRef(l[d],D,s),Discussion.AttachEvent.showMyRange(l[d],!1)}}Discussion.Filter.update()},contentValidation:function(s){return""===s?!1:s.length>Discussion.contentLimit?(showAlertDialog(replaceParams(jsMsg["Discussion.ContentExceedInfo"],new Array(Discussion.contentLimit+""))),!1):!0},add:function(){var s=$("#ND"),i=$(s.find("#dnE")[0]),e=$(s.find("#dCellRef")[0]).val(),n=($(s.find("#dCellRef")[0]).attr("asn"),Discussion.Utilities.getRange(!0,$(s.find("#dCellRef")[0]))),t=getRichTextContent(i);return Discussion.contentValidation(t)?($(i)[0].contentEditable="false",Discussion.ShareViaCmt.do(t,function(s){Discussion.Ajax.do(ActionConstants.DISCUSSION_ADD,null,encodeURIComponent(s),n,WorkSheets.getSheetCodeFromName(CellUtils.getSheetNameFromCelLbl(e)))},s),void Discussion.showLoader(s)):!1},edit:function(s){Discussion.Utilities.edit(s,!1)},delete:function(s){Discussion.Ajax.do(ActionConstants.DISCUSSION_DELETE,s)},deleteAll:function(){if($("#dCdA").addClass("fTnM"),$(".rPdC").css("overflow","hidden"),!(Object.keys(Discussion.all).length>0))return!1;var s,i,e=null!=Discussion.Filter.sheetname?Discussion.Filter.sheetname:jsMsg["Discussion.HDAllSheet"];switch(Discussion.Filter.state){case"active":if(!(Discussion.SJsonUtil.getCounts().active>0))return!1;s=replaceParams(jsMsg["Discussion.UnresolvedCommentDeleteConfirmation"],new Array(e)),i=0;break;case"resolved":if(!(Discussion.SJsonUtil.getCounts().resolved>0))return!1;s=replaceParams(jsMsg["Discussion.ResolvedCommentDeleteConfirmation"],new Array(e)),i=1;break;case"all":if(!(Discussion.SJsonUtil.getCounts().all>0))return!1;s=replaceParams(jsMsg["Discussion.AllCommentDeleteConfirmation"],new Array(e)),i=2}$("#discussionContainer #noComment").hide();var n=$("#discussionTray");n.scrollTop("0"),$(".dC").hide(),$("#dltA_dlg").detach().prependTo(n).css({height:n.outerHeight()+"px",left:n.offset().left+4+"px",top:n.offset().top+"px"}).show(),$("#dltA_dlg").find("#dCdM").text(s),Discussion.AttachEvent.esc(),$("#dltA").unbind("click").click(function(){Discussion.Ajax.do(ActionConstants.DISCUSSION_DELETE_ALL,null,null,null,null,i),$("#dCdA").removeClass("fTnM"),$(".rPdC").css("overflow","auto")}),$("#cnlA").unbind("click").click(function(){Discussion.hideDeleteAll(),$("#dCdA").removeClass("fTnM"),$(".rPdC").css("overflow","auto")})},reset:function(){$("#ND").remove(),Discussion.isAddCmtOn=!1,Discussion.Filter.showNoCmtDiv(),Discussion.highlightActiveComment(Discussion.prevFDsn,!1),Discussion.endRangeEdit()},cancelEdit:function(s){Discussion.Utilities.cancelEdit(s,!1)},hideSbarCmtIcon:function(){$("#statusBar #hD").is(":visible")&&$("#hD").css("display","none"),$("#statusBar #sD").is(":visible")&&$("#sD").css("display","none")},showAll:function(s,i){isRTL&&(document.getElementById("ssHScrollbar").style.direction="rtl"),Discussion.isAddCmtOn=!1,docPanel.show("discussion"),""==Discussion.Filter.state&&(Discussion.cardConstructed||Discussion.constructCmtDiv(Discussion.Filter.defaultState),Discussion.Filter.show(Discussion.Filter.defaultState),Discussion.highlightMyDiscussion(!0)),Discussion.toggle(),Discussion.ellipsesAdded||(Discussion.showEllipsis(Discussion.Filter.defaultState),Discussion.ellipsesAdded=!0),$.ui.utils.initComponents($("#disFilter")),s&&Discussion.urCount>0&&!i&&Discussion.showNotificationPanel(!0)},constructCmtDiv:function(s){Discussion.cardConstructed=!0,s==Discussion.Filter.resolvedState&&(Discussion.cardConstructedRes=!0);for(var i in Discussion.sJson)if(Discussion.sJson[i]==s){var e="#dnC_"+i,n=$(e);Discussion.Utilities.getDS(Discussion.all[i],!1,$(n.find("#dnPG")[0]),i,!1);var t=Discussion.all[i].cmtA;if(void 0!=t&&Object.keys(t).length>0){var o=Object.keys(t).length,c=0;for(var l in t){var d=c>=o-Discussion.cmtLimit?!1:!0;o>Discussion.cmtLimit?n.find("#dnCM_viewOlderReplies").text(replaceParams(jsMsg["Discussion.ViewOlderReplies"],new Array(o-Discussion.cmtLimit+""))).show():n.find("#dnCM_hideReplies").show(),Discussion.Utilities.getDS(t[l],!0,$(n.find("#dnPG")[0]),i,!1,d,s),c++}}}},showEllipsis:function(){if(!browser_ie)for(var s in Discussion.all)if(Discussion.checkEllipse($("#p_"+s)[0],!1,s),Discussion.all[s].cmtA)for(var i in Discussion.all[s].cmtA)Discussion.checkEllipse($("#p_"+i)[0],!0,i)},checkEllipse:function(s,i,e,n,t){var o,c=t?36:54;void 0!=i?(o=$(s).find("#dnCM_Content"),c=i?54:72):o=$(s);var l=$(o).prop("scrollHeight"),d=$(o).innerHeight();if(d>=l&&!n)return Discussion.removeEllipClass(s,i),!1;t&&$(o).css("max-height","60px"),Discussion.removeEllipClass(s,i);var a="more_"+e,r=$(o).contents();$(o).html("");var u=0,D=0,h=1,f=18,C=0,m=r.length;for(C=0;m>C;C++)if(h=f/18,$(r[C]).appendTo(o),f=$(o).height(),$(r[C]).is("br")&&(f+=18),f>c){u=f/18-h,$(o).html("");for(var g=0;C>g;g++)$(r[g]).appendTo(o);break}var v;if(void 0!=i?(v=$("#sm").clone().attr("id","more_"+e).attr("class","dnM"),$(v).appendTo(o).show()):(v=$("#nDots").clone().attr("class","dnM"),$(v).appendTo(o).show()),f=$(o).height(),0>f-c&&(D=c/18-h,void 0!=$(r[C]).get(0)&&3==$(r[C]).get(0).nodeType)){for(var g=0;C>g;g++)$(r[g]).appendTo(o);var p=$(r[C]).text();p=p.substr(0,p.length*D/u),$(v).remove(),$(o).html($(o).html()+p),$(v).appendTo(o).show()}void 0!=i&&(Discussion.Utilities.cellLink(s),$("#"+a).click(function(){$(s).find("#more_"+e).remove();var n=Discussion.DJsonUtil.getContent(e,i);return $(o).html(n),Discussion.Utilities.cellLink(s),!1}))},removeEllipClass:function(s,i){void 0!=i?($(s).find("#dnCM_Content").removeClass(i?"rsmEllip":"csmEllip"),$(s).find("#sm").remove()):$(s).removeClass("ndellip")},toggle:function(){return Discussion.on?($("#discussionContainer").is(":visible")?($("#hideAllDiscussion").show(),$("#showAllDiscussion").hide(),$("#statusBar #hD").show(),$("#statusBar #sD").hide()):($("#hideAllDiscussion").hide(),$("#showAllDiscussion").show(),$("#statusBar #hD").hide(),$("#statusBar #sD").show(),Discussion.isPanelClosed=!0,Discussion.endRangeEdit()),void Discussion.showUnreadCount()):!1},getLink:function(s,i,e){suffix=e?"/comments/"+s+"/replies/"+i:"/comments/"+s;var n=SERVERSCHEME+SERVERNAME+":"+SERVERPORT+"/sheet/open/"+RESOURCE_ID+suffix;return n},print:function(s,i){if(Discussion.Filter.isCmtAvailable()){if(i){if(Object.keys(Discussion.all).length>0){var e=Discussion.Filter.state,n=null!=Discussion.Filter.sheetname?Discussion.range[Discussion.Filter.sheetname]:Discussion.sJson,t=[],o=[];for(var c in n)if(Discussion.sJson[c]==e||e==Discussion.Filter.allState){var l=$("#dnC_"+c),d=$(l).find(".dS:hidden");$(d).show();var a=$(l).find(".dS span[id^=more_]").click();t.push(a),o.push(d),Discussion.Utilities.hideIfZeroLikes($(l));for(var r=$(l).find("div[id^=p_]"),u=$(r).length,D=0;u>D;D++)Discussion.Utilities.hideIfZeroLikes($(r[D]));Discussion.Filter.state==Discussion.Filter.resolvedState&&$(r).find("#dnCM_ResolvedState").hide()}var h=$("#discussionTray");$("#dnPHr_fn").text(replaceParams(jsMsg["Discussion.print.Header"],new Array(DOCUMENT_NAME,Discussion.Filter.sheetname||"",Discussion.Filter.getHdr(Discussion.Filter.state)))),$("#allCMts").html($(h).html());var f=window.frames.hid_imgframe;f.document.write("<link href='/sheet/styles/grey/discussion_sprite.css' rel='stylesheet' type='text/css'><link href='//fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'><div id='discussionContainer'>"+$("#dnPHr").html().replace(/[\u200B]/g,"")+"<div>"),f.document.close(),$("#allCMts").html("");for(var C=o.length,D=0;C>D;D++)$(o[D]).hide();for(var m=t.length,g=$(t[D]).length,D=0;m>D;D++)for(var v=0;g>v;v++){var c=$($(t[D])[v]).attr("id").replace("more_",""),p="#p_"+c;Discussion.checkEllipse($(p),!isNaN(c),c,!0)}for(var c in n)if(Discussion.sJson[c]==e||e==Discussion.Filter.allState){var l=$("#dnC_"+c);Discussion.Utilities.showIfZeroLikes($(l));for(var r=$(l).find("div[id^=p_]"),u=$(r).length,D=0;u>D;D++)Discussion.Utilities.showIfZeroLikes($(r[D]));Discussion.Filter.state==Discussion.Filter.resolvedState&&$(r).find("#dnCM_ResolvedState").show()}}}else{var d=$(s).find(".dS:hidden");$(d).show();var a=$(s).find(".dS span[id^=more_]").click();Discussion.Utilities.hideIfZeroLikes($(s));for(var r=$(s).find("div[id^=p_]"),u=$(r).length,D=0;u>D;D++)Discussion.Utilities.hideIfZeroLikes($(r[D]));Discussion.Filter.state==Discussion.Filter.resolvedState&&$(s).find("#dnCM_ResolvedState").hide(),$("#dnPHr_fn").text(replaceParams(jsMsg["Discussion.print.Header"],new Array(DOCUMENT_NAME,"",""))),$("#allCMts").html($(s).html());var h=$("#dnPHr"),f=window.frames.hid_imgframe;f.document.write("<link href='/sheet/styles/grey/discussion_sprite.css' rel='stylesheet' type='text/css'><link href='//fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'><div id='discussionContainer'>"+$(h).html().replace(/[\u200B]/g,"")+"<div>"),f.document.close(),$("#allCMts").html(""),$(d).hide(),a.each(function(){var s=this.id.replace("more_",""),i="#p_"+s;Discussion.checkEllipse($(i),!isNaN(s),s,!0)}),Discussion.Utilities.showIfZeroLikes($(s));for(var D=0;u>D;D++)Discussion.Utilities.showIfZeroLikes($(r[D]));Discussion.Filter.state==Discussion.Filter.resolvedState&&$(s).find("#dnCM_ResolvedState").show()}setTimeout(function(){f.print()},500)}},addGetter:function(){var s=$("#discussionTray");if(s.scrollTop("0"),0===$(s.find(l)).length){$("#dnG").clone().prependTo(s).attr("id","ND").attr("class","dL noprint").css("position","relative");var i=$("#discussionTray").outerHeight(),e=140,n=i/2,t=e/2,o=n-t;Discussion.mTB=o;var c=10;Discussion.animateShowGetter?$("#ND").animate({"margin-top":o-c+"px","margin-bottom":o-c+"px"},300).show():$("#ND").css({"margin-top":"5px"}).show(),$($("#ND").find("#dnUName")[0]).text(LOGIN_FULL_NAME),Discussion.Utilities.constructPhoto(zuid,$($("#ND").find("img")[0]))}var l=$("#ND"),d=$(l.find("#dnE")[0]),a=Discussion.Utilities.getRange(),r=CURRSHEETNAME,u=CURRSHEETNAME+"."+Discussion.Utilities.getCellLabel(!1);$(l.find("#dnCM_CellRefAd")[0]).show(),Discussion.Utilities.setRangeAttr($($("#ND").find("#dnCM_CellRefAd #dCellRef")[0]),a);var D=$(l.find("#dnCM_CellRefAd #dCellRef")[0]);$(D).attr("asn",WorkSheets.getSheetCodeFromName(r)).val(u),$(l.find("#dnCMAd")[0]).show(),Discussion.AttachEvent.shortcut($($("#ND").find("#dEAdd")[0]),"add","ND"),Discussion.AttachEvent.shortcut($($("#ND").find("#dECancel")[0]),"add","ND"),$($("#ND").find("#dEAdd")[0]).bind("focus blur",function(){$(this).toggleClass("dFE")}),$($("#ND").find("#dECancel")[0]).bind("focus blur",function(){$(this).toggleClass("dFE")}),Discussion.highlightActiveComment(["ND"],!0),Discussion.activeCmtId="newCmt",Discussion.Utilities.gotoRange(r,a,u),$("#ND").unbind("click").click(function(){Discussion.highlightActiveComment(["ND"],!0),Discussion.activeCmtId="newCmt",Discussion.Utilities.gotoRange(r,a,u)});var h=$(l.find("#dEAdd")[0]);$(h).prop("disabled",!0),browser_ie?$(D).unbind("keyup paste").bind("keyup paste",function(){Discussion.validateRange(D,d,h)}):$(D).unbind("input").bind("input",function(){Discussion.validateRange(D,d,h)}),$(d).unbind("keyup paste").bind("keyup paste",function(){var s=(CellUtils.checkCellRef($(D).val())?!1:!0)&&""===$(D).text().trim()||""===$(d).text().trim();$(h).prop("disabled",s)}),Discussion.AttachEvent.shortcut(d,"add","ND"),$(l.find("#dEAdd")[0]).text(jsMsg["Discussion.Action.Add"]).attr("title",jsMsg["Discussion.Action.Add"]+" [Cmd+Enter]").attr("disabled",!0).unbind("click").click(function(s){Discussion.add(),stopEvent(s)}),$(l.find("#dECancel")[0]).unbind("click").click(function(){Discussion.reset(),$("#dnFC_newCmt").remove()}),D.unbind("focus").focus(function(){Discussion.rangeEdit=!0,enableRangeSelector($("#dCellRef")[0]),Discussion.currRangeTF=D,$(this).css("borderColor","#01975b")}).unbind("click").click(function(s){stopEvent(s)}).unbind("blur").bind("blur",function(){CellUtils.checkCellRef($(this).val())||$(this).css("borderColor","#cc0909")}),Discussion.AttachEvent.highlightRangeOnAddCmt(),$(d).text("").attr({placeholder:jsMsg["Discussion.EnterYourDiscussion"]}).unbind("click").click(function(s){Discussion.handleFocus(),Discussion.Smiley.toggle(s,this,!0),Discussion.endRangeEdit(),Discussion.Utilities.highlightOnEdit("ND","newCmt",!0),stopEvent(s)}).blur(function(){Discussion.handleFocus()}),connectProcessMention($(d))},validateRange:function(s,i,e){var n=(CellUtils.checkCellRef($(s).val())?!1:!0)&&""===$(s).text().trim()||""===$(i).text().trim();$(e).prop("disabled",n),(CellUtils.checkCellRef($(s).val())?1:0)||""!==$(s).text().trim()?(Discussion.Utilities.setRangeAttr($(s)[0],Discussion.Utilities.getRange(!1,void 0,$(s).val())),$(Discussion.currRangeTF).css("borderColor","#01975b")):$(Discussion.currRangeTF).css("borderColor","#cc0909")},handleFocus:function(){var s=$($("#ND").find("#dnE")[0]);(browser_ie||browser_ff3)&&void 0!=$(s).attr("placeholder")&&($(s).removeAttr("placeholder"),Discussion.setFocus())},showGetter:function(){if(!Discussion.on)return!1;Discussion.cardConstructed||Discussion.constructCmtDiv(Discussion.Filter.defaultState),Discussion.ellipsesAdded||(docPanel.show("discussion"),Discussion.toggle(),Discussion.showEllipsis(Discussion.Filter.defaultState),Discussion.ellipsesAdded=!0);var s=$("#discussionTray #ND"),i=void 0;$(s).length>0&&(i=$($(s).find("#dnE")[0]).html(),Discussion.reset()),Discussion.highlightActiveComment([]),Discussion.hideDeleteAll(),Discussion.backToFilter(),Discussion.Filter.show(Discussion.Filter.defaultState,$("#li_dnSF_All")),$("#discussionContainer #noComment").hide(),$("#discussionContainer #aNcF").hide(),Discussion.addGetter(),Discussion.isAddCmtOn=!0,Discussion.isPanelOpened()||(docPanel.show("discussion"),Discussion.toggle()),s.show(),setTimeout(function(){var s=$($("#discussionTray #ND").find("#dnE")[0]);browser_ie?Discussion.setFocus():$(s).focus(),i&&($(s).text("").focus().html(i),Discussion.Utilities.setCursorAtEnd($(s)))},300),$(s.find("#dnUS")[0]).hide().empty()},resolve:function(s){Discussion.Ajax.do(ActionConstants.DISCUSSION_RESOLVE,s)},highlightMyDiscussion:function(s){if(Discussion.isHlgtEnabled||Discussion.reInitHighlightEl(),Discussion.rangeEdit&&enableRangeSelector($(Discussion.currRangeTF)[0]),!Discussion.isAddCmtOn){var i=!1,e=[],n=0;for(var t in Discussion.range[CURRSHEETNAME]){var o,c=Discussion.range[CURRSHEETNAME][t],l=Merge.getCellInfo(currRow,currCol);o=l?new Range(l.startRow,l.startCol,l.endRow,l.endCol):new Range(getCellRange().startRow,getCellRange().startCol,getCellRange().endRow,getCellRange().endCol),o.intersects(new Range(c.sr,c.sc,c.er,c.ec))&&(e[n++]=t,i=!0)}if(i){var d=0,a=!1;Discussion.highlightActiveComment(e);for(var r=e.length,n=0;r>n;n++)if(""==Discussion.Filter.state||Discussion.Filter.state==Discussion.Filter.allState||Discussion.Filter.state==Discussion.sJson[e[n]]){if(d+=1,!Discussion.isPanelOpened()){if(!(!Discussion.isPanelClosed&&Discussion.isHlgtEnabledOnLoad||Discussion.allowAutoOpen&&Discussion.isHlgtEnabled))return;Discussion.showAll(),Discussion.highlightActiveComment(e)}a||(Discussion.Utilities.scrollIntoView($("#discussionTray")[0],$("#dnC_"+e[n])[0]),a=!0)}s&&d>1?Discussion.Notification.showFlashMsg(replaceParams(jsMsg["Discussion.Highlighted"],new Array(d+"")),Discussion.Notification.FlashMsg_info):Discussion.Notification.closeFlashMsg()}else Discussion.highlightActiveComment([]),Discussion.Notification.closeFlashMsg()}},spotlight:function(s){$(s).effect("highlight",{color:Discussion.spotLightColor},1e4).removeClass("unRCmt")},removeSpotlight:function(s){$(s).find("div[id^=p_]").removeClass("unRCmt")},setPreSpotlight:function(s){$(s).addClass("unRCmt")},highlightActiveComment:function(s,i){if(Discussion.prevFDsn.length>0)if("ND"==Discussion.prevFDsn[0])$("#ND").css("border-left","");else{for(var e=Discussion.prevFDsn.length,n=0;e>n;n++)$($("#dnC_"+Discussion.prevFDsn[n]).find("#dnPp")[0]).css("border","2px solid transparent");Discussion.isHlgtEnabled?Discussion.sJson[Discussion.prevFDsn[0]]!=Discussion.Filter.openState&&$("#dnFC_"+Discussion.prevFDsn[0]).remove():$("#dnFC_"+Discussion.prevFDsn[0]).remove()}if(Discussion.prevFDsn=[],i)$("#"+s).css("border-left","2px solid #f58517"),Discussion.prevFDsn[0]=s;else if(s.length>0)for(var t=s.length,n=0;t>n;n++)$($("#dnC_"+s[n]).find("#dnPp")[0]).css("border-left","2px solid #f58517"),Discussion.prevFDsn[n]=s[n]},resetHighlightedComments:function(){Discussion.isHlgtEnabled||Discussion.reInitHighlightEl(),Discussion.highlightActiveComment("")},highlightAllCmtRange:function(s,i){i||Discussion.reInitHighlightEl();var e=CURRSHEETNAME;for(var n in Discussion.range[e])Discussion.highlightCmtRange(n,e,s,i,!0)},highlightCmtRange:function(s,i,e,n,t){var o=!1;null!=document.activeElement&&(o="dnE"==document.activeElement.id?!0:!1);var c,l;if("newCmt"==s)$("#dnFC_newCmt").remove(),c=Discussion.currRange,l=Discussion.Filter.openState;else if($("#dnC_"+s).find("#dnCM_SheetName_input").is(":visible")){var d=$($("#dnC_"+s).find("#dCellRef")[0]),a=$(d).val();if(c=Discussion.Utilities.getRange(!1,void 0,$(d).val()),l=Discussion.Filter.openState,!CellUtils.checkCellRef(a))return!1}else n||($("#dnFC_"+s).remove(),$("#dnFC_newCmt").remove()),c=Discussion.range[i][s],l=Discussion.sJson[s];var r=c.sr==c.er&&c.sc==c.ec?!0:!1;if(Row.getHiddenRowCount(c.sr,c.er)>0&&(c.er-c.sr+1==Row.getHiddenRowCount(c.sr,c.er)||r))return!1;var u=t?l==Discussion.Filter.openState:Discussion.Filter.state==l||Discussion.Filter.state==Discussion.Filter.allState||""==Discussion.Filter.state&&l==Discussion.Filter.defaultState;if(u){var D,h,f,C,m=Merge.getCellInfo(c.sr,c.sc);m&&r?(D=m.startRow,h=m.startCol,f=m.endRow,C=m.endCol):(D=c.sr,h=c.sc,f=c.er,C=c.ec);var g,v=getCellRangeDIM(parseInt(D),parseInt(h),parseInt(f),parseInt(C)),p=v.height-1,S=v.width-1,_=getSheetPaneIds(D,h,f,C);r&&(g=Discussion.Utilities.getTopLeftforMergedRange(A));for(var E=_.length,R=0;E>R;R++){var A=_[R];A=0==A?"":A;var w=3==A?v.top-$("#sP"+A).position().top:v.top,F=2==A?v.left-$("#sP"+A).position().left:v.left,U=$($("#dnFCA"+A).find("#dnFC_"+s)),b=$($("#dnFCA"+A).find("#dnFC_"+s)).length,M=($($("#sP"+A).find("#dnFCA"+A)),$($("#sP"+A).find("#dnFCA"+A)).length);0==M&&$("#dnFCA").clone().appendTo("#sP"+A).attr("id","dnFCA"+A),b>0?n?isRTL?$($("#dnFCA"+A).find("#dnFC_"+s)[0]).css({top:w,right:F,height:p,width:S}).show():$($("#dnFCA"+A).find("#dnFC_"+s)[0]).css({top:w,left:F,height:p,width:S}).show():isRTL?$($(U)[0]).css({opacity:0,borderColor:"#f99025"}).stop(!0).css({top:w,right:F,height:p,width:S}).animate({opacity:1},1e3).show():$($(U)[0]).css({opacity:0,borderColor:"#f99025"}).stop(!0).css({top:w,left:F,height:p,width:S}).animate({opacity:1},1e3).show():isRTL?$("#dnFC").clone().appendTo("#dnFCA"+A).attr("id","dnFC_"+s).css({opacity:0,borderColor:"#f99025"}).stop(!0).css({top:w,right:F,height:p,width:S}).animate({opacity:1},1e3).show():$("#dnFC").clone().appendTo("#dnFCA"+A).attr("id","dnFC_"+s).css({opacity:0,borderColor:"#f99025"}).stop(!0).css({top:w,left:F,height:p,width:S}).animate({opacity:1},1e3).show(),r&&$("#dnFC_"+s).css({"margin-left":g.left+"px","margin-top":g.top+"px"});var k=$("#dnFCA"+A).find("#dnFC_"+s).children()[0];$(k).css({height:p,width:$("#dnFC_"+s).outerWidth()-2}).show(),e||(Discussion.focusComment(),$(k).css({opacity:0,backgroundColor:"#f99025"}).css({height:p,width:$("#dnFC_"+s).outerWidth()-2}).animate({opacity:.8},1e3).animate({opacity:0},1e3)),o&&$("#dnC_"+s).find("#dnE").length>0&&$($("#dnC_"+s).find("#dnE")[0]).focus()}}},hideDeleteAll:function(){$("#dltA_dlg").is(":visible")&&$("#dltA_dlg").hide()},isPanelOpened:function(){return $("#discussionTray").is(":visible")},Wms:{handle:function(s){if(!Discussion.on)return!1;Discussion.cardConstructed||Discussion.constructCmtDiv(Discussion.Filter.defaultState),Discussion.cardConstructedRes||Discussion.constructCmtDiv(Discussion.Filter.resolvedState);var i,e=0,n=null;switch(i=$("#discussionTray").prop("scrollHeight"),$("#discussionTray").is(":visible")&&s.on!=LOGIN_FULL_NAME&&Object.keys(Discussion.all).length>0&&(s.a==ActionConstants.DISCUSSION_ADD||s.a==ActionConstants.DISCUSSION_ADD_REPLY||s.a==ActionConstants.DISCUSSION_UPDATE_RANGE_CONTENT||s.a==ActionConstants.DISCUSSION_UPDATE_REPLY||s.a==ActionConstants.DISCUSSION_DELETE_REPLY||s.a==ActionConstants.DISCUSSION_DELETE||s.a==ActionConstants.DISCUSSION_REOPEN||s.a==ActionConstants.DISCUSSION_RESOLVE)&&(n=Discussion.getScrollState(),null!=n&&(e=$(n).offset().top)),s.a){case ActionConstants.DISCUSSION_ADD:var t=$("#discussionTray")[0],o=s.uid;Discussion.SJsonUtil.add(o),Discussion.DJsonUtil.add(s),Discussion.RangeJsonUtil.add(s),Discussion.Filter.update(),$("#dnP").clone().removeAttr("style").prependTo(t).attr("id","dnC_"+o).show();var c=$("#dnC_"+o);$(c.find("#dnR")[0]).show(),$(c.find("#dnPG")[0]).empty().css("max-height","none"),c.find("#dnRC").attr("disid",o).unbind("click"),Discussion.AttachEvent.reply(c.find("#dnRC")),Discussion.removeLoader($(c.find("#dnPp")[0])),Discussion.Utilities.getDS(s,!1,$(c.find("#dnPG")[0]),o,!0),$("#dnFC_newCmt").attr("id","#dnFC_"+o),Discussion.toggle();break;case ActionConstants.DISCUSSION_ADD_REPLY:var l=$("#dnC_"+s.uid);if(s.r_cid){var d=s.cid;s.cid=s.r_cid,s.type=2,Discussion.Utilities.getDS(s,!0,l.find("#dnPG")[0],s.uid,!0),s.cid=d,s.type=0}if(Discussion.Utilities.getDS(s,!0,l.find("#dnPG")[0],s.uid,!0),Discussion.removeLoader(l),Discussion.DJsonUtil.addCmt(s),Discussion.Utilities.showRepliesOpts(s.uid,"cmtAdd"),Discussion.sJson[s.uid]===Discussion.Filter.resolvedState){var a={a:ActionConstants.DISCUSSION_REOPEN,uid:s.uid,sn:s.sn,on:s.on,rsid:s.rsid};Discussion.Notification.showFlashMsg(replaceParams(jsMsg["Discussion.commentReopened"],new Array("")),Discussion.Notification.FlashMsg_notify,s.uid,s.uid,!0),setTimeout(function(){Discussion.Wms.handle(a)},1e3)}break;case ActionConstants.DISCUSSION_UPDATE_RANGE_CONTENT:Discussion.Utilities.enableMouseEvent=!0;var r=s.uid;Discussion.Utilities.resetAE(r,!1,!1);var u=Discussion.Utilities.getCellLabel(void 0,s.range.sr,s.range.sc,s.range.er,s.range.ec),D=$("#p_"+r);$(D.find(".rBH")[0]).show(),$(D.find("#dnCM_CellName")[0]).text(u).show(),$(D.find("#dnCM_SheetName")[0]).text(s.sn).show(),$(D.find("#p_"+r+"_lbl")[0]).attr("title",s.sn+"."+u),Discussion.Utilities.showSheetNEllip($(D.find("#dnCM_SheetName_ellip")[0]),s.sn),$(D.find("#dnCM_SheetName_dot")[0]).show(),$(D.find("#dnCM_repliesOpts")[0]).show(),$(D.find("#dnCM_Content")).html(Discussion.addLinkToMsg(s.c,s.sn)).show(),Discussion.Utilities.cellLink(D),$(D.find("#dnCM_Date")).show(),$(D.find("#clike")[0]).css("visibility","visible"),Discussion.removeLoader(D),Discussion.DJsonUtil.updateCellRef(r,s.range,s.sn),Discussion.RangeJsonUtil.remove(s.osn,r),Discussion.RangeJsonUtil.add(s),Discussion.DJsonUtil.updateCmt(s,!1),s.sn==CURRSHEETNAME&&(s.on!=LOGIN_FULL_NAME&&Discussion.isHlgtEnabled?Discussion.highlightCmtRange(r,s.sn,!0):s.on==LOGIN_FULL_NAME&&Discussion.highlightCmtRange(r,s.sn,!1));break;case ActionConstants.DISCUSSION_UPDATE_REPLY:var h=$("#p_"+s.cid);Discussion.Utilities.enableMouseEvent=!0,$(h.find("#dnCM_Content")).html(Discussion.addLinkToMsg(s.c,s.sn)).show(),Discussion.Utilities.cellLink(h),$(h.find("#dnCM_Date")).show(),$(h.find("#clike")[0]).css("visibility","visible"),$(h.find("#dnCM_SEdit")[0]).html("").hide(),Discussion.removeLoader(h),Discussion.DJsonUtil.updateCmt(s,!0);break;case ActionConstants.DISCUSSION_LIKE_REPLY:Discussion.DJsonUtil.updateLike(s,!0),Discussion.Utilities.showlike(s.cid,s.on,s.likes,!0);break;case ActionConstants.DISCUSSION_LIKE:Discussion.DJsonUtil.updateLike(s,!1),Discussion.Utilities.showlike(s.uid,s.on,s.likes,!0);break;case ActionConstants.DISCUSSION_UNLIKE_REPLY:Discussion.DJsonUtil.updateLike(s,!0),Discussion.Utilities.showlike(s.cid,s.on,s.likes,!1);break;case ActionConstants.DISCUSSION_UNLIKE:Discussion.DJsonUtil.updateLike(s,!1),Discussion.Utilities.showlike(s.uid,s.on,s.likes,!1);break;case ActionConstants.DISCUSSION_DELETE_REPLY:$("#p_"+s.cid).remove(),$("#dnC_"+s.uid).find("#dlt_dlg").hide(),$("#dnC_"+s.uid).css("position",""),Discussion.Utilities.showRepliesOpts(s.uid,"delete"),Discussion.DJsonUtil.removeCmt(s.cid);break;case ActionConstants.DISCUSSION_DELETE:Discussion.Utilities.hide_urCmt(s.uid),Discussion.DJsonUtil.remove(s.uid),Discussion.RangeJsonUtil.remove(s.sn,s.uid),Discussion.SJsonUtil.remove(s.uid),$("#dnC_"+s.uid).css("position",""),$("#dnC_"+s.uid).remove(),$("#dnFC_"+s.uid).remove(),Discussion.Filter.update(),LOGIN_FULL_NAME!=s.on&&Discussion.Notification.showFlashMsg(jsMsg["Discussion.commentDeleted"],Discussion.Notification.FlashMsg_info),Discussion.isHlgtEnabled&&$("#dnFC_"+s.uid).hide();break;case ActionConstants.DISCUSSION_RESOLVE:var f=$("#dnC_"+s.uid);if(Discussion.Utilities.getDS(s,!0,f.find("#dnPG")[0],s.uid,!0),Discussion.DJsonUtil.addCmt(s),s.on==LOGIN_FULL_NAME)if(Discussion.Filter.state==Discussion.Filter.openState){$(f).css("width",$(f).width()),$(f).css("height",$(f).height()),$(f).css("left",$(f).offset().left),$(f).css("top",$(f).offset().top);var C=$("#displayFilter").offset().left,m=$("#displayFilter").offset().top;$(f).css("position","absolute"),$(f).css("overflow","hidden"),$(f).css("zIndex","1"),$(f.find(".rBH")[0]).hide(),$("#dCdA").addClass("fTnM"),$(".rPdC#unread_discussionTray").css("overflow-y","hidden"),$(f).animate({zIndex:"100",left:C+"px",top:m-5+"px",width:"10px",height:"10px"},500,function(){$(this).attr("style","display: none;"),$(f).find("#dnCM_ResolvedState").show(),$(f.find(".rBH")[0]).show(),$("#discussionContainer .dCb .mSb").effect("highlight",{color:"#fcc99f"},500),$("#dCdA").removeClass("fTnM"),$(".rPdC#unread_discussionTray").css("overflow-y","auto")})}else $(f).find("#dnCM_ResolvedState").show();else Discussion.Notification.showFlashMsg(jsMsg["Discussion.commentResolved"],Discussion.Notification.FlashMsg_notify,s.uid,s.uid,!0),Discussion.Filter.state==Discussion.Filter.resolvedState?$(f).show():Discussion.Filter.state==Discussion.Filter.openState&&$(f).hide(),$(f).find("#dnCM_ResolvedState").show();Discussion.SJsonUtil.update(s.uid,Discussion.Filter.resolvedState),Discussion.Filter.update();var g=$("#p_"+s.uid);ALLOW_TO_COMMENT&&($(f).find("#dnCM_resolve").hide(),$(f).find("#dnCM_Edit").hide(),$(f).find("#dnCM_ReOpen").show(),$($("#p_"+s.uid)[0]).find("#dnCM_ReOpen").show().click(function(){$(f).find("#dnCM_ResolvedState").hide(),$(g).find("#dnCM_resolve").show(),$(g).find("#dnCM_Edit").show(),$(g).find("#dnCM_ReOpen").hide()}));var v=Discussion.DJsonUtil.get(s.uid);if(void 0!==v.cmtA)for(var d in v.cmtA)$($("#p_"+d).find("#dnCMOpt")[0]).hide();$("#dnFC_"+s.uid).hide(),Discussion.SheetCallout.remove(s.sn);break;case ActionConstants.DISCUSSION_REOPEN:var f=$("#dnC_"+s.uid);if(s.DU&&Discussion.Utilities.getDS(s,!0,f.find("#dnPG")[0],s.uid,!0),Discussion.DJsonUtil.addCmt(s),s.on==LOGIN_FULL_NAME){if(Discussion.Filter.state==Discussion.Filter.resolvedState){$(f).css("width",$(f).width()),$(f).css("height",$(f).height()),$(f).css("left",$(f).offset().left),$(f).css("top",$(f).offset().top);var C=$("#displayFilter").offset().left,m=$("#displayFilter").offset().top;$(f).css("position","absolute"),$(f).css("overflow","hidden"),$(f).css("zIndex","1"),$("#dCdA").addClass("fTnM"),$(".rPdC#unread_discussionTray").css("overflow-y","hidden"),$(f).animate({zIndex:"100",left:C+"px",top:m-5+"px",width:"10px",height:"10px"},500,function(){$(this).attr("style","display: none;"),$("#discussionContainer .dCb .mSb").effect("highlight",{color:"#fcc99f"},500),$("#dCdA").removeClass("fTnM"),$(".rPdC#unread_discussionTray").css("overflow-y","auto")})}}else Discussion.Notification.showFlashMsg(replaceParams(jsMsg["Discussion.commentReopened"],new Array("1")),Discussion.Notification.FlashMsg_notify,s.uid,s.uid,!0),Discussion.Filter.state==Discussion.Filter.resolvedState?$(f).hide():Discussion.Filter.state==Discussion.Filter.openState&&$(f).show();var g=$("#p_"+s.uid);$(g.find(".rBH")[0]).hide();var p=$(g.find("#dnCM_ResolvedState .rS")[0]);Discussion.Filter.state==Discussion.Filter.allState?($(g.find("#dnCM_ResolvedState")[0]).hide(),$(f).find("#dnCM_ReOpen").hide(),$(g.find(".rBH")[0]).show()):($(p).addClass("cS tE"),$(p).removeClass("cS tE",500),setTimeout(function(){$(g.find("#dnCM_ResolvedState")[0]).hide(),$(g.find(".rBH")[0]).show()},501)),(s.on==LOGIN_FULL_NAME||Discussion.isOwnerRCo||Discussion.all[s.uid].details.oid==zuid)&&($(f).find("#dnCM_resolve").show(),Discussion.all[s.uid].details.oid==zuid&&$(f).find("#optBox li[id='dnCM_Edit']").show(),$(f.find("#dnCM_ReOpen")[0]).hide()),Discussion.SJsonUtil.update(s.uid,Discussion.Filter.openState),Discussion.Filter.update(),Discussion.DJsonUtil.updateStatus(s.uid,Discussion.Filter.defaultState);var v=Discussion.DJsonUtil.get(s.uid);if(void 0!==v.cmtA)for(var d in v.cmtA)$($("#p_"+d).find("#dnCMOpt")[0]).show();Discussion.isHlgtEnabled&&Discussion.highlightCmtRange(s.uid,s.sn,!0),Discussion.SheetCallout.add(s.sn);break;case ActionConstants.DISCUSSION_UPDATE_SHAREDUSERS:mentionsData=s.su,appEvent.trigger("Discussion.updateShUserAndCmt");break;case ActionConstants.DISCUSSION_DELETE_ALL:if(null==Discussion.Filter.sheetname)if(2==s.state){for(var r in Discussion.sJson)$("#dnC_"+r).remove(),$("#dnFC_"+r).remove();Discussion.sJson={},Discussion.all={},Discussion.RangeJsonUtil.removeAll()}else{state=1==s.state?Discussion.Filter.resolvedState:Discussion.Filter.openState;for(var r in Discussion.sJson)Discussion.sJson[r]==state&&($("#dnC_"+r).remove(),$("#dnFC_"+r).remove(),Discussion.RangeJsonUtil.remove(Discussion.all[r].details.sn,r),Discussion.SJsonUtil.remove(r),Discussion.DJsonUtil.remove(r))}else for(var r in Discussion.sJson)state=1==s.state?Discussion.Filter.resolvedState:Discussion.Filter.openState,Discussion.sJson[r]!=state&&2!=s.state||Discussion.all[r].details.sn!=Discussion.Filter.sheetname||($("#dnC_"+r).remove(),$("#dnFC_"+r).remove(),Discussion.RangeJsonUtil.remove(Discussion.all[r].details.sn,r),Discussion.SJsonUtil.remove(r),Discussion.DJsonUtil.remove(r));Discussion.hideDeleteAll(),Discussion.Filter.update(),Discussion.toggle(),$("#dnFDel").addClass("dndS"),Discussion.Notification.showFlashMsg(replaceParams(jsMsg["Discussion.FilteredCommentsDeleted"],new Array(Discussion.CommentsFilterState)),Discussion.Notification.FlashMsg_info)}null!=n&&Discussion.persistScrollState(i,n,e)}},Ajax:{getAll:function(){if(!Discussion.on)return!1;var s=new RequestParameters(ActionConstants.DISCUSSION_GET),i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.addEventListener("onComplete",function(s){var i=s.responseText;if(i)try{var e=JSON.parse(i);Discussion.range=e.rangeJson,appEvent.trigger("Discussion.cmtReady"),Discussion.isOwnerRCo=jsSHARE_VIEW&&!isCoOwnerSharedDoc?!1:!0,Discussion.isOwnerRCo||$("#discussionContainer #dnFDel_li").remove(),mentionsData=e.su,$("#discussionTray").scroll(function(){$(".ui-autocomplete").hide()}),e.dns.dnA.length>0?(e.dns.dnA.forEach(function(s){Discussion.all[s.uid]={}}),Discussion.Panel.showAll(e.dns.dnA),Discussion.isPanelClosed=!1,appEvent.trigger("Discussion.cmtReady")):(Discussion.Filter.showNoCmtDiv(),$("#sD").show(),Discussion.Filter.initSheetFilter()),$("#discussionTray #spinner").remove()}catch(s){e=!1}}),i.sendRequest(),ALLOW_TO_COMMENT||$("#dA").remove(),(Discussion.isHlgtEnabled||Discussion.isHlgtEnabledOnLoad)&&Discussion.highlightAllCmtRange(!0)},unread:function(){Discussion.readNtfn=!0;var s=new RequestParameters(ActionConstants.DISCUSSION_UPDATE_DOC_CLOSEDTIME),i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.sendRequest(),$("#noComment").is(":visible")&&$("#noComment").hide(),Discussion.showUnread(),$("#displayNotify").show(),$("#displayFilter").hide()},do:function(s,i,e,n,t,o){if(!Discussion.on)return!1;var c=new RequestParameters(s),l=new AjaxRequest,d="";if(s==ActionConstants.DISCUSSION_UPDATE_REPLY||s==ActionConstants.DISCUSSION_LIKE||s==ActionConstants.DISCUSSION_UNLIKE||s==ActionConstants.DISCUSSION_LIKE_REPLY||s==ActionConstants.DISCUSSION_UNLIKE_REPLY||s==ActionConstants.DISCUSSION_DELETE_REPLY||s==ActionConstants.DISCUSSION_DELETE){var a=$("#p_"+i).attr("cellId");d=$("#p_"+a).find("#dnCM_SheetName").text(),n=Discussion.range[d][a]}else if(s==ActionConstants.DISCUSSION_REOPEN||ActionConstants.DISCUSSION_RESOLVE){var a=$("#p_"+i).attr("cellId");d=$("#p_"+a).find("#dnCM_SheetName").text()}switch(s){case ActionConstants.DISCUSSION_ADD:c.setParameters(t,e,n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_ADD_REPLY:c.setParameters(i,e,t,n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_UPDATE_RANGE_CONTENT:c.setParameters(i,e,t,n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_UPDATE_REPLY:c.setParameters(i,a,e,WorkSheets.getSheetCodeFromName(d),n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest(),$("#dnE").text("");break;case ActionConstants.DISCUSSION_LIKE:case ActionConstants.DISCUSSION_UNLIKE:c.setParameters(i,WorkSheets.getSheetCodeFromName(d),n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_LIKE_REPLY:case ActionConstants.DISCUSSION_UNLIKE_REPLY:c.setParameters(a,i,WorkSheets.getSheetCodeFromName(d),n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_REOPEN:case ActionConstants.DISCUSSION_RESOLVE:var r=Discussion.DJsonUtil.getCellRef(i);c.setParameters(i,WorkSheets.getSheetCodeFromName(d),r.sr,r.sc,r.er,r.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_DELETE:var r=Discussion.DJsonUtil.getCellRef(i);c.setParameters(i,WorkSheets.getSheetCodeFromName(d),r.sr,r.sc,r.er,r.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_DELETE_REPLY:c.setParameters(a,i,WorkSheets.getSheetCodeFromName(d),n.sr,n.sc,n.er,n.ec),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest();break;case ActionConstants.DISCUSSION_DELETE_ALL:var t=null!=Discussion.Filter.sheetname?WorkSheets.getSheetCodeFromName(Discussion.Filter.sheetname):WorkSheets.getAssociatedActiveSheetName(),u=null!=Discussion.Filter.sheetname;c.setParameters(u,t,o),l.init("POST",c.getURL(),!0,c.getParametersAsString()),l.sendRequest()}},updateSharedUsers:function(){var s=new RequestParameters(ActionConstants.DISCUSSION_UPDATE_SHAREDUSERS),i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.sendRequest()},changeNType:function(s,i){var e=new RequestParameters(ActionConstants.DISCUSSION),n=new AjaxRequest;e.setParameters("",null,"",s,i,8),n.init("POST",e.getURL(),!0,e.getParametersAsString()),n.addEventListener("onComplete",function(){Discussion.Notification.setType(i)}),n.sendRequest()}},Utilities:{hideIfZeroLikes:function(s){0==parseInt($(s).find("#lCount").text())&&($(s).find("#dnLike").hide(),$(s).find("#dndot").hide())},showIfZeroLikes:function(s){0==parseInt($(s).find("#lCount").text())&&($(s).find("#dnLike").show(),$(s).find("#dndot").show())},highlightOnEdit:function(s,i,e){var n=$($("#"+s).find("#dCellRef")[0]),t=$(n).val();if(CellUtils.checkCellRef(t)){Discussion.highlightActiveComment([i],e);var o=WorkSheets.getSheetNameFromCode($(n).attr("asn")),c=Discussion.Utilities.getRange(!1,void 0,t);Discussion.activeCmtId=i,Discussion.Utilities.gotoRange(o,c,t)}},gotoRange:function(s,i,e){{var n=i.sr,t=(i.er,i.sc);i.ec}Discussion.currRange=i,Discussion.setFocusOn=!0,CURRSHEETNAME==s?Goto.gotoCellPosition(n,t):(Discussion.disableCmtHgltOnFocus=!0,Goto.gotoCellInit(e,"LABEL"))},getTopLeftforMergedRange:function(s){var i,e;if(thirdPaneTop||secondPaneLeft){var n=-1*thirdPaneTop+"px",t=-1*secondPaneLeft+"px";switch(s){case 1:e=0,i=n=0;break;case 2:i=n=0,e=t;break;case 3:e=0,i=n;break;default:e=t,i=n}}return{top:i,left:e}},scrollIntoView:function(s,i){$(s)[0].scrollIntoView(!1),void 0!=$(i)[0]&&$(s).stop(!0).animate({scrollTop:$(s).scrollTop()+$(i).offset().top-$(s).offset().top-15},{duration:"slow",easing:"swing"})},show_urCmt:function(s,i,e){if($("#noNtfn").hide(),$("#gotoDnCmts").css("margin-top","").addClass("dS"),!s.ur)return!1;var n,t=$("#unread_discussionTray_1")[0],o=s.disId?s.disId:s.id,c=!1,l="";Discussion.readNtfn&&(Discussion.readNtfn=!1);var d=!1;switch(s.type){case 0:n="ur_"+s.id+"R",$("div[id^=urDivId]").length>0&&(n+=$("div[id^=urDivId]").length),null!=Discussion.ntfnJson[o]?(c=!0,n=Discussion.ntfnJson[o],l=" "+jsMsg["Discussion.RepliedToAComment"]):(Discussion.ntfnJson[o]=n,d=!0,l=" "+jsMsg["Discussion.Replied"]);break;case 1:n="ur_"+s.id+"RS",l=" "+jsMsg["Discussion.ResolvedAComment"],Discussion.readNtfn||(Discussion.ntfnJson[o]=null),$("div[id^=urDivId]").length>0&&(n+=$("div[id^=urDivId]").length);break;case 2:n="ur_"+s.id+"RO",l=" "+jsMsg["Discussion.ReopenedAComment"],Discussion.readNtfn||(Discussion.ntfnJson[o]=null),$("div[id^=urDivId]").length>0&&(n+=$("div[id^=urDivId]").length);break;case void 0:n="ur_"+s.id+"AC",l=" "+jsMsg["Discussion.AddedAComment"],Discussion.readNtfn||(Discussion.ntfnJson[o]=null)}c||($("#dnUCM").clone().prependTo(t).attr("id",n).attr("countable","T").attr("uid",o),e&&$("#"+n).show());var a=$("#"+n);if(c||(Discussion.urCount=Discussion.urCount+1,Discussion.showUnreadCount()),c){if($(a.find("#dnCMmsg")[0]).text(l),$(a.find("#dnCM_Content")[0]).html(Discussion.addLinkToMsg(Discussion.all[o].details.c,Discussion.all[o].details.sn)),!e){var r=$(a.find("#dnCM_Date")[0]).attr("tms");delete Discussion.notifyByTimeJson[r],Discussion.notifyByTimeJson[s.timein_ms]=n,$(a.find("#dnCM_Date")[0]).attr("tms",s.timein_ms)}$(a).parent().prepend($(a)),$(a.find("#dnCM_Date")[0]).text(s.time),$(a).hasClass("unRCmt")||($(a).removeClass("rCmt").addClass("unRCmt"),Discussion.urCount=Discussion.urCount+1,Discussion.showUnreadCount(),$(a).unbind("click").click(function(){Discussion.Notification.gotoCmt(o,s.id,i),$(this).removeClass("unRCmt").addClass("rCmt")})),$(a).click(function(){Discussion.spotlight($("#p_"+s.id)[0])}),-1==$($(a)[0]).attr("replierList").split(",").indexOf(String(s.zuid))&&Discussion.Utilities.setRepliersName(a,s.owner,s.zuid)}else $(a).addClass("unRCmt"),$(a).click(function(){Discussion.Notification.gotoCmt(o,s.id,i),$(this).removeClass("unRCmt").addClass("rCmt")}),Discussion.Utilities.constructPhoto(s.zuid,a.find("img")[0]),$(a.find("#dnCMmsg")[0]).text(l),$(a.find("#dnCM_Content")[0]).html(s.content),$(a.find("#dnCM_Date")[0]).text(s.time),$(a.find("#dnCM_msgUN")[0]).text(s.owner),$(a).attr("replierList",s.zuid),e||(Discussion.notifyByTimeJson[s.timein_ms]=n,$(a.find("#dnCM_Date")[0]).attr("tms",s.timein_ms),$(a).show());e&&$("#nT").is(":visible")&&Discussion.Ajax.unread()},setRepliersName:function(s,i,e){var n=$(s.find("#dnCM_msgUN")[0]).text(),t=$(s).attr("replierList");switch(n.split(",").length){case 1:"inline"==$(s.find("#dnCM_msgUN_and")[0]).css("display")?$(s.find("#dnCM_msgUN")[0]).text(n+", "+i):($(s.find("#dnCM_msgUN_and")[0]).show(),$(s.find("#dnCM_msgUN_othersN")[0]).text(i).show());break;case 2:var o=2;"inline"==$(s.find("#dnCM_msgUN_more")[0]).css("display")?o=parseInt($(s.find("#dnCM_msgUN_othersN")[0]).text()):$(s.find("#dnCM_msgUN_more")[0]).show(),$(s.find("#dnCM_msgUN_othersN")[0]).text(o).show()}$($(s)[0]).attr("replierList",t+","+e)},hide_urCmt:function(s){$("div[uid^="+s+"]").css({"background-color":"#fafafa"}),Discussion.removeSpotlight($("#dnC_"+s));for(var i=$("div[uid^="+s+"]"),e=i.length,n=0;e>n;n++)void 0!=$($(i)[n]).attr("countable")&&(Discussion.urCount=Discussion.urCount>0?Discussion.urCount-1:Discussion.urCount);Discussion.showUnreadCount()},isVisible:function(s){var i=$(s),e=$("#discussionTray"),n=e.scrollTop(),t=n+e.height(),o=i.offset().top,c=o+i.height();return t>=c&&o>=n},cellLink:function(s){$($(s).find("#dnCM_Content a")).click(function(s){s.stopPropagation()}),$($(s).find("#dnCM_Content a[title^='#']")).click(function(s){Discussion.disableCmtHgltOnFocus=!0,stopEvent(s)}),$($(s).find("#dnCM_Content a[href='#']")).unbind("click")},getDS:function(s,i,e,n,t,o,c){s.sn;s=Discussion.Utilities.arrangeJson(s,t,i);var l,d="#p_"+s.id,a=LOGIN_FULL_NAME==s.owner,r=a&&t;l=i?t?Discussion.sJson[n]===Discussion.Filter.resolvedState:c===Discussion.Filter.resolvedState:s.status==Discussion.Filter.resolvedState;s.cellRef;if(r){i?Discussion.Comment.resetAR(n,!1):(Discussion.reset(),Discussion.activeCmtId=null,Discussion.highlightActiveComment([n],!1));var u=$("#discussionTray").scrollTop();$($("#dnC_"+n)[0]).focus();var D=$("#discussionTray").scrollTop();u!=D&&$("#discussionTray").scrollTop(u)}t&&(a?a&&i&&Discussion.Utilities.hide_urCmt(s.disId):Discussion.Utilities.show_urCmt(s,i,t));var h=1==s.type||2==s.type?"rRs":"";$("#dnCM").clone().appendTo(e).attr("id","p_"+s.id).attr("cellId",n).addClass(h);var f=$(d),C=$($("#dnC_"+s.id).find("#optBox").find("#dnCM_resolve")[0]),m=$($("#dnC_"+s.id).find("#dnCM_ReOpen")[0]),g=$($("#dnC_"+s.id).find("#optBox").find("#dnCM_Print")[0]),v=i?$(f.find("#dnCM_Delete")[0]).attr("uid",n):$($("#dnC_"+s.id).find("#optBox").find("#dnCM_Delete")[0]),p=$(i?f.find("#dnCM_Edit")[0]:$("#dnC_"+s.id).find("#optBox").find("#dnCM_Edit")[0]);Discussion.Utilities.constructPhoto(s.zuid,f.find("img")[0]),t||browser_ie?$(f.find("#sm")[0]).remove():$(f.find("#dnCM_Content")[0]).addClass(i?"rsmEllip":"csmEllip"),1==s.type||2==s.type?$(f.find("#dnCM_Content")[0]).remove():$(f.find("#dnCM_Content")[0]).html(s.content),$(f.find("#dnCM_Date")[0]).text(s.time).attr("href",Discussion.getLink(n,s.id,i)).click(function(s){s.stopPropagation()});var S=$(f.find("#dnCM_uN")[0]);if(1==s.type?$(S).text(s.owner).append("<i>"+jsMsg["Discussion.MarkedAsResolved"]+"</i>"):2==s.type?$(S).text(s.owner).append("<i>"+jsMsg["Discussion.Reopened"]+"</i>"):$(S).text(s.owner).attr("title",s.owner),Discussion.Utilities.cellLink(f),s.likes){s.likes.hasOwnProperty(zuid)?$(f.find("#dnLike")[0]).attr("liked",!0).attr("title","Liked").addClass("ldImg").show():$(f.find("#dnLike")[0]).attr("liked",!1).attr("title","Like");var _=Discussion.Utilities.getLikedNames(s.likes);$(f.find("#lCount")[0]).attr("title",_.names),Discussion.Utilities.showLikeCount(_.count,d)}else $(f.find("#lCount")[0]).attr("likes","").attr("title",""),$(f.find("#dnLike")[0]).attr("title","Like");if(i&&0!=s.type&&($(f.find("#lCount")[0]).remove(),$(f.find("#dnLike")[0]).remove(),$(f.find(".dot")[0]).remove()),$(f.find("#lCount")[0]).click(function(){var e=i?s.id:null;Discussion.Utilities.showLikedMembersDialog(n,e)}),$(C).hide().click(function(){return Discussion.Utilities.removeAllReplyEdit(s.id),Discussion.Ajax.do(ActionConstants.DISCUSSION_RESOLVE,s.id,"",s.cellRef),!1}),Discussion.AttachEvent.delete($(v),s.id,i),$(p).hide().attr("_id",s.id).click(function(){return Discussion.Utilities.showEdit($(p),i,s.id),!1}),i)$(f.find(".rBH")[0]).removeClass("rBH"),$(f.find("#dnCM_CellRef")[0]).remove(),Discussion.AttachEvent.showOptions(f,i),$(f.find("#dnCM_repliesOpts")[0]).remove(),$(f.find("#dnCM_resolve")[0]).remove(),ALLOW_TO_COMMENT&&0==s.type||($(p).remove(),$(v).remove()),a||$(p).remove(),Discussion.isOwnerRCo||a||$(v).remove(),l&&$(f.find("#dnCMOpt")[0]).hide();else{$(f.find("#dnCMOpt")[0]).remove(),Discussion.AttachEvent.showOptions($(d)[0],i),$(m).attr("disId",s.id),Discussion.AttachEvent.reopen($(m)),f.addClass("hC"),$(f.find("#dnCM_uN")[0]).text(s.owner).addClass("hN"),$(f.find("#dnCM_SheetName")[0]).text(s.sheetName),Discussion.Utilities.showSheetNEllip($(f.find("#dnCM_SheetName_ellip")[0]),s.sheetName);var E=Discussion.Utilities.getCellLabel(void 0,s.cellRef.sr,s.cellRef.sc,s.cellRef.er,s.cellRef.ec);$(f.find("#dnCM_CellName")[0]).text(E),$(f.find("#dnCM_CellLbl")[0]).attr({id:"p_"+s.id+"_lbl",title:s.sheetName+"."+E}),Discussion.AttachEvent.showMyRange(s.id,!1),Discussion.AuthenticateOptions(a,l,"#dnC_"+s.id)&&$(f.find("#resolveBtn")[0]).show(),r&&$("#dnC_"+n).css({"margin-top":Discussion.mTB+"px","margin-bottom":Discussion.mTB+"px"}).animate({"margin-top":"0px","margin-bottom":"0px"},300).show(),$(f.find("#dnCM_viewOlderReplies")[0]).click(function(){return $("[cellid="+n+"]").show(),$(f.find("#dnCM_hideReplies")[0]).show(),$(this).remove(),!1}),$(f.find("#dnCM_viewAllReplies")[0]).click(function(){return Discussion.Panel.viewAllReplies(s.id),!1}),$(f.find("#dnCM_hideReplies")[0]).click(function(){return $("[cellid="+n+"]").not(":first").hide(),$(f.find("#dnCM_viewAllReplies")[0]).show(),$(this).hide(),!1}),$(g).click(function(){return Discussion.print($("#dnC_"+s.id)),!1})}Discussion.AttachEvent.like(s.id,i),l||$(f.find("#dnCM_ResolvedState")[0]).hide(),i?($(f.find("#resolveBtn")[0]).remove(),$(f.find(".rBH")[0]).removeClass("rBH")):$(f.find("#dnCMOpt")[0]).remove(),o?f.hide():f.show(),i||Discussion.Filter.state!=Discussion.Filter.resolvedState||$("#dnC_"+n).hide(),!a&&t&&(Discussion.setPreSpotlight(f),i?Discussion.Notification.showFlashMsg(jsMsg["Discussion.replyAdded"],Discussion.Notification.FlashMsg_notify,n,s.id,!0):Discussion.Notification.showFlashMsg(jsMsg["Discussion.commentAdded"],Discussion.Notification.FlashMsg_notify,n,s.id,!1)),!t&&s.ur&&Discussion.setPreSpotlight(f[0])},removeAllReplyEdit:function(s){Discussion.Utilities.removeExistingReplyOrEdit(s);var i=$("#dnC_"+s).find("#dnE"),e=$(i).length;if(e>0)for(var n=0;e>n;n++){var t=$($(i)[n]).attr("myId");Discussion.Utilities.cancelEdit(t,!0)}},showSheetNEllip:function(s,i){i.length>22?$(s).show():$(s).hide()},getCellLabel:function(s,i,e,n,t){var o;switch(s){case!0:if(isCellRange()){var c=getCellRange();c=getServerRange(c.startRow,c.startCol,c.endRow,c.endCol),o=CellUtils.constructCellName(c.startRow,c.startCol,c.endRow,c.endCol,!1)}else o=getCellLabel(currRow,currCol),o=CURRSHEETNAME+"."+o;break;case!1:if(isCellRange()){var c=getCellRange();c=getServerRange(c.startRow,c.startCol,c.endRow,c.endCol),o=CellUtils.constructCellName(c.startRow,c.startCol,c.endRow,c.endCol,!1)}else o=getCellLabel(currRow,currCol);break;case void 0:o=i==n&&e==t?getCellLabel(i,e):getCellLabel(i,e)+":"+getCellLabel(n,t)}return o},setRangeAttr:function(s,i,e,n,t,o){$(s).attr(i?{sr:i.sr,sc:i.sc,er:i.er,ec:i.ec}:{sr:e,sc:n,er:t,ec:o})},getRange:function(s,i,e){var n;switch(s){case!0:n={sr:$(i).attr("sr"),sc:$(i).attr("sc"),er:$(i).attr("er"),ec:$(i).attr("ec")};break;case!1:var t=getDataFrom2DRangeText(e);return n={sr:t.sR,sc:t.sC,er:t.eR,ec:t.eC};case void 0:n=isCellRange()?{sr:getCellRange().startRow,sc:getCellRange().startCol,er:getCellRange().endRow,ec:getCellRange().endCol}:{sr:currRow,sc:currCol,er:currRow,ec:currCol}}return n},showlike:function(s,i,e,n){var t=$("#p_"+s);if(LOGIN_FULL_NAME==i){var o=$(t.find("#dnLike")[0]);o.attr("liked",n),n?o.attr("title","Liked").addClass("ldImg lkCmt animated").delay(1e3).queue(function(){$(this).removeClass("lImg lkCmt animated").dequeue()}):o.attr("title","Like").addClass("unlImg lkCmt animated").delay(500).queue(function(){$(this).removeClass("ldImg lkCmt animated"),$(this).addClass("lImg lkCmt animated"),$(this).removeClass("unlImg lkCmt animated").dequeue()})}if(0!=e.length){var c=Discussion.Utilities.getLikedNames(e);$(t.find("#lCount")[0]).attr("title",c.names),Discussion.Utilities.showLikeCount(c.count,"#p_"+s)}else Discussion.Utilities.showLikeCount(0,"#p_"+s)},getLikedNames:function(s){var i=JSON.parse(JSON.stringify(s)),e=Object.keys(i).length,n=i.hasOwnProperty(zuid),t="";if(1==e)t=n?replaceParams(jsMsg["Discussion.LikedBy"],new Array(jsMsg["Discussion.You"])):replaceParams(jsMsg["Discussion.LikedBy"],new Array(i[Object.keys(i)[0]]));else if(2==e)if(n)delete i[zuid],t=replaceParams(jsMsg["Discussion.LikedByAnd"],new Array(jsMsg["Discussion.You"],i[Object.keys(i)[0]]));else{var o=Object.keys(i);t=replaceParams(jsMsg["Discussion.LikedByAnd"],new Array(i[o[0]],i[o[1]]))}else if(e>2)if(n)delete i[zuid],t=replaceParams(jsMsg["Discussion.LikedByAndMore"],new Array(jsMsg["Discussion.You"],i[Object.keys(i)[0]],e-2+""));else{var o=Object.keys(i);t=replaceParams(jsMsg["Discussion.LikedByAndMore"],new Array(i[o[0]],i[o[1]],e-2+""))}return{names:t,count:e}},showLikedMembersDialog:function(s,e){var n=Discussion.Utilities.getLikedMembers(s,e),t="<table id='dLmL' cellpadding='0' cellspacing='0'>";for(i in n)t+="<tr><td class='iB'><img src='"+Discussion.Utilities.getPhotoUrl(i)+"'></td><td class='lUn'>"+n[i]+"</td></tr>";t+="</table>";var o={width:390,minHeight:0,maxHeight:300,modal:!0,title:jsMsg["Discussion.PeopleWhoLikeThis"]};sheetdialog.open(t,o)},getLikedMembers:function(s,i){return i?Discussion.all[s].cmtA[i].details.likes:Discussion.all[s].details.likes},enableRangeEdit:function(s){var i=$(s).parent().children()[0];if($(i).focus(),CellUtils.checkCellRef($(i).val())){var e=Discussion.Utilities.getRange(!1,void 0,$(i).val());focusCellRangeFill(e.sr,e.sc,e.er,e.ec,!0)}},showEdit:function(s,i,e){var n="#p_"+e,t=$(n),o=$(t.find("#dnCM_Content")[0]);if($(t.find("#dnCM_Content")[0]).hide(),void 0!=$(t).find("#more_"+e)[0]){$(t).find("#more_"+e).remove();var c=Discussion.DJsonUtil.getContent(e,i);$(o).html(c)}Discussion.isAddCmtOn=!0;var l=$("#p_"+e).attr("cellId");Discussion.Utilities.removeAllReplyEdit(l),$("#dnC_"+l).attr("prevId",e).attr("isPrevEdit",!0),$("#dnG").clone().appendTo($(t.find("#dnCM_SEdit")[0])),$(t.find("#dnCM_Content")[0]).hide();for(var d=$(t.find("#dnCM_Content")[0]).clone(),a=$(d).find("A").length,r=0;a>r;r++){var u=$(d).find("A")[0],D=$(u).attr("title");D=0==D.indexOf("mailto:")?D.replace("mailto:",""):D,$(u).replaceWith(D)}for(var h=$(d).find("IMG").length,r=0;h>r;r++){var u=$(d).find("IMG")[0];$(u).replaceWith($(u).attr("symbol"))}var f=$(d).html();if($(t.find("#dnCM_SEdit")[0]).show(),$(t.find("#dnCM_CellRefAd")[0]).hide(),$(t.find("#dnCM_CellName")[0]).hide(),$(t.find("#dnCM_SheetName_ellip")[0]).hide(),$(t.find("#dnCM_SheetName_dot")[0]).hide(),$(t.find("#dnCM_SheetName")[0]).hide(),$(t.find("#dnCM_SheetName_input")[0]).show(),$(t.find("#dnCMAd")[0]).hide(),$(t.find("#dnCM_Delete")[0]).hide(),$(t.find("#dnCM_Edit")[0]).hide(),$(t.find("#dnUName")[0]).text(""),$(t.find("#dnCM_Date")[0]).hide(),$(t.find("#clike")[0]).css("visibility","hidden"),i)Discussion.AttachEvent.emptyValidation($(t.find("#dnE")[0]),$(t.find("#dEAdd")[0]));else{$(t.find(".rBH")[0]).hide(),$(t.find("#dnCM_resolve")[0]).hide(),$(t.find("#dnCM_repliesOpts")[0]).hide();var C=$(t.find("#dCellRef")[0]);Discussion.AttachEvent.shortcut($(C),"edit",l,!1);var m=$(t.find("#dnCM_SheetName")[0]).text();$(C).attr("asn",WorkSheets.getSheetCodeFromName(m)),C.val(m+"."+$(t.find("#dnCM_CellName")[0]).text()).unbind("focus").focus(function(){Discussion.AttachEvent.showMyRange(e,!0),$($("#dnC_"+e)[0]).unbind("click"),Discussion.rangeEdit=!0,enableRangeSelector($("#dCellRef")[0]),Discussion.currRangeTF=C,$(this).css("borderColor","#01975b")}).unbind("click").click(function(s){stopEvent(s)}).unbind("blur").bind("blur",function(){CellUtils.checkCellRef($(this).val())||$(this).css("borderColor","#cc0909")});var g=8*$(C).val().length+5;g=(g>150?150:g)+"px",$(C).css("width",g);var v=Discussion.range[m][e];Discussion.Utilities.setRangeAttr($(C),v),Discussion.Utilities.highlightOnEdit("dnC_"+e,e,!1),$(t.find("#dnE")[0]).unbind("focus").focus(function(){Discussion.endRangeEdit();var s=$($(n).find("#dCellRef")[0]),i=$(s).val();CellUtils.checkCellRef(i)&&$(t).unbind("click").click(function(s){Discussion.Utilities.highlightOnEdit("dnC_"+e,e,!1),stopEvent(s)})}).unbind("click").click(function(s){Discussion.Utilities.highlightOnEdit("dnC_"+e,e,!1),stopEvent(s)}),Discussion.AttachEvent.rangeValidation(C,$(t.find("#dEAdd")[0]))}Discussion.AttachEvent.shortcut($(t.find("#dnE")[0]),"edit",e,i),Discussion.AttachEvent.shortcut($(t.find("#dEAdd")[0]),"edit",e,i),Discussion.AttachEvent.shortcut($(t.find("#dECancel")[0]),"edit",e,i),$(t.find("#dEAdd")[0]).bind("focus blur",function(){$(this).toggleClass("dFE")}),$(t.find("#dECancel")[0]).bind("focus blur",function(){$(this).toggleClass("dFE")}),$(t.find("#dEAdd")[0]).text(jsMsg.Save).attr("title",jsMsg.Save+" [Cmd+Enter]").unbind("click").click(function(s){i?Discussion.Comment.edit(e):Discussion.edit(e),stopEvent(s)}),$(t.find("#dECancel")[0]).unbind("click").click(function(s){i?Discussion.Comment.cancelEdit(e):Discussion.cancelEdit(e),stopEvent(s)}),$(t.find("#dnG").find(".dS.rC").css("background-color","transparent")),$(t.find("#dnG").find(".dS.rC").find("#dB")).hide(),$(t.find("#dnG")).show(),$(t.find("#dnE")[0]).text("").focus().html(f).attr("myId",e).click(function(s){Discussion.Smiley.toggle(s,this,!0)}),Discussion.Utilities.setCursorAtEnd(t.find("#dnE")[0]),connectProcessMention($(t.find("#dnE")[0]))},edit:function(s,i){var e=$("#p_"+s),n=getRichTextContent($(e.find("#dnE")[0]));if(!Discussion.contentValidation(n))return!1;if(i)Discussion.ShareViaCmt.do(n,function(i){Discussion.Ajax.do(ActionConstants.DISCUSSION_UPDATE_REPLY,s,encodeURIComponent(i))},e);else{var t=$("#p_"+s).find("#dCellRef"),o=t.val();if(!CellUtils.checkCellRef(o))return Discussion.cancelEdit(s),Discussion.Notification.showFlashMsg(jsMsg["Discussion.CellReferenceInvalid"],Discussion.Notification.FlashMsg_error),stopEvent(event),!1;var c=Discussion.Utilities.getRange(!1,void 0,o);Discussion.ShareViaCmt.do(n,function(i){Discussion.Ajax.do(ActionConstants.DISCUSSION_UPDATE_RANGE_CONTENT,s,encodeURIComponent(i),c,WorkSheets.getSheetCodeFromName(CellUtils.getSheetNameFromCelLbl(o)))},e)}Discussion.showLoader(e,!0)},resetAE:function(s,i,e){Discussion.endRangeEdit(),Discussion.isAddCmtOn=!1;var n="#p_"+s,t=$(n).attr("cellId"),o=$(n);$(o.find("#dnCM_SheetName_input")[0]).hide(),$(o.find("#dnG")[0]).remove(),i||($(o.find("#dnCM_resolve")[0]).show(),$(o.find("#dnCM_Delete")[0]).show(),$(o.find("#dnCM_Edit")[0]).show()),$("#dnC_"+t).attr("previd")&&$("#dnC_"+t).attr("previd",null).attr("isPrevEdit",null),e||Discussion.AttachEvent.showMyRange(t,!1)},cancelEdit:function(s,i){Discussion.Utilities.resetAE(s,i,!1);var e=$("#p_"+s);$(e.find("#dnCM_Date")[0]).show(),$(e.find("#clike")[0]).css("visibility","visible"),$(e.find("#dnCM_Content")[0]).show(),$(e.find("#dnCM_SEdit")[0]).hide(),i||($(e.find(".rBH")[0]).show(),$(e.find("#dnCM_SheetName")[0]).show(),Discussion.Utilities.showSheetNEllip($(e.find("#dnCM_SheetName_ellip")[0]),$(e.find("#dnCM_SheetName")[0]).text()),$(e.find("#dnCM_SheetName_dot")[0]).show(),$(e.find("#dnCM_CellName")[0]).show()),$(e.find("#dnCM_repliesOpts")[0]).show();var n=$(e).attr("cellid");void 0!=n&&Discussion.highlightActiveComment([n],!1)},getPhotoUrl:function(s){var i=PHOTO_SERVER_URL+"/file?fs=thumb&ID="+s;return(""===s||-1===s)&&(i=CollabUtil.cserver+"/file?fs=thumb&ID=none"),i},constructPhoto:function(s,i){img=Discussion.Utilities.getPhotoUrl(s),$(i).attr("src",img)},arrangeJson:function(s,i,e){var n;return e?i?(s.c=Discussion.addLinkToMsg(s.c,s.sn),n={zuid:s.oid,owner:s.on,id:s.cid,disId:s.uid,content:s.c,time:s.t,ur:!0,likes:s.likes,sheetName:s.sn,type:s.type}):(s.details.c=Discussion.addLinkToMsg(s.details.c,s.details.sn),n={zuid:s.details.oid,owner:s.details.on,id:s.cid,disId:s.uid,content:s.details.c,time:s.details.t,ur:s.details.ur,likes:s.details.likes,sheetName:s.details.sn,type:s.type},s.details.ur&&(n.timein_ms=s.details.rt)):i?(s.c=Discussion.addLinkToMsg(s.c,s.sn),n={zuid:s.oid,owner:s.on,id:s.uid,content:s.c,time:s.t,ur:!0,likes:s.likes,status:s.s,sheetName:s.sn,cellRef:s.range}):(s.details.c=Discussion.addLinkToMsg(s.details.c,s.details.sn),n={zuid:s.details.oid,owner:s.details.on,id:s.uid,content:s.details.c,time:s.details.t,ur:s.details.ur,likes:s.details.likes,status:s.details.s,sheetName:s.details.sn,cellRef:s.details.range},s.details.ur&&(n.timein_ms=s.details.rt)),n},arrangeSharedUsersJson:function(s){for(var i=[],e=s.length,n=0;e>n;n++)i[n]={id:s[n].zuid,name:s[n].fullName,avatar:CollabUtil.cserver+"/file?fs=thumb&ID="+s[n].zuid,type:"contact",value:s[n].fullName};return i},removeExistingReplyOrEdit:function(s){var i=$("#dnC_"+s).attr("prevId"),e=$("#dnC_"+s).attr("isPrevEdit");i&&("true"==e?Discussion.cancelEdit(s):Discussion.Comment.resetAR(s,!0))},showRepliesOpts:function(s,i){switch(i){case"delete":var e=Object.keys(Discussion.all[s].cmtA).length;if(0>=e-1){var n=$("#dnC_"+s);n.find("#dnCM_viewAllReplies").hide(),n.find("#dnCM_hideReplies").hide()}break;case"cmtAdd":var n=$("#dnC_"+s);n.find("#dnCM_viewAllReplies").is(":visible")||n.find("#dnCM_hideReplies").is(":visible")||n.find("#dnCM_viewOlderReplies").is(":visible")||n.find("#dnCM_hideReplies").show()}},setCursorAtEnd:function(s){var i=$(s).get(0).lastChild;if(i){var e=i.textContent.length,n=document.getSelection(),t=document.createRange();t.setStart(i,e),t.setEnd(i,e),t.collapse(!0),n.removeAllRanges(),n.addRange(t)}s.focus()},showLikeCount:function(s,i){s>0?$($(i).find("#lCount")[0]).text(s+"").show():$($(i).find("#lCount")[0]).text(s+"").hide()}},Panel:{showAll:function(s){Discussion.toggle("show");for(var i=$("#discussionTray")[0],e=s.length,n=0;e>n;n++){var t=s[n].uid;Discussion.ntfnJson[t]=null;{var o="#dnC_"+t;s[n].details.s}$("#dnP").clone().appendTo(i).attr("id","dnC_"+t).show();var c=$(o);$(c.find("#dnG")[0]).remove(),$(c.find("#dnR")[0]).show(),$(c.find("#dnPG")[0]).empty().css("max-height","none"),c.find("#dnRC").attr("disid",t).unbind("click"),Discussion.AttachEvent.reply($(o).find("#dnRC")),Discussion.all[t]=s[n];var l=LOGIN_FULL_NAME==s[n].owner;if(!l&&s[n].details.ur&&Discussion.Utilities.show_urCmt(Discussion.Utilities.arrangeJson(s[n],!1,!1),!1,!1),void 0!==s[n].cmtA){for(var d=s[n].cmtA,a=d.length,r={},u=0;a>u;u++){var D=d[u].cid;r[D]=d[u],l=LOGIN_FULL_NAME==d[u].owner,!l&&d[u].details.ur&&Discussion.Utilities.show_urCmt(Discussion.Utilities.arrangeJson(d[u],!1,!0),!0,!1)}delete s[n].cmtA,s[n].cmtA=r}Discussion.all[t]=s[n]}Discussion.SJsonUtil.init(Discussion.all);var h=$("#unread_discussionTray_1")[0];if(Object.keys(Discussion.all).length>0){var f=Object.keys(Discussion.notifyByTimeJson);f.sort().reverse();for(var C=0;C<f.length;C++){var m=Discussion.notifyByTimeJson[f[C]];$("#"+m).detach().appendTo(h).show()}}Discussion.showUnreadCount(),Discussion.showNoNtfnDiv(),"null"==NICEURL&&Discussion.highlightMyDiscussion(!1),NiceURL.processCmtURL(),(Discussion.isHlgtEnabled||Discussion.isHlgtEnabledOnLoad)&&Discussion.highlightAllCmtRange(!0),Discussion.Filter.init(!0),appEvent.trigger("Discussion.cmtReady"),appEvent.trigger("Discussion.sheetReady")},viewAllReplies:function(s){var i=$("#dnC_"+s);if(i.find("#dnPG").children().length>1){i.find("#dnCM_hideReplies").show();for(var e=i.find("#dnPG").children().length,n=1;e>n;n++)$(i.find("#dnPG").children()[n]).show()}i.find("#dnCM_viewAllReplies").hide(),i.find("#dnCM_viewOlderReplies").hide()},resetDim:function(s){var i=2,e=25,n=s+i-(e+$("#discussionPanelHdr").outerHeight(!0)+4);$("#discussionTray").height(n),$("#unread_discussionTray").height(n),Discussion.unreadDisTrayHeight=n},updateRange:function(s,i){$($("#p_"+s).find("#dnCM_CellName")[0]).text(i),$("#dnFC_"+s).remove()},renameSheet:function(s,i,e){$($("#p_"+s).find("#dnCM_SheetName")[0]).text(i);var n=$($("#p_"+s).find("#dCellRef")[0]).val();n.indexOf(e+".")>=0&&$($("#p_"+s).find("#dCellRef")[0]).val(n.replace(e,i)),Discussion.Utilities.showSheetNEllip($($("#p_"+s).find("#dnCM_SheetName_ellip")[0]),i)},remove:function(s){$("#dnC_"+s).remove(),$("#dnFC_"+s).remove()}},Comment:{showGetter:function(s,i){var e="#dnC_"+i;$($(e).find("#dnR")[0]).hide(),Discussion.Utilities.removeExistingReplyOrEdit(i),$($("#dnC_"+i)[0]).attr("prevId",i).attr("isPrevEdit",!1),$($("#dnC_"+i).find("#dnR")[0]).hide(),$("#dnG").clone().appendTo(s).attr("id","dnGR").attr("class","noprint");var n=$($(e).find("#dnGR")[0]);$(n.find("#dnUName")[0]).text(""),$(n.find("#dnCM_CellRefAd")[0]).hide(),$(n.find("#dnCMAd")[0]).hide(),$(n.find("#dEAdd")[0]).attr("disid",i),$(n.find("#dECancel")[0]).attr("disid",i),Discussion.AttachEvent.emptyValidation($(n.find("#dnE")[0]),$(n.find("#dEAdd")[0])),Discussion.AttachEvent.shortcut($(n.find("#dnE")[0]),"reply",i),Discussion.AttachEvent.shortcut($(n.find("#dEAdd")[0]),"reply",i),Discussion.AttachEvent.shortcut($(n.find("#dECancel")[0]),"reply",i),$(n.find("#dEAdd")[0]).bind("focus blur",function(){$(this).toggleClass("dFE")}),$(n.find("#dECancel")[0]).bind("focus blur",function(){$(this).toggleClass("dFE")}),$(n.find("#dEAdd")[0]).text(jsMsg["Discussion.Reply"]).attr("title",jsMsg["Discussion.Reply"]+" [Cmd+Enter]").prop("disabled",!0).unbind("click").click(function(s){Discussion.Comment.add(i),stopEvent(s)}),$(n.find("#dnE")[0]).text("").attr("rows",2),$(n.find("#dECancel")[0]).unbind("click").click(function(s){return Discussion.Comment.resetAR(i,!1),stopEvent(s),!1});var t=Discussion.sJson[i]===Discussion.Filter.resolvedState?jsMsg["Discussion.ReplyToReopenThisDiscussion"]:jsMsg["Discussion.ReplyToThisDiscussion"];$(n.find("#dnE")[0]).attr({placeholder:t}).click(function(s){Discussion.Smiley.toggle(s,this,!0),$(n.find("#dnE")[0]).focus(),stopEvent(s)}),setTimeout(function(){$(n.find("#dnE")[0]).focus()},300),$(n.find("#dnUS")[0]).hide().empty(),n.show(),connectProcessMention($(n.find("#dnE")[0]))},add:function(s){var i=$($("#dnC_"+s).find("#dnPp")),e=$($("#dnC_"+s).find("#dnGR")[0]),n=($(e).find("#dnE")[0],getRichTextContent($(e.find("#dnE")[0])));if(!Discussion.contentValidation(n))return!1;var t=$("#p_"+s).find("#dnCM_SheetName").text(),o=Discussion.range[t][s],c=WorkSheets.getSheetCodeFromName(t);return Discussion.ShareViaCmt.do(n,function(i){Discussion.Ajax.do(ActionConstants.DISCUSSION_ADD_REPLY,s,encodeURIComponent(i),o,c)},$($(i).find("#dnGR")[0])),Discussion.showLoader($($(i).find("#dnGR")[0])),!1},edit:function(s){Discussion.Utilities.edit(s,!0)},resetAR:function(s,i){var e=$("#dnC_"+s);Discussion.isAddCmtOn=!1,$(e.find("#dnGR")[0]).remove(),$(e.find("#dnR")[0]).show(),e.attr("previd")&&e.attr("previd",null).attr("isPrevEdit",null),i||Discussion.AttachEvent.showMyRange(s,!1)},cancelEdit:function(s){Discussion.Utilities.cancelEdit(s,!0)},delete:function(s){Discussion.Ajax.do(ActionConstants.DISCUSSION_DELETE_REPLY,s)}},Filter:{openState:"active",resolvedState:"resolved",allState:"all",prevState:"active",state:"",defaultState:"active",sheetname:null,init:function(s){var i=Discussion.SJsonUtil.getCounts(),e=Discussion.Filter.state==Discussion.Filter.openState?i.active:Discussion.Filter.state==Discussion.Filter.resolvedState?i.resolved:i.all;$("#dnFCnt").text(e),$("#dnFOUnresolvedCnt").text(i.active>0?i.active:""),$("#dnFOResolvedCnt").text(i.resolved>0?i.resolved:""),$("#dnFOAllCnt").text(i.all>0?i.all:""),s&&Discussion.Filter.initSheetFilter(),Discussion.Filter.updateSheetFilter();var n=0;if(Object.keys(Discussion.all).length>0){var t=Discussion.Filter.state,o=null!=Discussion.Filter.sheetname?Discussion.range[Discussion.Filter.sheetname]:Discussion.sJson;for(var c in o)(Discussion.sJson[c]==t||t==Discussion.Filter.allState)&&(n+=1)}$("#dnSFCnt").text(n);var l=Discussion.SJsonUtil.getStateCount(Discussion.SJsonUtil.getCounts(null,!0));$("#li_dnSF_All").find("#dnSFCnt_All").text(l>0?l:"")},initSheetFilter:function(){for(var s=CellUtils.getRequiredSheetNames().sheetNames.length,i=0;s>i;i++){var e=CellUtils.getRequiredSheetNames().sheetNames[i],n="cF_"+WorkSheets.getSheetCodeFromName(e).replace(/#/g,""),t=$("<li id="+n+"></li>").attr("state",i+1).html("<div id = dnSF_"+n+" title='"+e+"'>"+e+"</div>");$($("#dnFO1List")[0]).append($(t));{$("#dnFCnt_All").clone().appendTo(t)}Discussion.AttachEvent.sheetFilterOnchange(t)}},updateSheetFilter:function(){for(var s=CellUtils.getRequiredSheetNames().sheetNames.length,i=0;s>i;i++){var e=CellUtils.getRequiredSheetNames().sheetNames[i],n="cF_"+WorkSheets.getSheetCodeFromName(e).replace(/#/g,""),t=Discussion.SJsonUtil.getCounts(e),o=Discussion.SJsonUtil.getStateCount(t);$("#"+n).find("#dnSFCnt_All").text(o>0?o:"")}},showMenu:function(s){stopEvent(event),$($("#"+s)[0]).show()},hideMenu:function(s){$($("#"+s)[0]).hide()},getHdr:function(s){return s==Discussion.Filter.resolvedState?jsMsg["Discussion.PanelHeader.Resolved"]:s==Discussion.Filter.openState?jsMsg["Discussion.PanelHeader.Active"]:jsMsg["Discussion.PanelHeader.All"]},changeHdr:function(s){var i=Discussion.Filter.getHdr(s);$("#dPhS").text(i).attr("title",i)},show:function(s,i,e){var n=Discussion.Filter.state;if("object"==typeof s&&null!=s){var t=parseInt($(s).attr("state"));s=0==t?Discussion.Filter.openState:1==t?Discussion.Filter.resolvedState:Discussion.Filter.allState}if(void 0==i)i=Discussion.Filter.sheetname;else if("object"==typeof i){var o=$(i).attr("state");i=$($(i).find("div")[0]).text(),i=void 0==o?null:i}if(s=null==s?n:s,!Discussion.isPanelOpened()&&e&&Discussion.showAll(void 0,!0),s==Discussion.Filter.state&&Discussion.Filter.sheetname==i)return!1;Discussion.Filter.sheetname=i;var c,l,d,a=Discussion.SJsonUtil.getCounts(),r=a,u=null!=Discussion.Filter.sheetname?Discussion.Filter.sheetname:jsMsg["Discussion.HDAllSheet"],D=null!=Discussion.Filter.sheetname?Discussion.Filter.sheetname:jsMsg["Discussion.All"];s==Discussion.Filter.openState?(c=$("#discussionContainer #dnFOUnresolved").text(),r=r.active,l=replaceParams(jsMsg["Discussion.DeleteUnresolved"],new Array(u)),d=replaceParams(jsMsg["Discussion.PrintUnresolvedComments"],new Array(u)),Discussion.CommentsFilterState=D+" unresolved"):s==Discussion.Filter.resolvedState?(c=$("#discussionContainer #dnFOResolved").text(),r=r.resolved,l=replaceParams(jsMsg["Discussion.DeleteResolved"],new Array(u)),d=replaceParams(jsMsg["Discussion.PrintResolvedComments"],new Array(u)),Discussion.CommentsFilterState=D+" resolved"):(c=$("#discussionContainer #dnFOAll").text(),r=r.all,l=replaceParams(jsMsg["Discussion.DeleteAll"],new Array(u)),d=replaceParams(jsMsg["Discussion.PrintAllComments"],new Array(u)),Discussion.CommentsFilterState=D),$("#discussionContainer .dCb .mSb .mS #dnF").text(c),$("#discussionContainer .dCb .mSb .mS #dnFCnt").text(r),$("#dnFOUnresolvedCnt").text(a.active>0?a.active:""),$("#dnFOResolvedCnt").text(a.resolved>0?a.resolved:""),$("#dnFOAllCnt").text(a.all>0?a.all:""),$("#discussionContainer #dnFDel").attr("title",l),$("#discussionContainer #dnFHglt").attr("title",jsMsg["Discussion.HighlightUnresolvedComments"]),$("#discussionContainer #dnp_All").attr("title",d),$("#discussionContainer .dCb .mSb .mS #dnF1").text(null==i?jsMsg["Discussion.AllSheet"]:i),$($("#ND")[0]).remove(),$($("#discussionTray")[0]).scrollTop("0").show(),$("#noNtfn").is(":visible")||$($("#gotoDnCmts")[0]).hide(),Discussion.Filter.prevState=s,s!=Discussion.Filter.defaultState&&Discussion.Notification.closeFlashMsg();var h=0;if(s!=Discussion.Filter.resolvedState&&s!=Discussion.Filter.allState||Discussion.cardConstructedRes||Discussion.constructCmtDiv(Discussion.Filter.resolvedState),Object.keys(Discussion.all).length>0){var f=null!=Discussion.Filter.sheetname?Discussion.range[Discussion.Filter.sheetname]:Discussion.sJson;$('div[id^="dnC_"]').hide();for(var C in f)void 0==Discussion.sJson[C]||Discussion.sJson[C]!=s&&s!=Discussion.Filter.allState||($($("#dnC_"+C)[0]).show(),h+=1)}$("#dnSFCnt").text(h);var m=$("#spreadSheet").outerHeight(),g=$("#discussionPanelHdr").outerHeight(),v=$("#fOhd").outerHeight(),p=7,S=m-(g+p+v);$("#discussionTray").css("height",S),$("#unread_discussionTray").css("height",S),Discussion.Filter.state=s,Discussion.Filter.showNoCmtDiv(),Discussion.Filter.changeHdr(s),Discussion.Filter.updateSheetFilter();var _=Discussion.SJsonUtil.getStateCount(Discussion.SJsonUtil.getCounts(null,!0));$("#li_dnSF_All").find("#dnSFCnt_All").text(_>0?_:""),s!=Discussion.Filter.resolvedState&&s!=Discussion.Filter.allState||Discussion.ellipResAdded||(Discussion.showEllipsis(Discussion.Filter.resolvedState),Discussion.ellipResAdded=!0),Discussion.isHlgtEnabled&&""==n},isCmtAvailable:function(){var s=!1,i=Discussion.SJsonUtil.getCounts();switch(Discussion.Filter.state){case Discussion.Filter.openState:i.active>0&&(s=!0);break;case Discussion.Filter.resolvedState:i.resolved>0&&(s=!0);break;case Discussion.Filter.allState:i.all>0&&(s=!0)}return s},showNoCmtDiv:function(){var s=Discussion.Filter.isCmtAvailable();$("#discussionContainer #noComment").hide(),$("#discussionContainer #aNcF").hide(),s?($("#discussionContainer #dnFDel").removeClass("dndS").enable(),$("#discussionContainer #dnp_All").enable()):(Discussion.Filter.state==Discussion.Filter.resolvedState?$("#discussionContainer #noComment").show():$("#discussionContainer #aNcF").show(),$("#discussionContainer #dnFDel").addClass("dndS").disable(),$("#discussionContainer #dnp_All").disable()),Discussion.DJsonUtil.hasActiveCmt()?$("#discussionContainer #dnFHglt").enable():$("#discussionContainer #dnFHglt").disable()},update:function(){Discussion.Filter.init(),Discussion.Filter.showNoCmtDiv()},sheetUpdate:function(s,i){switch(s){case"SHEET_COPY":case"SHEET_INSERT":Discussion.Filter.addSheet(i.sn);break;case"SHEET_REMOVE":Discussion.Filter.removeSheet(i.asn,i.sn);break;case"SHEET_RENAME":Discussion.Filter.renameSheet(i.osn,i.sn);var e=Discussion.SJsonUtil.getCounts(i.sn).active;e>0&&Discussion.SheetCallout.add(i.sn,e)}},addSheet:function(s){var i="cF_"+WorkSheets.getSheetCodeFromName(s).replace(/#/g,""),e=$("<li id="+i+"></li>").attr("state",CellUtils.getRequiredSheetNames().sheetNames.length).html("<div id = dnSF_"+i+" title='"+s+"'>"+s+"</div>");$($("#dnFO1List")[0]).append($(e));var n=$("#dnFCnt_All").clone().appendTo(e);$(n).find("#dnSFCnt_All").text(""),Discussion.AttachEvent.sheetFilterOnchange(e)},removeSheet:function(s,i){var e="cF_"+s.replace(/#/g,"");$("#dnFO1List").find($("#"+e)).remove(),$("#discussionContainer .dCb .mSb .mS #dnF1").text()==i&&Discussion.Filter.show(Discussion.Filter.state,$("#li_dnSF_All"))},renameSheet:function(s,i){var e="cF_"+WorkSheets.getSheetCodeFromName(i).replace(/#/g,"");$("#dnFO1List").find($("#dnSF_"+e)).text(i).attr("title",i),$("#discussionContainer .dCb .mSb .mS #dnF1").text()==s&&$("#discussionContainer .dCb .mSb .mS #dnF1").text(i)}},SJsonUtil:{init:function(s){var i=!1;for(var e in s)Discussion.sJson[e]=s[e].details.s,s[e].details.s==Discussion.Filter.openState&&(i=!0);return i},getCounts:function(s,i){var e=0,n=0;all=0;var t;1==i?t=Discussion.sJson:(s=void 0!=s?s:Discussion.Filter.sheetname,t=null!=s?Discussion.range[s]:Discussion.sJson);for(var o in t)void 0!=Discussion.sJson[o]&&(Discussion.sJson[o]==Discussion.Filter.openState?e+=1:Discussion.sJson[o]==Discussion.Filter.resolvedState&&(n+=1),all+=1);return{active:e,resolved:n,all:all}},getStateCount:function(s){var i=0;switch(Discussion.Filter.state){case Discussion.Filter.openState:i=s.active;break;case Discussion.Filter.resolvedState:i=s.resolved;break;case Discussion.Filter.allState:i=s.all;break;default:i=s.active}return i},add:function(s){Discussion.sJson[s]=Discussion.Filter.openState},update:function(s,i){Discussion.sJson[s]=i},remove:function(s){delete Discussion.sJson[s]}},RangeJsonUtil:{add:function(s){var i={},e={};e.sr=s.range.sr,e.sc=s.range.sc,e.er=s.range.er,e.ec=s.range.ec,i[s.uid]=e,Discussion.range[s.sn]?Discussion.range[s.sn][s.uid]=e:Discussion.range[s.sn]=i,Discussion.SheetCallout.add(s.sn)},remove:function(s,i){delete Discussion.range[s][i],Discussion.sJson[i]!=Discussion.Filter.resolvedState&&Discussion.SheetCallout.remove(s)},shRename:function(s,i){var e=Discussion.range[i];delete Discussion.range[i],Discussion.range[s]=e},shRemove:function(s){delete Discussion.range[s]},removeAll:function(){Discussion.range={}}},DJsonUtil:{add:function(s){Discussion.all[s.uid]=Discussion.DJsonUtil.arrangeJson(s,!1)},addCmt:function(s){var i=Discussion.all[s.uid];if(void 0==i)return!1;if(i.cmtA)i.cmtA[s.cid]=Discussion.DJsonUtil.arrangeJson(s,!0);else{var e={};e[s.cid]=Discussion.DJsonUtil.arrangeJson(s,!0),i.cmtA=e}},update:function(s,i){Discussion.all[s].details.c=i},getContent:function(s,i){if(!i)return Discussion.all[s].details.c;for(var e in Discussion.all)if(Discussion.all[e].cmtA&&Discussion.all[e].cmtA[s])return Discussion.all[e].cmtA[s].details.c},updateCmt:function(s,i){if(i){for(var e in Discussion.all)if(Discussion.all[e].cmtA&&Discussion.all[e].cmtA[s.cid]){Discussion.all[e].cmtA[s.cid].details.c=s.c;break}}else Discussion.all[s.uid].details.c=s.c},updateLike:function(s,i){i?Discussion.all[s.uid].cmtA[s.cid].details.likes=s.likes:Discussion.all[s.uid].details.likes=s.likes},updateStatus:function(s,i){Discussion.all[s].details.s=i},getCellRef:function(s){return Discussion.all[s].details.range},updateCellRef:function(s,i,e){void 0!=Discussion.all[s]&&(Discussion.all[s].details.range=i,Discussion.all[s].details.sn=e)},remove:function(s){delete Discussion.all[s]},removeCmt:function(s){for(var i in Discussion.all)if(Discussion.all[i].cmtA&&Discussion.all[i].cmtA[s]){delete Discussion.all[i].cmtA[s];break}},get:function(s){return Discussion.all[s]},getSD:function(s){var i=[],e=0;for(var n in Discussion.all)Discussion.all[n].details.sn===s&&(i[e]=Discussion.all[n],e++);return i},shRename:function(s,i){for(var e in Discussion.all)Discussion.all[e].details.sn===i&&(Discussion.all[e].details.sn=s,Discussion.Panel.renameSheet(e,s,i));Discussion.RangeJsonUtil.shRename(s,i)},shRemove:function(s){var i=Discussion.all;for(var e in i)Discussion.all[e].details.sn===s&&(Discussion.Panel.remove(e),Discussion.RangeJsonUtil.remove(s,e),Discussion.SJsonUtil.remove(e),delete Discussion.all[e]);Discussion.Filter.update()},arrangeJson:function(s,i){var e,n;return i?(n={on:s.on,oid:s.oid,c:s.c,t:s.t},e={uid:s.uid,cid:s.cid,details:n}):(n={on:s.on,oid:s.oid,c:s.c,t:s.t,range:s.range,sn:s.sn,s:Discussion.Filter.openState},e={uid:s.uid,details:n}),e},hasActiveCmt:function(){var s=!1;for(var i in Discussion.sJson)if(Discussion.sJson[i]==Discussion.Filter.openState){s=!0;break}return s}},AttachEvent:{highlightRangeOnAddCmt:function(){$($("#ND")[0]).unbind("click").bind("click",function(s){var i=$($("#ND").find("#dCellRef")[0]),e=$(i).val();if(CellUtils.checkCellRef(e)){Discussion.highlightActiveComment(["ND"],!0);var n=WorkSheets.getSheetNameFromCode($(i).attr("asn")),t=Discussion.Utilities.getRange(!1,void 0,e);Discussion.activeCmtId="newCmt",Discussion.Utilities.gotoRange(n,t,e),stopEvent(s)}})},sheetFilterOnchange:function(s){$(s).bind("click",function(){Discussion.Filter.show(null,this)})},highlgtOnSheetCallout:function(s){$(s).mouseenter(function(){}).mousedown(function(s){var i=$($(this)[0]).attr("sn"),e="cF_"+WorkSheets.getSheetCodeFromName(i).replace(/#/g,"");Discussion.Filter.show(Discussion.Filter.openState,$("#dnFO1List").find("#"+e)[0],!0,!0),i!=CURRSHEETNAME?(showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(i),"open"),Discussion.sheetHglgt=i,Discussion.disableCmtHgltOnFocus=Discussion.isHlgtEnabled?!1:!0):(Discussion.sheetHglgt=i,Discussion.highlightAllCmtRange(!1,!1,!0)),stopEvent(s)})},shortcut:function(s,i,e,n){$(s).keyup(function(t){if(27==t.which){var o=!1,c=$(s).parent().find("#iIt");if($(c).is(":visible"))Discussion.Smiley.toggle(t,s,!0),o=!0;else for(var l=$('ul[id^="ui-id-"]'),d=l.length,a=0;d>a;a++)"block"==$($(l)[a]).css("display")&&($($(l)[a]).css("display","none"),o=!0);if(!o){switch(i){case"add":Discussion.reset(),$("#dnFC_newCmt").remove(),focusCell(currRow,currCol);break;case"reply":Discussion.Comment.resetAR(e,!1),focusCell(currRow,currCol);break;case"edit":Discussion.Utilities.cancelEdit(e,n),focusCell(currRow,currCol)}Discussion.endRangeEdit()}}stopEvent(t)}),$(s).unbind("keydown").keydown(function(s){if((s.metaKey||s.ctrlKey)&&13==s.which)switch(s.which=27,i){case"add":Discussion.add();break;case"reply":Discussion.Comment.add(e),stopEvent(s);break;case"edit":Discussion.Utilities.edit(e,n),stopEvent(s)}else if(9==s.which){var t;t="add"===i?"#"+e:n?"#p_"+e:"#dnC_"+e;var o=$(t).find("#dnE")[0],c=document.activeElement;if(""!=$(o).text())if(s.shiftKey)if("dnE"===c.id)l="edit"===i?$(t).find("#dCellRef")[0]:$(t).find("#dECancel")[0],$(l).focus();else if("dEAdd"===c.id)l=$(t).find("#dnE")[0],$(l).focus();else if("dECancel"===c.id){var l=$(t).find("#dEAdd")[0];$(l).focus()}else"dCellRef"===c.id&&(l=$(t).find("#dECancel")[0],$(l).focus());else if("dnE"===c.id){var l=$(t).find("#dEAdd")[0];$(l).focus()}else"dEAdd"===c.id?(l=$(t).find("#dECancel")[0],$(l).focus()):"dECancel"===c.id?(l="edit"===i?$(t).find("#dCellRef")[0]:$(t).find("#dnE")[0],$(l).focus()):"dCellRef"===c.id&&(l=$(t).find("#dnE")[0],$(l).focus());Event.stop(s),stopEvt(s)}})},addReply:function(s,i){var e=$(s).attr("id");if(Discussion.prevFDsn.length<1||"dnE"==document.activeElement.id||"dCellRef"==document.activeElement.id)return!1;switch(i.which){case 37:var n=$(s).prevAll("div[id^='dnC_']:visible")[0];if(void 0!=n){$(n).trigger("click").focus();var t=$("#discussionTray")[0],o=$(n)[0];$(t).stop(!0).animate({scrollTop:$(t).scrollTop()+$(o).offset().top-($(t).offset().top+100)},{duration:"slow"})}break;case 39:var c=$(s).nextAll("div[id^='dnC_']:visible")[0];void 0!=c&&($(c).trigger("click").focus(),Discussion.Utilities.scrollIntoView($("#discussionTray")[0],$(c)[0]));break;case 82:if(i.ctrlKey||i.metaKey)return;var l=e.substring(4,e.length);if(void 0!=$("#dnC_"+l).find("#dnR")[0]&&!$("#dnC_"+l).find("#dnR").is(":visible"))return;Discussion.AttachEvent.triggerReply(l)}},emptyValidation:function(s,i){""===$(s).text().trim();browser_ie?$(s).unbind("keyup paste").bind("keyup paste",function(){$(i).prop("disabled",""===$(s).text().trim())}):$(s).unbind("input").bind("input",function(){$(i).prop("disabled",""===$(s).text().trim())})},rangeValidation:function(s,i){browser_ie?$(s).unbind("keyup paste").bind("keyup paste",function(){$(i).prop("disabled",(CellUtils.checkCellRef($(this).val())?!1:!0)&&""===$(s).text().trim()),$(Discussion.currRangeTF).css("borderColor","#cc0909")}):($(s).unbind("input").bind("input",function(){$(i).prop("disabled",(CellUtils.checkCellRef($(this).val())?!1:!0)&&""===$(s).text().trim()),$(Discussion.currRangeTF).css("borderColor","#cc0909")}),$(s).unbind("change").bind("change",function(){$(i).prop("disabled",(CellUtils.checkCellRef($(this).val())?!1:!0)&&""===$(s).text().trim()),$(Discussion.currRangeTF).css("borderColor","#cc0909")}))},reply:function(s){var i=$(s).attr("disid");$(s).click(function(s){Discussion.AttachEvent.triggerReply(i),stopEvent(s)})},triggerReply:function(s){ALLOW_TO_COMMENT&&(Discussion.Utilities.removeAllReplyEdit(s),Discussion.Comment.showGetter($("#dnC_"+s).find("#dnPp"),s),Discussion.Utilities.isVisible($("#dnC_"+s).find("#dEAdd"))||Discussion.Utilities.scrollIntoView($("#discussionTray")[0],$("#dnC_"+s).find("#dnGR")))},reopen:function(s){var i=$(s).attr("disId");$(s).click(function(){return Discussion.Ajax.do(ActionConstants.DISCUSSION_REOPEN,i),!1})},showOptions:function(s,i){i?$(s).mouseenter(function(){return $($(s).find("#dnG")[0]).is(":visible")?!1:($($(s).find("#dnCM_Delete")[0]).show(),void $($(s).find("#dnCM_Edit")[0]).show())}).mouseleave(function(){return $($(s).find("#dnG")[0]).is(":visible")?!1:($($(s).find("#dnCM_Delete")[0]).hide(),void $($(s).find("#dnCM_Edit")[0]).hide())}):$($(s).find(".rBH")[0]).unbind("click").click(function(){return Discussion.showResolveMenu(this,"dnC_"+$(s).attr("cellId")),!1})},delete:function(s,i,e){$(s).hide().click(function(n){var t=e?"#p_"+i:"#dnC_"+i,o=$($(t).find("#dnPp")[0]).css("width");e&&(o=$("#dnC_"+$(t).attr("cellid")).find("#dnPp").css("width"));var c=0;if(e){c=parseInt($(t).css("height"))+13+"px";var l=$(s).attr("uid");$("#dnC_"+l).find(".dC").hide(),o=$($("#dnC_"+l).find("#dnPp")[0]).css("width")}else $(t+" .dC").hide(),c=$($(t).find("#dnPp")[0]).css("height");return $($(t).find("#dlt_dlg")[0]).css({width:o,height:c}).show(),Discussion.AttachEvent.esc(),$($(t).find("#dlt")[0]).unbind("click").click(function(s){e?Discussion.Comment.delete(i):Discussion.delete(i),stopEvent(s)}),$($(t).find("#cnl")[0]).unbind("click").click(function(n){if($($(t).find("#dlt_dlg")[0]).hide(),e){var o=$(s).attr("uid");$("#dnC_"+o).css("position","")}else $("#dnC_"+i).css("position","");stopEvent(n)}),stopEvent(n),!1})},like:function(s,i){$($("#p_"+s).find("#dnLike")[0]).unbind("click").attr("_id",s).click(function(){return"true"==$($("#p_"+s).find("#dnLike")[0]).attr("liked")?Discussion.Ajax.do(i?ActionConstants.DISCUSSION_UNLIKE_REPLY:ActionConstants.DISCUSSION_UNLIKE,s):Discussion.Ajax.do(i?ActionConstants.DISCUSSION_LIKE_REPLY:ActionConstants.DISCUSSION_LIKE,s),!1})},unBindLike:function(s){$($("#p_"+s).find("#dnLike")[0]).unbind("click")},esc:function(){$(document).keydown(function(s){27==s.which&&$(".dC").hide()})},showMyRange:function(s,i){i?$($("#dnC_"+s)[0]).unbind("click"):$($("#dnC_"+s)[0]).unbind("click").click(function(i){Discussion.removeSpotlight($("#dnC_"+s)[0]),Discussion.highlightActiveComment([s],!1);var e=$($("#dnC_"+s).find("#dnCM_SheetName")[0]).text(),n=Discussion.DJsonUtil.getCellRef(s),t=$("#p_"+s+"_lbl SPAN").text();Discussion.activeCmtId=s,Discussion.isHlgtEnabled||Discussion.reInitHighlightEl(),e!=CURRSHEETNAME?setTimeout(function(){Discussion.reInitHighlightEl(),Discussion.Utilities.gotoRange(e,n,t)},300):Discussion.Utilities.gotoRange(e,n,t),showArrowMark("hide",$("#commentView"),"commentView"),appEvent.trigger("HistoryAPI",["cmtClick"]),stopEvent(i)})}},showLoader:function(s,i){"dS hC"!=$(s)[0].className&&$(s).css("position","relative");var e=$(s).width(),n=$(s).height();i&&(e+=5,n+=10),$("#dnMask").clone().prependTo(s);var t=$(s).find("#dnMask")[0];$(t).width(e).height(n).show(),$("#rpspinner").clone().appendTo(t);var o=$(t).find("#rpspinner")[0];$(o).css("margin-top",n/2-10).show(),$($(o).find(".spinner")[0]).show()},removeLoader:function(s){$(s).find("#dnMask").remove()},isOwnEl:function(s){return"dnHRD"==s.id||"dnFC"==s.id},isPanelEl:function(s){return $("#discussionContainer").find(s).length>0},enableLink:!0,addLinkToMsg:function(s,i){return s=convertRichTextContent(s),LinkMaker.convert(s,i,!0).msg},Smiley:{populate:function(){var s={};0==Object.keys(wmsSmiley).length&&Smiley.init();for(el in Smiley.defaultsmiley_lookup)s[el.toUpperCase()]=Smiley.defaultsmiley_lookup[el];var i="<table>",e=0,n=9;for(x in s){e%n==0&&(i+="<tr>"),e++;var t='<td><img src="'+IMAGE_PATH+'spacer.gif" class="wmssmils wmssmil-'+s[x]+'" symbol="'+x+'" title="'+s[x]+'" onclick="Discussion.Smiley.add(this, event)"/></td>';i+=e%n==0?t+"</tr>":t}i+=(e%n!=0?"</tr>":"")+"</table>",$("#iIt").append(i)},add:function(s,i){var e=$(s).parents(),n=$($(e[5]).find("#dnE")[0]);$(n).append(" "+$(s).attr("symbol")+" "),$($(e[6]).find("#dEAdd")[0]).prop("disabled",!1),Discussion.Utilities.setCursorAtEnd(n),stopEvent(i)},toggle:function(s,i,e){e||Discussion.Utilities.setCursorAtEnd($(i).parent().find("#dnE")[0]);var n=$(i).parent().find("#iIt");(!e||$(n).is(":visible"))&&(0==$("#iIt").children().length&&Discussion.Smiley.populate(),$(n).toggle(),stopEvent(s))}},Notification:{FlashMsg_notify:0,FlashMsg_error:1,FlashMsg_info:2,gotoCmt:function(s,i,e){void 0!=Discussion.sJson[s]?(Discussion.Filter.show(Discussion.sJson[s]),e&&Discussion.Panel.viewAllReplies(s),$("#p_"+s).click(),$("#displayNotify").hide(),$("#displayFilter").show(),$("#gotoDnCmts").hide(),$(this).css({"background-color":"#fafafa"}).removeAttr("uid"),$(this).removeClass("unRCmt").addClass("rCmt"),Discussion.spotlight($("#p_"+i)[0]),Discussion.Utilities.scrollIntoView($("#discussionTray")[0],$("#p_"+i)[0]),$(".rPdC#discussionTray").css("zIndex",1),$(".rPdC").css("overflow","hidden").removeClass("flip").delay(500).queue(function(){$(this).css("overflow-y","auto").dequeue()})):($(this).css({"background-color":"#fafafa"}).removeAttr("uid"),$(this).removeClass("unRCmt").addClass("rCmt"),Discussion.Notification.showFlashMsg(jsMsg["Discussion.commentDeletedN"],Discussion.Notification.FlashMsg_info))},showFlashMsg:function(s,i,e,n,t){switch(i){case Discussion.Notification.FlashMsg_notify:$("#cDMsg").unbind("click").click(function(){Discussion.Notification.gotoCmt(e,n,t)});break;case Discussion.Notification.FlashMsg_error:$("#cDMsg").unbind("click");break;case Discussion.Notification.FlashMsg_info:$("#cDMsg").unbind("click")}$("#cDMsg").text(s),$("#cDM").stop(!0).css({opacity:"1",zIndex:"6"}).delay(3e3).animate({opacity:0,zIndex:-1},2e3)},closeFlashMsg:function(){$("#cDM").css({opacity:"0",zIndex:"-1"})}},SheetCallout:{init:function(){Discussion.SheetCallout.removeAll();for(var s=CellUtils.getRequiredSheetNames().sheetNames.length,i=0;s>i;i++){var e=CellUtils.getRequiredSheetNames().sheetNames[i],n=Discussion.SJsonUtil.getCounts(e).active;if(n>0){var t=$("<span class='cSc' sn='"+e+"'><p>"+n+"</p></span>");$($("#sheetnames_"+i)[0]).prepend($(t)),Discussion.AttachEvent.highlgtOnSheetCallout($(t)[0])}}},add:function(s,i){var e=(WorkSheets.getSheetCodeFromName(s),$($("#sheetsTabTable [sheetname='"+s+"'] .tabItem div[id^='sheetnames_']")[0]));if(i=void 0!=i&&i>0?i:1,$(e).find(".cSc").length>0){var i=parseInt($(e).find("p").text())+1;$(e).find("p").text(i)}else{var n=$("<span class='cSc' sn='"+s+"'><p>"+i+"</p></span>");Discussion.isHlgtEnabled&&$(n).css("display","inline-block"),$($(e)[0]).prepend($(n)),Discussion.AttachEvent.highlgtOnSheetCallout($(n)[0])}},remove:function(s){var i=(WorkSheets.getSheetCodeFromName(s),$($("#sheetsTabTable [sheetname='"+s+"'] .tabItem div[id^='sheetnames_']")[0])),e=parseInt($(i).find("p").text())-1;e>0?$(i).find("p").text(e):$(i).find(".cSc").remove()},removeAll:function(){$("#sheetsTab").find(".cSc").remove()},show:function(){Discussion.isHlgtEnabled&&$("#sheetsTab .cSc").css("display","inline-block")}},ShareViaCmt:{unSharedMailIds:"",all_mailIds:[],content:"",callback:void 0,sharedUsers:[],loaderDiv:null,init:function(s,i,e){Discussion.ShareViaCmt.content=s,Discussion.ShareViaCmt.callback=i,Discussion.ShareViaCmt.loaderDiv=e;for(var n=mentionsData.length,t=0;n>t;t++)Discussion.ShareViaCmt.sharedUsers.push("@"+mentionsData[t].email)},destroy:function(){Discussion.ShareViaCmt.content="",Discussion.ShareViaCmt.callback=null,Discussion.ShareViaCmt.all_mailIds=[],Discussion.ShareViaCmt.unSharedMailIds=[],Discussion.ShareViaCmt.sharedUsers=[],Discussion.ShareViaCmt.loaderDiv=null},do:function(s,i,e){Discussion.ShareViaCmt.destroy(),Discussion.ShareViaCmt.all_mailIds=Discussion.ShareViaCmt.getMailAddress(s),Discussion.ShareViaCmt.init(s,i,e),Discussion.isOwnerRCo&&Discussion.ShareViaCmt.hasMailId(s)?(Discussion.ShareViaCmt.all_mailIds=Discussion.ShareViaCmt.getMailAddress(s),setTimeout(function(){ShareAndComment.show(Discussion.ShareViaCmt.eliminateDuplicateMailId(Discussion.ShareViaCmt.unSharedMailIds).toString())},50)):null!=Discussion.ShareViaCmt.all_mailIds&&Discussion.ShareViaCmt.all_mailIds.length>0?Discussion.ShareViaCmt.cmtWithoutShare():i(s)},getMailAddress:function(s){return s.match(/(@[a-zA-Z0-9.!#$%&'*+-\/=?^_`{|}~]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi)},hasMailId:function(){if(null===Discussion.ShareViaCmt.all_mailIds)return!1;for(var s=Discussion.ShareViaCmt.all_mailIds,i=[],e=s.length,n=0;e>n;n++)-1==Discussion.ShareViaCmt.sharedUsers.indexOf(s[n])&&i.push(s[n].substr(1,s[n].length));return Discussion.ShareViaCmt.unSharedMailIds=i,null!=i&&i.length>0},share:function(s){ZDSHAREDIALOG.commentAndShare(RESOURCE_ID,parseInt(s),encodeURIComponent(Discussion.ShareViaCmt.unSharedMailIds.toString()),function(s){Discussion.ShareViaCmt.updateSharedUsers(s)})},updateSharedUsers:function(s){"SUCCESS"==s.STATUS_MESSAGE&&Discussion.Ajax.updateSharedUsers()},updateContent:function(){for(var s=Discussion.ShareViaCmt.content,i=mentionsData.length,e=0;i>e;e++)if(-1!=Discussion.ShareViaCmt.all_mailIds.indexOf("@"+mentionsData[e].email)){var n=mentionsData[e].name,t=mentionsData[e].id;s=s.split("@"+mentionsData[e].email).join("<user:mention>"+t+":"+n+"</user:mention>")}return s},cmtWithoutShare:function(){Discussion.ShareViaCmt.callback(Discussion.ShareViaCmt.updateContent())},eliminateDuplicateMailId:function(s){var i=s;if(null!=s){for(var e={},n=0;n<s.length;n++){var t=s[n];e[t]=""}i=Object.keys(e)}return i}}};appEvent.on("postDocumentLoader",function(){Discussion.init(),Discussion.Ajax.getAll()}),appEvent.on("isAddCmtOn",function(){Discussion.setFocus()}),appEvent.on("Discussion.setFocusOn",function(){Discussion.setFocusOn&&(null!=Discussion.activeCmtId&&Discussion.highlightCmtRange(Discussion.activeCmtId,CURRSHEETNAME),Discussion.setFocusOn=!1)}),appEvent.on("book.onbeforesheetswitch",function(){Discussion.hideDefaultRangeSelector()}),appEvent.on("UpdateDiscussionRanges",function(s,i,e,n,t){Discussion.updateRanges(s,i,e,n,t),Discussion.isHlgtEnabled&&Discussion.highlightAllCmtRange(!0)}),appEvent.on("ShiftDiscussionRanges",function(s,i,e,n,t,o,c){Discussion.shiftRanges(s,i,e,n,t,o,c),Discussion.isHlgtEnabled&&Discussion.highlightAllCmtRange(!0)}),appEvent.on("Discussion.updateSharedUsers",function(s){Discussion.updateSharedUsers(s)}),appEvent.on("Discussion.updateShUserAndCmt",function(){null!=Discussion.ShareViaCmt.callback&&(Discussion.ShareViaCmt.callback(Discussion.ShareViaCmt.updateContent()),sheetdialog.close(),Discussion.ShareViaCmt.destroy())}),appEvent.on("cell.focus",function(){Discussion.disableCmtHgltOnFocus?Discussion.disableCmtHgltOnFocus=!1:("undefined"!=typeof discussionFocusInt&&window.clearTimeout(discussionFocusInt),discussionFocusInt=window.setTimeout(function(){Discussion.highlightMyDiscussion(!0)},500))}),appEvent.on("range.focus",function(){Discussion.disableCmtHgltOnFocus?Discussion.disableCmtHgltOnFocus=!1:("undefined"!=typeof discussionRangeFocusInt&&window.clearTimeout(discussionRangeFocusInt),discussionRangeFocusInt=window.setTimeout(function(){Discussion.highlightMyDiscussion(!0)},500))}),appEvent.on("postSheetLoader",function(){(Discussion.isHlgtEnabled||null!=Discussion.sheetHglgt)&&setTimeout(function(){Discussion.reInitHighlightEl(),Discussion.highlightAllCmtRange(!0),Discussion.sheetHglgt=null!=Discussion.sheetHglgt?null:Discussion.sheetHglgt},200),Discussion.disableCmtHgltOnFocus&&null!=Discussion.activeCmtId&&Discussion.highlightCmtRange(Discussion.activeCmtId,CURRSHEETNAME,!1),Discussion.Smiley.populate()}),appEvent.on("cmtRangeUpdate",function(){Discussion.isHlgtEnabled&&Discussion.highlightAllCmtRange(!0,!0)}),appEvent.on("cmtHgltAfterFreeze",function(){Discussion.isHlgtEnabled&&Discussion.highlightAllCmtRange(!0)}),appEvent.on("DiscussionSheets",function(s,i){Discussion.Filter.sheetUpdate(s,i)}),appEvent.on("Discussion.sheetReady",function(){Discussion.cmtReady?Discussion.SheetCallout.init():Discussion.cmtReady=!0}),appEvent.on("Discussion.cmtReady",function(){Discussion.cmtReady&&Discussion.SheetCallout.init(),Discussion.getterAfterload&&Discussion.showGetter()}),appEvent.on("PostSheetObjectUpdate",function(){Discussion.SheetCallout.init(),Discussion.SheetCallout.show()}),appEvent.on("postVersionView",function(){$("#discussionContainer").hide(),Discussion.reInitHighlightEl(),Discussion.hideSbarCmtIcon(),Discussion.SheetCallout.removeAll()});
appEvent.on("OnDocumentReady",function(){"null"!=NICEURL&&(NICEURL=parseInt(NICEURL),NiceURL.init())});var NiceURL={isToolbarLoaded:!0,params:{},isValidHash:window.location.hash.length>0?!0:!1,enableHistoryAPI:!1,init:function(){appEvent.on("cell.keyUp",function(){appEvent.trigger("HistoryAPI",["rangeSelection"])}),appEvent.on("rangeEndSelect",function(){appEvent.trigger("HistoryAPI",["rangeSelection"])}),appEvent.on("PostVersionPaneLoad",function(){NiceURL.triggerViewVersion()}),appEvent.on("PostVersionLoad",function(){NiceURL.enableHistoryAPI=!0,NiceURL.updateURL("versions")}),appEvent.on("menutabListener",function(e){"versionview"==e&&(NiceURL.enableHistoryAPI=!0,NiceURL.updateURL("versions"))}),appEvent.on("HistoryAPI",function(e){NiceURL.updateURL(e)}),appEvent.on("postSheetLoader",function(){NiceURL.isToolbarLoaded&&NiceURL.updateURL("loadSheet")}),appEvent.on("sheet.onnamechanged",function(e,n){CURRSHEETNAME===n&&(CURRSHEETNAME=e,NiceURL.updateURL("rangeSelection"))}),NiceURL.openDialog(),NiceURL.parseURL()},parseURL:function(){var e=document.URL;e.indexOf("#")+1==e.length&&(e=e.substr(0,e.length-1));var n=e.split("/"),s="/"==ctxpath?4:5;switch(NICEURL){case ActionConstants.NICEURL_COMMENT:case ActionConstants.NICEURL_GETREPLY:NiceURL.params.commentId=n[s+2];break;case ActionConstants.NICEURL_REPLY:NiceURL.params.commentId=n[s+2],NiceURL.params.replyId=n[s+4];break;case ActionConstants.NICEURL_RANGE:NiceURL.params.range=n[s+2];break;case ActionConstants.NICEURL_SHEET:NiceURL.params.sheetname=n[s+2];break;case ActionConstants.NICEURL_SHEETRANGE:NiceURL.params.sheetname=n[s+2],NiceURL.params.range=n[s+4];break;case ActionConstants.NICEURL_VERSIONS:NiceURL.params.versionNo=void 0==n[s+2]?DOCUMENT_VERSION:n[s+2]}},processCmtURL:function(){if(!Discussion.on)return!1;if("null"!=NICEURL)switch(NICEURL){case ActionConstants.NICEURL_CMTDLG:Discussion.showAll(),Discussion.highlightAllCmtRange();break;case ActionConstants.NICEURL_COMMENT:case ActionConstants.NICEURL_GETREPLY:case ActionConstants.NICEURL_REPLY:Discussion.showAll();var e=NiceURL.params.commentId,n=$("#dnC_"+e)[0];if(void 0!=n){"resolved"==Discussion.sJson[e]&&Discussion.Filter.show("resolved"),Discussion.Panel.viewAllReplies(e),Discussion.Utilities.scrollIntoView($("#discussionTray")[0],$(n)[0]),Discussion.highlightActiveComment([e],!1);var s=$($("#dnC_"+e).find("#dnCM_SheetName")[0]).text(),t=Discussion.DJsonUtil.getCellRef(e),i=$("#p_"+e+"_lbl SPAN").text();Discussion.Utilities.gotoRange(s,t,i),Discussion.highlightCmtRange(e,s,!1),NICEURL==ActionConstants.NICEURL_GETREPLY?Discussion.AttachEvent.triggerReply(e):NICEURL==ActionConstants.NICEURL_REPLY?(Discussion.Utilities.scrollIntoView($("#discussionTray")[0],$("#p_"+NiceURL.params.replyId)[0]),Discussion.spotlight($("#p_"+NiceURL.params.replyId)[0])):Discussion.spotlight($("#p_"+NiceURL.params.commentId)[0])}else showAlertDialog(jsMsg["Discussion.ThatCommentHasBeenDeleted"])}},process:function(){switch(NICEURL){case ActionConstants.NICEURL_RANGE:case ActionConstants.NICEURL_SHEETRANGE:case ActionConstants.NICEURL_SHEET:NiceURL.gotoRange();break;case ActionConstants.NICEURL_VERSIONS:AuditTrail.showVersionHistory()}},openDialog:function(){window.location.hash==jsMsg["Notification.NotificationSettings"]&&NotificationSettings.showDialog()},gotoRange:function(){if("null"!=NICEURL){var e=NiceURL.params.range,n=decodeURIComponent(NiceURL.params.sheetname),s=n+(void 0==NiceURL.params.range?"":"."+e);return void 0==NiceURL.params.range||CellUtils.checkCellLbl(s)&&(void 0==n||CellUtils.isDefinedSheet(n))?void Goto.gotoCellInit(s,"LABEL"):void showAlertDialog(jsMsg["NiceURL.InValidCellReference"])}},updateURL:function(e){if(NiceURL.isToolbarLoaded){if(!NiceURL.enableHistoryAPI)return void(NiceURL.enableHistoryAPI=!0);var n,s=jsPUBLIC_VIEW?"/sheet/published/"+RESOURCE_ID:"/sheet/open/"+RESOURCE_ID,t=encodeURIComponent(CURRSHEETNAME);switch(n=isCellRange()?getCellLabel(getCellRange().startRow,getCellRange().startCol)+":"+getCellLabel(getCellRange().endRow,getCellRange().endCol):getCellLabel(currRow,currCol),e){case"rangeSelection":if(isCellRange()){var n=getCellLabel(getCellRange().startRow,getCellRange().startCol)+":"+getCellLabel(getCellRange().endRow,getCellRange().endCol);s=s+"/sheets/"+t+"/ranges/"+n}else s=s+"/sheets/"+t+"/ranges/"+getCellLabel(currRow,currCol);break;case"fillSeries":var n=getCellLabel(getCellRange().startRow,getCellRange().startCol)+":"+getCellLabel(getCellRange().endRow,getCellRange().endCol);s=s+"/sheets/"+t+"/ranges/"+n;break;case"sheetswitch":s=s+"/sheets/"+encodeURIComponent(currSheetOnMove.getAttribute("sheetname"));break;case"loadSheet":s=s+"/sheets/"+t;break;case"versions":s=s+"/versions"+(""!=DOCUMENT_VERSION?"/"+DOCUMENT_VERSION:""),NiceURL.enableHistoryAPI=!1;break;case"cmtClick":s=s+"/comments/"+Discussion.activeCmtId}window.history.replaceState({state:e},"sheets",s)}},triggerViewVersion:function(){if(void 0!=NiceURL.params.versionNo){var e=NiceURL.params.versionNo;e=NiceURL.params.versionNo=-1!=e.indexOf(".0")?e:e+".0",e!=DOCUMENT_VERSION&&$("#versionItemsContainer").find('div[ver^="'+e+'"]').trigger("click")}}};
var ShareAndComment=function(){var i,s="",e=function(i){s=i,t()},t=function(){i=!0;var e={autoOpen:!1,width:540,modal:!0,resizable:!1,title:jsMsg["Discussion.ShareCommentTitle"],close:function(){if(sheetdialog.close(),i){Discussion.removeLoader(Discussion.ShareViaCmt.loaderDiv);var s=$(Discussion.ShareViaCmt.loaderDiv.find("#dnE")[0]);$(s)[0].contentEditable="true",setTimeout(function(){Discussion.Utilities.setCursorAtEnd($(s)[0])},100)}},buttons:[{text:jsMsg["Discussion.ShareAndComment"],class:"ui-zbutton-primary",click:function(){i=!1,Discussion.ShareViaCmt.share($("#rs_perm").val())}},{text:jsMsg["Discussion.CommentWithoutSharing"],click:function(){i=!1,Discussion.ShareViaCmt.cmtWithoutShare(),sheetdialog.close()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};sheetdialog.open("shareandcommentdialog",e,{init:function(){$("#scMail").val(s),jsSHARE_VIEW&&$("#rs_perm_coOwner").remove()}})};return{show:e}}(jQuery);
function resetglobalvariables(){FILE_FORMAT=null,DOCUMENT_VIEW="NEW_VIEW",COLOR_DIV_ID="bg_fill_div",jsVERSION_VIEW||(wmsCommErrorStatus=DOCUMENT_NAME=DOC_NAME=TAGLIST=currDocPanelId=currFocusFld=funcFocusFld=publicURL=SHEETNAMES=LOCKED_USER=deleteOptions=insertOptions=formatOptions=saveAsDialog=saveAsTemplateDialog=publishOptionsDialog=moreActionsDialog=DOCUMENT_NAME_URL=""),isErrorDoc=displayAll=DEFAULT_FILENAME_FLAG=isDocumentSemiPublic=doAutoSave=isEdit=isFuncDlgOpen=isStockConfigured=isDocumentPublic=IS_UNSAVED_SHEET=ALL_SHEET_SHARED=INSERT_SHEET_ALLOWED=ALLOW_TO_WRITE=READ_WRITE=DOCUMENT_LOCKED=jsREMOTE_SAVE_VIEW=jsVERSION_VIEW=jsTHROWAWAY_VIEW=jsREMOTE_VIEW=jsPUBLIC_VIEW=jsGUEST_VIEW=jsNEW_DOC_VIEW=jsOPEN_DOC_VIEW=jsSHARE_VIEW=jsTRASH_VIEW=INSERTIMAGE=fromGoTo=savingInProgress=isSheetLoading=PUBLIC_EDIT_MODE=jsEMBED_VIEW=hasOleMoved=allowOrgEdit=!1,panelOpenedFor=defineNameHTML=currentNamesListSPAN=ASSIGNEDTO=FOCUSSEDNAMEINPUTOBJECT="",wmsErrorMsgShown=!1,allowExportOrg=showFormulasOrg=allowExport=showFormulas=SAVED=DOC_SHARE_STATE=DOC_BASED_SHARE=savedFlag=OOLOADED=CANREADWRITE=!0,SHEETSWITCH=ENTEREDPERFCHECK=!1,SAVECHART="false",resetChartVars(),noOfUpdateRequestInProgress=0,loadoff(),getObj("htmlvalues").innerHTML="",getObj("htmlbackup").innerHTML="",versionDetailsNo=0,resetUNDO(),IMAGEOBJECT=XPOSITION=YPOSITION=lastSavedTime=null,getObj("waitmsg").style.display="none",CLONEIMAGE=!1,isEngineSupported=!1,WIDTHHEIGHTUNDO=!1,SHEET.FREEZE.resetVariables(),isRespondedInScroll=!0,availableStartRow=0,availableEndRow=-1,lastSavedTime=null,errorMsgShown=!1,errorInLoadObject=!1,documentBakeStatus.setRenderBake(!0),isAnyOnline=!1,ruleElem=null,colorElem=null,isReadOnlyViewMode=!1,fPainter.fPaintersingleclick=!1,fPainter.fPainterdoubleclick=!1,updatedSaveTime="",isCollabJoined=!1}function resetRTCvariables(){if(ENABLERTC){{getObj("sharedUserStatus")}getObj("chatLogs").innerHTML="",COLLABORATIVE_EDITING="OFF",RTCSHEETNAME=C_STARTROW=C_ENDROW=C_STARTCOL=C_ENDCOL=SHAREDUSERS=LISTOFCOLLABIDS="",SAVEDOC=RTC_EXISTS="false",ISSAMESHEET="true",SHAREDUSERSLIST=[],isCollabJoined=!1}}function resetChartVars(){HTMLCHARTINFO=[];for(var e in ExcelGraph._INSTANCES){var t=getObj(e);ExcelGraph.removeInstance(e),null!=t&&(t=null)}var s=getObj("chartLoadingDIV");"undefined"!=typeof s&&null!=s&&(s.innerHTML=""),availChartRange={}}function loadDocument(e){e==DOCUMENT_ID&&(e=RESOURCE_ID),document.location.href=ctxpath+"open/"+e}function collabopen(e,t,s,n,r,i){"false"==documentOpened&&e==COLLAB_DOCUMENT_ID&&openDoc1(e,t,s,n,r,i)}function deferLoadFiles(){isArray(scriptsToDownload)?scriptsToDownload.forEach(function(e){lazyLoad.JS(e)}):lazyLoad.JS(scriptsToDownload),isArray(stylesToDownload)?stylesToDownload.forEach(function(e){lazyLoad.CSS(e)}):lazyLoad.CSS(stylesToDownload),stylesToDownload=[],scriptsToDownload=[]}function loadDocumentObject(e,t,s,n,r,i,o,a){var l=new RequestParameters(ActionConstants.LOAD_BOOK),E=$("#mainOuterDiv");E&&mask.toolbar(!0,E);var d=!0;isPublished&&(d=!1);var u=getViewType();null===noExportV&&(noExportV=!1),null!=GDRIVEVIEW&&(isGDriveView=!0);var c={noprint:noPrintV,noexport:noExportV,hasWritePermission:HASWRITEPERMISSION,isCoOwner:ISCOOWNER,RemoteMode:REMOTEMODE,isDocShareRW:ISDOCSHARERW,isSheetBasedShare:ISSHEETBASEDSHARE,isDocOwner:ISDOCOWNER,isgdriveView:isGDriveView,isCDView:ISCDVIEW,viewType:u,allowToLoadMenutab:d,isLoggedIn:isLoggedIn,pushFormat:pushFormat,allowToComment:ALLOW_TO_COMMENT},h=JSON.stringify(c);l.setParameters(DOCUMENT_REQUESTED_TIME,h),isNaN(e)||initServerCompLoadingActivities();var S=new AjaxRequest;S.init("POST",l.getURL(),!0,l.getParametersAsString()),S.addEventListener("onComplete",function(e){{var t=parseJSON(e.responseText);t.viewtype}if(t.a&&t.a==ActionConstants.SHOW_ERROR_MESSAGE)return void ErrorMsg.show(t);accLocale=t.workbook.accLocale;var s=t;return user.permissions=JSON.parse(t.permissions),HIDE_PUBLISH_OPTION=user.permissions.publish?!1:!0,deferLoadFiles(),userThousandSeparator=s.workbook.thousandSeparator,appEvent.trigger("documentLoad",[t]),e.status>=300?void errorAlert(e.status,e.statusText):(updateLoadObjectResponse(e.responseText,i,a),void((d||jsVERSION_VIEW)&&preprocessor.loadMenutab(t)))}),S.sendRequest()}function loadAfterLoadFiles(){if($("<div>").attr("id","HTMLTemplates").appendTo(document.body).load(ctxpath+"pages/afterload.jsp",function(){if(contextMenu.initContextMenu(),toolbarinited||($.ZToolbarHandler.init(["#toolbarContainer","#popupmenu","#versionview","#contextpopupmenus"]),toolbarinited=!1),!isPreview){var e={zmenu:"#rmenu, #sheettabrmenu, #filemenu"};$.ui.utils.initDeferredComponents(e,10)}appEvent.trigger("UI.Initialization.Done")}),-1===zuid&&!localStorage.getItem("isSignupPopupBlocked")&&(REMOTE.MODE===REMOTE.SCRATCHVIEW||REMOTE.MODE===REMOTE.EXCELVIEW)){var e=3e4;signupTriggerTimer=setTimeout(function(){showSignupWidget(),localStorage.setItem("isSignupPopupBlocked",!0)},e)}}function updateLoadObjectResponse(e,t){var s=JSON.parse(e),n=(s.docRequestedTime,s.DOCUMENT_ID);if(s.workbook&&(workbooksheets=s.workbook),!errorMsgShown)if(s.ERROR!=showErrorPanelMsg){documentBakeStatus.setObjectBake(!0);var r=JSON.parse(s.SHEETNAMES),o=r[0],a=r[1];if(WorkSheets.updateSheetNamesList(r),WorkSheets.updateAscActiveSheetName(),$("#sheetsTabContainer").length)for(i=0;i<o.length;i++){var l=o[i],E=SHEETNAMES_MAP[l],d=getObj(E);d&&d.setAttribute("id","sheetdiv-"+a[i])}documentBakeStatus.isBaked()&&postDocumentLoader(),docMetaDetails={},serverCompLoadedActivities(),tempPublicDocId=s.tempPublicDocId,isUndefined(tempPublicDocId)?(tempPublicDocId="",isInOOMode=!1):isInOOMode=!0,n==DOCUMENT_ID&&documentBakeStatus.isBaked()&&!t,t&&(editPublicDoc(!0,!0),stopLoadSheetObject())}else{message("","none"),errorMsgShown=!0;var u=getObj("waitmsg");if(u.style.display="none",isDocumentLoading=!1,jsPUBLIC_VIEW||jsGUEST_VIEW)handleServerError("ERROR",showErrorPanelMsg,!0);else if(errorInLoadObject=!0,-1!=s.MESSAGE.indexOf("Document.Parse.Error")){parseError=!0;var c=s.VIEW;DOCUMENT_ID=n,CURR_DOC_OWNERNAME=s.DOC_AUTHOR_NAME;var h=s.LAST_MODIFIED_TIME;h=isNaN(h)?null:parseInt(h);var S=s.HASVERSION;DOCUMENT_NAME=s.DOCUMENT_NAME,null!=$("#fileName")&&$("#fileName").text(DOCUMENT_NAME);var g="<a href='mailto:"+jsMsg.SupportMailId+"'>"+jsMsg.SupportMailId+"</a>";if(cdview&&S&&ALLOW_TO_WRITE){var O=returnTimeElaspsedinString(s.CURRENTTIME,h),T=getI18NLastSavedMsg(O.unit,O.count);errMsg=replaceParams(jsMsg["Document.Parse.Error.LastSavedTime"],new Array("<a href='#' onclick='AuditTrail.revertVersion(0)'>","</a>",T))}else if("SHARE_VIEW"==c)errMsg=replaceParams(jsMsg["ShareView.Document.Parse.Error"],new Array("<a href='#' onclick='notifySharedUsers(false)'>","</a>",g)),jsSHARE_VIEW=!0;else if("OPEN_VIEW"==c)if(ALL_SHEET_SHARED=!0,S){var O=returnTimeElaspsedinString(s.CURRENTTIME,h),f="";-1!=O.unit.indexOf("second")?f=jsMsg["Document.Parse.Error.LastSavedTimeinSeconds"]:"minutes"==O.unit?f=jsMsg["Document.Parse.Error.LastSavedTimeinMinutes"]:"hours"==O.unit?f=jsMsg["Document.Parse.Error.LastSavedTimeinHours"]:"days"==O.unit&&(f=jsMsg["Document.Parse.Error.LastSavedTimeinDays"]),errMsg=replaceParams(f,new Array("<a href='#' onclick='AuditTrail.revertVersion(0)'>","</a>",O.count,"<a href='#' onclick='AuditTrail.showVersionHistory()'>","</a>",g))}else errMsg=replaceParams(jsMsg["Document.Parse.Error.WithoutVersion"],new Array(g));return void handleServerError("ERROR",errMsg,!0)}}}function maskSheet(){if(!documentBakeStatus.isBaked()&&!jsPUBLIC_VIEW){errorDocMenutab(),getObj("Tv").readOnly=!0;var e=getObj("Trc");null!=e&&(e.readOnly=!0);var t=getObj("cF");if(null!=t&&(t.readOnly=!0),!jsTRASH_VIEW){getObj("waitmsg")}}}function unMaskSheet(){if(documentBakeStatus.isBaked()&&REMOTE.ISEDITABLE){errorMsgShown||errorDocMenutab("enable"),getObj("Tv").readOnly=!1;var e=getObj("Trc");null!=e&&(e.readOnly=!1);var t=getObj("cF");null!=t&&(t.readOnly=!1),message("","none"),toggleUNDO(),toggleREDO()}else(jsREMOTE_VIEW||jsPUBLIC_VIEW||jsVERSION_VIEW)&&(message("","none"),errorDocMenutab("enable"))}function openDocument(e){if(errorInLoadObject)return errorInLoadObject=!1,void message("","none");message(jsMsg.Loading,"none");var t=e.responseText;if("INVALID_VERSION"==t)return void showAlertDialog(jsMsg["Version.ViewVersionConflict"]);var s=t.substring(t.indexOf("<script>dataResponse=")+21,t.length-1);dataResponse=s.substring(0,s.indexOf("</script>"));var n=t.indexOf("<script>")+8,r=t.indexOf("</script>"),i=t.substring(n,r);if("null"==i||i==VIEW_REQUESTED_TIME){BACKUPCOLLABID=COLLAB_ID,IMPORTACC="0",getObj("widgetDIV").innerHTML=getOnlyHtml(e),isEditorClosed=!1,resetglobalvariables(),"undefined"!=typeof ole&&ole.reset(),Filter.clear(),populateValues(),scrollSheetTabToView(WorkSheets.getAssociatedActiveSheetName()),updateDocTitle(DOCUMENT_NAME),isDocumentLoading=!1,DOCUMENT_LOCKED&&!ENABLERTC&&(-1!=LOCKED_USER.indexOf(".")&&(LOCKED_USER=LOCKED_USER.substring(0,LOCKED_USER.indexOf("."))),showAlertDialog(replaceParams(jsMsg.CannotModifyAlert,new Array(LOCKED_USER)))),isDocumentPublic?constructpublicurl():removePublicUrl();var o=t.indexOf("<script>filterM");if(-1!==o){var a=t.substring(o+23,t.indexOf("</script>",o+23));"null"!==a.trim()&&(filterMetaInfo=JSON.parse(a),filterMetaInfo.isCriteriaApplied?Filter.create(CURRSHEETNAME,filterMetaInfo):filterMetaInfo=void 0)}if(btn_disabled(),assignInitialValues(),initSheet(ssServer,initSSWidth,initSSHeight,initCols,initRows,initColHeadHeight,initRowHeadWidth,initColWidth,initRowHeight,tablewidth,tableheight),$.ZToolbarHandler.init(["#versionview"]),disableToolBar(READ_WRITE),"doc_id"!=DOCUMENT_ID?maskSheet():serverCompLoadedActivities(!0),initBottomBand(),getCommentCalloutPropertyValues(),message("","none"),postDocumentLoader(),jsVERSION_VIEW&&(READ_WRITE=!1),"#FFFFFF"!=BACKGROUNDCOLOR&&""!=BACKGROUNDCOLOR&&(getObj("bg_fill_div").style.backgroundColor=BACKGROUNDCOLOR),""!==FONTCOLOR&&(getObj("text_color_div").style.backgroundColor=FONTCOLOR),isExprFieldExpanded&&expandExprField(),SET_LASTEDITED_DOCID&&"doc_id"!=DOCUMENT_ID){var l=document.domain;l=l.substring(l.indexOf(".")+1,l.length),set_cookie("ZS_DID",DOCUMENT_ID,null,null,l)}}}function populateValues(){for(var e=getObj("widgethiddenDIV"),t=e.childNodes,s=new Array(t.length),n=0,r=0;r<t.length;r++){var i=t[r];"INPUT"==i.tagName&&(s[n]=i.value,n++)}var o=s[0],a=s[1],l=s[2],E=s[3],d=s[4],u=s[5],c=s[6],h=s[7],S=s[8],g=s[9],O=s[10],T=s[11],f=s[12],m=s[13],R=(s[14],s[15]),v=s[16],p=s[17],I=s[18],C=s[19],A=s[20],M=s[21],D=s[22],_=s[23],N=s[24],b=s[25],L=s[26],W=s[27],w=s[28],V=s[30],U=s[31],j=s[33],P=s[34],y=s[35],H=s[36],k=s[37],B=s[38],x=(s[39],s[40],s[41]),F=(s[42],s[43],s[44],s[45]),G=s[46],X=s[47],q=s[49],z=s[50],J=s[51],K=s[52],Y=s[54],Z=s[55],Q=s[56],et=s[57],tt=s[58],st=s[59],nt=s[60],rt=getObj("sheethiddenDIV2");if(null!=rt){var t=rt.childNodes,it=new Array(5);n=0;for(var r=0;r<t.length;r++){var i=t[r];if("INPUT"==i.tagName&&(it[n]=i.value,n++),5==n)break}var ot=it[1],at=it[2],lt=it[3],Et=it[4],dt=it[0]}if("undefined"!=m&&"null"!=m){var ut=getServerPath();publicURL=ut+ctxpath+"published.do?rid="+RESOURCE_ID}if(null!=o&&(DOCUMENT_VIEW=o,identifyView()),null!=a&&(DOCUMENT_LOCKED=!1,"true"==a&&(DOCUMENT_LOCKED=!0)),null!=l&&(LOCKED_USER=l),null!=E&&(DOCUMENT_ID=E),null!=d&&(DOCUMENT_NAME=DOC_NAME=replaceSplChrs(d)),null!=u&&(CURRSHEETNAME=u),null!=c&&(TOTALSHEETS=c),null!=S&&(window.ALLOW_TO_WRITE=!1,"true"==S&&(window.ALLOW_TO_WRITE=!0)),null!=X&&(isSheetBasedShare=!1,"true"==X&&(isSheetBasedShare=!0)),wmsCommErrorStatus="true"==q&&ALLOW_TO_WRITE?"true":"false","true"==z&&(jsEMBED_VIEW=!0),"true"==J&&(isDocContainsArrayFormula=!0),null!=h&&(READ_WRITE=!1,"true"==wmsCommErrorStatus||jsTRASH_VIEW||jsSHARE_VIEW&&isSheetBasedShare&&!ALLOW_TO_WRITE||jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE?READ_WRITE=!1:"true"==h&&(READ_WRITE=!0)),null!=g&&(isDocumentPublic=!1,"true"==g&&(isDocumentPublic=!0)),null!=T&&("doc_id"===DOCUMENT_ID||jsVERSION_VIEW?CURRENTTIME=T:"true"===Y?CURRENTTIME=T:"false"!==Y&&"null"!==Y||documentBakeStatus.isBaked()||(CURRENTTIME=T)),null!=f&&(HTMLVIEW=!1,"true"==f&&(HTMLVIEW=!0)),null!=O&&(ALL_SHEET_SHARED=!1,"true"==O&&(ALL_SHEET_SHARED=!0)),null!=C&&(window.IS_REVERT_ALLOWED=!1,"true"==C&&(window.IS_REVERT_ALLOWED=!0)),null!=R&&(CURR_DOC_OWNERNAME=R),null!=ot&&(initSSWidth=ot),null!=at&&(initSSHeight=at),null!=lt&&(initColHeadHeight=lt),null!=Et&&(initRowHeadWidth=Et),null!=dt&&(ssServer=dt),jsSHARE_VIEW&&(isVersionPending=!0),null!=v&&(isDocumentSemiPublic=!1,"true"==v&&(isDocumentSemiPublic=!0)),null!=p&&(isEdit=!1,"true"==p&&(isEdit=!0)),null!=I&&(isStockConfigured=I),null!=A&&(DO_INDEX_SEARCH="true"==A?!0:!1),browser_ie&&DOCUMENT_NAME.indexOf("'")>-1&&$("#fileName")&&$("#fileName").text(DOCUMENT_NAME),null!=M&&(DOCUMENT_NAME_URL=M),null!=D&&(CURR_THEME=D),null!=_&&(DEFAULT_THEME=_),null!=N&&(USE_COMPRESSION="true"==N?!0:!1),null!=b&&(STYLE_PATH=b),null!=L&&(BUILD_VERSION=L),null!=W&&(OOLOADED="true"==W?!0:!1),null!=w&&(CANREADWRITE="true"==w?!0:!1),null!=V&&(allowExport=!1,"true"==V&&(allowExport=!0)),null!=U&&(showFormulas=!1,"true"==U&&(showFormulas=!0)),null!=j&&(INSERT_SHEET_ALLOWED=!1,"true"==j&&(INSERT_SHEET_ALLOWED=!0)),showPublic=null!=P&&"false"==P?!1:!0,showFormulasOrg=null!=y&&"false"==y?!1:!0,allowExportOrg=null!=H&&"false"==H?!1:!0,allowExportPublic=null!=k&&"false"==k?!1:!0,displayAll=null!=B&&"true"==B?!0:!1,null!=x&&(isEngineSupported=!1,"true"==x&&(isEngineSupported=!0)),null!=F){var ct=F;"COL"==ct?isColsOnlyFreezed=!0:"ROW"==ct?isRowsOnlyFreezed=!0:"ALL"==ct&&(isColsAndRowsFreezed=!0)}null!=G&&(FILE_FORMAT=G),allowOrgEdit=null!=K&&"true"==K?!0:!1,cursor_Row_Index="null"==Y?0:parseInt(Y),cursor_Col_Index="null"==Z?0:parseInt(Z),position_Bottom="null"==Q?0:parseInt(Q),position_Left="null"==et?0:parseInt(et),null!=tt&&(currUserColor=tt),USERPRESENCE_COLORS=st.substring(1,st.length-1).split(", ");var ht="show_doc_";try{0==currSBItemNum&&(ht="show_search_doc_")}catch(e){}try{var St=getObj(ht+DOCUMENT_ID);if(""==PREV_DOCUMENT_ID)PREV_DOCUMENT_ID=DOCUMENT_ID;else if(PREV_DOCUMENT_ID!=DOCUMENT_ID){var gt=getObj(ht+PREV_DOCUMENT_ID);gt&&(gt.className=""),PREV_DOCUMENT_ID=DOCUMENT_ID}St&&(St.className="selected")}catch(e){PREV_DOCUMENT_ID=DOCUMENT_ID}ALLOW_TO_COMMENT=null!=nt&&"true"==nt?!0:!1}function generateTags(){}function identifyView(){"NEW_VIEW"==DOCUMENT_VIEW&&(jsNEW_DOC_VIEW=!0,DEFAULT_FILENAME_FLAG=!0),"OPEN_VIEW"==DOCUMENT_VIEW&&(jsOPEN_DOC_VIEW=!0),"SHARE_VIEW"==DOCUMENT_VIEW&&(jsSHARE_VIEW=!0),"TRASH_VIEW"==DOCUMENT_VIEW&&(jsTRASH_VIEW=!0),"GUEST_VIEW"==DOCUMENT_VIEW&&(jsGUEST_VIEW=!0),"PUBLIC_VIEW"==DOCUMENT_VIEW&&(jsPUBLIC_VIEW=!0),("THROWAWAY_VIEW"==DOCUMENT_VIEW||REMOTE.MODE===REMOTE.SCRATCHVIEW)&&(jsTHROWAWAY_VIEW=!0),"REMOTE_VIEW"==DOCUMENT_VIEW&&(jsREMOTE_VIEW=!0),"VERSION_VIEW"==DOCUMENT_VIEW&&(jsVERSION_VIEW=!0),"REMOTE_SAVE_VIEW"==DOCUMENT_VIEW&&(jsREMOTE_SAVE_VIEW=!0)}function constructpublicurl(){var e=getServerPath();publicURL=e+ctxpath+"published.do?rid="+RESOURCE_ID}function removePublicUrl(){}function showsheet(e,t,s,n,r){if("string"==typeof e&&(e=getObj(e)),jsVERSION_VIEW||(focusRemembering.setWorkbookData(),workbookData.switchSheet=!0),documentBakeStatus.isBaked()||(maskSheet(),initServerCompLoadingActivities(!0)),appEvent.trigger("book.onbeforesheetswitch",[CURRSHEETNAME]),isSheetLoading=!0,!jsSHARE_VIEW||null!=e){var i=CURRSHEETNAME,o=e?e.getAttribute("sheetname"):"",a=WorkSheets.getSheetObjByName(CURRSHEETNAME),l=WorkSheets.getSheetObjByName(o);a&&(o!==CURRSHEETNAME?($($(a).children()).css("cursor","pointer"),$($(l).children()).css("cursor","default")):$($(l).children()).css("cursor","default"));if((i!=o||void 0!=r)&&(hasOleMoved||resetChartVars(),SHEET.FREEZE.resetVariables()),sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BACKGROUND"}),CURRSHEETNAME=o,sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BORDER"}),WorkSheets.updateAscActiveSheetName(),i!=CURRSHEETNAME||void 0!=r){scrollSheetTabToView(WorkSheets.getAssociatedActiveSheetName()),"undefined"==typeof n&&message(jsMsg.Loading,"block","...");var E=getObj("html-"+CURRSHEETNAME);null!=E&&null!=DOCUMENT_ID&&"doc_id"!=DOCUMENT_ID&&"OFF"==COLLABORATIVE_EDITING&&""==COLLAB_ID?(isSSActive=!0,sheetHTML=replaceHTML(E.value),getObj("sheetdiv").innerHTML=sheetHTML,HTMLVIEW=!0,sheetDefault()):jsREMOTE_SAVE_VIEW||jsPUBLIC_VIEW&&!showFormulas?(HTMLVIEW=!1,sheetopen(t)):sheetopen(t)}}}function sheetopen(e,t){isFilterOptionsDIVOpened&&Filter.hideFilterOptions();var s=WorkSheets.getSheetObjByName(CURRSHEETNAME);s&&$($(s).children()).css("cursor","default");var n,r,i,o=new RequestParameters(ActionConstants.LOAD_SHEET);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,getViewType(),getSheetHeight(),getSheetWidth(),r,i,n);var a=new AjaxRequest;a.init("POST",o.getURL(),!0,o.getParametersAsString()),a.sendRequest(),a.addEventListener("onComplete",function(s){openSheet(s,e),t&&insertImage.loadSheetImages()})}function versionSheetopen(e){if(e&&e!=CURRSHEETNAME){appEvent.trigger("book.onbeforesheetswitch",[CURRSHEETNAME]),jsVERSION_VIEW||(focusRemembering.setWorkbookData(),workbookData.switchSheet=!0),sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BACKGROUND"}),CURRSHEETNAME=e,WorkSheets.updateAscActiveSheetName(),sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BORDER"}),message(jsMsg.Loading,"block","..."),SHEET.FREEZE.resetVariables();var t=jsVERSION_VIEW&&""==DOCUMENT_VERSION?!0:void 0,s=new RequestParameters(ActionConstants.LOAD_SHEET);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),null,getViewType(),getSheetHeight(),getSheetWidth(),null,null,null,t);var n=new AjaxRequest;n.init("POST",s.getURL(),!0,s.getParametersAsString()),n.addEventListener("onComplete",function(e){openVersionSheet(e)}),n.sendRequest()}}function openVersionSheet(e,t){openSheet(e,t),AuditTrail.showViewPortVersionChanges()}function openSheet(e){(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&chartOnLoad.removeSheetCharts(WorkSheets.getAssociatedActiveSheetName()),focusRemembering.localFromGoto=Goto.isPreventDefault(),Filter.hasFilter=!1,Filter.clear();var t=getObj("tfr");t&&(t.innerHTML="");var s=e.responseText;if(sheetHTML=getOnlyHtml(s),sheetHTML==showErrorPanelMsg)return handleServerError("ERROR",sheetHTML,!0),void message("","none");var n=s.substring(s.indexOf("<script>dataResponse=")+21,s.length-1);dataResponse=n.substring(0,n.indexOf("</script>"));var r=s.indexOf("<script>filterM");if(-1!==r){var i=s.substring(r+23,s.indexOf("</script>",r+23));"null"!==i.trim()&&(filterMetaInfo=JSON.parse(i),filterMetaInfo.isCriteriaApplied?Filter.create(CURRSHEETNAME,filterMetaInfo):filterMetaInfo=void 0)}var o=sheetHTML.indexOf("<!--"),a=sheetHTML.indexOf("-->"),l="",E="";if(-1==sheetHTML.indexOf('<!-- [{"REPORT_ID":')&&-1!=o&&-1!=a){var n=sheetHTML.substring(o+4,a),d=JSON.parse(n),u=d[0];if(l=u.DOCUMENT_ID,E=u.SHEETNAME,l==DOCUMENT_ID&&E==CURRSHEETNAME){isSSActive=!0;var c=getObj("sheetdiv");if(browser_nn6){var h=c.offsetHeight;c.style.height=h+"px",c.style.overflow="hidden"}c.innerHTML=sheetHTML,sheetDefault(),browser_nn6&&(c.style.height="",c.style.overflow="")}}appEvent.trigger("book.onaftersheetswitch",[CURRSHEETNAME]),cursorchange()}function setSheetDivDefaultHeight(){if(browser_ie)var e=document.body.clientHeight;else if(browser_nn4||browser_nn6)var e=window.innerHeight;var t=e-findPosY(getObj("sheetdiv"))-getObj("bottomBand").offsetHeight,s=document.createElement("div");s.innerHTML="&nbsp;",s.style.height=t+"px";var n=getObj("sheetdiv");n.appendChild(s)}function insertSheet(e,t,s){if(!isServerComponentLoaded(!0))return!1;if(!(isErrorDoc||GoalSeek.dialog||Solver.dialog)&&documentBakeStatus.isBaked()){"undefined"==typeof s&&(s="false");var n="false";if("undefined"==typeof e){n="false",sheetdialog.close();var r=currSheetOnRightClick;""==r&&(r=CURRSHEETNAME)}else if("undefined"==typeof t){n="true";for(var i=getObj("sheetsTab").getElementsByTagName("TD"),o=0;o<i.length-1;o++)if("TD"==i[o].tagName){var r=i[o].getAttribute("sheetname");break}}else n=e,r=t;var a=document.createElement("TD");if(a.setAttribute("context","sheettabrmenu"),("undefined"==typeof t||t==CURRSHEETNAME)&&"false"==s){var l=WorkSheets.getSheetObjByName(CURRSHEETNAME);l.removeClass("selected")}if(a.onmousedown=function(e){return reorderSheet(e,this)},r=WorkSheets.getSheetCodeFromName(r),void 0!=r){var E=new RequestParameters(ActionConstants.SHEET_INSERT);E.setParameters(r,n,!1);var d=new AjaxRequest;d.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(d),IS_UNSAVED_SHEET=!0}}}function deleteSheet(e,t){if(documentBakeStatus.isBaked()){"undefined"==typeof t&&(t="false");if("undefined"==typeof e)var s=currSheetOnRightClick;else s=e;if(1==ProtectedRanges.getObject().hasProtectedSheet(s))return void alert(jsMsg["ProtectedSheet.alert.DeleteSheet"]);{var n=getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(s));n.parentNode}if(sheetdialog.close(),WorkSheets._sheetNamesMetaList[0].length<=1)return void(jsSHARE_VIEW&&"true"==t?loadDocument("ajaxnew.do"):showAlertDialog(jsMsg.documentMustContainAtleastOneSheet));var r=WorkSheets.getSheetCodeFromName(currSheetOnRightClick);if("undefined"==typeof e){if(FormObj.instances[r]){if(CURR_DOC_OWNERNAME===LOGINNAME){var i={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){deleteSheet(s),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};return sheetdialog.showConfirmDialog(replaceParams(jsMsg["Form.DeleteMessage.WhileDeletingSheet"],new Array('"'+s+'"')),i),!1}return void showAlertDialog(jsMsg["Form.DeleteMessage.SharedUser.WhileDeletingSheet"])}var i={buttons:[{text:jsMsg["Actions.Delete"],class:"ui-zbutton-primary",click:function(){deleteSheet(s),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]},o=Discussion.hasComments(s),a=replaceParams(jsMsg["SheetTab.DeleteSheet.Warning"],new Array('"'+s+'"'));return o&&(a=replaceParams(jsMsg["Discussion.DeleteSheetWithComment"],new Array('"'+s+'"',o+""))),sheetdialog.showConfirmDialog(a,i),!1}if(s=WorkSheets.getSheetCodeFromName(s),void 0!==s){documentBakeStatus.setRenderBake(!1);var l=new RequestParameters(ActionConstants.SHEET_REMOVE),E=void 0===WebForm.formRid?void 0:encodeURIComponent(WebForm.formRid);l.setParameters(s,E);var d=new AjaxRequest;d.init("POST",l.getURL(),!0,l.getParametersAsString()),actionManager.addRequest(d),ClipObject.checkIsServerClipSourceSheet(currSheetOnRightClick)}}}function showSheetRenameDialog(){if(isErrorDoc||!isServerComponentLoaded(!0)||!ALLOW_TO_WRITE&&REMOTE.MODE!==REMOTE.EXCELVIEW&&REMOTE.MODE!==REMOTE.SCRATCHVIEW)return!1;if(featurePermission.getPermission("hidesheetTabMenu"))return!1;var e=currSheetOnRightClick;if(1==ProtectedRanges.getObject().hasProtectedSheet(e))return void alert(jsMsg["ProtectedSheet.alert.RenameSheet"]);var t="<div class='divSpacing'>"+jsMsg.EnterSheetName+" :</div> <div><input type='text' id='newShName' value='"+e+"' maxlength='31' onkeydown='submitFuction(event,renameSheet);' style='width:250px' ></div>",s={width:300,modal:!0,title:jsMsg.Rename,buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){renameSheet()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};sheetdialog.open(t,s),setTimeout(function(){$("#newShName").focus(),$("#newShName").select()},400)}function renameSheet(e,t,s){if("undefined"==typeof s&&(s="false"),"undefined"==typeof e)var n=currSheetOnRightClick,r=(getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(n)),n),i=$("#newShName").val();else var n=e,r=n,i=t;if(r==i)return void sheetdialog.close();if(!i||0===i.trim().length)return void showAlertDialog(jsMsg["Rename.SheetNameCannotBeEmpty"]);if(i=i.trim(),WorkSheets.isNameExists(i,!0))return void showAlertDialog(jsMsg["Error.Sheet.Name.Exists"]);if(checkSheetName(i))return void showAlertDialog(jsMsg.SheetNameShouldContain);var o=new RequestParameters(ActionConstants.SHEET_RENAME);o.setParameters(r,i,WorkSheets.getSheetCodeFromName(CURRSHEETNAME));var a=new AjaxRequest;a.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(a),sheetdialog.close(),ClipObject.checkIsServerClipSourceSheet(CURRSHEETNAME)}function checkSheetName(e,t){if("Cell Reference"==t){var s=new RegExp("^[a-zA-Z0-9_\\u00A1-\\uFFFF!:]+$");return!s.test(e)}if("Define Name"==t){var s=new RegExp("^[a-zA-Z0-9_\\u00A1-\\uFFFF]+$");return!s.test(e)}var s=new RegExp("^[a-zA-Z0-9_ \\u00A1-\\uFFFF\\-]+$");return!s.test(e)}function reorderSheet(e,t){if(isSheetsTabDblClicked)return isSheetsTabDblClicked=!1,currSheetOnRightClick=t.getAttribute("sheetname"),void showSheetRenameDialog();isSheetsTabDblClicked=!0,setTimeout(function(){isSheetsTabDblClicked=!1},350);var s=Chart.container[WorkSheets.getAssociatedActiveSheetName()];if(s)for(var n in s)for(var r in s[n])"function"!=typeof s&&"string"==typeof s[n][r]&&"function"!==s[n]&&$("#"+s[n].id).css("z-index")>103&&$("#"+s[n].id).css("z-index",BASEZINDEX+103);if((!isErrorDoc||allowSheetSwitch)&&2!=e.button){if(isSheetPre)return!1;if(isSheetPre=!0,1==sheetOnMove)endReorderSheet();else{sheetOnMove=!0,currSheetOnMove=t;for(var i=getObj("sheetsTab").getElementsByTagName("TD"),r=0;r<i.length-1;r++)if(i[r]==currSheetOnMove){currSheetOnMoveIdx=r;break}var o=currSheetOnMove.getAttribute("sheetname"),a=WorkSheets.getSheetObjByName(o);a&&$($(a).children()).css("cursor","move"),movingSheet=document.createElement("div"),movingSheet.className="sheetsTab",movingSheet.style.position="absolute",RTLlang?browser_ie||browser_ff3?(movingSheet.style.right=getOffsetRight(t)-getSheetTabScroll()+1+"px",movingSheet.style.top=findPosY(t)+"px"):(movingSheet.style.right=getOffsetRight(t)-getSheetTabScroll()+"px",movingSheet.style.top=findPosY(t)-1+"px"):browser_ie||browser_ff3?(movingSheet.style.left=findPosX(t)-getSheetTabScroll()+1+"px",movingSheet.style.top=findPosY(t)+"px"):(movingSheet.style.left=findPosX(t)-getSheetTabScroll()+"px",movingSheet.style.top=findPosY(t)-1+"px");var l=UTIL.DOM.getOuterHTML(t);movingSheet.innerHTML="<table cellpadding='0' cellspacing='0'><tr>"+l+"</tr></table>",document.body.appendChild(movingSheet),currSheetOnMove.style.visibility="hidden",sheetTransPosCnt=0,sheetTransX=null,"undefined"!=typeof sheetTransIntvl&&window.clearInterval(sheetTransIntvl),movingSheetDiffX=RTLlang?clientDim.width-e.pageX-parseInt(movingSheet.style.right):e.pageX-parseInt(movingSheet.style.left),window.addEventListener("mousemove",doReorderSheet,!1),window.addEventListener("mouseup",endReorderSheet,!1),ole.getCurrObj()&&$("#"+ole.getCurrObj().id).css("z-index",BASEZINDEX+101)}}}function doReorderSheet(e){if(isServerComponentLoaded()){if(INSERT_SHEET_ALLOWED)return!1;if(clearTextSelection(),browser_ie)var t=RTLlang?clientDim.width-window.event.clientX-movingSheetDiffX+document.body.scrollLeft:window.event.clientX-movingSheetDiffX+document.body.scrollLeft;else if(browser_nn6)var t=RTLlang?clientDim.width-e.pageX-movingSheetDiffX:e.pageX-movingSheetDiffX;var s=getObj("sheetsTab"),n=($("#sheetsTabNavBar"),RTLlang?getOffsetRight(s):findPosX(s)),r=s.offsetWidth-currSheetOnMove.offsetWidth;if(n>t?scrollSheets("left"):t>r?scrollSheets("right"):(scrollSheetMouseUp("left"),scrollSheetMouseUp("right")),t<n+s.offsetWidth){movingSheet.style[RTLlang?"right":"left"]=t+"px";for(var i=(t+movingSheet.offsetWidth/2,t+movingSheet.offsetWidth),o=s.getElementsByTagName("TD"),a=0;a<o.length-1;a++){var l=o[a],E=RTLlang?getOffsetRight(l)-getSheetTabScroll():findPosX(l)-getSheetTabScroll(),d=E,u=E+l.offsetWidth/2,c=E+l.offsetWidth;if(t+getSheetTabScroll()<(RTLlang?getOffsetRight(currSheetOnMove):findPosX(currSheetOnMove))){if(t>=d&&u>=t){l.parentNode.insertBefore(currSheetOnMove,l);break}}else if(i>=u&&c>=i){l.parentNode.insertBefore(currSheetOnMove,o[a+1]);break}}}}}function endReorderSheet(){for(var e=getObj("sheetsTab").getElementsByTagName("TD"),t=0;t<e.length-1;t++)if(e[t]==currSheetOnMove){var s=t;break}var n="false";"undefined"!=typeof s&&currSheetOnMoveIdx!=s&&updateSheetOrder(currSheetOnMove.getAttribute("sheetname"),s,n),sheetOnMove=!1,sheetTransX=[],RTLlang?sheetTransPath(parseInt(movingSheet.style.right)+getSheetTabScroll(),getOffsetRight(currSheetOnMove),-1*getSheetTabScroll()):sheetTransPath(parseInt(movingSheet.style.left)+getSheetTabScroll(),findPosX(currSheetOnMove),-1*getSheetTabScroll()),sheetTransPitStops=sheetTransX.length>10?(sheetTransX.length-1)/10:1,sheetTransPosCnt=0,sheetTransIntvl=window.setInterval(function(){placeReorderedSheet()},1),window.removeEventListener("mousemove",doReorderSheet,!1),window.removeEventListener("mouseup",endReorderSheet,!1),scrollSheetMouseUp("left"),scrollSheetMouseUp("right")}function sheetTransPath(e,t,s){for(var n,r=Math.sqrt((t-e)*(t-e)),i=(t-e)/r,o=0;r>o;o++)n=e+i,sheetTransX[o]=n+s,e=n;return sheetTransX}function placeReorderedSheet(){null!=sheetTransX&&(sheetTransPosCnt<sheetTransX.length-1?(movingSheet.style[RTLlang?"right":"left"]=sheetTransX[sheetTransPosCnt]+"px",sheetTransPosCnt+=Math.round(sheetTransPitStops)):(sheetTransPosCnt=0,sheetTransX=null,window.clearInterval(sheetTransIntvl),document.body.removeChild(movingSheet),movingSheet="",isSheetPre=!1,currSheetOnMove.style.visibility="",jsREMOTE_SAVE_VIEW&&CURRSHEETNAME!=currSheetOnMove.getAttribute("sheetname")&&message(jsMsg.Loading,"block","..."),showsheet(currSheetOnMove,"open"),currSheetOnMove=""))}function updateSheetOrder(e,t){if(e=WorkSheets.getSheetCodeFromName(e),void 0!=e){var s=new RequestParameters(ActionConstants.SHEET_MOVE);s.setParameters(e,t);var n=new AjaxRequest;n.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(n)}}function scrollSheets(e){var t=getObj("sheetsTab");"first"==e?$(t).animate({scrollLeft:0},600,"easeInOutCubic",function(){toggleSheetsTabNavButtons()}):"left"==e?(t.scrollLeft-=5,scrollSheetMouseUp(e),sheetsSLIntvl=window.setInterval(function(){t.scrollLeft-=5},1)):"right"==e?(t.scrollLeft+=5,scrollSheetMouseUp(e),sheetsSRIntvl=window.setInterval(function(){t.scrollLeft+=5},1)):$(t).animate({scrollLeft:t.scrollWidth-t.offsetWidth},600,"easeInOutCubic",function(){toggleSheetsTabNavButtons()})}function scrollSheetMouseUp(e){window.clearInterval("right"==e?sheetsSRIntvl:sheetsSLIntvl),toggleSheetsTabNavButtons()}function scrollSheetTabToView(e){if(!jsGADGET_VIEW){var t=getObj("sheetsTab"),s=t.offsetWidth,n=getObj("sheetdiv-"+e),r=n.offsetLeft,i=n.offsetWidth;if(r-t.scrollLeft<0)t.scrollLeft=s>r?0:r,toggleSheetsTabNavButtons();else if(r+i-t.scrollLeft>s){var o=r+i-s;t.scrollLeft=r>=t.scrollWidth-s?t.scrollWidth:o,toggleSheetsTabNavButtons()}}}function showSheetsPickList(){if(!(isErrorDoc||GoalSeek&&GoalSeek.dialog||Solver&&Solver.dialog||AuditTrail&&AuditTrail.isActionDetailOpen)){for(var e=[],t=CellUtils.getRequiredSheetNames().sheetNames,s=0;s<t.length;s++){var n=t[s],r="sheetdiv-"+WorkSheets.getSheetCodeFromName(n),i=jsVERSION_VIEW?"versionSheetopen":"showsheet",o=jsVERSION_VIEW?n:r+",open";e.push(n==CURRSHEETNAME?{data:"{label:'"+n+"', icon:'ui-individual-icon ui-icon-ztick', appData:{dynamic:true, callback: '"+i+"', arg:'"+o+"'} }"}:{data:"{label:'"+n+"', appData:{dynamic:true, callback: '"+i+"', arg:'"+o+"'} }"})}var a={target:$("#sheetsMenu"),clearcache:!0};sheetMenu.showMenu("sheetlistMenu",e,a);var l=$("#sheetlistMenu"),E=$("#sheetsMenu").offset().top,d=clientDim.height-E,u=$("#sheetlistMenu").height();u>E&&(u=E-10);{l.width()}if(l.css({top:"auto",bottom:d+"px",height:u+"px"}),jsVERSION_VIEW){var c=l.children().children(".ui-zmenu-text");Object.keys(AuditTrail.sheetCallOuts).forEach(function(e){c.each(function(t){if(e==$(c[t]).text()){var s=AuditTrail.sheetCallOuts[e]>1?jsMsg.edits:jsMsg.edit,n=replaceParams(jsMsg["AT.sheetTabCallOutMsg"],new Array(AuditTrail.sheetCallOuts[e],s)),r=$("<span/>",{title:n,class:"versionSheetCallOut"}).text(AuditTrail.sheetCallOuts[e]);r.appendTo($(c[t])),l.children().width("auto"),l.css("width","auto")}})})}}}function toggleSheetsTabNavBar(){var e=getObj("sheetsTab"),t=e.getElementsByTagName("TABLE")[0];t.offsetWidth<e.offsetWidth?(getObj("sheetsTabNavBar").style.visibility="hidden",e.scrollLeft=0):isEditorClosed||(getObj("sheetsTabNavBar").style.visibility="visible"),toggleSheetsTabNavButtons()}function toggleSheetsTabNavButtons(){var e=getObj("sheetsTab"),t=getObj("sheetsTabNavFirst"),s=getObj("sheetsTabNavPrev"),n=getObj("sheetsTabNavNext"),r=getObj("sheetsTabNavLast"),i=t.className,o=s.className,a=n.className,l=r.className;0==e.scrollLeft?(t.className+=" disabled",s.className+=" disabled",n.className=a.indexOf(" ")>-1?a.substring(0,a.indexOf(" ")):a,r.className=l.indexOf(" ")>-1?l.substring(0,l.indexOf(" ")):l):e.scrollLeft==e.scrollWidth-e.offsetWidth?(t.className=i.indexOf(" ")>-1?i.substring(0,i.indexOf(" ")):i,s.className=o.indexOf(" ")>-1?o.substring(0,o.indexOf(" ")):o,n.className+=" disabled",r.className+=" disabled"):(t.className=i.indexOf(" ")>-1?i.substring(0,i.indexOf(" ")):i,s.className=o.indexOf(" ")>-1?o.substring(0,o.indexOf(" ")):o,n.className=a.indexOf(" ")>-1?a.substring(0,a.indexOf(" ")):a,r.className=l.indexOf(" ")>-1?l.substring(0,l.indexOf(" ")):l)}function setSheetsTabDim(){var e=getObj("sheetsTab");if(null!=e){if(e.style.width=e.parentNode.offsetWidth+"px",toggleSheetsTabNavBar(),browser_ie){var t=getObj("sheetdiv-"+WorkSheets.getAssociatedActiveSheetName());null!=t&&(t.getElementsByTagName("DIV")[0].className="tabItem selected")}e=null}}function resetSheetsTabDim(){var e=getObj("sheetsTab");null!=e&&(e.style.width="1px",setSheetsTabDim(),e=null)}function getViewType(){var e="NEW_VIEW";return jsVERSION_VIEW?e="VERSION_VIEW":jsNEW_DOC_VIEW?e="NEW_VIEW":jsOPEN_DOC_VIEW?e="OPEN_VIEW":jsTHROWAWAY_VIEW?e="THROWAWAY_VIEW":jsPUBLIC_VIEW?e="PUBLIC_VIEW":jsGUEST_VIEW?e="GUEST_VIEW":jsSHARE_VIEW?e="SHARE_VIEW":jsTRASH_VIEW?e="TRASH_VIEW":jsREMOTE_SAVE_VIEW?e="REMOTE_SAVE_VIEW":jsREMOTE_VIEW&&(e="REMOTE_VIEW"),e}function assignInitialValues(){var e=getObj("sheethiddenDIV2");if(null!=e){var t=e.childNodes,s=new Array(t.length),n=0;try{for(var r=0;r<t.length;r++){var i=t[r];"INPUT"==i.tagName&&(s[n]=i.value,n++)}}catch(e){}var o=s[6],a=s[5],l=s[7],E=s[8],d=s[9],u=s[10],c=s[11],h=s[12],S=s[13],g=s[14],O=s[15],T=s[16],f=s[17],m=s[18],R=s[19],v=s[20],p=s[21],I=s[22],C=s[23],A=s[24];null!=o&&(initCols=parseInt(o)),null!=a&&(initRows=parseInt(a)),null!=l&&(initColWidth=parseInt(l)),null!=E&&(initRowHeight=parseInt(E)),null!=d&&(defCellStyleStr=d,defCellStyle=defCellStyleStr.split("-")),null!=u&&(defCellFormat=u),null!=c&&(defCellHolderProp=c),null!=h&&(tablewidth=h),null!=S&&(tableheight=S),null!=g&&(usedCursCol=parseInt(g)),null!=O&&(usedCursRow=parseInt(O)),null!=T&&(wholeValAsStringInArrFormt=T),null!=f&&(rowDetailStr=f),null!=m&&(colDetailStr=m),null!=R&&(colMergeDetailStr=R),null!=v&&(isSheetFreezed="true"==v||1==v?!0:!1,isSheetFreezed&&(fromOpenFreeze=!0)),null!=p&&(persistedFreezedRow=parseInt(p)),null!=I&&(persistedFreezedCol=parseInt(I)),C=JSON.parse(C),null!==C&&(READ_WRITE=!!C),A=JSON.parse(A),!ALLOW_TO_WRITE&&ALLOW_TO_COMMENT&&READ_WRITE&&(READ_WRITE=!1)}}function disableToolBar(e){jsPUBLIC_VIEW||jsGADGET_VIEW||e&&!documentBakeStatus.isBaked()||(e?(e&&!jsPUBLIC_VIEW&&null!=getObj("addSheetBtn")&&(getObj("addSheetBtn").style.visibility="visible"),getObj("readymsg").style.display="none",getObj("Tv").readOnly=!1,getObj("Trc").readOnly=!1):(!OOLOADED&&CANREADWRITE&&(null!=getObj("addSheetBtn")&&(getObj("addSheetBtn").style.visibility="hidden"),ENTEREDPERFCHECK=!0),getObj("Tv").readOnly=!0,getObj("Trc").readOnly=!0))}function removeSheets(e){var t=getObj("html-"+e),s=getObj("save-"+e);if(null!=t&&"null"!=t){var n=t.parentNode;n.removeChild(t)}if(null!=s&&"null"!=s){var n=s.parentNode;n.removeChild(s)}ProtectedRanges.getObject().onSheetDelete(e)}function renameSheets(e,t){var s=getObj("html-"+e),n=getObj("save-"+e);"object"==typeof s&&null!=s&&(s.id="html-"+t,s.name="html-"+t),"object"==typeof n&&null!=n&&(n.id="save-"+t,n.name="save-"+t);for(var r=1;r<=ExcelGraph._INSCOUNT;r++){var i=ExcelGraph.getInstance("ExcelGraph"+r);i&&e==i.CP_DOCUMENTSHEET_NAME&&(i.CP_DOCUMENTSHEET_NAME=t)}Filter.renameFilterInstance(e,t)}function getisSheetWritable(){return IPHONE_VIEW||jsVERSION_VIEW||jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE?void(READ_WRITE=!1):void(jsREMOTE_SAVE_VIEW&&(READ_WRITE=ISGEEDITOR&&!ALLOW_TO_WRITE?!1:!0))}function duplicatesheet(e,t,s,n,r,i){if(documentBakeStatus.isBaked()){var o=!0;"undefined"==typeof e&&(e=$("#sheetSelect").zcombo("getValue")),"undefined"==typeof n&&(n=currSheetOnRightClick),"undefined"==typeof s&&(s=getObj("newsheetname").value.trim(),null===s||""===s?(showAlertDialog(jsMsg["Rename.SheetNameCannotBeEmpty"]),o=!1):checkSheetName(s)?(showAlertDialog(jsMsg.AllowedSheetName),o=!1):s.length>31&&(showAlertDialog(jsMsg["Error.Sheet.Name.Length.Exceed"]),o=!1));var a=WorkSheets.isNameExists(s);if(a&&(showAlertDialog(jsMsg["Error.Sheet.Name.Exists"]),o=!1,getObj("newsheetname").focus()),o){if("AfterCurrentSheet"==e||"BeforeCurrentSheet"==e||"At First"==e||"At End"==e?(i=e,e=currSheetOnRightClick):i="After",n=WorkSheets.getSheetCodeFromName(n),void 0==n)return;documentBakeStatus.setRenderBake(!1);var l=$("#copyLocks").is(":checked"),E=new RequestParameters(ActionConstants.SHEET_COPY);E.setParameters(s,n,i,e,l);var d=new AjaxRequest;d.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(d),sheetdialog.close()}else getObj("newsheetname").focus()}}function sheetmovement(e,t,s){if("undefined"==typeof e)currentsheetname=getObj("onclicksheetname").value,n=$("#SelectedSheet").zcombo("getValue"),s=!1;else{currentsheetname=e;var n=""}var r=getObj("sheetsTab").getElementsByTagName("TD");if("undefined"==typeof t)if("-"==n){showAlertDialog(jsMsg.MoveProperLocation);var i="no";document.getElementById("SelectedSheet").focus()}else if("MoveStart"==n)t=0;else if("MoveEnd"==n)t=r.length-2;else for(var o=0;o<r.length-1;o++){var a=r[o].getAttribute("sheetname");a==n&&(t=o)}if("no"!=i){sheetdialog.close(),updateSheetOrder(currentsheetname,t,s),nextsheetname=r[t+1].getAttribute("sheetname");var l=document.getElementById("sheetdiv-"+WorkSheets.getSheetCodeFromName(currentsheetname));if("MoveEnd"==n||t==r.length-1)var E=document.getElementById("dummySheetTab");else if(null!=nextsheetname)var E=document.getElementById("sheetdiv-"+WorkSheets.getSheetCodeFromName(nextsheetname));l.parentNode.insertBefore(l,E)}}function closeDocumentInstance(e,t){if(!e||SAVED&&MACROSAVED&&!RECORDINGMACRO||!ALLOW_TO_WRITE){var s="curtime="+CURRENTTIME;jsPUBLIC_VIEW&&isInOOMode&&(s+="&tempPublicDocId="+tempPublicDocId),t&&""!=COLLAB_ID&&"null"!=COLLAB_ID&&(s+="&collabId="+COLLAB_ID,s+="&uname="+(jsREMOTE_SAVE_VIEW?RMUSER:zuid)),s+="&viewType="+getViewType()+"&docowner="+CURR_DOC_OWNERNAME+"&docId="+DOCUMENT_ID;var n=new RequestParameters(ActionConstants.CLOSE_DOCUMENT),r=isHighlightInvalidData;n.setParameters(r);var i=new AjaxRequest;i.init("POST",n.getURL(),!1,n.getParametersAsString()),i.sendRequest()}else checksaved("closeButton")}function documentLoadInit(){""!=COLLAB_ID&&"null"!=COLLAB_ID&&Collaboration.quit(COLLAB_ID),resetRTCvariables(),$.ZToolbarHandler.init(["#toolbarContainer","#popupmenu","#contextpopupmenus"]),toolbarinited=!1,getCommentCalloutPropertyValues()}function getI18NLastSavedMsg(e,t){var s="";return"seconds"==e?s=replaceParams(jsMsg.DurationInSeconds,new Array(t)):"minutes"==e?s=replaceParams(jsMsg.DurationInMinutes,new Array(t)):"hours"==e?s=replaceParams(jsMsg.DurationInHours,new Array(t)):"days"==e&&(s=replaceParams(jsMsg.DurationInDays,new Array(t))),s}function stopLoadSheetObject(){var e=new RequestParameters(ActionConstants.CLOSE_DOCUMENT),t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()}function postDocumentLoader(){return allowPostDocCall?(allowPostDocCall=!1,serverCompLoadedActivities(!1),sheetTabBgColor.getSheetTabColors(),postSheetLoader(ActionConstants.POST_DOC_LOAD),void appEvent.trigger("postDocumentLoader")):!1}function postSheetLoader(e,t,s){var n=!0,r=chartOnLoad.getSheetCharts(WorkSheets.getAssociatedActiveSheetName()),i=null;if(r&&(n=!1,chartOnLoad.renderSheetCharts(WorkSheets.getAssociatedActiveSheetName())),e===ActionConstants.POST_DOC_LOAD)pivot.Collection.reset(),filterIconsPane.innerHTML="",filterIconsPane1.innerHTML="",filterIconsPane2.innerHTML="",filterIconsPane3.innerHTML="";else if(i=chartOnLoad.getAffectInfo(WorkSheets.getAssociatedActiveSheetName()),i&&(i=i.isChartReaded),r||void 0!==i)if(Chart.affect[WorkSheets.getAssociatedActiveSheetName()]&&Chart.affect[WorkSheets.getAssociatedActiveSheetName()].chartId)if(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)n=!0;else{n=!1;var o=chartOnLoad.getAffectInfo(WorkSheets.getAssociatedActiveSheetName()).chartId;chartOnLoad.renderSheetCharts(WorkSheets.getAssociatedActiveSheetName())}else!r||Chart.affect[WorkSheets.getAssociatedActiveSheetName()]&&Chart.affect[WorkSheets.getAssociatedActiveSheetName()].chartId||(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?n=!0:(n=!1,chartOnLoad.renderSheetCharts(WorkSheets.getAssociatedActiveSheetName())));else n=!0;var a=new RequestParameters(e),l=jsVERSION_VIEW&&""==DOCUMENT_VERSION?!0:void 0;if(e===ActionConstants.POST_DOC_LOAD){var E=Row.getVisibleRowsInViewPortAsJSONStr(!1),d='[{"sc": 0 ,"ec":'+totCols+"}]";a.setParameters(CURRSHEETNAME,l,s,n,o,E,d,totRows,totCols,FREEZED_ROW)}else a.setParameters(CURRSHEETNAME,l,s,n,o);var u=new AjaxRequest;u.init("POST",a.getURL(),!0,a.getParametersAsString()),u.addEventListener("onComplete",function(e){checkTLSVersion();for(var s=parseJSON(e.responseText),n=0;n<s.length;n++){var r=s[n];if(isUndefined(r[JSONConstants.IS_NEW_DOC])){if(!isUndefined(r[JSONConstants.ISFORMEXISTS])){var i=r[JSONConstants.ISFORMEXISTS];appEvent.trigger("WebForm.updateFormInfo",[i,r])}if(isUndefined(r[JSONConstants.BUILD_VERSION_LABEL])||appEvent.trigger("Build.Version.label",[r[JSONConstants.BUILD_VERSION_LABEL]]),!isUndefined(r[JSONConstants.PIVOT_DETAILS]))for(var o=r[JSONConstants.PIVOT_DETAILS],a=0;a<o.length;a++)PivotUtil.createPivotObject(o[a]);isUndefined(r.cC)||ClipObject.setVars(r.cC),isUndefined(r.rtype)||ClipObject.setResourceType(r.rtype),isUndefined(r.htmlSrc)||(ClipRange.htmlSrc=r.htmlSrc),updateJson(r)}else isNewDocument=!0}var l=WorkSheets.getSheetCodeFromName(CURRSHEETNAME);scrollSheetTabToView(l);var E=ole.getObjects();if(E.length){var d=getOleUsedRow(totRows);d>totRows&&(totRows=d,totalTableHeight=getRowTop(totRows-1)+getRowHeight(totRows-1),setSheetTableHeight(totalTableHeight))}isSheetBasedShare&&disableToolBar(READ_WRITE),focusSheet(),t&&setTimeout(function(){AuditTrail.goToCellRef(t[0],t[1],t[2])},300);try{var u=getObj("currency");$(u).find("span").first().text(userCurrencySymbol),appEvent.trigger("setUserThousandSep",[userThousandSeparator])}catch(e){}appEvent.trigger("Audit.dismantleQueue")}),u.sendRequest(),appEvent.trigger("postSheetLoader")}function showStockGlitchBanner(){var e="https://forums.zoho.com/topic/temporary-glitch-in-stock-function",t=jsMsg["Error.Stock.Function.Disabled"]+" <a href='"+e+"' target='_blank' rel='noreferrer'>"+jsMsg["Tour.LearnMore"]+"</a>";showBannerMessage("WARNING",t,!0)}function showSignupDialog(){window.location.href=signInUpUrl+"?serviceurl="+encodeURIComponent(getServerRedirectUrl(!0))}function getServerRedirectUrl(e){var t=e?sheetServerURL+"sheetSignupAction.do?isCreateNew=true":listpageUrl;if("undefined"!=typeof REMOTE)if(REMOTE.MODE===REMOTE.SCRATCHVIEW||REMOTE.MODE===REMOTE.EXCELVIEW){var s="doc="+DOCUMENT_INFO.DOCUMENT_POINTER;REMOTE.MODE===REMOTE.SCRATCHVIEW&&(s=s+"&docName="+DOC_NAME),t=sheetServerURL+"sheetSignupAction.do?"+encodeURIComponent(s)}else if(jsPUBLIC_VIEW){var n=docCtxPath.split("/")[1],r="undefined"==typeof TEMP_CONTAINER_IDENTITY?DOCUMENT_INFO.DOCUMENT_POINTER:TEMP_CONTAINER_IDENTITY,s=encodeURIComponent("viewIdentity="+n+"&temp_container_identity="+r);t=sheetServerURL+"sheetSignupAction.do?"+s}return t}function getSigninUrl(){var e=getServerRedirectUrl(!1)+"isSignIn=true";return signUpRedirectUrl=signInUpUrl+"?serviceurl="+encodeURIComponent(getServerRedirectUrl(!0)),signInUrl+"&signupurl="+encodeURIComponent(signUpRedirectUrl)+"&serviceurl="+encodeURIComponent(e)}function showSignupWidget(){var e=$("<div/>",{class:"shBtmNtftCard"}).attr("id","signupWidget");e.append($("<span/>",{class:"shBtmClose",click:function(){$("#signupWidget").remove()}})),e.append($("<div/>",{class:"sheetLogoIcon"})),e.append($("<div/>",{class:"fntBld mt5 mb10",id:"signupWidgetTitle"}).text(jsMsg["Signup.Popup.TitleMsg"])),e.append($("<div/>",{class:"fnt-darkgrey mb15",id:"signupWidgetDescription"}).text(jsMsg["Signup.Popup.DescriptionMsg"])),e.append($("<a/>",{class:"Zsbtn flt_none dsp_inblk",id:"signupWidgetSignupMsg",click:function(){showSignupDialog()}}).text(jsMsg["Signup.Popup.SignupMsg"])),e.append($("<div/>",{class:"fnt13 mt5",style:"padding-top: 20px"}).append($("<span/>",{id:"signupWidgetSigninMsg"}).text(jsMsg["Signup.Popup.SigninMsg"])).append($("<a/>",{class:"ZsLink",id:"signupWidgetSigninLink"}).text(jsMsg.SignIn).attr("href",getSigninUrl()))),$("body").append(e)}function checkTLSVersion(){if(!checkBannerStatus()&&null!==TLS_SERVER_URL&&"null"!==TLS_SERVER_URL){var e=new getXmlhttp;e.open("POST",TLS_SERVER_URL,!1),e.onreadystatechange=function(){if(4==e.readyState){var t=JSON.parse(e.responseText);if("TLSv1.2"!==t.version){var s="announcement",n=jsMsg.TLSBannerMessage,r=TLS_INFO_BLOG_URL,i=jsMsg["Tour.ReadMore"],o="<div ctype='zannouncementbar' id='zannouncementbarnew' data=\"{'type':'"+s+"', 'message':'"+n+"',autoOpen:true,'learnMoreLink':'"+r+"','learnMoreText':'"+i+"'}\" ></div>";AnnouncementBanner.showBanner("zannouncementbarnew",o,"TLS Warning ",!0,!1,n),document.cookie="tlsBannerShown=true",sendTLSLogger(navigator.userAgent)}}},e.send(null)}}function sendTLSLogger(e){e&&e.length>0||(e="Older version browser detected which support only TLSv1.0 and TLSv1.1");var t="SenderDetails="+e+"&"+csrfParamName+"="+getCookie("zscookcsr");$.post(ctxpath+"bannerlog.do",t).done(function(){})}function checkBannerStatus(){return document.cookie.indexOf("tlsBannerShown=true")>-1?!0:void 0}var PREV_DOCUMENT_ID="",isDocumentLoading=!1,errorInLoadObject=!1,errorMsgShown=!1,workbooksheets=null,tempsheetname="",tempdocid="",isSheetLoading=!1,sheetHTML="",currSheetOnRightClick="",sheetOnMove=!1,currSheetOnMove="",movingSheet="",currSheetOnMoveIdx="",isSheetPre=!1,isSheetsTabDblClicked=!1,sheetTransX,sheetTransPitStops,sheetTransPosCnt,sheetsScrollLeft,sheetsScrollRight,sheetsScrollCnt=0,sheetsSRIntvl,sheetsSLIntvl=0,sheetTabSLCnt,sheetTabSRCnt,allowPostDocCall=!0;
function makepublishdialog(e,t){var l=user.permissions.unRegisteredUserEmail;if(l)return void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[l]));"undefined"!=typeof t&&(pubType=t);var s=new RequestParameters(ActionConstants.JSP_MAKE_PUBLISH),i={},a=showFormulas,r=allowExportPublic;if(("org"==t||-1!=zoid||isDocumentSemiPublic)&&(a=showFormulasOrg,r=allowExportOrg),"fromPublic"==e){publicURL=getServerPath()+location.href.substring(location.href.indexOf("/",SERVERSCHEME.length)),s.setParameters(publicURL,"true",null,isDocumentSemiPublic,"fromPublic",a,r,showPublic),i={width:500,modal:!0,title:jsMsg.EmbedToWebsiteBlog};var o=s.getURL()+"?"+s.getParametersAsString();sheetdialog.open("makepublishdialog",i,void 0,void 0,o)}else if(isDocumentSemiPublic&&"org"==t||isDocumentPublic){s.setParameters(publicURL,"true",null,isDocumentSemiPublic,"fromPublic",a,r,showPublic),i={width:520,modal:!0,title:jsMsg.EmbedToWebsiteBlog};var o=s.getURL()+"?"+s.getParametersAsString();sheetdialog.open("makepublishdialog",i,void 0,void 0,o)}else makepublishconfirm(pubType)}function makepublishconfirm(e){var t="";t="org"==e?null==orgDisplayName||""==orgDisplayName||"Organization"==orgDisplayName?jsMsg.EmbedwithinOrganization:replaceParams(jsMsg.EmbedwithinDomain,new Array(orgDisplayName)):"external"==e?jsMsg.EmbedToWebsiteBlog:jsMsg.EmbedToWebsiteBlog;var l=new RequestParameters(ActionConstants.JSP_MAKE_PUBLISH);if(0==DOCUMENT_NAME.toLowerCase().indexOf(jsMsg.Untitled.toLowerCase())){var s=showPromptDialog(jsMsg.RenameWhilePublish,$("#fileName").text());null!=s&&""!=s&&(renameDocument(s,e),isNewDocument=!1),l.setParameters(null,null,null,null,null,showFormulasOrg,allowExportOrg,null,e);var i={width:520,modal:!0,title:t},a=l.getURL()+"?"+l.getParametersAsString();sheetdialog.open("makepublishconfirmdialog",i,void 0,void 0,a)}else{l.setParameters(null,null,null,null,null,showFormulasOrg,allowExportOrg,"",e);var i={width:520,modal:!0,title:t},a=l.getURL()+"?"+l.getParametersAsString();sheetdialog.open("makepublishconfirmdialog",i,void 0,void 0,a)}}function makepublishsubmit(e){var t=new RequestParameters(ActionConstants.MAKE_PUBLIC);if("org"!=e||isDocumentSemiPublic)if(isDocumentPublic)sheetdialog.close(),makepublishdialog("",e);else{var l=!1,s=getObj("semipublic_confirmoption");null!=s&&(l=s.checked?!1:!0),showFormulas=!0;var i=getObj("public_formulaoption");null!=i&&(showFormulas=i.checked?!1:!0),allowExportPublic=!0;var a=getObj("public_exportoption");if(null!=a&&(allowExportPublic=a.checked?!0:!1),allowExportOrg=allowExportPublic,showFormulasOrg=showFormulas,showPublic=!0,"org"==e)showPublic="false",l="true";else if("external"==e)showPublic="true",null==s&&(l="false");else{var r=getObj("showPublicOption");null!=r&&(showPublic=r.checked?!0:!1)}t.setParameters(DOCUMENT_ID,"Make Public",l,encodeURIComponent(DOCUMENT_NAME),showFormulas,allowExportPublic,showPublic,e);var o=new AjaxRequest;o.init("POST",t.getURL(),!0,t.getParametersAsString()),o.addEventListener("onComplete",function(t){var s=t.responseText;return"Unconfirmed user"===s?void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail])):"Not Authorized"===s?void showAlertDialog(jsMsg.YouAreNotAuthorizedUserToMakeDocPublic):($("#orgpub").hide(),$("#extpub").show(),isDocumentPublic=!0,isDocumentSemiPublic=l,publicURL=t.responseText,void makepublishdialog("showURL",e))}),sheetdialog.close(),o.sendRequest()}else{var l=!1,s=getObj("semipublic_confirmoption");null!=s&&(l=s.checked?!1:!0),showFormulasOrg=!0;var i=getObj("public_formulaoption");null!=i&&(showFormulasOrg=i.checked?!1:!0),allowExportOrg=!0;var a=getObj("public_exportoption");null!=a&&(allowExportOrg=a.checked?!0:!1);var n=getObj("public_allowOrgEditoption");null!=n&&(allowOrgEdit=n.checked?!0:!1),showPublic=!0,showPublic="false",t.setParameters(DOCUMENT_ID,"Make Public",l,encodeURIComponent(DOCUMENT_NAME),showFormulasOrg,allowExportOrg,showPublic,e,"",allowOrgEdit);var o=new AjaxRequest;o.init("POST",t.getURL(),!0,t.getParametersAsString()),o.addEventListener("onComplete",function(t){var l=t.responseText;return"Unconfirmed user"===l?void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail])):"Not Authorized"===t.responseText?void showAlertDialog(jsMsg.YouAreNotAuthorizedUserToMakeDocPublic):($("#orgpub").show(),isDocumentSemiPublic=!0,publicURL=t.responseText,void makepublishdialog("showURL",e))}),sheetdialog.close(),o.sendRequest()}}function rangePublish(e,t){var l=getCellRange();if(void 0!=Merge.getCellInfo(l.startRow,l.startCol)&&!Merge.isCovered(l.startRow,l.startCol)){var s=Merge.getCellInfo(l.startRow,l.startCol);l.endRow=l.endRow<s.endRow?s.endRow:l.endRow,l.endCol=l.endCol<s.endCol?s.endCol:l.endCol}var a=user.permissions.unRegisteredUserEmail;if(a)return void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[a]));if(sheetdialog.close(),t){var r="confirm",o="org"==e&&null!=orgDisplayName&&""!=orgDisplayName&&"Organization"!=orgDisplayName?orgDisplayName:"",n="undefined"!=typeof e?e:"",g=new RequestParameters(ActionConstants.JSP_RANGE_SNIPPET);g.setParameters(n,r,o);var d={width:500,modal:!0,title:jsMsg.PublishRange},u=g.getURL()+"?"+g.getParametersAsString();return void sheetdialog.open("rangepublishdialog",d,void 0,void 0,u)}var p=l.startRow,b=l.startCol,c=l.endRow,h=l.endCol,R=getCell(c,h);null==R&&(R=getCell(getAvailableEndRow(),getAvailableEndCol())),cellColspan=R.colSpan,cellColspan>1&&(h=h+cellColspan-1);var m=0,E=0;for(message(jsMsg.Loading,"block","..."),i=p;c>=i;i++)m+=getRowHeight(i);for(i=b;h>=i;i++)E+=getColWidth(i);l=p+":"+b+":"+c+":"+h,dyn_updation="yes",col_head="yes",cell_width="yes",borders="yes",row_num="yes";var g=new RequestParameters(ActionConstants.RANGE_PUBLISH);g.setParameters(CURRSHEETNAME,l,e);var O=new AjaxRequest;O.init("POST",g.getURL(),!0,g.getParametersAsString()),O.addEventListener("onComplete",function(t){var l=t.responseText;if("Unconfirmed user"===l)return message("","none"),void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail]));if("Not Authorized to publish externally"==l)return void showAlertDialog(jsMsg["Publish.Alert.NotAuthorizedToPublishExternally"]);var s="";s=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(s+=":"+SERVERPORT),publishURL="org"==e?s+ctxpath+"publishrange.org":s+ctxpath+"publishrange.do",message(jsMsg.Loading,"none"),"external"==e?e="public":"org"==e&&(e="org");var i=t.responseText,a=JSON.parse(i);showRangePublishURL(publishURL,"rangepublish",m,E,e,a.id)}),O.sendRequest()}function showPublishedRange(){if(sheetdialog.close(),null!=DOCUMENT_ID&&"doc_id"!=DOCUMENT_ID&&"DOCUMENT_ID"!=DOCUMENT_ID){message(jsMsg.Loading,"block","...");var e=new RequestParameters(ActionConstants.SHOW_PUBLISH_RANGE);e.setParameters(CURRSHEETNAME,orgDisplayName);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=e.responseText;message(jsMsg.Loading,"none"),isRangeDialog=!0;var l={width:"auto",closeOnEscape:!1,title:jsMsg.PublishedRanges,close:function(){RangeSelector.off(),closePublsihedRangeDialog()}};sheetdialog.open(t,l)}),t.sendRequest()}else showAlertDialog(jsMsg.NoRangesPublishedFromThisSheet)}function closePublsihedRangeDialog(){isRangeEdit=!1,resetCellRangeFill("publishedRange")}function rangePublishActions(e,t,l,s,i,r,o,n){if(callFrom=n,"Remove"==t){if(a=showConfirmDialog(jsMsg["RangePublish.ShowPublishedRangeDialog.RevertRangePublishAlert.ConfirmMsg"])){var g=new RequestParameters(ActionConstants.UPDATE_PUBLISH_RANGE);g.setParameters("Remove",l,n);var d=new AjaxRequest;d.init("POST",g.getURL(),!0,g.getParametersAsString()),d.addEventListener("onComplete",function(t){"undefined"!=typeof e?(getObj("RangeRow_"+e).style.display="none",getObj("SnippetRow_"+e).style.display="none"):sheetdialog.close(),"-1"==t.responseText&&sheetdialog.close()}),d.sendRequest(),rangeEditText=="range_text_"+e&&resetCellRangeFill("publishedRange")}}else if("Cancel_Edit"==t)isRangeEdit=!1,rangeEditText="",rangeEditURL="",getObj("edit_"+e).style.display="",getObj("cancel_edit_"+e).style.display="none",getObj("range_span_"+e).style.display="",getObj("range_text_"+e).value=rangeEditValue,getObj("range_text_"+e).style.display="none",getObj("update_"+e).style.display="none",getObj("remove_"+e).style.display="",resetCellRangeFill("publishedRange");else if("Edit"==t){for(isRangeEdit=!0,rangeEditText="range_text_"+e,rangeEditURL=l,b=1;b<=parseInt(rangeCnt);b++)b!=e&&(getObj("edit_"+b).style.display="",getObj("cancel_edit_"+b).style.display="none",getObj("range_span_"+b).style.display="",getObj("range_text_"+b).style.display="none",getObj("update_"+b).style.display="none",getObj("remove_"+b).style.display=""),getObj("SnippetRow_"+b).style.display="none",getObj("hide_snippet_"+b).style.display="none",getObj("show_snippet_"+b).style.display="";getObj("edit_"+e).style.display="none",getObj("cancel_edit_"+e).style.display="",getObj("range_span_"+e).style.display="none",rangeEditValue=getObj("range_text_"+e).value,getObj("range_text_"+e).style.display="",$("#range_text_"+e).focus(function(){var e=this;RangeSelector.on({el:e,appendSheetName:!0})}),getObj("range_text_"+e).focus(),getObj("update_"+e).style.display="",getObj("remove_"+e).style.display="none",val=getObj("range_text_"+e).value,arr=val.split(".")}else if("Update"==t){if(""==getObj("range_text_"+e).value)return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);if(val=getObj("range_text_"+e).value,val=CellUtils.removeApostrophe(val),arr=val.split("."),2!=arr.length)return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);for(var u=0,p=getObj("sheetsTab").getElementsByTagName("TD"),b=0;b<p.length-1;b++)if(null!=p[b].getAttribute("sheetname")){var c=p[b].getAttribute("sheetname");c==arr[0]&&(u=1)}if(0==u)return void showAlertDialog(jsMsg.SpecifyValidSheetName);if(""==arr[0]||""==arr[1])return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);var h=formatWithConditions.getRangeValues(val);if(!h)return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);var R=h.sheetName,m=h.startCol,E=h.startRow,O=h.endCol,w=h.endRow;if(R==CURRSHEETNAME){var P=0,_=0;for(P+=getRowTop(w)+getRowHeight(w)-getRowTop(E),b=m;O>=b;b++)_+=getColWidth(b);var y="";y=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(y+=":"+SERVERPORT),y+=ctxpath,y+="org"==callFrom?"publishrange.org?id="+l:"publishrange.do?id="+l,y="<iframe src='"+y+"' frameborder='0' style='height:"+P+"px;width:"+_+"px' marginwidth='0' marginheight='0' scrolling='auto'>&nbsp;</iframe>",getObj("picPublishURL_"+e).value=y}var v=new RequestParameters(ActionConstants.UPDATE_PUBLISH_RANGE);v.setParameters("Update",l,n,R,E,m,w,O);var d=new AjaxRequest;d.init("POST",v.getURL(),!0,v.getParametersAsString()),d.addEventListener("onComplete",function(){isRangeEdit=!1,rangeEditText="",getObj("edit_"+e).style.display="",getObj("cancel_edit_"+e).style.display="none",getObj("range_span_"+e).style.display="",getObj("range_span_"+e).innerHTML=ZSEC.Encoder.encodeForHTML(getObj("range_text_"+e).value),getObj("range_text_"+e).style.display="none",getObj("update_"+e).style.display="none",getObj("remove_"+e).style.display=""}),d.sendRequest(),resetCellRangeFill("publishedRange")}else if("ShowSnippet"==t){for(b=1;b<=parseInt(rangeCnt);b++)b!=e&&(getObj("SnippetRow_"+b).style.display="none",getObj("hide_snippet_"+b).style.display="none",getObj("show_snippet_"+b).style.display=""),getObj("edit_"+b).style.display="",getObj("cancel_edit_"+b).style.display="none",getObj("range_span_"+b).style.display="",getObj("range_text_"+b).style.display="none",getObj("update_"+b).style.display="none",getObj("remove_"+b).style.display="";val=getObj("range_text_"+e).value,arr=val.split("."),arr1=arr[1].split(":");var m=-1,E=-1,O=-1,w=-1;if(2==arr1.length){if(""==arr1[0]||""==arr1[1])return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);st=CellUtils.getCellPosByLabel(arr1[0]),m=st.col,E=st.row,en=CellUtils.getCellPosByLabel(arr1[1]),O=en.col,w=en.row}else if(1==arr1.length){if(""==arr1[0])return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);st=CellUtils.getCellPosByLabel(arr1[0]),m=st.col,E=st.row,O=m,w=E}if(arr[0]==CURRSHEETNAME){var P=0,_=0;for(P+=getRowTop(w)+getRowHeight(w)-getRowTop(E),b=m;O>=b;b++)_+=getColWidth(b);var y="";y=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(y+=":"+SERVERPORT),y+=ctxpath,y+="org"==callFrom?"publishrange.org?id="+l:"publishrange.do?id="+l,y="<iframe src='"+y+"' frameborder='0' style='height:"+P+"px;width:"+_+"px' scrolling='auto' marginwidth='0' marginheight='0'>&nbsp;</iframe>",getObj("picPublishURL_"+e).value=y}else{var y="";y=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(y+=":"+SERVERPORT),y+=ctxpath,y+="org"==callFrom?"publishrange.org?id="+l:"publishrange.do?id="+l,y="<iframe src='"+y+"' frameborder='0' style='height:100%;width:100%' scrolling='auto' marginwidth='0' marginheight='0'>&nbsp;</iframe>",getObj("picPublishURL_"+e).value=y}getObj("SnippetRow_"+e).style.display="",getObj("picPublishURL_"+e).focus(),getObj("hide_snippet_"+e).style.display="",getObj("show_snippet_"+e).style.display="none"}else"HideSnippet"==t&&(getObj("SnippetRow_"+e).style.display="none",getObj("hide_snippet_"+e).style.display="none",getObj("show_snippet_"+e).style.display="")}function updateRangeEnter(e,t){var l;if(window.event?l=window.event.keyCode:t&&(l=t.which),13==l){var s=e.id.split("_");rangePublishActions(s[2],"Update",rangeEditURL,"","","","",callFrom)}else{if(27==l){var s=e.id.split("_");return rangePublishActions(s[2],"Cancel_Edit",rangeEditURL,"","","","",callFrom),!1}if(0==l)return!1}}function callpublic(e,t){if("Made Public"==e)publicURL=t,null!=publicURL&&""!=publicURL&&(publishURL=-1==zoid?publicURL.replace("/public/","/publish/"):publicURL+"/embed",publishURL="<iframe src='"+publishURL+"' frameborder='0' scrolling='no' style='height:400px;width:500px'>&nbsp;</iframe>"),i=0;else if("Made Publish"==e){publicURL=t;var l="",s=publicURL.length,i=0;if(publicURL.length>50)for(;s>i;)l+=i+50>s?publicURL.substring(i,s):publicURL.substring(i,i+50),l+="<br>",i+=50;else l=t;publishURL="",null!=publicURL&&""!=publicURL&&(publishURL=-1==zoid?publicURL.replace("/public/","/publish/"):publicURL+"/embed",publishURL="<iframe src='"+publishURL+"' frameborder='0' scrolling='no' style='height:400px;width:500px'>&nbsp;</iframe>")}else"Cancel Public"==e&&(isDocumentPublic=!1,isDocumentSemiPublic=!1);getObj("PUBLICURL").value=publicURL}function showembedblog(){"none"==getObj("embedblog").style.display?(getObj("embedblog").style.display="",getObj("embedblog_btn_exp").style.display="",getObj("embedblog_btn_col").style.display="none"):(getObj("embedblog").style.display="none",getObj("embedblog_btn_exp").style.display="none",getObj("embedblog_btn_col").style.display="")}function changepublicOptions(e,t,l){var s=!0;null!=e&&("ALLOWEXPORT"!=t&&e.checked?s=!1:"ALLOWEXPORT"==t&&e.checked?s=!0:"ALLOWEXPORT"!=t||e.checked?"SHOWPUBLIC"==t&&(showPublic=e.checked?!0:!1):s=!1,"ALLOWORGEDIT"==t&&(s=e.checked?!0:!1));var i=new RequestParameters(ActionConstants.MANAGE_PUBLIC),a="Change Options";"SHOWPUBLIC"!=t||e.checked?"SHOWPUBLIC"==t&&e.checked&&(a="Add Public"):a="Remove Public",i.setParameters(l,DOCUMENT_ID,a,t,s);var r=new AjaxRequest;r.init("POST",i.getURL(),!0,i.getParametersAsString()),r.addEventListener("onComplete",function(e){var i=e.responseText;return"Unconfirmed user"===i?void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail])):"Not Authorized"==i?void showAlertDialog(jsMsg.YouAreNotAuthorizedUser):void("org"==l?"ALLOWEXPORT"==t?allowExportOrg=s:"SHOWFORMULAS"==t?showFormulasOrg=s:"ALLOWORGEDIT"==t&&(allowOrgEdit=s):"ALLOWEXPORT"==t?(allowExportPublic=s,allowExportOrg=s):"SHOWFORMULAS"==t?(showFormulas=s,showFormulasOrg=s):"ALLOWORGEDIT"==t&&(allowOrgEdit=s))}),r.sendRequest()}var rangeEditText="",rangeCnt=0,rangeEditValue="",rangeEditURL="",callFrom="";
function resetUNDO(){UNDO=0,REDO=0,toggleREDO(),toggleUNDO()}function setREDO(e){REDO=parseInt(e),toggleREDO()}function setUNDO(e){UNDO=parseInt(e),toggleUNDO()}function getREDO(){return 0===REDO?(toggleREDO(),!1):(REDO-=1,0===REDO&&toggleREDO(),!0)}function getUNDO(){return 0===UNDO?(toggleUNDO(),!1):(UNDO-=1,0===UNDO&&toggleUNDO(),!0)}function redo(){if(getREDO()===!1)return void repeat.doAction(repeat.LASTACTIONJSON,!1);sheetdialog.isDialogOpen()&&sheetdialog.close(),ole&&ole.isActive()&&ole.getCurrObj()&&"chart"==ole.getCurrObj().type&&chartPreview.hideContextualToolbar(),setUNDO(UNDO+1);var e=new RequestParameters(ActionConstants.REDO);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t)}function undo(){if(getUNDO()!==!1){if(sheetdialog.isDialogOpen()&&sheetdialog.close(),ole&&ole.isActive()&&ole.getCurrObj()&&"chart"==ole.getCurrObj().type&&chartPreview.hideContextualToolbar(),isCellEdited())return void submitCell();setREDO(REDO+1);var e=new RequestParameters(ActionConstants.UNDO);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t)}}function toggleUNDO(){jsGADGET_VIEW||jsTHROWAWAY_VIEW||undoCallback()}function toggleREDO(){jsGADGET_VIEW||jsTHROWAWAY_VIEW||redoCallback()}function undoCallback(){return 0===UNDO?void menutabListener.doAction(TOOLBAR.HOME,{id:"undo",action:"disable",callback:button_disable,args:["undo"]}):void menutabListener.doAction(TOOLBAR.HOME,{id:"undo",action:"enable",callback:button_enable,args:["undo"]})}function redoCallback(){return 0===REDO?void menutabListener.doAction(TOOLBAR.HOME,{id:"redo",action:"disable",callback:button_disable,args:["redo"]}):void menutabListener.doAction(TOOLBAR.HOME,{id:"redo",action:"enable",callback:button_enable,args:["redo"]})}var UNDO=0,REDO=0;
var WMSResponseProcessor={processMessage:function(e,s,a,t,n){var o;try{o=parseJSON(n)}catch(e){o=parseJSON(replaceSplChrs(n))}if(appEvent.trigger("wms.messageprocessed",[o,s,a,t]),void 0!=o[ResponseKey.EXECUTED]&&appEvent.trigger("xaid.returned",[o[ResponseKey.EXECUTED],t]),submitCallBack.action){var r=submitCallBack[ResponseKey.QUEUED],i=o[ResponseKey.EXECUTED];r?i>=r&&fireRegisteredEvent():setTimeout(function(){fireRegisteredEvent()},1e3)}if(1==o.DU)switch(o.a){case ActionConstants.SAVE_API:SAVED=!0;break;case ActionConstants.USER_PRESENCE:o.user!=WebMessanger.getRawSid()&&setTimeout(function(){userPresence.show(o)},500);break;case ActionConstants.POST_DOC_LOAD:updateJson(o);break;case ActionConstants.MACRO_CONTENT_CHANGED:utid!=o[JSONConstants.UNIQUE_TAB_ID]&&WebMessanger.getRawSid()!=o[JSONConstants.UNIQUE_TAB_ID]&&(ISMACROEDITOROPEN||ISMINDLG)&&pullMacroContent(o.mnA,o.ao);break;case ActionConstants.WEB_DATA:"WebdataPaste"==o.SUBACTION&&refreshWebData(o.WEBDATAID,o.sn,!0);break;case ActionConstants.USER_PRESENCE_REMOVE:userPresence.remove(o.rsid);break;case ActionConstants.SHOW_ERROR_MESSAGE:ErrorMsg.show(o);break;case ActionConstants.IMPORT_REPLACE_SPREADSHEET:if(appEvent.trigger("import.response"),$("#sharedialogdiv").is(":visible")&&$("#sharedialogdiv").dialog("close"),LOGINNAME!=o[JSONConstants.LOGIN_NAME]){var S=!0,l=jsMsg["Overwrite.dialog.newVersionUploaded"],E=replaceParams(jsMsg["Share.dialog.reloadMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("info",jsMsg["Overwrite.dialog.versionUploadTitle"],l,E),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}else loadDocument(DOCUMENT_ID,DOCUMENT_NAME);break;case ActionConstants.REVERT_VERSION:loadDocument(DOCUMENT_ID,DOCUMENT_NAME);break;case ActionConstants.RENAME_DOCUMENT:case ActionConstants.SAVE_DOCUMENT:o.dn&&updateDocName(o.dn);break;case ActionConstants.VERSION_UPLOAD_NOTIFICATION:if(DOCUMENT_ID==o[JSONConstants.DOC_ID]&&COLLAB_ID==o[JSONConstants.COLLAB_ID]){var S=!0,l=jsMsg["Overwrite.dialog.newVersionUploaded"],E=replaceParams(jsMsg["Share.dialog.reloadMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("info",jsMsg["Overwrite.dialog.versionUploadTitle"],l,E),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}break;case ActionConstants.CHECKIN_CHECKOUT:if((LOGINNAME==o[JSONConstants.RECEIVER]||"ALL"==o[JSONConstants.RECEIVER])&&DOCUMENT_ID==o[JSONConstants.DOC_ID]&&COLLAB_ID==o[JSONConstants.COLLAB_ID])if(void 0==o.locked_by){var S=!0,d=replaceParams(jsMsg["Checkin.dialog.CheckIn"],["<b>"+LOCKED_BY+"</b>"]),c=jsMsg["Share.dialog.permissionChanged"],C=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>")),g=jsMsg["Checkin.reloadButton"];$("#notifyDlgHeading").hide(),Share.showDialog(g,S),Share.setValues("info",c,d,C),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}else{LOCKED_BY=o.locked_by;var S=!0,d=replaceParams(jsMsg["Checkin.dialog.CheckOut"],["<b>"+o.locked_by+"</b>"]),g=jsMsg["Checkin.reloadButton"],c=jsMsg["Share.dialog.permissionChanged"],C=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>"));$("#notifyDlgHeading").hide(),Share.showDialog(g,S),Share.setValues("info",c,d,C),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}break;case ActionConstants.SHARE_PERMISSION_CHANGE:if(LOGINNAME!=o[JSONConstants.LOGIN_NAME]&&(LOGINNAME==o[JSONConstants.RECEIVER]||"ALL"==o[JSONConstants.RECEIVER])&&DOCUMENT_ID==o[JSONConstants.DOC_ID]&&COLLAB_ID==o[JSONConstants.COLLAB_ID]){var O=o[JSONConstants.PERMISSION_TO],R=o[JSONConstants.PERMISSION_FROM],S=!0;if(isSheetBasedShare){var d=replaceParams(jsMsg["SheetShare.dialog.ROtoRW"],new Array(o.SName)),g=jsMsg["SheetShare.dialog.reloadButMsg2"];return 1==R&&0==O&&(d=replaceParams(jsMsg["SheetShare.dialog.RWtoRO"],new Array(o.SName)),g=jsMsg["SheetShare.dialog.reloadButMsg1"],S=!0),Share.showDialog(g,S,O),void Share.setValues("info",jsMsg["Share.dialog.permissionChanged"],d)}var l=jsMsg["Share.dialog.ROtoRW"],A=jsMsg["Share.dialog.reloadButMsg2"];return 2!=R&&1!=R&&3!=R||0!=O?2==R&&1==O?(l=jsMsg["Share.dialog.COtoRW"],A=jsMsg["Share.dialog.reloadButMsg1"],S=!0):1==R&&2==O?(l=jsMsg["Share.dialog.RWtoCO"],A=jsMsg["Share.dialog.reloadButMsg1"],S=!0):0!=R&&3!=R||2!=O?3==R&&0==O?(l=jsMsg["Share.dialog.RCtoRO"],A=jsMsg["Share.dialog.reloadButMsg2"],S=!0):0==R&&3==O?(l=jsMsg["Share.dialog.ROtoRC"],A=jsMsg["Share.dialog.reloadButMsg2"],S=!0):2!=R&&1!=R||3!=O||(l=jsMsg["Share.dialog.RW_COtoRC"],A=jsMsg["Share.dialog.reloadButMsg2"],S=!0):(l=jsMsg["Share.dialog.ROtoCO"],A=jsMsg["Share.dialog.reloadButMsg2"],S=!0):(l=jsMsg["Share.dialog.CO_RWtoRO"],A=jsMsg["Share.dialog.reloadButMsg1"],S=!0),Share.showDialog(A,S,O),void Share.setValues("info",jsMsg["Share.dialog.permissionChanged"],l)}break;case ActionConstants.SHARE_REMOVE_BYOWNER:if(LOGINNAME!=CURR_DOC_OWNERNAME){if(!disableRemoveShareNotify)if(isSheetBasedShare){var d=replaceParams(jsMsg["SheetShare.dialog.removeShareMsg"],new Array(o.SName)),c=jsMsg["SheetShare.dialog.accessDenied"],C=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("error",c,d,C),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}else{var l=jsMsg["Share.dialog.removeShareMsg"],D=jsMsg["Share.dialog.accessDenied"],E=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("error",D,l,E),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}Collaboration.quit(COLLAB_ID)}break;case ActionConstants.DOCUMENT_TRASH:var S=!0,l=jsMsg["Trash.dialog.dlgMsg"],A=jsMsg.OK;return Trash.showDialog(A),void Trash.setValues("info",jsMsg["Trash.dialog.headMsg"],l);case ActionConstants.SHARE_REMOVE_BYUSER:if(o[JSONConstants.DOC_ID]==DOCUMENT_ID)if(o.sharedUser==LOGINNAME)document.location.href=location.href;else{for(var M=0;M<SHAREDUSERSLIST.length;M++){var I=SHAREDUSERSLIST[M],_=I.uname;if(a==_){SHAREDUSERSLIST.splice(M,1);break}}0!=SHAREDUSERSLIST.length&&updateSharedUserStatus()}if(respObjsender!=LOGINNAME){for(var M=0;M<SHAREDUSERSLIST.length;M++){var I=SHAREDUSERSLIST[M],_=I.uname;if(a==_){SHAREDUSERSLIST.splice(M,1);break}}0!=SHAREDUSERSLIST.length&&updateSharedUserStatus()}break;case ActionConstants.CHANGE_OWNER:loadDocument(o[JSONConstants.DOC_ID]);break;case ActionConstants.READ_FILTER_RANGE:Filter.updateFilterJson(o);break;case ActionConstants.DISCUSSION_ADD:case ActionConstants.DISCUSSION_DELETE:case ActionConstants.DISCUSSION_RESOLVE:case ActionConstants.DISCUSSION_REOPEN:case ActionConstants.DISCUSSION_ADD_REPLY:case ActionConstants.DISCUSSION_UPDATE_RANGE_CONTENT:case ActionConstants.DISCUSSION_DELETE_REPLY:case ActionConstants.DISCUSSION_UPDATE_REPLY:case ActionConstants.DISCUSSION_LIKE:case ActionConstants.DISCUSSION_LIKE_REPLY:case ActionConstants.DISCUSSION_UNLIKE:case ActionConstants.DISCUSSION_UNLIKE_REPLY:case ActionConstants.DISCUSSION_UPDATE_SHAREDUSERS:case ActionConstants.DISCUSSION_DELETE_ALL:Discussion.Wms.handle(o);break;case ActionConstants.WAKE_UP_CALL:stopGetStatus=!1,wakeUpTime=new Date,updateViewPort();break;case ActionConstants.EXTERNAL_REMOTE_SAVE:if(RMUSER===t){200===o.msg.statusCode&&(SAVED=!0,btn_disabled());var u=getObj("save_message_display");u&&(u.innerHTML=escapeSpecialCharacters(o.msg.statusValue)),setTimeout(function(){u.innerHTML=""},2e3)}break;default:updateJson(o)}else if(o.a&&o.a[ActionConstants.USER_PRESENCE]){var h=String(o.a[ActionConstants.USER_PRESENCE]).split(",");if(h[0]!=WebMessanger.getRawSid()){var N=h[9],p=parseInt(h[4]),T=parseInt(h[5]);"true"===N&&(p=parseInt(h[2]),T=parseInt(h[3]));var m={vcID:h[0],sheetName:h[1],row:parseInt(h[2]),col:parseInt(h[3]),erow:p,ecol:T,dname:h[6],zuid:h[7],colorCode:h[8]};userPresence.show(m),CollabPanel.setCollboratorStatus(h[0],h[1],h[2],h[3],p,T,h[7]),CollabPanel.updateUserEdit(h[0],h[1],h[2],h[3],N)}}else if(isUndefined(o.qaid)&&isUndefined(o.xaid)){if(o.a&&o.a[ActionConstants.COLLAB_USER_EDIT]){var h=String(o.a[ActionConstants.COLLAB_USER_EDIT]).split(",");if(h[0]!==WebMessanger.getRawSid()){var m={vcID:h[0],sheetName:h[1],row:parseInt(h[2]),col:parseInt(h[3]),erow:parseInt(h[2]),ecol:parseInt(h[3]),dname:h[6],zuid:h[7],colorCode:h[8]};userPresence.show(m),CollabPanel.setCollboratorStatus(h[0],h[1],h[2],h[3],h[2],h[3],h[7]),CollabPanel.updateUserEdit(h[0],h[1],h[2],h[3],"true")}}else if(!isUndefined(o[JSONConstants.STOP_GET_STATUS])&&1==o[JSONConstants.STOP_GET_STATUS]){var b=new Date;(!wakeUpTime||b-wakeUpTime>5e4)&&(stopGetStatus=!0,wakeUpTime=null)}}else{if(logMsg){test.log("response via wms for xaid : "+o.xaid);var L=time[o.xaid];L&&(test.log("delay in time : ",(new Date).getTime()-L),delete time[o.xaid])}if(responseManager.updateResponse(o),"undefined"!=typeof CollabPanel){var U=CollabPanel.getPanelPermissions();U.allowActionStream&&o[ActionConstants.ACTION_STREAM_UPDATE]&&(U.includeTabActionStream||o.rsid!==WebMessanger.getRawSid())&&CollabPanel.updateActionStream(o[ActionConstants.ACTION_STREAM_UPDATE][0])}}},processCustomMessage:function(e){this.processMessage(void 0,void 0,void 0,void 0,e)},handleServerDown:function(){responseManager=new _ResponseManager(1e3,3e3,2500,9,5e3,allowSyncTimerGetStatus),documentBakeStatus.setCollabBake(!0),documentBakeStatus.isBaked()&grantRequest&&(grantRequest=!1),documentBakeStatus.setCollabBake(!0),unMaskSheet()},handleServerUp:function(){var e=new RequestParameters(ActionConstants.JOIN_COLLAB),s=Row.getVisibleRowsInViewPortAsJSONStr(!1),a='[{"sc": 0 ,"ec":'+totCols+"}]",t=COLLAB_INFO.RS_ID;e.setParameters(CURRSHEETNAME,t,encodeURIComponent(WebMessanger.getSid()),s,a,totRows,totCols,FREEZED_ROW),COLLAB_INFO.RS_ID=WebMessanger.getRawSid();var n=new AjaxRequest;n.init("POST",e.getURL(),!0,e.getParametersAsString()),n.addEventListener("onComplete",function(e){documentBakeStatus.setCollabBake(!0),unMaskSheet(),jsPUBLIC_VIEW||setTimeout(WMSResponseProcessor.handleWMSJoinError,6e4);var s=e.responseText;if(s){var a=JSON.parse(s);if(a.a==ActionConstants.SHOW_ERROR_MESSAGE)return void ErrorMsg.show(a);if(1==a.IS_LOCKED&&(RESOURCE_LOCKED=!0,DOCUMENT_MAX_PERMISSION=a.maxPermission,"READ"==DOCUMENT_MAX_PERMISSION?$("#readonlyico").show():$("#readonlyico").hide(),a.LOCKED_BY==a.LOGIN_USER?(showLockedBy("you"),LOCKED_BY=a.LOGIN_USER,InfoBanner.showBanner(jsMsg["Checkin.CheckoutBannerOnReload"],!0,"info")):(showLockedBy(a.LOCKED_BY),LOCKED_BY=a.LOCKED_BY,InfoBanner.showBanner(replaceParams(jsMsg["Checkin.CheckoutBannerForSharedUser"],new Array(a.LOCKED_BY)),!1,"info"))),errorMsgShown){hideBannerMessage(),errorDocMenutab("enable"),a.ro||(READ_WRITE=!0,ALLOW_TO_WRITE=!0),errorMsgShown=!1,isErrorDoc=!1;var n=getObj("addSheetBtn");n&&(n.style.visibility="visible")}if(ole&&READ_WRITE&&(ole.setObjectProperties("button",{permissions:{isDraggable:!0,isResizable:!0,isEditable:!0}}),ole.setObjectProperties("chart",{permissions:{isDraggable:!0,isResizable:!0,isEditable:!0}}),ole.setObjectProperties("img",{permissions:{isDraggable:!0,isResizable:!0,isEditable:!0}})),JSON.parse(e.responseText).xaid!==responseManager.getLastExecutedActionId()){var o={};o.isExecuteActionIdNeeded=!0,reloadPage(null,null,o)}if(documentBakeStatus.setCollabBake(!0),isCollabJoined=!0,responseManager=new _ResponseManager(1e3,3e3,25e3,9,5e3,allowSyncTimerGetStatus),documentBakeStatus.isBaked()&grantRequest&&(grantRequest=!1,postDocumentLoader()),appEvent.trigger("collab.reconnect"),a.irc?responseManager.reInit(a):(responseManager.init(a),"undefined"!=typeof a.cid&&(COLLAB_ID=a.cid),a[JSONConstants.READ_ONLY]),t){{({a:ActionConstants.USER_PRESENCE_REMOVE,DU:!0,rsid:t})}sendUserPresence()}}if(jsPUBLIC_VIEW&&void 0!=TEMP_CONTAINER_IDENTITY){Public.holdRequests=!1;var r="&temp_container_identity="+TEMP_CONTAINER_IDENTITY,S=Public.requestsArray.length;for(i=0;S>i;i++){var l=Public.requestsArray[i];l.parameters.indexOf("temp_container_identity")<0&&l.appendParams(r),l.sendRequest()}delete Public.requestsArray,actionManager.revokeHoldedRequest()}}),n.addEventListener("onError",function(e){var s=e.responseText;if(s){var a=JSON.parse(s);a&&"Error.Remote.Document.Not.Available"==a.mk&&(BLOCK_REMOVED_FILE_REQUEST=!0)}}),n.sendRequest()},handleWMSJoinError:function(){if(!isCollabJoined&&!errorMsgShown){restrictScroll=!1,documentBakeStatus.setCollabBake(!0),unMaskSheet(),postDocumentLoader();var e=new RequestParameters(ActionConstants.SYNC_CHECK);e.setParameters(DOCUMENT_ID,"failed");var s=new AjaxRequest;s.init("POST",e.getURL(),!0,e.getParametersAsString()),s.sendRequest(),errorMsgShown=!0}},handleWmsOffline:function(){if(READ_WRITE){var e=replaceParams(jsMsg["Error.WMS.Connection.Lost"],new Array("<a onclick='javascript:loadDocument(\""+DOCUMENT_ID+"\");' href='#'>","</a>"));handleServerError("ERROR",e,!0,!0)}}};
var insertImage=function(e){function t(e,t){ole.isSelected(e)?t._setSelectLayer().positionActionBar():ole.isFocussed(e)&&t.setFocusLayer()}function n(e,t,n){e.sCol=findColInXPos(t),e.sRow=findRowInYPos(n),e.sRowDiff=n-getRowTop(e.sRow),e.sColDiff=t-getColLeft(e.sCol)}function o(){var e=new RequestParameters(ActionConstants.LOAD_IMAGE);jsVERSION_VIEW||"undefined"!=typeof ole&&ole.reset(),e.setParameters(WorkSheets.getActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!1,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText),n=t.imageDetails;void 0!==n&&a(void 0,n)}),t.sendRequest()}function a(e,o,a,s){var i=o.length;switch(e){case ActionConstants.IMAGE_MOVE:case ActionConstants.INSERT_ROW:case ActionConstants.INSERT_COL:case ActionConstants.DELETE_ROW:case ActionConstants.DELETE_COL:case ActionConstants.INSERT_CELL_LEFT:case ActionConstants.INSERT_CELL_TOP:case ActionConstants.DELETE_CELL_BOTTOM:case ActionConstants.DELETE_CELL_RIGHT:for(var c=0;i>c;c++){if(o[c][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var m=parseInt(o[c][CommandConstants.IMAGE_ROW]),d=parseInt(o[c][CommandConstants.IMAGE_COLUMN]),E=parseInt(o[c][CommandConstants.IMAGE_ROW_DIFF]),C=parseInt(o[c][CommandConstants.IMAGE_COL_DIFF]),g="img_"+o[c][CommandConstants.IMAGE_ID].toString(),I=getRowTop(m)+E,u=getColLeft(d)+C,f=ole(g);f.moveTo(u,I),t(g,f),n(f,u,I),a&&e===ActionConstants.IMAGE_MOVE&&ole(g)._setSelectLayer()}break;case ActionConstants.IMAGE_RESIZE:for(var c=0;i>c;c++){if(o[c][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var g="img_"+o[c][CommandConstants.IMAGE_ID].toString(),m=parseInt(o[c][CommandConstants.IMAGE_ROW]),d=parseInt(o[c][CommandConstants.IMAGE_COLUMN]),E=parseInt(o[c][CommandConstants.IMAGE_ROW_DIFF]),C=parseInt(o[c][CommandConstants.IMAGE_COL_DIFF]),I=getRowTop(m)+E,u=getColLeft(d)+C,A=parseInt(o[c][CommandConstants.IMAGE_WIDTH]),_=parseInt(o[c][CommandConstants.IMAGE_HEIGHT]),f=ole(g);f.moveTo(u,I).resizeTo(A,_),t(g,f),n(f,u,I),a&&ole(g)._setSelectLayer()}break;case ActionConstants.IMAGE_REMOVE:if(s)r(o,a);else for(var c=0;i>c;c++){if(o[c][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var g="img_"+o[c][CommandConstants.IMAGE_ID].toString();ole.remove(g,!1),ole.conf.onblur()}break;case ActionConstants.IMAGE_CUT_PASTE:for(var c=0;i>c;c++){if(o[c][JSONConstants.SOURCE_SHEET_NAME]==CURRSHEETNAME){var g="img_"+o[c][CommandConstants.IMAGE_SOURCE_ID].toString();ole.remove(g,!1),ole.conf.onblur()}o[c][JSONConstants.SHEET_NAME]==CURRSHEETNAME&&r(o,a)}break;case ActionConstants.IMAGE_REPLACE:for(var c=0;i>c;c++){if(o[c][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var R=o[c][CommandConstants.IMAGE_URL],p=o[c][CommandConstants.IMAGE_NAME],m=parseInt(o[c][CommandConstants.IMAGE_ROW]),d=parseInt(o[c][CommandConstants.IMAGE_COLUMN]),E=parseInt(o[c][CommandConstants.IMAGE_ROW_DIFF]),C=parseInt(o[c][CommandConstants.IMAGE_COL_DIFF]),g="img_"+o[c][CommandConstants.IMAGE_ID].toString(),I=getRowTop(m)+E,u=getColLeft(d)+C,A=parseInt(o[c][CommandConstants.IMAGE_WIDTH]),_=parseInt(o[c][CommandConstants.IMAGE_HEIGHT]),f=ole(g);f.moveTo(u,I).resizeTo(A,_),t(g,f),n(f,u,I),a&&ole(g)._setSelectLayer(),-1!=R.indexOf("u_n=")&&(R=l(R)),document.getElementById(g).src=decodeURIComponent(R),document.getElementById(g).imgName=p}break;case ActionConstants.IMAGE_COPY_PASTE:case ActionConstants.IMAGE_NEW:case ActionConstants.IMAGE_CLONE:if(s){for(var c=0;i>c;c++){if(o[c][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var g="img_"+o[c][CommandConstants.IMAGE_ID].toString();ole.remove(g,!1),ole.conf.onblur()}break}default:r(o,a)}}var s={},r=function(e,t,n){var o=e.length,n=void 0==n?0:n;if(o>n){var a=o-n,s=1e3>a?o:n+1e3;i(e,t,n,s)}},i=function(e,t,n,o){for(var a=e,i=(a.length,n);o>i;i++){var c=a[i],m=c.sn;if(m!=CURRSHEETNAME)break;var d=c[CommandConstants.IMAGE_URL],C=c[CommandConstants.IMAGE_NAME],g=parseInt(c[CommandConstants.IMAGE_WIDTH]),I=parseInt(c[CommandConstants.IMAGE_HEIGHT]),u=c[CommandConstants.IMAGE_ID],f=parseInt(c[CommandConstants.IMAGE_ROW]),A=parseInt(c[CommandConstants.IMAGE_COLUMN]),_=parseInt(c[CommandConstants.IMAGE_ROW_DIFF]),R=parseInt(c[CommandConstants.IMAGE_COL_DIFF]),p=getRowTop(f)+_,M=getColLeft(A)+R,O=document.createElement("img");-1!=d.indexOf("u_n=")&&(d=l(d)),O.src=decodeURIComponent(d),O.id="img_"+u,O.name=C,O.height=I,O.width=g,O.className="img",O.objType="img",O.setAttribute("imgid",O.id);var h=p,S=M;O.style.top=h+"px",isRTL?(O.style.right=S+"px",O.style.left=""):(O.style.left=S+"px",O.style.right=""),O.style.position="absolute",sheetObjectsPane.appendChild(O),E(O.id),insertImgorChartIsFreezed(O,S,h),ole.init(O.id,h,S,I,g),ole(O.id).sCol=A,ole(O.id).sColDiff=R,ole(O.id).sRow=f,ole(O.id).sRowDiff=_,O.style.cursor="default",t&&ole(O.id)._setSelectLayer(),s[O.id]=O}setTimeout(function(){r(e,t,o)},1e3)},l=function(e){return e=ctxpath+e+"&doc="+REMOTE_ENC_DOC_ID},c=function(){var e=!1,t=!1,n=!1;switch(getViewType()){case"SHARE_VIEW":if(!ALLOW_TO_WRITE)break;case"NEW_VIEW":case"OPEN_VIEW":ALLOW_TO_WRITE&&(e=!0,t=!0);break;case"REMOTE_VIEW":e=!1,t=!1,n=!1;break;case"REMOTE_SAVE_VIEW":case"PUBLIC_VIEW":isReadOnlyViewMode||(e=!0,t=!0,n=!0)}ole.setObjectProperties("img",{permissions:{isDraggable:e,isResizable:t,isEditable:n}})},m=function(e){var t=e.indexOf("_");return e.substring(t+1,e.length)},d=function(e,t,o){var a=getObj(e);if(null!==a&&READ_WRITE){var s=a.id,r=(a.name,s.substring(4,s.length),a.getAttribute("imgid"),ole(s));n(r,t,o);var i={row:ole(s).sRow,column:ole(s).sCol,sRowDiff:Math.round(ole(s).sRowDiff),sColDiff:Math.round(ole(s).sColDiff),imgId:m(s)},l=[i],c=new RequestParameters(ActionConstants.IMAGE_MOVE);c.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(l));var d=new AjaxRequest;d.init("POST",c.getURL(),!0,c.getParametersAsString()),actionManager.addRequest(d)}},E=function(t){jsVERSION_VIEW||e("#"+t).bind("contextmenu",function(n){ole(t)._setSelectLayer().positionActionBar();var o=getCursorPos(n),a=o.x,s=o.y,r=createImageContextMenu(),i={target:e(this),position:[a,s],clearcache:!0};sheetMenu.showMenu("imageRMenu",r,i),ole.contextMenuStatus=!0,e("#imageRMenu").show(),browser_ie&&(n=window.event),stopEvent(n)})},C=function(e,t,o){var a=getObj(e);if(null!==a&&READ_WRITE){{var s=a.getAttribute("imgid"),r=ole(a.id),i=parseInt(a.style[isRTL?"right":"left"]),l=parseInt(a.style.top),c=findColInXPos(i),d=findRowInYPos(l);l-getRowTop(d),i-getColLeft(c)}n(r,i,l);var E={row:r.sRow,column:r.sCol,sRowDiff:Math.round(r.sRowDiff),sColDiff:Math.round(r.sColDiff),imgId:m(s),imgWd:parseInt(t),imgHt:parseInt(o)},C=[E],g=new RequestParameters(ActionConstants.IMAGE_RESIZE);g.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(C));var I=new AjaxRequest;I.init("POST",g.getURL(),!0,g.getParametersAsString()),actionManager.addRequest(I)}},g=function(){var e=ole.getCurrObj().el;if(null!==e&&READ_WRITE){var t=e.getAttribute("imgid"),n=e.width,o=e.height,a=ole(e.id),s=parseInt(e.style.left),r=parseInt(e.style.top),i=findColInXPos(s),l=findRowInYPos(r),c=(r-getRowTop(l),s-getColLeft(i),{row:a.sRow,column:a.sCol,sRowDiff:Math.round(a.sRowDiff),sColDiff:Math.round(a.sColDiff),imgId:m(t),imgWd:parseInt(n),imgHt:parseInt(o)}),d=[c],E=new RequestParameters(ActionConstants.IMAGE_REMOVE);E.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(d));var C=new AjaxRequest;C.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(C)}},I=function(e){var t=document.getElementById(e),n=ole.getCurrObj(),o=t.naturalHeight,a=t.naturalWidth;n.resizeTo(a,o)._setSelectLayer(!0),C(e,a,o)},u=function(e){if("undefined"!=typeof e){var t=document.getElementById(e),n=document.createElement("canvas");if("undefined"==typeof n.getContext||!n.getContext)return!1;var o=n.getContext("2d"),a=t.width,s=t.height;n.width=a,n.height=s,n.style.width=a+"px",n.style.height=s+"px",o.drawImage(t,0,0,a,s);var r=t.getAttribute("src"),i=document.createElement("a"),l=-1!=r.indexOf("u_n")?!1:!0;if(l)c=r;else{var c=n.toDataURL("image/png;base64");c=c.replace("image/png","image/octet-stream")}var i=document.createElement("a");i.href=c,i.download=t.name,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},f=function(e){if("undefined"!=typeof e){var t=ole.getCurrObj().type,n=getObj(e),o=(n.src,new RequestParameters(ActionConstants.IMAGE_SAVE));if("chart"==t){var a=chartOnLoad.getInstance(e).co.options.title.text;o.setParameters(e,t,encodeURIComponent("ChartDisplay.do"),encodeURIComponent(a),WorkSheets.getAssociatedActiveSheetName())}}try{isExportEvent=!0;var s=document.forms.utilFORM;s.method="post",s.action=o.getURL()+"?"+o.getParametersAsString(),s.zsreqcsr.value=readCookie(csrfCookieName),s.target="hid_imp_doc",getObj("utilFORMContainer").innerHTML="",s.submit()}catch(e){}},A=function(e){if(READ_WRITE){var t=getObj(e),n=parseInt(t.width)/2,o=parseInt(t.height)/2,a=parseInt(t.style.left)+n,s=parseInt(t.style.top)+o,r=findColInXPos(a),i=findRowInYPos(s),l=s-getRowTop(i),c=a-getColLeft(r),d=t.getAttribute("imgid"),E=new RequestParameters(ActionConstants.IMAGE_CLONE),C={row:i,column:r,sRowDiff:Math.round(l),sColDiff:Math.round(c),imgsid:m(d)},g=[C];E.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(g));var I=new AjaxRequest;I.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(I)}},_=function(){ole.getCurrObj()&&(getObj(ole.getCurrObj().id).style.background="")},R=function(e){var t=ole(e).el,n=t.width,o=t.height;C(t.id,n,o)},p=function(e){ImageDialog.showImageDialog(m(e))},M=function(){var t=[],n=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.width+10),o=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.height+10);allowExport&&(t.push({data:"{label:'"+jsMsg["Image.SaveImageAs"]+"', appData:{dynamic:true, callback: 'insertImage.saveImage', arg:'"+ole.getCurrObj().id+"'}}"}),t.push({mtype:"separator"})),t.push({data:"{label:'"+jsMsg.Clone+"', appData:{dynamic:true, callback: 'ole.currObj.clone', arg: '1,"+n+","+o+"'}}"}),t.push({data:"{label:'"+jsMsg.Delete+"', appData:{dynamic:true, callback: 'ole.remove', arg:'"+ole.getCurrObj().id+",true'}}"});var a={target:e("#image_actionBar_moreActions"),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("imgMoreMenu",t,a)},O=function(e){ole(e).hideContextMenu()},h=function(e){var t=document.forms.frmUpload;"image_url"==e?(t.xfile.disabled=!0,t.urlfile.disabled=!1,t.image.checked=!1,getObj("loadtypeinput").style.display=""):"image"==e&&(t.urlfile.disabled=!0,t.xfile.disabled=!1,t.image_url.checked=!1,getObj("loadtypeinput").style.display="none")};return ole.createObjectProperties("img",{focusLayer:"OLEFocusLayer",selectLayer:"OLESelectLayer",minHeight:10,minWidth:10,hasOrdering:!1,contextMenu:"ImageConetextMenu",cloneOnCTRLDrag:!0,resizeCorners:"all",resizeCornersBehaviour:"Proportional",onResizeStart:h,onResizeEnd:C,onDragEnd:d,onRemove:g,onObjectSwitch:O,onEditLayerClick:appEvent.trigger("insertImageSelection"),onClone:A,onMove:O,onMoveEnd:d,onDeselect:_,onDocOpen:O,onSync:R,onMouseDownOutsideOLEElements:O}),appEvent.on("documentLoad",function(){c()}),appEvent.on("RTC",function(e,t){e[ActionConstants.UPDATE_IMAGE]&&a(e.a,e[ActionConstants.UPDATE_IMAGE],t,e.fromundo)}),{resizeToOriginalDim:I,saveImage:f,showMoreActionsMenu:M,image_check:h,updateImageJson:a,onClone:A,loadSheetImages:o,downloadImage:u,replaceImage:p}}(jQuery);
function initZohoDBService(){setZohoDBServiceDim()}function setZohoDBServiceDim(){if(browser_ie)var e=(document.body.clientWidth,document.body.clientHeight);else if(browser_nn4||browser_nn6)var e=(window.innerWidth,window.innerHeight);var i=e-findPosY(getObj("sheetdiv"))-getObj("bottomBand").offsetHeight;getObj("sheetdiv").style.height=i+"px"}function resetZohoDBServiceDim(){setZohoDBServiceDim()}var isZohoDBServiceOn;
function disableSaveButton(){isSaveButtonEnabled=!1,0==SAVED&&(btn_disabled(),isSaveButtonEnabled=!0)}function enableSaveButton(){(1==isSaveButtonEnabled||MACRO_DOC_SAVED&&!MACROSAVED)&&(READ_WRITE&&btn_enabled(),isSaveButtonEnabled=!1)}function closeScriptDialog(){ISMACROEDITOROPEN=!1,sheetdialog.allowToClose=!0,editAreaLoader.delete_instance("macrotextid"),enableSaveButton()}function closeEditorDialog(){if(ISMINDLG&&(dynele.style.display="none"),!MACRO_DOC_SAVED&&!jsVERSION_VIEW&&!jsPUBLIC_VIEW&&!jsGUEST_VIEW&&ALLOW_TO_WRITE){var e=showConfirmDialog(jsMsg.DoYouWantToSaveChanges);e?saveMacro():MACROSAVED=!0}clearErrorAndMsg(),MacroPanelState.tabs="",MACRO_DOC_SAVED=!0,ISMINDLG=!1,sheetdialog.close()}function showMacroEditorDialog(e,t,a,r){if(!jsPUBLIC_VIEW||READ_WRITE){VBAEDITORMODULENAME="",VBAEDITORLINENO="",VBAEDITORMODULETYPE="",VBAEDITORSHOW="";var n=getObj("macroPanel");if(n&&"none"!=n.style.display)return void hideMacroRecordPanel(function(){if(e){var r=t?t:"";showMacroEditorDialog(e,r,a)}else showMacroEditorDialog()});var o=findDocDim(),i=o.width-300;950>i&&(i=950);var s=(o.width-i)/2;if("undefined"!=typeof r&&""!=r?(MacroPanelState.tabs=r,MacroPanelState.lineNo=t):MacroPanelState.lineNo="",!ISMINDLG&&!ISMACROEDITOROPEN||ISMACRODOCCHANGE){if(sheetdialog.close(),ISMINDLG&&(dynele.style.display="none"),currentMdl={},ISMACRODOCCHANGE=!1,MacroPanelState.tabs=closetabs,callback_load="loadAllMacro",!isUndefined(t)&&null!=t&&""!=t&&isNaN(t))var l=t;else var d=t;var c=getCurrentSelectionRange(),m=new RequestParameters(ActionConstants.JSP_MACROEDITOR);m.setParameters(WorkSheets.getAssociatedActiveSheetName(),c.startRow,c.startCol,c.endRow,c.endCol,i,e,d,l,getViewType());var g=new AjaxRequest;g.init("POST",m.getURL(),!0,m.getParametersAsString()),g.addEventListener("onComplete",function(e){dlghtml=e.responseText,showDialog(dlghtml,"position=absolute,left="+s+",top=35, modal=yes, closeOnEscKey=no, closeButton=no, width="+i+" ,height="+(o.height-70),initEditArea,closeScriptDialog)}),g.sendRequest()}else ISMINDLG&&(dynele.style.display="none"),ISMACROEDITOROPEN?(toggleEditor(),"undefined"!=typeof e&&""!=e&&loadMacro(e,a,t)):(callback_load="loadOldMacro","undefined"!=typeof e&&""!=e&&(currentMdl.PREVIOUS=currentMdl.CURRENT,currentMdl.CURRENT=e,currentMdl.CTYPE=a,currentMdl.LINE=t,currentMdl.CURLINE=null),null!=macrodialog&&(dlghtml=UTIL.DOM.getOuterHTML(macrodialog)+UTIL.DOM.getOuterHTML(runMacroList),macrodialog=null),showDialog(dlghtml,"position=absolute,left="+s+",top=35, modal=yes, closeOnEscKey=no, closeButton=no, width="+i+" ,height="+(o.height-70),initEditArea,closeScriptDialog));ISMINDLG=!1,ISMACROEDITOROPEN=!0}}function runCodeMacro(e,t,a){if("true"!=getObj("run_td").getAttribute("iconDisabled")&&(t!=ActionConstants.MACRO_SAVE_RUN||!(jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW))){disableError(),disableMessage();var r=getObj("busydiv");r&&(r.innerHTML=jsMsg.Running+"...",r.style.display="");var n=(window.frames.frame_macrotextid.editArea,getModuleContent());checkMacroTriggerObj.isMacroTrigger=!0;var o=getCurrentSelectionRange(),i=new RequestParameters(t);i.setParameters(WorkSheets.getAssociatedActiveSheetName(),o.startRow,o.startCol,o.endRow,o.endCol,e,null,a,n);var s=new AjaxRequest;s.init("POST",i.getURL(),!0,i.getParametersAsString()),s.addEventListener("onComplete",callBack_runCodeMacro,t),enableSaveButtonForMacro&&READ_WRITE&&!ISMACROEDITOROPEN?(btn_enabled(),enableSaveButtonForMacro=!1):t!=ActionConstants.MACRO_SAVE_RUN||enableSaveButtonForMacro||btn_disabled(),s.sendRequest()}}function runmacro(e,t,a,r,n,o,i,s,l){if(ISMACROEDITOROPEN||sheetdialog.close(),!isSheetBasedShare||"true"==a.toString()){disableError(),disableMessage();var d,c=getObj("busydiv");if(c?(c.style.display="",l?(Button.visualiseMacroExecution(arguments[2]),d=arguments[2],arguments[2]=void 0):c.innerHTML=jsMsg.Running+" - '"+ZSEC.Encoder.encodeForHTML(t)+"'"):l?(Button.visualiseMacroExecution(arguments[2]),d=arguments[2],arguments[2]=void 0):showProgressMessage(jsMsg.Running+" - '"+t+"'"),"undefined"==typeof a)a=!1;else if(r===ActionConstants.MACRO_RUN||r===ActionConstants.MACRO_SAVE_RUN){var m=replaceParams(jsMsg.UserhasModifiedTheModule,new Array(escapeSpecialCharacters(n),escapeSpecialCharacters(t)));SheetNotifier.open({type:"PopUp",content:m})}"undefined"==typeof r&&(r=ActionConstants.MACRO_RUN);var g=!0,u=getObj("MacroList");null!=u&&"none"!=u.style.display&&(closeMacroList(),g=!1);var M;M=i?i:getCurrentSelection(),"undefined"==typeof s&&(s=CURRSHEETNAME);var b=getCurrentSelectionRange();if(s=WorkSheets.getSheetCodeFromName(s),void 0!=s){var f=new RequestParameters(r);f.setParameters(s,b.startRow,b.startCol,b.endRow,b.endCol,e,t);var E=new AjaxRequest;E.init("POST",f.getURL(),!0,f.getParametersAsString()),g||E.addEventListener("onBeforeSend",function(){if(!ISMINDLG&&ISMACROEDITOROPEN){var e=window.frames.frame_macrotextid.editArea,t=editAreaLoader.getSelectionRange("macrotextid");e.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",t.start,t.end)}}),E.addEventListener("onComplete",callBack_runMacro,l,g,s,d),checkMacroTriggerObj.isMacroTrigger=!0,E.sendRequest()}}}function loadMacro(e,t,a){var r,n=window.frames.frame_macrotextid.editArea;"undefined"!=typeof currentMdl.PREVIOUS&&""!=currentMdl.PREVIOUS?(r=getObj("tr_"+currentMdl.PREVIOUS),currentMdl.PREVIOUS=""):"undefined"!=typeof currentMdl.CURRENT&&(r=getObj("tr_"+currentMdl.CURRENT)),r&&(r.cells[r.cells.length-1].getElementsByTagName("A")[0].className=""),clearModuleHiglight(),1==errorObj.ISERROR&&(enableError(),"undefined"!=typeof errorObj.MODULENAME&&""!=errorObj.MODULENAME&&"unknown"!=errorObj.MODULENAME&&(errorObj.MODULENAME==e?showMacroError():disableError())),currentMdl.CURRENT=e;var o=getObj("tr_"+e);if(null!=o){o.cells[o.cells.length-1].getElementsByTagName("A")[0].className="scriptExplrSeletedObject"}currentMdl.CTYPE=t,n.execCommand("switch_to_file",e),getObj("modulename").innerHTML=ZSEC.Encoder.encodeForHTML(e),jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW||!ALLOW_TO_WRITE||(5==t?(getObj("events").style.display="none",getObj("arrow").style.display="none"):(getObj("arrow").style.display="",getObj("events").style.display=""),1==t?(getObj("sheetevents").style.display="",getObj("workbookevents").style.display="none"):2==t&&(getObj("sheetevents").style.display="none",getObj("workbookevents").style.display=""),"undefined"!=typeof a&&n.execCommand("go_to_line",a))}function saveMacro(){if(!(jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW||MACROSAVED)&&ALLOW_TO_WRITE){var e=DOCUMENT_NAME;if(""!=e&&null!=e){var t;if(window.frames.frame_macrotextid&&(t=window.frames.frame_macrotextid.editArea,null!=t.textarea&&"undefined"!=typeof t.textarea)){var a=editAreaLoader.getSelectionRange("macrotextid");t.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",a.start,a.end)}var r=getModuleContent(),n=getObj("busydiv");n&&(n.innerHTML=jsMsg.Saving,n.style.display="");var o=new RequestParameters(ActionConstants.MACRO_SAVE);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),r);var i=new AjaxRequest;i.init("POST",o.getURL(),!0,o.getParametersAsString()),checkMacroTriggerObj.isMacroTrigger=!0,i.sendRequest()}}}function prepare(e){if(window.frames.frame_macrotextid){var t=window.frames.frame_macrotextid.editArea;if(null!=t.textarea&&"undefined"!=typeof t.textarea){var a=editAreaLoader.getSelectionRange("macrotextid");t.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",a.start,a.end);var r=editAreaLoader.getCurrentFile("macrotextid").id;runCodeMacro(r,e,t.get_selection_infos().line_start)}}}function closeMacroList(){getObj("RunMacroList").style.display="none",ISMACROEDITOROPEN||sheetdialog.close()}function deleteMacro(e,t,a){if("undefined"==typeof a&&(a=!1),0==a)var r=showConfirmDialog(replaceParams(jsMsg.AreYouSureToDeleteMacro,new Array(t)));if(1==r||1==a){var n=new RequestParameters(ActionConstants.MACRO_DELETE);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t);var o=new AjaxRequest;o.init("POST",n.getURL(),!0,n.getParametersAsString()),checkMacroTriggerObj.isMacroTrigger=!0,o.sendRequest()}}function sheetEvent(e){var t="\n";is_ie&&(t="\r\n");var a=e.options[e.selectedIndex].value;if("none"!=a){var r,n=editAreaLoader.getCurrentFile("macrotextid").text,o=new RegExp("Sub\\s+"+a,"i"),i=o.exec(n);if(null!=i)r=n.indexOf("\n",i.index)+1;else{var s="",l="";"\n"!=n.charAt(n.length-1)&&(s=t),s+=e[e.selectedIndex].getAttribute("param"),"Worksheet_Change"==a?(s+=t+"Application.EnableEvents = false",s+=t+"On Error Goto ENEV",s+=t+"REM add your code below",s+=t,l+=t+"ENEV:",l+=t+"Application.EnableEvents = true"):l+=t,l+=t+"End Sub"+t,window.frames.frame_macrotextid.editArea.textarea.value+=s+l,n=window.frames.frame_macrotextid.editArea.textarea.value,r=n.length-l.length}window.frames.frame_macrotextid.editArea.area_select(r,0),e.selectedIndex=0,MacroBtn_enabled()}}function initEditArea(){sheetdialog.allowToClose=!1;var e=getObj("mdlcontDIV");e.style.display="",null==macrodialog&&(macrodialog=e.cloneNode(!0));var t=e.getElementsByTagName("IFRAME")[0];null!=t&&t.parentNode.removeChild(t);var a=(findDocDim(),getObj("macroBrowser")),r=getObj("macrotextid"),n=e.offsetHeight,o=5;a&&(is_ie?a.style.height=getObj("objbrowser").offsetHeight+"px":(a.style.height=getObj("objbrowser").offsetHeight-o+"px",r.style.display="none")),r.style.height="100%",MACROSAVED&&macroBtn_disabled(),editAreaLoader.init({id:"macrotextid",syntax:"vb",start_highlight:!0,allow_resize:"no",allow_toggle:!1,font_size:10,font_family:"monospace",max_undo:20,EA_load_callback:callback_load,height:n,replace_tab_by_spaces:4})}function deleteMacroRow(e,t){var a=getObj(e+"."+t);if(a){var r=a.parentNode;if(r.removeChild(a),isSaveButtonEnabled=!0,"undefined"!=typeof r.rows&&1==r.rows.length){var n=getObj("nomacrotr");n.style.display=""}}}function toggleEditor(){if(!RECORDINGMACRO)if(ISMINDLG)ISMACROEDITOROPEN?ISMACRODOCCHANGE?(closeEditorDialog(),showMacroEditorDialog()):(ISMINDLG=!1,recallDialog(),window.frames.frame_macrotextid.editArea.textarea.focus(),"undefined"!=typeof currentMdl.CURLINE&&null!=currentMdl.CURLINE&&("undefined"!=typeof currentMdl.CURLINE.start?editAreaLoader.setSelectionRange("macrotextid",currentMdl.CURLINE.start,currentMdl.CURLINE.end):window.frames.frame_macrotextid.editArea.execCommand("go_to_line",currentMdl.CURLINE)),MACROSAVED&&macroBtn_disabled()):showMacroEditorDialog(),dynele.style.display="none";else{ISMINDLG=!0;var e=getObj("mdlcontDIV");for(null!=e&&(macrodialog=e.cloneNode(!0),runMacroList=getObj("RunMacroList").cloneNode(!0)),ISMACROEDITOROPEN=!0,currentMdl.CURLINE=editAreaLoader.getSelectionRange("macrotextid"),i=0;i<mdlnames.length;i++)module_content[i]=editAreaLoader.getFile("macrotextid",mdlnames[i]).text;var t=getObj("titlebar");t&&(minbarhtml=getObj("minimizediv").innerHTML,""==minbarhtml&&(minbarhtml='<table width="100%" height="25" border="0" cellspacing="0" cellpadding="0" class="scriptEditorDialog">',minbarhtml+='<tr><td class="scriptEditorDialogTitleBar">'+t.innerHTML+"</td></tr></table>"),document.getElementsByTagName("body")[0].appendChild(dynele),dynele.id="mindlg",dynele.innerHTML=getObj("minimizediv").innerHTML,dynele.style.position="absolute",dynele.style.zIndex="1001",dynele.style.left=findPosX(t)+"px",dynele.style.top=findPosY(t)+"px",dynele.style.display="",dynele.style.height="25px",dynele.style.width="150px"),minimizedlg(),sheetdialog.close(),hideDialog(),ole.isActive()?ole.conf.onfocus():setFocusInCellField()}}function minimizedlg(){$("#mindlg").animate({top:"0px"},500)}function showInsertMethod(){closeAllPopup(),$("#insertdiv").show(),$("#insertdiv").css({width:"23.5%",top:"20%",left:"40%"});var e=getObj("functionname");e.value="",e.focus()}function insertMethod(){var e="\n";is_ie&&(e="\r\n");var t=document.forms.insertform.functionname.value;if(t=t.trim(),0==t.length)return showAlertDialog(jsMsg.ProcedureNameCannotBeEmpty),document.forms.insertform.functionname.focus(),!1;var a=checkMacroName(t);if(a>0)return showAlertDialog(1==a?jsMsg.ProcedureNameCannotContainMsg:2==a?jsMsg.ProcedureNameStartWithMsg:jsMsg.ProcedureNameInEnglish),document.forms.insertform.functionname.select(),!1;getObj("insertdiv").style.display="none";var r=window.frames.frame_macrotextid.editArea.textarea.value,n="";"\n"!=r.charAt(r.length-1)&&(n=e),n+=document.forms.insertform.insertscope.value+" "+document.forms.insertform.methodtype.value+" "+t+"()"+e;var o=e+"End "+document.forms.insertform.methodtype.value+e;window.frames.frame_macrotextid.editArea.textarea.value+=n+o,r=window.frames.frame_macrotextid.editArea.textarea.value;var i=r.length-o.length;return window.frames.frame_macrotextid.editArea.area_select(i,0),MacroBtn_enabled(),window.frames.frame_macrotextid.editArea.execCommand("check_undo",!0),!1}function closeInsertDiv(){getObj("insertdiv").style.display="none",window.frames.frame_macrotextid.editArea.textarea.focus()}function setScope(e){document.forms.insertform.insertscope.value=e.value}function editor_undo(){window.frames.frame_macrotextid.editArea.execCommand("undo")}function editor_redo(){window.frames.frame_macrotextid.editArea.execCommand("redo")}function editor_find(){window.frames.frame_macrotextid.editArea.execCommand("show_search")}function editor_goto(){var e=parseInt($("#lineNo").text());if(isNaN(e)){var t=getObj("lineNo"),e=t.value;if(isNaN(e)||""===e)return showAlertDialog(jsMsg.PleaseEnterAnInteger),setTimeout(function(){$(".ui-dialog").filter(":visible").zIndex(100002)},200),$("#lineNo").select(),!1}return closeGotoDiv(),window.frames.frame_macrotextid.editArea.execCommand("go_to_line",e+""),!1}function closeGotoDiv(){$("#lineNo").text(""),getObj("gotodiv").style.display="none",window.frames.frame_macrotextid.editArea.textarea.focus()}function showGoto(){$("#gotodiv").css({position:"absolute",left:"45%",top:"30%"}),$("#gotodiv").show(),$("#lineNo").focus(),$("#lineNo").select()}function expandObjectExplorer(e){var t,a=getObj(e),r=a.parentNode,n=a.getAttribute("expand"),o=o=r.rows.length;if("ObjectExplore"==e?(t=1,0!=custommdlcnt&&(o=o-custommdlcnt-1)):t=r.rows.length-custommdlcnt,"true"==n){for(var i=t;o>i;i++)r.rows[i].style.display="";a.setAttribute("expand","false"),a.cells[0].getElementsByTagName("img")[0].className="mainBgImg macroItemCol",a.cells[1].getElementsByTagName("IMG")[0].className="ObjectExplore"==e?"mainBgImg scriptExplrObjectOpenFolder":"mainBgImg scriptExplrModuleOpenFolder"}else{for(var i=t;o>i;i++)r.rows[i].style.display="none";a.setAttribute("expand","true"),a.cells[0].getElementsByTagName("img")[0].className="mainBgImg macroItemExp",a.cells[1].getElementsByTagName("IMG")[0].className="ObjectExplore"==e?"mainBgImg scriptExplrObjectFolder":"mainBgImg scriptExplrModuleFolder"}}function macroBtn_disabled(){if(MACROSAVED=!0,MACRO_DOC_SAVED=!0,null!=getObj("save_img")&&null!=getObj("save_td")){getObj("save_img").src=IMAGE_PATH+"save_disabled.png","false"==getObj("saverun_td").getAttribute("iconDisabled")&&(getObj("saverun_img").src=IMAGE_PATH+"saveRun_disabled.png"),getObj("save_td").setAttribute("displayState","disabled");var e=getIconText(getObj("save_td"));""!=e&&(e.className="disabled")}(jsREMOTE_SAVE_VIEW||isEdit)&&null!=getObj("save_img")&&(getObj("save_img").src=IMAGE_PATH+"save_disabled.png")}function MacroBtn_enabled(){if(MACROSAVED){if(null!=getObj("save_img")&&null!=getObj("save_td")){getObj("save_img").src=IMAGE_PATH+"save.png","false"==getObj("saverun_td").getAttribute("iconDisabled")&&(getObj("saverun_img").src=IMAGE_PATH+"saveRun.png"),getObj("save_td").setAttribute("displayState","enabled");var e=getIconText(getObj("save_td"));""!=e&&(e.className="")}(jsREMOTE_SAVE_VIEW||isEdit)&&null!=getObj("save_img")&&(getObj("save_img").src=IMAGE_PATH+"save.png")}MACROSAVED=!1,MACRO_DOC_SAVED=!1}function loadOldMacro(){jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW||!ALLOW_TO_WRITE||disableRun();var e=MacroPanelState.tabs;(is_ie&&browser_ie6||!is_ie)&&(document.getElementById("frame_macrotextid").style.width="100%");var t=getObj("scriptEditorToolbar");if(registerIconEvents(t.getElementsByTagName("TD")),0==MacroPanelState.explorer){var a=getObj("objbrowser");a.style.display="",hideObjectExplorer()}for(var r=0;r<mdlnames.length;r++){var n={id:mdlnames[r],text:module_content[r],syntax:"vb"};editAreaLoader.openFile("macrotextid",n)}if(0!=sheetOperations.length){for(var o in sheetOperations)"undefined"!=typeof sheetOperations[o].a&&updateSheetChangesInEditor(sheetOperations[o]);sheetOperations=[]}handleMacroErrorAndMsg(errorObj,null,!0),"undefined"!=typeof e&&""!=e&&(window[e],""!=MacroPanelState.lineNo&&window.frames.frame_macrotextid.editArea.execCommand("go_to_line",MacroPanelState.lineNo)),"undefined"!=typeof currentMdl.CURRENT&&null!=currentMdl.CURRENT?"undefined"!=typeof currentMdl.CURLINE&&null!=currentMdl.CURLINE?(loadMacro(currentMdl.CURRENT,currentMdl.CTYPE),window.frames.frame_macrotextid.editArea.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",currentMdl.CURLINE.start,currentMdl.CURLINE.end)):loadMacro(currentMdl.CURRENT,currentMdl.CTYPE,currentMdl.LINE):loadMacro("Macros",5)}function updateSheetOperations(e){sheetOperations.push(e)}function getModuleIndex(e){var t;for(t=0;t<mdlnames.length;t++)if(mdlnames[t]==e)return t;return null}function showObjectExplorer(){getObj("frame_macrotextid").style.width="1px";var e=getObj("hideimg"),t=getObj("expandimg"),a=getObj("objbrowser");MacroPanelState.explorer=!0,t.style.display="none",a.style.display="",e.style.display="",e.parentNode.parentNode.className="scriptObjExporerShow",window.frames.frame_macrotextid.editArea.manage_width()}function hideObjectExplorer(){var e=getObj("objbrowser");if("none"==e.style.display)return void showObjectExplorer();var t=getObj("hideimg"),a=getObj("expandimg");a.style.display="",e.style.display="none",t.style.display="none",t.parentNode.parentNode.className="scriptObjExporerHide",MacroPanelState.explorer=!1,window.frames.frame_macrotextid.editArea.manage_width()}function closetabs(){MacroPanelState.tabs="",window.frames.frame_macrotextid.editArea.execCommand("hidden_tabs")}function showWarning(){var e=getObj("warningtd");e&&(window.frames.frame_macrotextid.editArea.execCommand("show_tabs","warningtab"),MacroPanelState.tabs=showWarning)}function enableWarning(){var e=getObj("warningtd");e&&(e.setAttribute("displayState","enabled"),window.frames.frame_macrotextid.editArea.execCommand("close_empty","warn"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+".png",e.title=replaceParams(jsMsg.nWarning,new Array("1")),showWarning())}function disableWarning(){var e=getObj("warningtd");e&&(e.setAttribute("displayState","disabled"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+"_disabled.png",window.frames.frame_macrotextid.editArea.execCommand("show_empty","warn"),e.title=jsMsg.ZeroWarnings)}function enableError(){var e=getObj("errortd");e&&(e.setAttribute("displayState","enabled"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+".png",window.frames.frame_macrotextid.editArea.execCommand("close_empty","error"),e.title=replaceParams(jsMsg.nError,new Array("1")))}function showMacroError(){var e=getObj("errortd");e&&(window.frames.frame_macrotextid.editArea.execCommand("show_tabs","errortab"),MacroPanelState.tabs=showMacroError)}function disableError(){var e=getObj("errortd");e&&(e.setAttribute("displayState","disabled"),window.frames.frame_macrotextid.editArea.execCommand("show_empty","error"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+"_disabled.png",e.title=jsMsg.ZeroErrors)}function showMessage(){var e=getObj("msgboxtd");e&&(window.frames.frame_macrotextid.editArea.execCommand("show_tabs","msgboxtab"),MacroPanelState.tabs=showMessage)}function enableMessage(){var e=getObj("msgboxtd");e&&(e.setAttribute("displayState","enabled"),window.frames.frame_macrotextid.editArea.execCommand("close_empty","msg"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+".png",e.title=1==errorObj.MSGCNT?replaceParams(jsMsg.nMessage,new Array(""+errorObj.MSGCNT)):replaceParams(jsMsg.nMessages,new Array(""+errorObj.MSGCNT)))}function disableMessage(){var e=getObj("msgboxtd");e&&(e.setAttribute("displayState","disabled"),window.frames.frame_macrotextid.editArea.execCommand("show_empty","msg"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+"_disabled.png",e.title=jsMsg.ZeroMessages)}function enableEvents(){var e=getObj("busydiv");e.innerHTML=jsMsg.EnableEvents,e.style.display="";var t=new RequestParameters(ActionConstants.ENABLE_EVENTS),a=new AjaxRequest;a.init("POST",t.getURL(),!0,t.getParametersAsString()),a.addEventListener("onComplete",callBack_enableEvents),checkMacroTriggerObj.isMacroTrigger=!0,a.sendRequest()}function showMsgBox(e){var t=getObj("msgboxtr");"none"==t.style.display?(t.style.display="",document.getElementById("msgBoxInd").style.paddingBottom="10px",e.value=jsMsg.HideMessages):(t.style.display="none",e.value=jsMsg.ShowMessages)}function insertMessage(e){"undefined"==typeof errorObj.MSGCNT?errorObj.MSGCNT=1:errorObj.MSGCNT++,!ISMINDLG&&ISMACROEDITOROPEN&&window.frames.frame_macrotextid.editArea.execCommand("insert_msg",e)}function clearMessage(){"undefined"!=typeof errorObj.MSGCNT&&(errorObj.MSGCNT=0),!ISMINDLG&&ISMACROEDITOROPEN&&window.frames.frame_macrotextid.editArea.execCommand("clear_msg")}function insertError(e){!ISMINDLG&&ISMACROEDITOROPEN&&window.frames.frame_macrotextid.editArea.execCommand("insert_error",e)}function higlightModule(e){clearModuleHiglight(),e.className="scriptExplrSeletedObject","true"==e.parentNode.parentNode.getAttribute("expand")&&expandObjectExplorer(e.parentNode.parentNode.id);var t=getObj("tr_"+currentMdl.CURRENT);t&&(t.cells[t.cells.length-1].getElementsByTagName("A")[0].className="scriptExplrPrevSeletedObject")}function clearModuleHiglight(){var e=getObj("ObjectExplore"),t=getObj("ModuleExplore");e&&(e.cells[e.cells.length-1].getElementsByTagName("A")[0].className=""),t&&(t.cells[t.cells.length-1].getElementsByTagName("A")[0].className="")}function checkMacroName(e){var t=new RegExp("[\\u00A1-\\uFFFF]+");if(t.test(e))return 3;if(t=new RegExp("^[a-zA-Z0-9_]+$"),t.test(e)){var t=new RegExp("^[a-zA-Z][a-zA-Z0-9_]*$");return t.test(e)?0:2}return 1}function closeAllPopup(){getObj("RunMacroList").style.display="none",getObj("insertdiv").style.display="none",getObj("gotodiv").style.display="none"}function cancelError(){clearErrorAndMsg(),sheetdialog.close()}function clearErrorAndMsg(){errorObj={},"undefined"!=typeof msgboxArray&&(msgboxArray=[]),errorObj.ISERROR=!1}function showHelpMenu(){var e=[];HIDE_MACRO_HELP_LINK?e.push({data:"{label:'"+jsMsg.VBAObjectExplorer+"', appData:{dynamic:true, callback: 'showHelp', arg:'vbaobjectexplorer.do'}}"}):(e.push({data:"{label:'"+jsMsg.VBAProgramming+"', appData:{dynamic:true, callback: 'showHelp'}}"}),e.push({data:"{label:'"+jsMsg.VBAObjectExplorer+"', appData:{dynamic:true, callback: 'showHelp', arg:'vbaobjectexplorer.do'}}"}),e.push({mtype:"separator"}),e.push({data:"{label:'"+jsMsg.WhatIsMacro+"', appData:{dynamic:true, callback: 'showHelp'}}"}),e.push({data:"{label:'"+jsMsg.SampleMacros+"', appData:{dynamic:true, callback: 'showHelp', arg:'SampleMacros'}}"}),e.push({data:"{label:'"+jsMsg.UserContributedMacros+"', appData:{dynamic:true, callback: 'showHelp', arg:'UserMacros'}}"}));var t={target:$("#macro_help"),clearcache:!1,menuoptions:{type:"text_only"}};sheetMenu.showMenu("vbaeditorHelpMenu",e,t),$("#vbaeditorHelpMenu").css("z-index","999999")}function showHelp(e){var t;t="undefined"!=typeof e?"SampleMacros"==e?jsMsg["Macros.Help.WikiURL"]+"Sample-Macros.html":"UserMacros"==e?jsMsg["Macros.Help.WikiURL"]+"User-Contributed-Macros.html":ctxpath+e:jsMsg["Macros.Help.WikiURL"],window.open(t)}function disableRun(){var e=getObj("run_td");if(null!==e)if(isSSActive){e.setAttribute("iconDisabled","false"),e.getElementsByTagName("IMG")[0].className="runMacro",getObj("saverun_td").setAttribute("iconDisabled","false"),getObj("saverun_img").src=MACROSAVED?IMAGE_PATH+"saveRun_disabled.png":IMAGE_PATH+"saveRun.png";var t=getIconText(getObj("saverun_td"));""!=t&&(t.className=""),t=getIconText(getObj("run_td")),""!=t&&(t.className="")}else{e.setAttribute("iconDisabled","true"),e.getElementsByTagName("IMG")[0].className="runMacroDisabled",getObj("saverun_td").setAttribute("iconDisabled","true"),getObj("saverun_img").src=IMAGE_PATH+"saveAndRunDisabled.png";var t=getIconText(getObj("saverun_td"));""!=t&&(t.className="disabled"),t=getIconText(getObj("run_td")),""!=t&&(t.className="disabled")}}function callBack_runCodeMacro(e,t){var a=e.responseText;checkMacroTriggerObj.isMacroTrigger=!1,t==ActionConstants.MACRO_SAVE_RUN?(macroBtn_disabled(),isSaveButtonEnabled=!1):(MACRO_DOC_SAVED=!0,isSaveButtonEnabled=!0);var r=getObj("busydiv");if(r.style.display="none",a.trim().length>0){var n=parseJSON(a);t==ActionConstants.MACRO_SAVE_RUN&&"doc_id"==DOCUMENT_ID&&(getObj("docNameSpan").innerHTML=ZSEC.Encoder.encodeForHTML(docname)),"undefined"!=typeof n.MACROTABLE?"NOMACROS"==n.MACROTABLE?(disableError(),disableMessage(),showAlertDialog(jsMsg.NoMacrosFound)):(closeAllPopup(),updateMacros(n),getObj("RunMacroList").style.display=""):updateJson(n)}}function callBack_runMacro(e,t,a,r,n){checkMacroTriggerObj.isMacroTrigger=!1;var o=getObj("RunMacroList");t&&(Button.removeVisuals(n),n=void 0),o&&(o.style.display="none");enableSaveButtonForMacro&&READ_WRITE&&(btn_enabled(),enableSaveButtonForMacro=!1);var i=getObj("busydiv");i?(i.style.display="none",setTimeout(function(){i.innerHTML="Updating"},5)):t||hideProgressMessage()}function callBack_saveMacro(e){checkMacroTriggerObj.isMacroTrigger=!1,macroBtn_disabled(),isSaveButtonEnabled=!1,!enableSaveButtonForMacro&&READ_WRITE&&btn_disabled();var t=getObj("busydiv");t&&(t.style.display="none");if(ISMACROEDITOROPEN){var a=window.frames.frame_macrotextid.editArea;for(i=0;i<mdlnames.length;i++)a.files[mdlnames[i]].compare_edited_text=editAreaLoader.getFile("macrotextid",mdlnames[i]).text}}function callBack_deleteMacro(e){if(checkMacroTriggerObj.isMacroTrigger=!1,enableSaveButtonForMacro&&READ_WRITE&&(btn_enabled(),enableSaveButtonForMacro=!1),deleteMacroRow(e.modN,e.macN),ISMINDLG&&!ISMACROEDITOROPEN){var t=getModuleIndex(e.modN);module_content[t]=e.mc}}function callBack_enableEvents(){checkMacroTriggerObj.isMacroTrigger=!1,enableSaveButtonForMacro&&READ_WRITE&&(btn_enabled(),enableSaveButtonForMacro=!1);var e=getObj("busydiv");e.style.display="none",disableWarning()}function pullMacroContent(e,t){var a=new RequestParameters(ActionConstants.MACRO_CONTENT_CHANGED);a.setParameters(JSON.stringify(e),t);var r=new AjaxRequest;r.init("POST",a.getURL(),!0,a.getParametersAsString()),r.addEventListener("onComplete",updateMacroContent),r.sendRequest()}function updateMacroContent(e){for(var t=parseJSON(e.responseText),a=t.mc,r=a.length,n=0;r>n;n++)if(ISMINDLG){var o=getModuleIndex(a[n].n);if(null!=o&&(module_content[o]=a[n].c),ISMACROEDITOROPEN){var i=window.frames.frame_macrotextid.editArea;editAreaLoader.getFile("macrotextid",a[n].n).text=a[n].c,i.files[a[n].n].compare_edited_text=a[n].c,a[n].n==editAreaLoader.getCurrentFile("macrotextid").id&&(i.textarea.value=a[n].c)}}else if(ISMACROEDITOROPEN){var i=window.frames.frame_macrotextid.editArea;if(editAreaLoader.getFile("macrotextid",a[n].n).text=a[n].c,i.files[a[n].n].compare_edited_text=a[n].c,a[n].n==editAreaLoader.getCurrentFile("macrotextid").id){i.textarea.value=a[n].c;var s=showConfirmDialog(replaceParams(jsMsg.UserhasModifiedTheModule,new Array(t.ao,a[n].n))+"\n"+jsMsg.DoYouWantToReloadIt);if(s){var l=editAreaLoader.getSelectionRange("macrotextid");i.textarea.focus(),i.display_file(editAreaLoader.getCurrentFile("macrotextid").id),editAreaLoader.setSelectionRange("macrotextid",l.start,l.end)}}}}function viewSheetCode(){showMacroEditorDialog(currSheetOnRightClick,1,1)}function getModuleContent(){var e,t=[],a=!1;if(!MACRO_DOC_SAVED)if(ISMACROEDITOROPEN)for(e=0;e<mdlnames.length;e++){var r=editAreaLoader.getFile("macrotextid",mdlnames[e]).text,n=window.frames.frame_macrotextid.editArea;if(n.files[mdlnames[e]].compare_edited_text!=r){var o={};o.mname=mdlnames[e],o.mcontent=encodeURIComponent(r),t.push(o),a=!0}}else for(e=0;e<mdlnames.length;e++){var o={};o.mname=mdlnames[e],o.mcontent=encodeURIComponent(module_content[e]),t.push(o),a=!0}return t=a?JSON.stringify(t):null}var isSaveButtonEnabled=!1,mdlnames=[],minbarhtml="",dynele=document.createElement("DIV"),macrodialog=null,runMacroList,xMinVal=0,yMinVal=0,minWidth=0,dlghtml="",module_content=[],callback_load="loadAllMacro",sheetOperations=[],custommdlcnt=0,currentMdl={},macroActionsMenuStatus=!1,errorObj={};errorObj.ISERROR=!1;var MacroPanelState={};MacroPanelState.explorer=!0,MacroPanelState.tabs="",MacroPanelState.find=!1;var gotoform=$("#gotoform"),checkMacroTriggerObj={isMacroTrigger:!1,isAutoSaveForMacro:!1},previousMdl="";
function handleError(e,r,a){if(0==e.ISERROR&&0==msgboxArray.length)return disableError(),void disableMessage();0==e.ISERROR&&disableError(),0==msgboxArray.length&&disableMessage(),"undefined"==typeof r&&(r=!1);var n="";if(0!=msgboxArray.length){clearMessage(),n="[";for(x in msgboxArray)"undefined"!=typeof msgboxArray[x].M&&(1==r?(n+='{"M":"'+encodeURIComponent(escapeSpecialCharacters(msgboxArray[x].M))+'",',n+='"L":"'+msgboxArray[x].L+'",',n+='"MT":"'+msgboxArray[x].MT+'",',n+='"MN":"'+msgboxArray[x].MN+'"},'):insertMessage(msgboxArray[x]));n+="]"}if(1==r){var s="";if(1==e.ISERROR&&(s="error="+encodeURIComponent(e.MESSAGE)+"&moduleName="+e.MODULENAME+"&lineNo="+e.LINE+"&modType="+e.MODULETYPE),""!=n||""!=s){var o=new RequestParameters(ActionConstants.JSP_MACROERROR);o.setParameters(encodeURIComponent(n));var t=new AjaxRequest;t.init("POST",o.getURL(),!0,o.getParametersAsString()),t.addEventListener("onComplete",function(r){var a=jsMsg.Error;e.ISERROR||(a=jsMsg.MessageBox);var n={width:450,title:a};sheetdialog.open(r.responseText,n)}),t.sendRequest()}else 0!=msgboxArray.length&&enableMessage(),"undefined"==typeof a&&(a=!1),1==e.ISERROR?(insertError(e),"undefined"!=typeof e.MODULENAME&&"unknown"!=e.MODULENAME&&loadMacro(e.MODULENAME,e.MODULETYPE,""+e.LINE),enableError(),a&&""==MacroPanelState.tabs||showMacroError()):0!=msgboxArray.length&&(a&&""==MacroPanelState.tabs||showMessage())}}function handleWarningTab(e){var r=getObj("warningtd");r&&(0==e?enableWarning():"none"!=r.style.display&&disableWarning())}var othersheetChanges={},sheetName={},selectedRange=null,chartList,msgboxArray=[],refreshSheet=!1,tileReloaded=!1,enableSaveButtonForMacro=!1;
